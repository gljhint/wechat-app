# å¾®ä¿¡é¡¹ç›®ç®¡ç†ç³»ç»Ÿ

<p align="center">
  <img src="https://img.shields.io/badge/Laravel-10.x-FF2D20?style=flat-square&logo=laravel" alt="Laravel">
  <img src="https://img.shields.io/badge/PHP-8.1+-777BB4?style=flat-square&logo=php" alt="PHP">
  <img src="https://img.shields.io/badge/MySQL-8.0+-4479A1?style=flat-square&logo=mysql" alt="MySQL">
  <img src="https://img.shields.io/badge/License-MIT-green?style=flat-square" alt="License">
</p>

åŸºäº Laravel 10 æ„å»ºçš„å¾®ä¿¡ç®¡ç†ç³»ç»Ÿï¼Œæä¾›æˆå‘˜ç®¡ç†ã€å­¦ä¹ æ‰“å¡ã€ç«¯åˆ°ç«¯åŠ å¯†èŠå¤©ã€åœ¨çº¿ç›´æ’­ã€æ–‡æ¡£åˆ†äº«ç­‰è§£å†³æ–¹æ¡ˆã€‚

é¡¹ç›®è¯´æ˜ï¼šè¯¥é¡¹ç›®ä¼šä½¿ç”¨åˆ°å¾®ä¿¡å…¬ä¼—å·ç™»å½•ï¼Œè€Œä½¿ç”¨å…¬ä¼—å·ç™»å½•åˆè¦æœ‰å·²ç»å¤‡æ¡ˆçš„åŸŸåï¼›æµç¨‹æ˜¯è¿™æ ·çš„ï¼šç”¨æˆ·æ‰“å¼€é¡¹ç›®é¡µé¢ï¼Œä¼šè¦æ±‚å…¬ä¼—å·ç™»å½•ï¼Œåœ¨ç®¡ç†åå°å¯ä»¥çœ‹åˆ°æ‰€æœ‰ç™»å½•çš„ç”¨æˆ·ï¼Œåå°è®¤è¯ç”¨æˆ·èº«ä»½ï¼ˆä¼šç»™åˆ°ç›¸åº”çš„æƒé™ï¼‰ï¼Œæ‰èƒ½æ­£å¸¸è¿›å…¥é¡¹ç›®ï¼Œæ²¡æœ‰è®¤è¯ç”¨æˆ·ä¸€å¾‹ç¦æ­¢è®¿é—®ã€‚è¿™æ ·å¯ä»¥åœ¨å¾®ä¿¡ä¸­æ‰“å¼€é“¾æ¥æ—¶ç³»ç»Ÿè‡ªåŠ¨å®Œæˆç™»å½• + æƒé™è®¤è¯ï¼Œè¿›å…¥é¡µé¢å°±å¯ä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½ï¼Œè€å°‘çš†å¯æ“ä½œï¼Œå­¦ä¹ æˆæœ¬ä½ã€‚

è¦æ³¨æ„çš„æ˜¯ï¼Œè¦æœ‰è®¤è¯çš„å…¬ä¼—å·å’Œå¤‡æ¡ˆçš„åŸŸåï¼Œå…¬ä¼—å·å’ŒåŸŸåï¼ˆå¯ä»¥ä½¿ç”¨äºŒçº§åŸŸåï¼‰ä¸å‘æ•æ„Ÿå†…å®¹ï¼Œè¿™å°±æ˜¯å†…éƒ¨åº”ç”¨ï¼Œå…¬ä¼—å·åªæ˜¯ç”¨æ¥ç™»å½•çš„ï¼Œåˆ«äººä¹Ÿä¸çŸ¥é“å¹²ä»€ä¹ˆï¼Œç›¸å¯¹æ¥è¯´æ˜¯å®‰å…¨çš„ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ” ç«¯åˆ°ç«¯åŠ å¯†èŠå¤©
- **å®Œå…¨éšç§ä¿æŠ¤**ï¼šé‡‡ç”¨ AES-256-CBC åŠ å¯†ï¼Œç®¡ç†å‘˜æ— æ³•æŸ¥çœ‹èŠå¤©å†…å®¹
- **ç§èŠä¸ç¾¤èŠ**ï¼šæ”¯æŒä¸€å¯¹ä¸€ç§èŠå’Œç¾¤ç»„èŠå¤©
- **å¤šåª’ä½“æ¶ˆæ¯**ï¼šæ–‡æœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€æ–‡ä»¶æ”¯æŒ
- **ç¾¤ç»„ç®¡ç†**ï¼šç¾¤åˆ›å»ºã€è§£æ•£ã€é‚€è¯·ã€è¸¢äººã€ç¾¤å¤´åƒè‡ªåŠ¨ç”Ÿæˆ
- **è‡ªåŠ¨æ¸…ç†**ï¼šå¯é…ç½®èŠå¤©è®°å½•ä¿ç•™å¤©æ•°ï¼Œè‡ªåŠ¨æ¸…ç†è¿‡æœŸæ¶ˆæ¯

### ğŸ“– å­¦ä¹ æ‰“å¡ç³»ç»Ÿ
- æ¯æ—¥å­¦ä¹ ä»»åŠ¡å‘å¸ƒï¼ˆè¯»ç» + çµä¿®ï¼‰
- æ‰“å¡è®°å½•ä¸è¡¥æ‰“å¡åŠŸèƒ½
- æ‰“å¡å†å²ç»Ÿè®¡ä¸æŸ¥è¯¢
- ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰æˆå‘˜æ‰“å¡æƒ…å†µ

### ğŸ“º åœ¨çº¿ç›´æ’­ä¼šè®®
- åŸºäº **Cloudflare RealtimeKit** çš„é«˜è´¨é‡éŸ³è§†é¢‘é€šè¯
- æ¨¡ä»¿zoomä¼šè®®
- æƒé™æ§åˆ¶ï¼ˆæŒ‰è§’è‰²æˆæƒï¼‰
- æœ¬åœ°åŒ–ä¼˜åŒ–ï¼ˆä¸­æ–‡è¯­è¨€åŒ… + æœ¬åœ°èµ„æºæ‰˜ç®¡ï¼‰


### ğŸ“ æ–‡æ¡£ç®¡ç†
- æ–‡æ¡£ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆ
- æ ‡ç­¾åˆ†ç±»ç®¡ç†
- åŸºäºè§’è‰²çš„å¯è§æ€§æ§åˆ¶
- Cloudflare R2 å¯¹è±¡å­˜å‚¨ï¼ˆå…¼å®¹ S3ï¼‰

### ğŸ‘¥ å®Œå–„çš„æƒé™ç³»ç»Ÿ
- **6 ç§è§’è‰²**ï¼šç®¡ç†å‘˜ã€æœä¾ç»„ã€æˆå‘˜ç»„ã€å‡†æˆå‘˜ç»„ã€æ…•é“ç»„ã€å¤–æ•™ä¼š
- **åŒç«¯æƒé™åˆ†ç¦»**ï¼šå¾®ä¿¡ç«¯å’Œåå°ç®¡ç†ç«¯ç‹¬ç«‹æƒé™é…ç½®
- **ç»†ç²’åº¦æ§åˆ¶**ï¼šæ”¯æŒåŠŸèƒ½çº§æƒé™ï¼ˆå¦‚ `chat.view`, `live.create`ï¼‰
- **è§’è‰²å¯è§æ€§**ï¼šæ–‡æ¡£ã€ç›´æ’­å¯æŒ‰è§’è‰²è®¾ç½®å¯è§èŒƒå›´

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§
- ç«¯åˆ°ç«¯åŠ å¯†æ¶ˆæ¯å­˜å‚¨
- æƒé™ä¸­é—´ä»¶éªŒè¯
- å¾®ä¿¡ OAuth è®¤è¯
- å¯†é’¥æ´¾ç”Ÿæœºåˆ¶ï¼ˆä» APP_KEY æ´¾ç”Ÿå¯¹è¯å¯†é’¥ï¼‰

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- **PHP** >= 8.1
- **MySQL** >= 8.0
- **Composer** >= 2.0
- **Node.js** >= 16.xï¼ˆç”¨äºç®¡ç†åå°ï¼Œå·²ç»ç¼–è¯‘å¥½ï¼Œå¯ä»¥ä¸ç”¨å®‰è£…ï¼‰
- **å¾®ä¿¡å…¬ä¼—å·**ï¼ˆå·²è®¤è¯ï¼‰
- **Cloudflare R2 è´¦å·**ï¼ˆæˆ–å…¶ä»– S3 å…¼å®¹å­˜å‚¨ï¼‰
- **Cloudflare RealtimeKit è´¦å·**ï¼ˆç”¨äºç›´æ’­åŠŸèƒ½ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/gljhint/wechat-app.git
cd wechat-app
```

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£… PHP ä¾èµ–
composer install

# å®‰è£…å‰ç«¯ä¾èµ– ï¼ˆå¯ä»¥ä¸å®‰è£…ï¼‰
npm install
```

### 3. ç¯å¢ƒé…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç”Ÿæˆåº”ç”¨å¯†é’¥ï¼ˆâš ï¸ é‡è¦ï¼šæ­¤å¯†é’¥ç”¨äºåŠ å¯†èŠå¤©æ¶ˆæ¯ï¼Œä¸€æ—¦ç”Ÿæˆåˆ‡å‹¿ä¿®æ”¹ï¼ï¼‰
php artisan key:generate
```

**ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å¿…è¦å‚æ•°ï¼š**

```env
# åº”ç”¨åŸºç¡€é…ç½®
APP_NAME=æ•™ä¼šç®¡ç†ç³»ç»Ÿ
APP_URL=https://your-domain.com

# æ•°æ®åº“é…ç½®
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=your_database
DB_USERNAME=your_username
DB_PASSWORD=your_password

# å¾®ä¿¡å…¬ä¼—å·é…ç½®
WECHAT_OFFICIAL_ACCOUNT_APPID=your_appid
WECHAT_OFFICIAL_ACCOUNT_SECRET=your_secret
WECHAT_OFFICIAL_ACCOUNT_TOKEN=your_token
WECHAT_OFFICIAL_ACCOUNT_AES_KEY=your_aes_key

# Cloudflare R2 å­˜å‚¨é…ç½®
FILESYSTEM_DISK=r2
R2_ACCESS_KEY_ID=your_r2_access_key
R2_SECRET_ACCESS_KEY=your_r2_secret_key
R2_BUCKET=your_bucket_name
R2_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com
R2_URL=https://your-custom-domain.com

# Cloudflare RealtimeKit ç›´æ’­é…ç½®
CLOUDFLARE_REALTIME_ORG_ID=your_org_id
CLOUDFLARE_REALTIME_API_KEY=your_api_key

# èŠå¤©è®°å½•ä¿ç•™é…ç½®ï¼ˆå¯é€‰ï¼‰
CHAT_RETENTION_DAYS=90  # ä¿ç•™ 90 å¤©ï¼Œè®¾ä¸º 0 æ°¸ä¹…ä¿å­˜
CHAT_AUTO_CLEANUP_ENABLED=true
CHAT_STORAGE_DISK=r2

```

### 4. æ•°æ®åº“è¿ç§»

```bash
# è¿è¡Œè¿ç§»
php artisan migrate

# è¿è¡Œç§å­æ–‡ä»¶ï¼ˆåˆ›å»ºé»˜è®¤è§’è‰²ã€æƒé™å’Œç®¡ç†å‘˜è´¦å·ï¼‰
php artisan db:seed
```
ç™»å½•åå° `https://your-domain.com/admin/login`

**é»˜è®¤ç®¡ç†å‘˜è´¦å·ï¼š**
- ç”¨æˆ·åï¼š`admin`
- å¯†ç ï¼š`admin123456`
- é‚®ç®±ï¼š`admin@example.com`

âš ï¸ **è¯·åœ¨é¦–æ¬¡ç™»å½•åç«‹å³ä¿®æ”¹å¯†ç ï¼**

### 5. æ„å»ºå‰ç«¯èµ„æºï¼ˆå·²ç»ç¼–è¯‘å¥½ï¼Œå¯ä»¥ä¸ç”¨å®‰è£…ï¼‰

```bash
# å¼€å‘æ¨¡å¼ï¼ˆçƒ­é‡è½½ï¼‰
npm run dev

# ç”Ÿäº§æ¨¡å¼ï¼ˆå‹ç¼©ä¼˜åŒ–ï¼‰
npm run build
```

### 6. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
php artisan serve
```

è®¿é—® `http://localhost:8000`

## ğŸ“– è¯¦ç»†æ–‡æ¡£

### æ ¸å¿ƒæ–‡æ¡£
- [å®‰è£…éƒ¨ç½²æŒ‡å—](docs/INSTALLATION.md) - ä»é›¶å¼€å§‹éƒ¨ç½²ç³»ç»Ÿ
- [åŠŸèƒ½è¯´æ˜æ–‡æ¡£](docs/FEATURES.md) - è¯¦ç»†åŠŸèƒ½ä»‹ç»å’Œä½¿ç”¨æŒ‡å—

### æŠ€æœ¯æ–‡æ¡£
- [ç«¯åˆ°ç«¯åŠ å¯†åŸç†](docs/CHAT_ENCRYPTION_README.md) - èŠå¤©åŠ å¯†æŠ€æœ¯è¯¦è§£
- [ç›´æ’­åŠŸèƒ½é›†æˆ](docs/REALTIMEKIT_INTEGRATION.md) - Cloudflare RealtimeKit é›†æˆæŒ‡å—
- [æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½](docs/FILE_UPLOAD_README.md) - æ–‡ä»¶ä¸Šä¼ å®ç°è¯´æ˜

### åŠŸèƒ½æ¨¡å—æ–‡æ¡£
- [å­¦ä¹ ä»»åŠ¡ç³»ç»Ÿ](docs/å­¦ä¹ ä»»åŠ¡ç³»ç»Ÿå®ç°æ–‡æ¡£.md) - æ‰“å¡åŠŸèƒ½å®ç°æ–‡æ¡£
- [æƒé™ç³»ç»Ÿè¯´æ˜](docs/BLADE_PERMISSIONS.md) - æƒé™æ§åˆ¶è¯¦è§£
- [é¢‚ä¸»åœ£è¯—åŠŸèƒ½](docs/SONGS_README.md) - åœ£è¯—æ¨¡å—è¯´æ˜

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯
- **æ¡†æ¶**ï¼šLaravel 10.x
- **æ•°æ®åº“**ï¼šMySQL 8.0+
- **ç¼“å­˜/é˜Ÿåˆ—**ï¼šRedis
- **å¯¹è±¡å­˜å‚¨**ï¼šCloudflare R2ï¼ˆå…¼å®¹ S3 APIï¼‰
- **éŸ³è§†é¢‘**ï¼šCloudflare RealtimeKit

### å‰ç«¯
- **æ¨¡æ¿å¼•æ“**ï¼šBlade
- **UI æ¡†æ¶**ï¼šTailwind CSS + WeUI
- **ç»„ä»¶åº“**ï¼šVue 3 + Headless UI
- **æ„å»ºå·¥å…·**ï¼šVite
- **HTTP å®¢æˆ·ç«¯**ï¼šAxios

### æ ¸å¿ƒä¾èµ–
```json
{
  "overtrue/laravel-wechat": "^7.3",      // å¾®ä¿¡ SDK
  "league/flysystem-aws-s3-v3": "^3.0",   // S3 å­˜å‚¨
  "intervention/image": "^3.11",          // å›¾ç‰‡å¤„ç†
  "@cloudflare/realtimekit": "^1.2.0",    // ç›´æ’­æ ¸å¿ƒ
  "@cloudflare/realtimekit-ui": "^1.0.6"  // ç›´æ’­ UI
}
```

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
weixin-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Console/
â”‚   â”‚   â”œâ”€â”€ Commands/
â”‚   â”‚   â”‚   â””â”€â”€ CleanupChatMessages.php      # èŠå¤©è®°å½•æ¸…ç†å‘½ä»¤
â”‚   â”‚   â””â”€â”€ Kernel.php                       # å®šæ—¶ä»»åŠ¡é…ç½®
â”‚   â”œâ”€â”€ Http/
â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚   â”‚   â”‚   â”œâ”€â”€ Admin/                       # åå°ç®¡ç†æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LiveController.php
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MessageController.php
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â””â”€â”€ WeChat/                      # å¾®ä¿¡ç«¯æ§åˆ¶å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ ChatController.php
â”‚   â”‚   â”‚       â”œâ”€â”€ LiveController.php
â”‚   â”‚   â”‚       â”œâ”€â”€ CheckinController.php
â”‚   â”‚   â”‚       â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ Middleware/
â”‚   â”‚       â”œâ”€â”€ Authenticate.php
â”‚   â”‚       â”œâ”€â”€ CheckUserRole.php            # è§’è‰²éªŒè¯ä¸­é—´ä»¶
â”‚   â”‚       â””â”€â”€ CheckWechatPermission.php    # æƒé™éªŒè¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ Models/                              # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ WechatUser.php
â”‚   â”‚   â”œâ”€â”€ ChatMessage.php
â”‚   â”‚   â”œâ”€â”€ LiveStream.php
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ Services/                            # ä¸šåŠ¡æœåŠ¡å±‚
â”‚       â”œâ”€â”€ CloudflareRealtimeService.php    # ç›´æ’­æœåŠ¡
â”‚       â”œâ”€â”€ ChatEncryptionService.php        # åŠ å¯†æœåŠ¡
â”‚       â””â”€â”€ GroupAvatarService.php           # ç¾¤å¤´åƒç”Ÿæˆ
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ chat.php                             # èŠå¤©é…ç½®
â”‚   â”œâ”€â”€ live.php                             # ç›´æ’­æƒé™é…ç½®
â”‚   â”œâ”€â”€ easywechat.php                       # å¾®ä¿¡é…ç½®
â”‚   â”œâ”€â”€ songs349.php                         # åœ£è¯—é…ç½®
â”‚   â””â”€â”€ ...
â”œâ”€â”€ database/
â”‚   â””â”€â”€ migrations/                          # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”œâ”€â”€ resources/
â”‚   â””â”€â”€ views/
â”‚       â”œâ”€â”€ admin/                           # åå°ç®¡ç†ç•Œé¢
â”‚       â””â”€â”€ wechat/                          # å¾®ä¿¡ç«¯ç•Œé¢
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ web.php                              # å¾®ä¿¡ç«¯è·¯ç”±
â”‚   â””â”€â”€ admin.php                            # åå°ç®¡ç†è·¯ç”±
â””â”€â”€ public/
    â”œâ”€â”€ vendor/realtimekit/                  # æœ¬åœ°åŒ–ç›´æ’­èµ„æº
    â””â”€â”€ ...
```

## âš™ï¸ æ ¸å¿ƒåŠŸèƒ½é…ç½®

### èŠå¤©è®°å½•ä¿ç•™ç­–ç•¥

åœ¨ `config/chat.php` æˆ– `.env` ä¸­é…ç½®ï¼š

```php
// ä¿ç•™ 90 å¤©
CHAT_RETENTION_DAYS=90

// æ°¸ä¹…ä¿å­˜
CHAT_RETENTION_DAYS=0

// å¯ç”¨è‡ªåŠ¨æ¸…ç†
CHAT_AUTO_CLEANUP_ENABLED=true
```

### è§’è‰²æƒé™é…ç½®

ç³»ç»Ÿå†…ç½® 6 ç§è§’è‰²ï¼š

| è§’è‰² | ä»£ç  | æƒé™çº§åˆ« |
|------|------|----------|
| ç®¡ç†å‘˜ | `admin` | æœ€é«˜æƒé™ |
| æœä¾ç»„ | `ministry` | é«˜çº§æƒé™ |
| æˆå‘˜ç»„ | `member` | æ ‡å‡†æƒé™ |
| å‡†æˆå‘˜ç»„ | `pre_member` | å—é™æƒé™ |
| æ…•é“ç»„ | `seeker` | åŸºç¡€æƒé™ |
| å¤–æ•™ä¼š | `external` | åŸºç¡€æƒé™ |


## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æ•°æ®åº“è¿ç§»
php artisan migrate

# æ¸…ç†èŠå¤©è®°å½•ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰
php artisan chat:cleanup-messages

# æŸ¥çœ‹é˜Ÿåˆ—ä»»åŠ¡
php artisan queue:work

# æ¸…é™¤ç¼“å­˜
php artisan cache:clear
php artisan config:clear
php artisan view:clear

# é‡æ–°æ„å»ºå‰ç«¯èµ„æº
npm run build
```

## âš ï¸ é‡è¦å®‰å…¨æç¤º

### 1. APP_KEY å¤‡ä»½
ç«¯åˆ°ç«¯åŠ å¯†ä¾èµ– `APP_KEY` æ´¾ç”Ÿå¯†é’¥ï¼Œ**APP_KEY ä¸€æ—¦ä¸¢å¤±æˆ–å˜æ›´ï¼Œæ‰€æœ‰å†å²åŠ å¯†æ¶ˆæ¯å°†æ°¸ä¹…æ— æ³•è§£å¯†ï¼**

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºã€‚

## ğŸ™ è‡´è°¢

- [Laravel](https://laravel.com/) - ä¼˜é›…çš„ PHP æ¡†æ¶
- [EasyWeChat](https://easywechat.com/) - å¾®ä¿¡ SDK
- [Cloudflare RealtimeKit](https://realtime.cloudflare.com/) - éŸ³è§†é¢‘æœåŠ¡
- [Tailwind CSS](https://tailwindcss.com/) - CSS æ¡†æ¶
- [WeUI](https://weui.io/) - å¾®ä¿¡å®˜æ–¹ UI åº“

## ğŸ“§ è”ç³»æ–¹å¼

- Email: gljhint@gmail.com

---

