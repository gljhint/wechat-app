import{r as t,c as i,h as s,H as e,a}from"./p-0ee570cd.js";import{e as h,h as n,c,L as o}from"./p-3c9aa206.js";import{l as r,R as d}from"./p-c8eaa707.js";import{f as l,s as f}from"./p-338c7261.js";import{c as p,b,o as v,s as k,h as u}from"./p-769bb885.js";import{S as m}from"./p-e51bb952.js";import{d as g}from"./p-203a6c0b.js";var y=function(t,i,s,e){var a,h=arguments.length,n=h<3?i:null===e?e=Object.getOwnPropertyDescriptor(i,s):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,i,s,e);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(n=(h<3?a(n):h>3?a(i,s,n):a(i,s))||n);return h>3&&n&&Object.defineProperty(i,s,n),n};const x=class{constructor(s){t(this,s),this.rtkSendNotification=i(this,"rtkSendNotification",7),this.pinnedListener=({isPinned:t})=>{this.isPinned=t},this.toggleTileListener=({hidden:t})=>{this.isHidden=t},this.stageListener=({stageStatus:t})=>{this.isOnStage="ON_STAGE"===t},this.view="sidebar",this.iconPack=h,this.t=n(),this.config=c(),this.audioEnabled=!1,this.videoEnabled=!1,this.isPinned=!1,this.isHidden=!1,this.isOnStage=!1,this.canDisableParticipantAudio=!1,this.canDisableParticipantVideo=!1,this.canKickParticipant=!1,this.canPinParticipant=!1,this.canAllowParticipantOnStage=!1,this.menuOpen=!1,this.permissionsUpdateListener=()=>{this.meetingChanged(this.meeting)},this.inviteToStageToggle=async()=>{const t=this.participant,{stage:i}=this.meeting;"ACCEPTED_TO_JOIN_STAGE"!==t.stageStatus?(this.isOnStage?(t.isPinned&&t.unpin(),await i.kick([t.userId])):(await i.grantAccess([t.userId]),this.rtkSendNotification.emit({message:`${t.name} ${this.t("stage.invited_notification")}`,trace:`join-stage-invite-${t.id}`})),this.isOnStage="ON_STAGE"===t.stageStatus):this.rtkSendNotification.emit({message:`${t.name} ${this.t("stage.invited_notification")}`,trace:`join-stage-${t.id}`})},this.handleOutsideClick=t=>{!t.composedPath().includes(this.host)&&this.menuOpen&&(this.menuOpen=!1)},this.update=()=>{const t=this.host.shadowRoot.getElementById("trigger"),i=this.host.shadowRoot.getElementById("menu-list");p(t,i,{placement:"bottom-end",middleware:[b({allowedPlacements:["bottom-end","top-end"],alignment:"end"}),v(4),k({padding:8}),u()]}).then((({x:t,y:s,placement:e})=>{let a=null;a="bottom-end"===e?{right:`${t}px`,top:`${s}px`}:{right:`${t}px`,bottom:`${s}px`},Object.assign(i.style,a)}))},this.onMenuToggle=()=>{this.menuOpen=!this.menuOpen,this.menuOpen&&this.update()}}connectedCallback(){this.meetingChanged(this.meeting),this.participantChanged(this.participant),document.addEventListener("click",this.handleOutsideClick)}disconnectedCallback(){var t;document.removeEventListener("click",this.handleOutsideClick),null===(t=this.meeting)||void 0===t||t.self.permissions.removeListener("permissionsUpdate",this.permissionsUpdateListener),null!=this.participant&&null!=this.participant.removeListener&&(this.audioUpdateListener&&this.participant.removeListener("audioUpdate",this.audioUpdateListener),this.videoUpdateListener&&this.participant.removeListener("videoUpdate",this.videoUpdateListener),this.participant.removeListener("pinned",this.pinnedListener),this.participant.removeListener("unpinned",this.pinnedListener),this.participant.removeListener("stageStatusUpdate",this.stageListener),this.participant.removeListener("toggleTile",this.toggleTileListener))}meetingChanged(t){var i,s,e,a,h,n,c;if(null!=t){const{self:r}=t;this.canDisableParticipantAudio=r.permissions.canAllowParticipantAudio||r.permissions.canDisableParticipantAudio,this.canDisableParticipantVideo=r.permissions.canAllowParticipantVideo||r.permissions.canDisableParticipantVideo,this.canKickParticipant=r.permissions.kickParticipant&&!0!==(null===(i=this.meeting)||void 0===i?void 0:i.__internals__.features.hasFeature(o.DISABLE_KICKING))&&(!0!==(null===(s=this.meeting)||void 0===s?void 0:s.__internals__.features.hasFeature(o.ADMIN_CANTREMOVE_ADMIN))||"webinar_admin"!==(null===(e=this.participant)||void 0===e?void 0:e.presetName)),this.canPinParticipant=r.permissions.pinParticipant,this.canAllowParticipantOnStage=r.permissions.acceptStageRequests&&r.permissions.stageEnabled&&(!0!==(null===(a=this.meeting)||void 0===a?void 0:a.__internals__.features.hasFeature(o.ADMIN_CANTREMOVE_ADMIN))||"webinar_admin"!==(null===(h=this.participant)||void 0===h?void 0:h.presetName))&&(!0!==(null===(n=this.meeting)||void 0===n?void 0:n.__internals__.features.hasFeature(o.CANTINVITE_VIEWER))||"webinar_viewer"!==(null===(c=this.participant)||void 0===c?void 0:c.presetName)),t.self.permissions.addListener("permissionsUpdate",this.permissionsUpdateListener)}}participantChanged(t){var i;if(null!=t){if(this.audioEnabled=t.audioEnabled,this.videoEnabled=t.videoEnabled,this.isPinned=t.isPinned,this.isHidden=null!==(i=t.hidden)&&void 0!==i&&i,this.isOnStage="ON_STAGE"===t.stageStatus,this.audioUpdateListener=({audioEnabled:t})=>{this.audioEnabled=t},this.videoUpdateListener=({videoEnabled:t})=>{this.videoEnabled=t},null==t.addListener)return;t.addListener("audioUpdate",this.audioUpdateListener),t.addListener("videoUpdate",this.videoUpdateListener),t.addListener("pinned",this.pinnedListener),t.addListener("unpinned",this.pinnedListener),t.addListener("stageStatusUpdate",this.stageListener),this.participant.addListener("toggleTile",this.toggleTileListener)}}render(){var t,i,a,h,n,c,o,p,b;const v="AUDIO_ROOM"===(null===(t=this.meeting)||void 0===t?void 0:t.meta.viewType),k=(null===(i=this.meeting)||void 0===i?void 0:i.self.id)===this.participant.id,u=this.canDisableParticipantAudio&&this.audioEnabled||this.canDisableParticipantVideo&&this.videoEnabled&&!v||this.canKickParticipant||this.canPinParticipant&&this.isOnStage||this.canAllowParticipantOnStage,m=l((null===(a=this.participant)||void 0===a?void 0:a.name)||""),g=this.isOnStage||["GROUP_CALL","AUDIO_ROOM"].includes(null===(h=this.meeting)||void 0===h?void 0:h.meta.viewType),y={meeting:this.meeting,size:"sm",states:this.states,config:this.config,iconPack:this.iconPack,t:this.t};return s(e,{key:"804f9c2daf473fd518c6697a51b82f5baf63fb17"},s("div",{class:"left",key:null===(n=this.participant)||void 0===n?void 0:n.id},s("rtk-avatar",{key:"98f6f1a031269f5ca6523ed38228bcb64a3fe97d",participant:this.participant,size:"sm",iconPack:this.iconPack,t:this.t}),s("p",{key:"de05ef0806cb0e614bae951715ec263cb2271492",class:"name",title:m},f(m,16)," ",(null===(c=this.meeting)||void 0===c?void 0:c.self.id)===(null===(o=this.participant)||void 0===o?void 0:o.id)&&this.t("(you)"))),"sidebar"===this.view&&s("div",{key:"8393d899384cac8ff0e248a76f4095922f98e1cb",class:"right"},g&&s("rtk-icon",{key:"7b99b6269a101d01a8014dc4038b6bcada21203f",class:{red:!this.audioEnabled},icon:this.audioEnabled?this.iconPack.mic_on:this.iconPack.mic_off}),g&&!v&&s("rtk-icon",{key:"e6e7d7e8a50a9ad0be657b85245252300182c539",class:{red:!this.videoEnabled},icon:this.videoEnabled?this.iconPack.video_on:this.iconPack.video_off}),(u||r({element:"rtk-participant",defaults:y,childProps:{participant:this.participant}})>0)&&s("div",{key:"085e0ffe3c230ef1f21ed5de6c11ef70ccfeb69b",class:"menu"},s("span",{key:"ab295b485204509824a6bce511a80ec939e31fbb",id:"trigger",onClick:this.onMenuToggle},s("rtk-button",{key:"0f0cb35c69e63ba8d8b3835cec42aba9f65dc6b8",variant:"ghost",kind:"icon",slot:"trigger"},s("rtk-icon",{key:"ebd5705879751573de28ddad204d8f16b055a2b9",class:"more",icon:this.iconPack.more_vertical}))),s("span",{key:"98ec81219c735d44ba36eb2e677b734cc43e478d",id:"menu-list"},this.menuOpen&&s("rtk-menu-list",{key:"243c43eacd1c429f4c7bd2fcd24fef3983209226",iconPack:this.iconPack,t:this.t},this.canPinParticipant&&g&&!v&&s("rtk-menu-item",{key:"93b74a42b5b37fe15bcbe7a5217258c8cb2b48b9",onClick:()=>{this.isPinned?this.participant.unpin():this.participant.pin()},iconPack:this.iconPack,t:this.t},s("rtk-icon",{key:"0c1c8f6cc7b10c2fdea37f79ad0fc00cbb50f1d6",icon:this.isPinned?this.iconPack.pin_off:this.iconPack.pin,slot:"start"}),this.t(this.isPinned?"unpin":"pin")),k&&s("rtk-menu-item",{key:"dd4d5dff2c77f93a233a5f565d9d64fddb660c0d",iconPack:this.iconPack,t:this.t,onClick:()=>{this.isHidden?this.participant.show():this.participant.hide()}},s("rtk-icon",{key:"fdfc1cfeca1b1c63dd27fcc31a658f1d1a8d5c17",icon:this.isHidden?this.iconPack.minimize:this.iconPack.maximize,slot:"start"}),this.t(this.meeting.self.hidden?"maximize":"minimize")),this.canDisableParticipantAudio&&g&&this.audioEnabled&&s("rtk-menu-item",{key:"95edf3439889a9c468acce8ef88ababef747e018",iconPack:this.iconPack,t:this.t,onClick:()=>{this.participant.disableAudio()}},s("rtk-icon",{key:"1df60ff6541717369a5c8c1fa47dcb09e2499f8d",icon:this.iconPack.mic_off,slot:"start"}),this.t("mute")),this.canDisableParticipantVideo&&g&&this.videoEnabled&&s("rtk-menu-item",{key:"e3812a8631be2f84695b90ac80f0214a26495071",iconPack:this.iconPack,t:this.t,onClick:()=>{this.participant.disableVideo()}},s("rtk-icon",{key:"634c9c452ecd36d6c024cbb0e22a79059f4b85a6",icon:this.iconPack.video_off,slot:"start"}),this.t("participants.turn_off_video")),this.canAllowParticipantOnStage&&(null===(p=this.participant)||void 0===p?void 0:p.id)!==(null===(b=this.meeting)||void 0===b?void 0:b.self.id)&&s("rtk-menu-item",{key:"3428e0c1d22f675bbec3a920670a26dd3c7c66e5",iconPack:this.iconPack,t:this.t,class:this.isOnStage?"red":"",onClick:this.inviteToStageToggle},s("rtk-icon",{key:"55cdf3825acd959945ce82b19fd69f36e26aa476",icon:this.isOnStage?this.iconPack.leave_stage:this.iconPack.join_stage,slot:"start"}),this.t(this.isOnStage?"stage.remove_from_stage":"stage.add_to_stage")),!k&&this.canKickParticipant&&s("rtk-menu-item",{key:"affe710adb04e305b6a46b9de2d25984d6c075d6",iconPack:this.iconPack,t:this.t,class:"red",onClick:()=>{var t,i;null===(t=this.meeting)||void 0===t||t.participants.kick(null===(i=this.participant)||void 0===i?void 0:i.id)}},s("rtk-icon",{key:"d9c55c666231f76f00dd68ce0e2bedd92462ef89",icon:this.iconPack.dismiss,slot:"start"}),this.t("kick")),s("slot",{key:"7017ef52152b1908e93ce539f762120425e50562"},s(d,{key:"28c3eacd6a4572c806748a7d09a861f000430b90",element:"rtk-participant",defaults:y,childProps:{participant:this.participant},deepProps:!0,onlyChildren:!0})))))))}get host(){return a(this)}static get watchers(){return{meeting:["meetingChanged"],participant:["participantChanged"]}}};y([m()],x.prototype,"meeting",void 0),y([m()],x.prototype,"states",void 0),y([m()],x.prototype,"iconPack",void 0),y([m()],x.prototype,"t",void 0),y([m()],x.prototype,"config",void 0),x.style=":host{line-height:initial;font-family:var(--rtk-font-family, sans-serif);font-feature-settings:normal;font-variation-settings:normal}p{margin:var(--rtk-space-0, 0px);padding:var(--rtk-space-0, 0px)}:host{position:relative;display:flex;height:var(--rtk-space-14, 56px);align-items:center;justify-content:space-between;cursor:pointer;color:rgb(var(--rtk-colors-text-1000, 255 255 255))}:host rtk-avatar{height:var(--rtk-space-8, 32px);width:var(--rtk-space-8, 32px);font-size:14px}.left{display:flex;align-items:center}.left>*{margin-right:var(--rtk-space-2, 8px)}.left>*:last-child{margin-right:var(--rtk-space-0, 0px)}.right{display:flex;align-items:center;justify-content:flex-end}.right>*{margin-left:var(--rtk-space-2, 8px)}.right>*:first-child{margin-left:var(--rtk-space-0, 0px)}.name{overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1}rtk-icon{height:var(--rtk-space-6, 24px);width:var(--rtk-space-6, 24px)}rtk-icon.red{--tw-text-opacity:1;color:rgba(var(--rtk-colors-danger, 255 45 45) / var(--tw-text-opacity))}rtk-icon.more{cursor:pointer}.menu{position:relative;display:inline-block;color:rgb(var(--rtk-colors-text-1000, 255 255 255))}#menu-list{position:absolute;z-index:20}";const w=class{constructor(i){t(this,i),this.items=[],this.itemHeight=55,this.bufferedItemsCount=5,this.emptyListElement=null,this.visibleStart=0,this.visibleEnd=0,this.containerHeight=0,this.lastScrollTop=0,this.recalculatePositioning=()=>{this.updateContainerHeight(),requestAnimationFrame((()=>{this.updateItemHeight()}))},this.updateContainerHeight=()=>{this.el.querySelector(".virtual-list-container").clientHeight&&(requestAnimationFrame((()=>{this.updateItemHeight()})),this.containerHeight=this.el.querySelector(".virtual-list-container").clientHeight,this.updateVisibleRange())},this.onScroll=g((()=>{const t=this.el.querySelector(".virtual-list-container").scrollTop;t>this.lastScrollTop&&this.visibleEnd===this.items.length||(this.lastScrollTop=t,this.updateVisibleRange())}))}itemsChanged(){this.recalculatePositioning()}componentDidLoad(){this.recalculatePositioning(),this.el.querySelector(".virtual-list-container").addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.recalculatePositioning)}componentDidUpdate(){this.updateItemHeight()}disconnectedCallback(){this.el.querySelector(".virtual-list-container").removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.recalculatePositioning)}updateVisibleRange(){const t=this.el.querySelector(".virtual-list-container").scrollTop,i=Math.floor(t/this.itemHeight),s=Math.ceil(this.containerHeight/this.itemHeight),e=Math.min(this.items.length,i+s+this.bufferedItemsCount);this.visibleStart=i,this.visibleEnd=e,this.el.querySelector(".virtual-list-container").scrollTop=this.lastScrollTop}updateItemHeight(){const t=this.el.querySelector(".virtual-list-item");if(t){const i=t.style.height;t.style.height="auto";const s=t.getBoundingClientRect().height;i&&(t.style.height=i),s&&Math.floor(s)!==Math.floor(this.itemHeight)&&(this.itemHeight=s)}}renderItems(){return this.items.slice(this.visibleStart,this.visibleEnd).map(((t,i)=>{const e=this.visibleStart+i;return s("div",{class:"virtual-list-item",key:t.id,style:{position:"absolute",top:e*this.itemHeight+"px",height:`${this.itemHeight}px`,width:"100%"}},this.renderItem(t,e))}))}render(){var t;return s("div",{key:"8928758911fd6ac3b955e727306f1ebfe19aba9b",class:"virtual-list-container",style:{position:"relative",height:"100%",overflowX:"hidden",overflowY:"auto"}},s("div",{key:"4812952f05b7cbcb920cf5bfe54cd30c26cb8b0d",style:{height:this.items.length*this.itemHeight+"px",position:"relative"}},(null===(t=this.items)||void 0===t?void 0:t.length)?this.renderItems():this.emptyListElement),s("div",{key:"0f9cd358e2d49af44765dbe560a323c9e8fa09f7",style:{height:`${this.itemHeight}px`}}))}get el(){return a(this)}static get watchers(){return{items:["itemsChanged"]}}};w.style=":host{height:100%;width:100%}";export{x as rtk_participant,w as rtk_virtualized_participant_list}