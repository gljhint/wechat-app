import { v4 as Js, validate as Mv } from "uuid";
import _v from "bowser";
import { MessageType as M, PbLong as Jo, typeofJsonValue as mm } from "@protobuf-ts/runtime";
import * as Ml from "worker-timers";
import * as Dn from "sdp-transform";
var Zg = ["id"], xg = ["chat", "connectedMeetings", "plugins", "polls", "media"], em = ["id"], rm = ["meetingId"], cn, Xa, z, Jn, $e, Kn, oa, Fl, io, dn, Hl, pl, Za, xa, So, pn, ei, zn, Ti, so, Yn, oo, uo, hn, ri, Ir, Ye, Mr, ti, ni, At, ai, vn, ii, Hr, si, Zr, wi, oi, ui, li, Br, Ie, ci, di, Dr, Qn, bn, Xn, hl, It, lo, mn, Zn, Mt, vl, co, fl, gl, ke, po, xn, pi, ea, br, qr, xr, hi, vi, or, fi, Ne, _t, Ve, gi, Me, Pi, Si, ho, kp, Vc, Eo, Co, Qe, W, Ei, ur, ua, la, ra, vo, Wr, Ot, js, ta, na, pr, Tr, fn, ml, Bl, ql, Ro, Gl, Wl, Jl, Kl, Ge, aa, yl, kl, bl, ia, et, X, lr, gn, Te, we, Gr, We, fo, go, ve, Ue, sa;
function lc(o, t) {
  if (o == null)
    return {};
  var e, r, n = tm(o, t);
  if (Object.getOwnPropertySymbols) {
    var a = Object.getOwnPropertySymbols(o);
    for (r = 0; r < a.length; r++)
      e = a[r], t.indexOf(e) === -1 && {}.propertyIsEnumerable.call(o, e) && (n[e] = o[e]);
  }
  return n;
}
function tm(o, t) {
  if (o == null)
    return {};
  var e = {};
  for (var r in o)
    if ({}.hasOwnProperty.call(o, r)) {
      if (t.indexOf(r) !== -1)
        continue;
      e[r] = o[r];
    }
  return e;
}
function Gs(o) {
  var t = typeof Map == "function" ? /* @__PURE__ */ new Map() : void 0;
  return Gs = function(r) {
    if (r === null || !am(r))
      return r;
    if (typeof r != "function")
      throw new TypeError("Super expression must either be null or a function");
    if (t !== void 0) {
      if (t.has(r))
        return t.get(r);
      t.set(r, n);
    }
    function n() {
      return nm(r, arguments, Ws(this).constructor);
    }
    return n.prototype = Object.create(r.prototype, { constructor: { value: n, enumerable: !1, writable: !0, configurable: !0 } }), Wu(n, r);
  }, Gs(o);
}
function nm(o, t, e) {
  if (Tp())
    return Reflect.construct.apply(null, arguments);
  var r = [null];
  r.push.apply(r, t);
  var n = new (o.bind.apply(o, r))();
  return e && Wu(n, e.prototype), n;
}
function am(o) {
  try {
    return Function.toString.call(o).indexOf("[native code]") !== -1;
  } catch (t) {
    return typeof o == "function";
  }
}
function l(o, t) {
  if (!{}.hasOwnProperty.call(o, t))
    throw new TypeError("attempted to use private field on non-instance");
  return o;
}
var im = 0;
function S(o) {
  return "__private_" + im++ + "_" + o;
}
function Se(o) {
  return um(o) || om(o) || bp(o) || sm();
}
function sm() {
  throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);
}
function om(o) {
  if (typeof Symbol != "undefined" && o[Symbol.iterator] != null || o["@@iterator"] != null)
    return Array.from(o);
}
function um(o) {
  if (Array.isArray(o))
    return gd(o);
}
function xp(o, t) {
  var e = Object.keys(o);
  if (Object.getOwnPropertySymbols) {
    var r = Object.getOwnPropertySymbols(o);
    t && (r = r.filter(function(n) {
      return Object.getOwnPropertyDescriptor(o, n).enumerable;
    })), e.push.apply(e, r);
  }
  return e;
}
function $(o) {
  for (var t = 1; t < arguments.length; t++) {
    var e = arguments[t] != null ? arguments[t] : {};
    t % 2 ? xp(Object(e), !0).forEach(function(r) {
      lm(o, r, e[r]);
    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(o, Object.getOwnPropertyDescriptors(e)) : xp(Object(e)).forEach(function(r) {
      Object.defineProperty(o, r, Object.getOwnPropertyDescriptor(e, r));
    });
  }
  return o;
}
function lm(o, t, e) {
  return (t = Iv(t)) in o ? Object.defineProperty(o, t, { value: e, enumerable: !0, configurable: !0, writable: !0 }) : o[t] = e, o;
}
function Fn(o, t) {
  var e = typeof Symbol != "undefined" && o[Symbol.iterator] || o["@@iterator"];
  if (!e) {
    if (Array.isArray(o) || (e = bp(o)) || t && o && typeof o.length == "number") {
      e && (o = e);
      var r = 0, n = function() {
      };
      return { s: n, n: function() {
        return r >= o.length ? { done: !0 } : { done: !1, value: o[r++] };
      }, e: function(c) {
        throw c;
      }, f: n };
    }
    throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);
  }
  var a, i = !0, s = !1;
  return { s: function() {
    e = e.call(o);
  }, n: function() {
    var c = e.next();
    return i = c.done, c;
  }, e: function(c) {
    s = !0, a = c;
  }, f: function() {
    try {
      i || e.return == null || e.return();
    } finally {
      if (s)
        throw a;
    }
  } };
}
function Re(o, t, e, r) {
  var n = fd(Ws(1 & r ? o.prototype : o), t, e);
  return 2 & r && typeof n == "function" ? function(a) {
    return n.apply(e, a);
  } : n;
}
function fd() {
  return fd = typeof Reflect != "undefined" && Reflect.get ? Reflect.get.bind() : function(o, t, e) {
    var r = cm(o, t);
    if (r) {
      var n = Object.getOwnPropertyDescriptor(r, t);
      return n.get ? n.get.call(arguments.length < 3 ? o : e) : n.value;
    }
  }, fd.apply(null, arguments);
}
function cm(o, t) {
  for (; !{}.hasOwnProperty.call(o, t) && (o = Ws(o)) !== null; )
    ;
  return o;
}
function He(o, t) {
  return hm(o) || pm(o, t) || bp(o, t) || dm();
}
function dm() {
  throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);
}
function bp(o, t) {
  if (o) {
    if (typeof o == "string")
      return gd(o, t);
    var e = {}.toString.call(o).slice(8, -1);
    return e === "Object" && o.constructor && (e = o.constructor.name), e === "Map" || e === "Set" ? Array.from(o) : e === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e) ? gd(o, t) : void 0;
  }
}
function gd(o, t) {
  (t == null || t > o.length) && (t = o.length);
  for (var e = 0, r = Array(t); e < t; e++)
    r[e] = o[e];
  return r;
}
function pm(o, t) {
  var e = o == null ? null : typeof Symbol != "undefined" && o[Symbol.iterator] || o["@@iterator"];
  if (e != null) {
    var r, n, a, i, s = [], u = !0, c = !1;
    try {
      if (a = (e = e.call(o)).next, t === 0) {
        if (Object(e) !== e)
          return;
        u = !1;
      } else
        for (; !(u = (r = a.call(e)).done) && (s.push(r.value), s.length !== t); u = !0)
          ;
    } catch (d) {
      c = !0, n = d;
    } finally {
      try {
        if (!u && e.return != null && (i = e.return(), Object(i) !== i))
          return;
      } finally {
        if (c)
          throw n;
      }
    }
    return s;
  }
}
function hm(o) {
  if (Array.isArray(o))
    return o;
}
function p() {
  "use strict";
  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
  p = function() {
    return t;
  };
  var o, t = {}, e = Object.prototype, r = e.hasOwnProperty, n = typeof Symbol == "function" ? Symbol : {}, a = n.iterator || "@@iterator", i = n.asyncIterator || "@@asyncIterator", s = n.toStringTag || "@@toStringTag";
  function u(N, L, H, Q) {
    return Object.defineProperty(N, L, { value: H, enumerable: !Q, configurable: !Q, writable: !Q });
  }
  try {
    u({}, "");
  } catch (N) {
    u = function(H, Q, B) {
      return H[Q] = B;
    };
  }
  function c(N, L, H, Q) {
    var B = L && L.prototype instanceof v ? L : v, G = Object.create(B.prototype);
    return u(G, "_invoke", function(x, Pe, ie) {
      var le = 1;
      return function(Fr, Z) {
        if (le === 3)
          throw Error("Generator is already running");
        if (le === 4) {
          if (Fr === "throw")
            throw Z;
          return { value: o, done: !0 };
        }
        for (ie.method = Fr, ie.arg = Z; ; ) {
          var Lr = ie.delegate;
          if (Lr) {
            var ln = D(Lr, ie);
            if (ln) {
              if (ln === h)
                continue;
              return ln;
            }
          }
          if (ie.method === "next")
            ie.sent = ie._sent = ie.arg;
          else if (ie.method === "throw") {
            if (le === 1)
              throw le = 4, ie.arg;
            ie.dispatchException(ie.arg);
          } else
            ie.method === "return" && ie.abrupt("return", ie.arg);
          le = 3;
          var gt = d(x, Pe, ie);
          if (gt.type === "normal") {
            if (le = ie.done ? 4 : 2, gt.arg === h)
              continue;
            return { value: gt.arg, done: ie.done };
          }
          gt.type === "throw" && (le = 4, ie.method = "throw", ie.arg = gt.arg);
        }
      };
    }(N, H, new V(Q || [])), !0), G;
  }
  function d(N, L, H) {
    try {
      return { type: "normal", arg: N.call(L, H) };
    } catch (Q) {
      return { type: "throw", arg: Q };
    }
  }
  t.wrap = c;
  var h = {};
  function v() {
  }
  function f() {
  }
  function g() {
  }
  var k = {};
  u(k, a, function() {
    return this;
  });
  var y = Object.getPrototypeOf, b = y && y(y(F([])));
  b && b !== e && r.call(b, a) && (k = b);
  var C = g.prototype = v.prototype = Object.create(k);
  function T(N) {
    ["next", "throw", "return"].forEach(function(L) {
      u(N, L, function(H) {
        return this._invoke(L, H);
      });
    });
  }
  function E(N, L) {
    function H(B, G, x, Pe) {
      var ie = d(N[B], N, G);
      if (ie.type !== "throw") {
        var le = ie.arg, Fr = le.value;
        return Fr && be(Fr) == "object" && r.call(Fr, "__await") ? L.resolve(Fr.__await).then(function(Z) {
          H("next", Z, x, Pe);
        }, function(Z) {
          H("throw", Z, x, Pe);
        }) : L.resolve(Fr).then(function(Z) {
          le.value = Z, x(le);
        }, function(Z) {
          return H("throw", Z, x, Pe);
        });
      }
      Pe(ie.arg);
    }
    var Q;
    u(this, "_invoke", function(B, G) {
      function x() {
        return new L(function(Pe, ie) {
          H(B, G, Pe, ie);
        });
      }
      return Q = Q ? Q.then(x, x) : x();
    }, !0);
  }
  function D(N, L) {
    var H = L.method, Q = N.i[H];
    if (Q === o)
      return L.delegate = null, H === "throw" && N.i.return && (L.method = "return", L.arg = o, D(N, L), L.method === "throw") || H !== "return" && (L.method = "throw", L.arg = new TypeError("The iterator does not provide a '" + H + "' method")), h;
    var B = d(Q, N.i, L.arg);
    if (B.type === "throw")
      return L.method = "throw", L.arg = B.arg, L.delegate = null, h;
    var G = B.arg;
    return G ? G.done ? (L[N.r] = G.value, L.next = N.n, L.method !== "return" && (L.method = "next", L.arg = o), L.delegate = null, h) : G : (L.method = "throw", L.arg = new TypeError("iterator result is not an object"), L.delegate = null, h);
  }
  function I(N) {
    this.tryEntries.push(N);
  }
  function _(N) {
    var L = N[4] || {};
    L.type = "normal", L.arg = o, N[4] = L;
  }
  function V(N) {
    this.tryEntries = [[-1]], N.forEach(I, this), this.reset(!0);
  }
  function F(N) {
    if (N != null) {
      var L = N[a];
      if (L)
        return L.call(N);
      if (typeof N.next == "function")
        return N;
      if (!isNaN(N.length)) {
        var H = -1, Q = function B() {
          for (; ++H < N.length; )
            if (r.call(N, H))
              return B.value = N[H], B.done = !1, B;
          return B.value = o, B.done = !0, B;
        };
        return Q.next = Q;
      }
    }
    throw new TypeError(be(N) + " is not iterable");
  }
  return f.prototype = g, u(C, "constructor", g), u(g, "constructor", f), f.displayName = u(g, s, "GeneratorFunction"), t.isGeneratorFunction = function(N) {
    var L = typeof N == "function" && N.constructor;
    return !!L && (L === f || (L.displayName || L.name) === "GeneratorFunction");
  }, t.mark = function(N) {
    return Object.setPrototypeOf ? Object.setPrototypeOf(N, g) : (N.__proto__ = g, u(N, s, "GeneratorFunction")), N.prototype = Object.create(C), N;
  }, t.awrap = function(N) {
    return { __await: N };
  }, T(E.prototype), u(E.prototype, i, function() {
    return this;
  }), t.AsyncIterator = E, t.async = function(N, L, H, Q, B) {
    B === void 0 && (B = Promise);
    var G = new E(c(N, L, H, Q), B);
    return t.isGeneratorFunction(L) ? G : G.next().then(function(x) {
      return x.done ? x.value : G.next();
    });
  }, T(C), u(C, s, "Generator"), u(C, a, function() {
    return this;
  }), u(C, "toString", function() {
    return "[object Generator]";
  }), t.keys = function(N) {
    var L = Object(N), H = [];
    for (var Q in L)
      H.unshift(Q);
    return function B() {
      for (; H.length; )
        if ((Q = H.pop()) in L)
          return B.value = Q, B.done = !1, B;
      return B.done = !0, B;
    };
  }, t.values = F, V.prototype = { constructor: V, reset: function(L) {
    if (this.prev = this.next = 0, this.sent = this._sent = o, this.done = !1, this.delegate = null, this.method = "next", this.arg = o, this.tryEntries.forEach(_), !L)
      for (var H in this)
        H.charAt(0) === "t" && r.call(this, H) && !isNaN(+H.slice(1)) && (this[H] = o);
  }, stop: function() {
    this.done = !0;
    var L = this.tryEntries[0][4];
    if (L.type === "throw")
      throw L.arg;
    return this.rval;
  }, dispatchException: function(L) {
    if (this.done)
      throw L;
    var H = this;
    function Q(Fr) {
      x.type = "throw", x.arg = L, H.next = Fr;
    }
    for (var B = H.tryEntries.length - 1; B >= 0; --B) {
      var G = this.tryEntries[B], x = G[4], Pe = this.prev, ie = G[1], le = G[2];
      if (G[0] === -1)
        return Q("end"), !1;
      if (!ie && !le)
        throw Error("try statement without catch or finally");
      if (G[0] != null && G[0] <= Pe) {
        if (Pe < ie)
          return this.method = "next", this.arg = o, Q(ie), !0;
        if (Pe < le)
          return Q(le), !1;
      }
    }
  }, abrupt: function(L, H) {
    for (var Q = this.tryEntries.length - 1; Q >= 0; --Q) {
      var B = this.tryEntries[Q];
      if (B[0] > -1 && B[0] <= this.prev && this.prev < B[2]) {
        var G = B;
        break;
      }
    }
    G && (L === "break" || L === "continue") && G[0] <= H && H <= G[2] && (G = null);
    var x = G ? G[4] : {};
    return x.type = L, x.arg = H, G ? (this.method = "next", this.next = G[2], h) : this.complete(x);
  }, complete: function(L, H) {
    if (L.type === "throw")
      throw L.arg;
    return L.type === "break" || L.type === "continue" ? this.next = L.arg : L.type === "return" ? (this.rval = this.arg = L.arg, this.method = "return", this.next = "end") : L.type === "normal" && H && (this.next = H), h;
  }, finish: function(L) {
    for (var H = this.tryEntries.length - 1; H >= 0; --H) {
      var Q = this.tryEntries[H];
      if (Q[2] === L)
        return this.complete(Q[4], Q[3]), _(Q), h;
    }
  }, catch: function(L) {
    for (var H = this.tryEntries.length - 1; H >= 0; --H) {
      var Q = this.tryEntries[H];
      if (Q[0] === L) {
        var B = Q[4];
        if (B.type === "throw") {
          var G = B.arg;
          _(Q);
        }
        return G;
      }
    }
    throw Error("illegal catch attempt");
  }, delegateYield: function(L, H, Q) {
    return this.delegate = { i: F(L), r: H, n: Q }, this.method === "next" && (this.arg = o), h;
  } }, t;
}
function eh(o, t, e, r, n, a, i) {
  try {
    var s = o[a](i), u = s.value;
  } catch (c) {
    return void e(c);
  }
  s.done ? t(u) : Promise.resolve(u).then(r, n);
}
function m(o) {
  return function() {
    var t = this, e = arguments;
    return new Promise(function(r, n) {
      var a = o.apply(t, e);
      function i(u) {
        eh(a, r, n, i, s, "next", u);
      }
      function s(u) {
        eh(a, r, n, i, s, "throw", u);
      }
      i(void 0);
    });
  };
}
function R(o, t, e) {
  return t = Ws(t), vm(o, Tp() ? Reflect.construct(t, e || [], Ws(o).constructor) : t.apply(o, e));
}
function vm(o, t) {
  if (t && (be(t) == "object" || typeof t == "function"))
    return t;
  if (t !== void 0)
    throw new TypeError("Derived constructors may only return object or undefined");
  return fm(o);
}
function fm(o) {
  if (o === void 0)
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  return o;
}
function Tp() {
  try {
    var o = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function() {
    }));
  } catch (t) {
  }
  return (Tp = function() {
    return !!o;
  })();
}
function Ws(o) {
  return Ws = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function(t) {
    return t.__proto__ || Object.getPrototypeOf(t);
  }, Ws(o);
}
function A(o, t) {
  if (typeof t != "function" && t !== null)
    throw new TypeError("Super expression must either be null or a function");
  o.prototype = Object.create(t && t.prototype, { constructor: { value: o, writable: !0, configurable: !0 } }), Object.defineProperty(o, "prototype", { writable: !1 }), t && Wu(o, t);
}
function Wu(o, t) {
  return Wu = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function(e, r) {
    return e.__proto__ = r, e;
  }, Wu(o, t);
}
function be(o) {
  return be = typeof Symbol == "function" && typeof Symbol.iterator == "symbol" ? function(t) {
    return typeof t;
  } : function(t) {
    return t && typeof Symbol == "function" && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : typeof t;
  }, be(o);
}
function w(o, t) {
  if (!(o instanceof t))
    throw new TypeError("Cannot call a class as a function");
}
function rh(o, t) {
  for (var e = 0; e < t.length; e++) {
    var r = t[e];
    r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(o, Iv(r.key), r);
  }
}
function P(o, t, e) {
  return t && rh(o.prototype, t), e && rh(o, e), Object.defineProperty(o, "prototype", { writable: !1 }), o;
}
function Iv(o) {
  var t = gm(o, "string");
  return be(t) == "symbol" ? t : t + "";
}
function gm(o, t) {
  if (be(o) != "object" || !o)
    return o;
  var e = o[Symbol.toPrimitive];
  if (e !== void 0) {
    var r = e.call(o, t || "default");
    if (be(r) != "object")
      return r;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return (t === "string" ? String : Number)(o);
}
function ym(o) {
  var t = this.length, e = o >= 0 ? o : t + o;
  return e < 0 || e >= t ? void 0 : this[e];
}
Array.prototype.at || Object.assign(Array.prototype, { at: ym });
function km(o) {
  var t = this.length, e = o >= 0 ? o : t + o;
  return e < 0 || e >= t ? void 0 : this[e];
}
String.prototype.at || Object.assign(String.prototype, { at: km });
var bm = function(t) {
  !navigator.isReactNative && typeof window != "undefined" && (window.addEventListener("error", function(e) {
    var r;
    !((r = e.filename) !== null && r !== void 0 && r.includes("localhost")) && e.lineno !== 0 && t.error("window::error", { error: e.error }, !0);
  }), window.addEventListener("unhandledrejection", function(e) {
    var r, n, a, i, s;
    t.error("window::unhandledrejection", {
      error: e == null ? void 0 : e.reason,
      /**
      * NOTE(ravindra-cloudflare):
      * Network calls fail a lot for clients,
      *	tracking more info to see where
      *	*/
      networkCall: { url: e == null || (r = e.reason) === null || r === void 0 || (r = r.config) === null || r === void 0 ? void 0 : r.url, baseURL: e == null || (n = e.reason) === null || n === void 0 || (n = n.config) === null || n === void 0 ? void 0 : n.baseURL, method: e == null || (a = e.reason) === null || a === void 0 || (a = a.config) === null || a === void 0 ? void 0 : a.method, status: e == null || (i = e.reason) === null || i === void 0 ? void 0 : i.status, statusText: e == null || (s = e.reason) === null || s === void 0 ? void 0 : s.statusText }
    }, !0);
  }), window.addEventListener("offline", function() {
    t.info("window::offline");
  }), window.addEventListener("online", function() {
    t.info("window::online");
  }));
}, Ju = "chrome", Ov = "opera", Dv = "firefox", Lv = "iexplorer", $v = "safari", Nv = "nwjs", Vv = "electron", Uv = "react-native", wp = "unknown", zl = { Chrome: Ju, Chromium: Ju, Opera: Ov, Firefox: Dv, "Internet Explorer": Lv, Safari: $v };
function Tm() {
  var o = navigator, t = o.userAgent, e = { name: wp, version: void 0 };
  if (t.match(/Chrome/) && !t.match(/Edge/))
    if (t.match(/Edg(A?)/)) {
      var r = t.match(/Chrome\/([\d.]+)/)[1];
      Number.parseInt(r, 10) > 72 && (e.name = Ju, e.version = r);
    } else
      e.name = Ju, e.version = t.match(/Chrome\/([\d.]+)/)[1];
  return e;
}
function wm() {
  var o = navigator, t = o.userAgent;
  if (t.match(/Electron/)) {
    var e = t.match(/Electron\/([\d.]+)/)[1];
    return { name: Vv, version: e };
  }
  return null;
}
function Pm() {
  var o = navigator, t = o.userAgent;
  if (t.match(/JitsiMeetNW/)) {
    var e = t.match(/JitsiMeetNW\/([\d.]+)/)[1];
    return { name: Nv, version: e };
  }
}
function Sm() {
  var o = navigator.userAgent.match(/\b(react[ \t_-]*native)(?:\/(\S+))?/i), t;
  if (o || navigator.product === "ReactNative")
    return o && o.length > 2 && (o[1], t = o[2]), t || (t = "unknown"), { name: Uv, version: t };
}
function Em(o) {
  for (var t, e = [Sm, wm, Pm], r = 0; r < e.length; r += 1)
    if (t = e[r](), t)
      return t;
  var n = o.getBrowserName();
  return n in zl ? { name: zl[n], version: o.getBrowserVersion() } : (t = Tm(), t || { name: wp, version: void 0 });
}
var Cm = /* @__PURE__ */ function() {
  function o() {
    var t = this;
    w(this, o), this._bowser = void 0, this._name = void 0, this._version = void 0, this.getDeviceInfo = function() {
      return { isMobile: t.isMobile(), browserName: t._bowser.getBrowserName(), osName: t._bowser.getOSName(), browserVersion: t._bowser.getBrowserVersion(), osVersionName: t._bowser.getOSVersion(), engineName: t._bowser.getEngineName() };
    };
  }
  return P(o, [{
    key: "init",
    value: (
      /**
      * Creates new BrowserDetection instance.
      *
      * @param {Object} [browserInfo] - Information about the browser.
      * @param {string} browserInfo.name - The name of the browser.
      * @param {string} browserInfo.version - The version of the browser.
      */
      function(e) {
        var r, n;
        if (this._bowser = _v.getParser(navigator.userAgent), typeof e == "undefined") {
          var a = Em(this._bowser);
          r = a.name, n = a.version;
        } else
          e.name in zl ? (r = zl[e.name], n = e.version) : (r = wp, n = void 0);
        this._name = r, this._version = n;
      }
    )
    /**
    * Gets current browser name.
    * @returns {string}
    */
  }, {
    key: "getName",
    value: function() {
      return this._name;
    }
    /**
    * Checks if current browser is Chrome.
    * @returns {boolean}
    */
  }, {
    key: "isChrome",
    value: function() {
      return this._name === Ju;
    }
    /**
    * Checks if current browser is Opera.
    * @returns {boolean}
    */
  }, {
    key: "isOpera",
    value: function() {
      return this._name === Ov;
    }
    /**
    * Checks if current browser is Firefox.
    * @returns {boolean}
    */
  }, {
    key: "isFirefox",
    value: function() {
      return this._name === Dv;
    }
    /**
    * Checks if current browser is Internet Explorer.
    * @returns {boolean}
    */
  }, {
    key: "isIExplorer",
    value: function() {
      return this._name === Lv;
    }
    /**
    * Checks if current browser is Safari.
    * @returns {boolean}
    */
  }, {
    key: "isSafari",
    value: function() {
      return this._name === $v;
    }
    /**
    * Checks if current environment is NWJS.
    * @returns {boolean}
    */
  }, {
    key: "isNWJS",
    value: function() {
      return this._name === Nv;
    }
    /**
    * Checks if current environment is Electron.
    * @returns {boolean}
    */
  }, {
    key: "isElectron",
    value: function() {
      return this._name === Vv;
    }
    /**
    * Checks if current environment is React Native.
    * @returns {boolean}
    */
  }, {
    key: "isReactNative",
    value: function() {
      return this._name === Uv || navigator.isReactNative === !0;
    }
    /**
    * Returns the version of the current browser.
    * @returns {string}
    */
  }, { key: "getVersion", value: function() {
    return this._version;
  } }, { key: "isMobile", value: function() {
    return this._bowser.getPlatformType() === "mobile";
  } }, {
    key: "_checkCondition",
    value: (
      /**
      * Check if the parsed browser matches the passed condition.
      *
      * @param {Object} checkTree - It's one or two layered object, which can include a
      * platform or an OS on the first layer and should have browsers specs on the
      * bottom layer.
      * Eg. { chrome: '>71.1.0' }
      *		 { windows: { chrome: '<70.2' } }
      * @returns {boolean | undefined} - Returns true if the browser satisfies the set
      * conditions, false if not and undefined when the browser is not defined in the
      * checktree object or when the current browser's version is unknown.
      * @private
      */
      function(e) {
        if (this._version)
          return this._bowser.satisfies(e);
      }
    )
    /**
    * Compares the passed version with the current browser version.
    *
    * @param {*} version - The version to compare with. Anything different
    * than string will be converted to string.
    * @returns {boolean|undefined} - Returns true if the current version is
    * greater than the passed version and false otherwise. Returns undefined if
    * the current browser version is unknown.
    */
  }, {
    key: "isVersionGreaterThan",
    value: function(e) {
      return this._checkCondition({ [this._name]: ">".concat(e) });
    }
    /**
    * Compares the passed version with the current browser version.
    *
    * @param {*} version - The version to compare with. Anything different
    * than string will be converted to string.
    * @returns {boolean|undefined} - Returns true if the current version is
    * lower than the passed version and false otherwise. Returns undefined if
    * the current browser version is unknown.
    */
  }, {
    key: "isVersionLessThan",
    value: function(e) {
      return this._checkCondition({ [this._name]: "<".concat(e) });
    }
    /**
    * Compares the passed version with the current browser version.
    *
    * @param {*} version - The version to compare with. Anything different
    * than string will be converted to string.
    * @returns {boolean|undefined} - Returns true if the current version is
    * equal to the passed version and false otherwise. Returns undefined if
    * the current browser version is unknown.
    * A loose-equality operator is used here so that it matches the sub-versions as well.
    */
  }, { key: "isVersionEqualTo", value: function(e) {
    return this._checkCondition({ [this._name]: "~".concat(e) });
  } }]);
}(), Rm = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t, [{
    key: "doesVideoMuteByStreamRemove",
    value: (
      /**
      * Tells whether or not the <tt>MediaStream/tt> is removed from
      * the <tt>PeerConnection</tt> and disposed on video mute (in order to turn
      * off the camera device).
      * @return {boolean} <tt>true</tt> if the current browser supports this
      * strategy or <tt>false</tt> otherwise.
      */
      function() {
        return this.isChromiumBased() || this.isWebKitBased();
      }
    )
    /**
    * Check whether or not the current browser support peer to peer connections
    * @return {boolean} <tt>true</tt> if p2p is supported or <tt>false</tt>
    * otherwise.
    */
  }, {
    key: "supportsP2P",
    value: function() {
      return !this.usesUnifiedPlan();
    }
    /**
    * Checks if the current browser is Chromium based, that is, it's either
    * Chrome / Chromium or uses it as its engine, but doesn't identify as
    * Chrome.
    *
    * This includes the following browsers:
    * - Chrome and Chromium
    * - Other browsers which use the Chrome engine, but are detected as Chrome,
    *	 such as Brave and Vivaldi
    * - Browsers which are NOT Chrome but use it as their engine, and have
    *	 custom detection code: Opera, Electron and NW.JS
    */
  }, {
    key: "isChromiumBased",
    value: function() {
      return this.isChrome() || this.isElectron() || this.isNWJS() || this.isOpera();
    }
    /**
    * Checks if the current browser is WebKit based. It's either
    * Safari or uses WebKit as its engine.
    *
    * This includes Chrome and Firefox on iOS
    *
    * @returns {boolean}
    */
  }, {
    key: "isWebKitBased",
    value: function() {
      return this._bowser.isEngine("webkit") && typeof navigator.mediaDevices != "undefined" && typeof navigator.mediaDevices.getUserMedia != "undefined" && typeof window.RTCRtpTransceiver != "undefined" && Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection") > -1;
    }
    /**
    * Checks if the current browser is supported.
    *
    * @returns {boolean} true if the browser is supported, false otherwise.
    */
  }, {
    key: "isSupported",
    value: function() {
      return typeof RTCPeerConnection != "undefined";
    }
    /**
    * Returns whether or not the current environment needs a user interaction
    * with the page before any unmute can occur.
    *
    * @returns {boolean}
    */
  }, {
    key: "isUserInteractionRequiredForUnmute",
    value: function() {
      return this.isFirefox() && this.isVersionLessThan("68");
    }
    /**
    * Checks if the current browser triggers 'onmute'/'onunmute' events when
    * user's connection is interrupted and the video stops playback.
    * @returns {*|boolean} 'true' if the event is supported or 'false'
    * otherwise.
    */
  }, {
    key: "supportsVideoMuteOnConnInterrupted",
    value: function() {
      return this.isChromiumBased() || this.isReactNative() || this.isWebKitBased();
    }
    /**
    * Checks if the current browser reports upload and download bandwidth
    * statistics.
    * @return {boolean}
    */
  }, {
    key: "supportsBandwidthStatistics",
    value: function() {
      return !this.isFirefox() && !this.isWebKitBased();
    }
    /**
    * Checks if the current browser supports setting codec preferences on the transceiver.
    * @returns {boolean}
    */
  }, {
    key: "supportsCodecPreferences",
    value: function() {
      return this.usesUnifiedPlan() && typeof window.RTCRtpTransceiver != "undefined" && Object.keys(window.RTCRtpTransceiver.prototype).indexOf("setCodecPreferences") > -1 && Object.keys(RTCRtpSender.prototype).indexOf("getCapabilities") > -1 && !this.isWebKitBased();
    }
    /**
    * Checks if the current browser support the device change event.
    * @return {boolean}
    */
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "supportsDeviceChangeEvent",
    value: function() {
      return navigator.mediaDevices && typeof navigator.mediaDevices.ondevicechange != "undefined" && typeof navigator.mediaDevices.addEventListener != "undefined";
    }
    /**
    * Checks if the current browser supports RTT statistics for srflx local
    * candidates through the legacy getStats() API.
    */
  }, {
    key: "supportsLocalCandidateRttStatistics",
    value: function() {
      return this.isChromiumBased() || this.isReactNative() || this.isWebKitBased();
    }
    /**
    * Checks if the current browser supports the Long Tasks API that lets us observe
    * performance measurement events and be notified of tasks that take longer than
    * 50ms to execute on the main thread.
    */
  }, {
    key: "supportsPerformanceObserver",
    value: function() {
      return typeof window.PerformanceObserver != "undefined" && PerformanceObserver.supportedEntryTypes.indexOf("longtask") > -1;
    }
    /**
    * Checks if the current browser supports audio level stats on the receivers.
    */
  }, {
    key: "supportsReceiverStats",
    value: function() {
      return typeof window.RTCRtpReceiver != "undefined" && Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources") > -1;
    }
    /**
    * Checks if the current browser reports round trip time statistics for
    * the ICE candidate pair.
    * @return {boolean}
    */
  }, {
    key: "supportsRTTStatistics",
    value: function() {
      return !this.isFirefox();
    }
    /**
    * Checks if the browser uses plan B.
    *
    * @returns {boolean}
    */
  }, {
    key: "usesPlanB",
    value: function() {
      return !this.usesUnifiedPlan();
    }
    /**
    * Checks if the browser uses SDP munging for turning on simulcast.
    *
    * @returns {boolean}
    */
  }, {
    key: "usesSdpMungingForSimulcast",
    value: function() {
      return this.isChromiumBased() || this.isReactNative() || this.isWebKitBased();
    }
    /**
    * Checks if the browser uses unified plan.
    *
    * @returns {boolean}
    */
  }, {
    key: "usesUnifiedPlan",
    value: function() {
      return !!(this.isFirefox() || this.isWebKitBased());
    }
    /**
    * Returns whether or not the current browser should be using the new
    * getUserMedia flow, which utilizes the adapter shim. This method should
    * be temporary and used while migrating all browsers to use adapter and
    * the new getUserMedia.
    *
    * @returns {boolean}
    */
  }, {
    key: "usesNewGumFlow",
    value: function() {
      return !!(this.isChromiumBased() || this.isFirefox() || this.isWebKitBased());
    }
    /**
    * Checks if the browser uses webrtc-adapter. All browsers using the new
    * getUserMedia flow.
    *
    * @returns {boolean}
    */
  }, {
    key: "usesAdapter",
    value: function() {
      return this.usesNewGumFlow();
    }
    /**
    * Checks if the browser uses RIDs/MIDs for siganling the simulcast streams
    * to the bridge instead of the ssrcs.
    */
  }, {
    key: "usesRidsForSimulcast",
    value: function() {
      return !1;
    }
    /**
    * Checks if the browser supports getDisplayMedia.
    * @returns {boolean} {@code true} if the browser supports getDisplayMedia.
    */
  }, {
    key: "supportsGetDisplayMedia",
    value: function() {
      return typeof navigator.getDisplayMedia != "undefined" || typeof navigator.mediaDevices != "undefined" && typeof navigator.mediaDevices.getDisplayMedia != "undefined";
    }
    /**
    * Checks if the browser supports insertable streams, needed for E2EE.
    * @returns {boolean} {@code true} if the browser supports insertable streams.
    */
  }, {
    key: "supportsInsertableStreams",
    value: function() {
      if (!(typeof window.RTCRtpSender != "undefined" && (window.RTCRtpSender.prototype.createEncodedStreams || window.RTCRtpSender.prototype.createEncodedVideoStreams)))
        return !1;
      var r = new ReadableStream();
      try {
        return window.postMessage(r, "*", [r]), !0;
      } catch (n) {
        return !1;
      }
    }
    /**
    * Whether the browser supports the RED format for audio.
    */
  }, {
    key: "supportsAudioRed",
    value: function() {
      return Boolean(window.RTCRtpSender && window.RTCRtpSender.getCapabilities && window.RTCRtpSender.getCapabilities("audio").codecs.some(function(r) {
        return r.mimeType === "audio/red";
      }) && window.RTCRtpReceiver && window.RTCRtpReceiver.getCapabilities && window.RTCRtpReceiver.getCapabilities("audio").codecs.some(function(r) {
        return r.mimeType === "audio/red";
      }));
    }
    /**
    * Checks if the browser supports the "sdpSemantics" configuration option.
    * https://webrtc.org/web-apis/chrome/unified-plan/
    *
    * @returns {boolean}
    */
  }, {
    key: "supportsSdpSemantics",
    value: function() {
      return this.isChromiumBased();
    }
    /**
    * Returns the version of a Chromium based browser.
    *
    * @returns {Number}
    */
  }, { key: "_getChromiumBasedVersion", value: function() {
    if (this.isChromiumBased()) {
      if (this.isNWJS())
        return Number.parseInt(process.versions.chromium, 10);
      var r = navigator.userAgent;
      if (r.match(/Chrome/)) {
        var n = Number.parseInt(r.match(/Chrome\/([\d.]+)/)[1], 10);
        return n;
      }
    }
    return -1;
  } }, { key: "isIOSMobile", value: function() {
    return this.isMobile && this._bowser.getOSName() === "iOS";
  } }]);
}(Cm), kr = new Rm(), ht = {}, Am = { get exports() {
  return ht;
}, set exports(o) {
  ht = o;
} }, Ao = (typeof Reflect == "undefined" ? "undefined" : be(Reflect)) === "object" ? Reflect : null, th = Ao && typeof Ao.apply == "function" ? Ao.apply : function(t, e, r) {
  return Function.prototype.apply.call(t, e, r);
}, _l;
Ao && typeof Ao.ownKeys == "function" ? _l = Ao.ownKeys : Object.getOwnPropertySymbols ? _l = function(t) {
  return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t));
} : _l = function(t) {
  return Object.getOwnPropertyNames(t);
};
function Im(o) {
  console && console.warn && console.warn(o);
}
var jv = Number.isNaN || function(t) {
  return t !== t;
};
function Xe() {
  Xe.init.call(this);
}
Am.exports = Xe;
ht.once = Dm;
Xe.EventEmitter = Xe;
Xe.prototype._events = void 0;
Xe.prototype._eventsCount = 0;
Xe.prototype._maxListeners = void 0;
var nh = 10;
function cc(o) {
  if (typeof o != "function")
    throw new TypeError('The "listener" argument must be of type Function. Received type ' + be(o));
}
Object.defineProperty(Xe, "defaultMaxListeners", { enumerable: !0, get: function() {
  return nh;
}, set: function(t) {
  if (typeof t != "number" || t < 0 || jv(t))
    throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + t + ".");
  nh = t;
} });
Xe.init = function() {
  (this._events === void 0 || this._events === Object.getPrototypeOf(this)._events) && (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0;
};
Xe.prototype.setMaxListeners = function(t) {
  if (typeof t != "number" || t < 0 || jv(t))
    throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + t + ".");
  return this._maxListeners = t, this;
};
function Fv(o) {
  return o._maxListeners === void 0 ? Xe.defaultMaxListeners : o._maxListeners;
}
Xe.prototype.getMaxListeners = function() {
  return Fv(this);
};
Xe.prototype.emit = function(t) {
  for (var e = [], r = 1; r < arguments.length; r++)
    e.push(arguments[r]);
  var n = t === "error", a = this._events;
  if (a !== void 0)
    n = n && a.error === void 0;
  else if (!n)
    return !1;
  if (n) {
    var i;
    if (e.length > 0 && (i = e[0]), i instanceof Error)
      throw i;
    var s = new Error("Unhandled error." + (i ? " (" + i.message + ")" : ""));
    throw s.context = i, s;
  }
  var u = a[t];
  if (u === void 0)
    return !1;
  if (typeof u == "function")
    th(u, this, e);
  else
    for (var c = u.length, d = Wv(u, c), r = 0; r < c; ++r)
      th(d[r], this, e);
  return !0;
};
function Hv(o, t, e, r) {
  var n, a, i;
  if (cc(e), a = o._events, a === void 0 ? (a = o._events = /* @__PURE__ */ Object.create(null), o._eventsCount = 0) : (a.newListener !== void 0 && (o.emit("newListener", t, e.listener ? e.listener : e), a = o._events), i = a[t]), i === void 0)
    i = a[t] = e, ++o._eventsCount;
  else if (typeof i == "function" ? i = a[t] = r ? [e, i] : [i, e] : r ? i.unshift(e) : i.push(e), n = Fv(o), n > 0 && i.length > n && !i.warned) {
    i.warned = !0;
    var s = new Error("Possible EventEmitter memory leak detected. " + i.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit");
    s.name = "MaxListenersExceededWarning", s.emitter = o, s.type = t, s.count = i.length, Im(s);
  }
  return o;
}
Xe.prototype.addListener = function(t, e) {
  return Hv(this, t, e, !1);
};
Xe.prototype.on = Xe.prototype.addListener;
Xe.prototype.prependListener = function(t, e) {
  return Hv(this, t, e, !0);
};
function Mm() {
  if (!this.fired)
    return this.target.removeListener(this.type, this.wrapFn), this.fired = !0, arguments.length === 0 ? this.listener.call(this.target) : this.listener.apply(this.target, arguments);
}
function Bv(o, t, e) {
  var r = { fired: !1, wrapFn: void 0, target: o, type: t, listener: e }, n = Mm.bind(r);
  return n.listener = e, r.wrapFn = n, n;
}
Xe.prototype.once = function(t, e) {
  return cc(e), this.on(t, Bv(this, t, e)), this;
};
Xe.prototype.prependOnceListener = function(t, e) {
  return cc(e), this.prependListener(t, Bv(this, t, e)), this;
};
Xe.prototype.removeListener = function(t, e) {
  var r, n, a, i, s;
  if (cc(e), n = this._events, n === void 0)
    return this;
  if (r = n[t], r === void 0)
    return this;
  if (r === e || r.listener === e)
    --this._eventsCount === 0 ? this._events = /* @__PURE__ */ Object.create(null) : (delete n[t], n.removeListener && this.emit("removeListener", t, r.listener || e));
  else if (typeof r != "function") {
    for (a = -1, i = r.length - 1; i >= 0; i--)
      if (r[i] === e || r[i].listener === e) {
        s = r[i].listener, a = i;
        break;
      }
    if (a < 0)
      return this;
    a === 0 ? r.shift() : _m(r, a), r.length === 1 && (n[t] = r[0]), n.removeListener !== void 0 && this.emit("removeListener", t, s || e);
  }
  return this;
};
Xe.prototype.off = Xe.prototype.removeListener;
Xe.prototype.removeAllListeners = function(t) {
  var e, r, n;
  if (r = this._events, r === void 0)
    return this;
  if (r.removeListener === void 0)
    return arguments.length === 0 ? (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0) : r[t] !== void 0 && (--this._eventsCount === 0 ? this._events = /* @__PURE__ */ Object.create(null) : delete r[t]), this;
  if (arguments.length === 0) {
    var a = Object.keys(r), i;
    for (n = 0; n < a.length; ++n)
      i = a[n], i !== "removeListener" && this.removeAllListeners(i);
    return this.removeAllListeners("removeListener"), this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0, this;
  }
  if (e = r[t], typeof e == "function")
    this.removeListener(t, e);
  else if (e !== void 0)
    for (n = e.length - 1; n >= 0; n--)
      this.removeListener(t, e[n]);
  return this;
};
function qv(o, t, e) {
  var r = o._events;
  if (r === void 0)
    return [];
  var n = r[t];
  return n === void 0 ? [] : typeof n == "function" ? e ? [n.listener || n] : [n] : e ? Om(n) : Wv(n, n.length);
}
Xe.prototype.listeners = function(t) {
  return qv(this, t, !0);
};
Xe.prototype.rawListeners = function(t) {
  return qv(this, t, !1);
};
Xe.listenerCount = function(o, t) {
  return typeof o.listenerCount == "function" ? o.listenerCount(t) : Gv.call(o, t);
};
Xe.prototype.listenerCount = Gv;
function Gv(o) {
  var t = this._events;
  if (t !== void 0) {
    var e = t[o];
    if (typeof e == "function")
      return 1;
    if (e !== void 0)
      return e.length;
  }
  return 0;
}
Xe.prototype.eventNames = function() {
  return this._eventsCount > 0 ? _l(this._events) : [];
};
function Wv(o, t) {
  for (var e = new Array(t), r = 0; r < t; ++r)
    e[r] = o[r];
  return e;
}
function _m(o, t) {
  for (; t + 1 < o.length; t++)
    o[t] = o[t + 1];
  o.pop();
}
function Om(o) {
  for (var t = new Array(o.length), e = 0; e < t.length; ++e)
    t[e] = o[e].listener || o[e];
  return t;
}
function Dm(o, t) {
  return new Promise(function(e, r) {
    function n(i) {
      o.removeListener(t, a), r(i);
    }
    function a() {
      typeof o.removeListener == "function" && o.removeListener("error", n), e([].slice.call(arguments));
    }
    Jv(o, t, a, { once: !0 }), t !== "error" && Lm(o, n, { once: !0 });
  });
}
function Lm(o, t, e) {
  typeof o.on == "function" && Jv(o, "error", t, e);
}
function Jv(o, t, e, r) {
  if (typeof o.on == "function")
    r.once ? o.once(t, e) : o.on(t, e);
  else if (typeof o.addEventListener == "function")
    o.addEventListener(t, function n(a) {
      r.once && o.removeEventListener(t, n), e(a);
    });
  else
    throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + be(o));
}
var ce;
(function(o) {
  o[o.MAJOR_EVENT = 0] = "MAJOR_EVENT", o[o.MINOR_EVENT = 1] = "MINOR_EVENT";
})(ce || (ce = {}));
var K;
(function(o) {
  o.PRECALL_TEST_BEGIN = "precall_begin", o.PRECALL_TEST_COMPLETE = "precall_end", o.CALL_JOIN_BEGIN = "call_join", o.NET_QUALITY_TEST_BEGIN = "net_quality_test_begin", o.NET_QUALITY_TEST_END = "net_quality_test_end", o.WEBSOCKET_CONNECTED = "websocket_connected", o.TRANSPORT_CONNECTED = "transport_connected", o.AUDIO_ON = "audio_on", o.AUDIO_OFF = "audio_off", o.VIDEO_ON = "video_on", o.VIDEO_OFF = "video_off", o.PARTICIPANT_ROLE = "participant_role", o.PING_STAT = "ping_stat", o.DISCONNECT = "disconnect", o.RECONNECT_ATTEMPT = "reconnect_attempt", o.SCREENSHARE_START_REQUESTED = "screenshare_start_requested", o.SCREENSHARE_STARTED = "screenshare_started", o.SCREENSHARE_STOPPED = "screenshare_stopped", o.TAB_CHANGE = "tab_change", o.BROWSER_BACKGROUNDED = "browser_backgrounded", o.BROWSER_FOREGROUNDED = "browser_foregrounded", o.DOMINANT_SPEAKER = "dominant_speaker", o.AUDIO_DEVICES_UPDATES = "audio_devices_updates", o.VIDEO_DEVICES_UPDATES = "video_devices_updates", o.SPEAKER_DEVICES_UPDATES = "speaker_devices_updates", o.SELECTED_MICROHPONE_UPDATE = "selected_microphone_update", o.SELECTED_CAMERA_UPDATE = "selected_camera_update", o.SELECTED_SPEAKER_UPDATE = "selected_speaker_update", o.EXPECTED_VIDEO_RESOLUTION = "expected_video_resolution", o.EXPECTED_SCREENSHARE_RESOLUTION = "expected_screenshare_resolution", o.MEDIA_PERMISSION = "media_permission", o.LEGACY_SWITCH = "legacy_switch", o.AUDIO_PLAY_FAILED = "audio_play_failed", o.VIDEO_PLAY_FAILED = "video_play_failed", o.AUDIO_TRACK_MUTED = "audio_track_muted", o.VIDEO_TRACK_MUTED = "video_track_muted", o.IVS_PLAYER_REBUFFERING = "ivs_player_rebuffering", o.IVS_PLAYER_AUDIO_BLOCKED = "ivs_player_audio_blocked", o.IVS_PLAYER_PLAYBACK_BLOCKED = "ivs_player_playback_blocked", o.IVS_PLAYER_ERROR = "ivs_player_error", o.IVS_PLAYER_RECOVERABLE_ERROR = "ivs_player_recoverable_error", o.IVS_PLAYER_WORKER_ERROR = "ivs_player_worker_error", o.IVS_PLAYER_NETWORK_UNAVAILABLE = "ivs_player_network_unavailable", o.LIVESTREAM_LATENCY = "livestream_latency", o.IVS_PLAYER_ANALYTICS_EVENT = "ivs_player_analytics_event", o.IVS_PLAYER_PLAYBACK_RATE_CHANGED = "ivs_player_playback_rate_changed", o.IVS_PLAYER_QUALITY_CHANGED = "ivs_player_quality_changed", o.IVS_PLAYER_INITIALIZED = "ivs_player_initialized";
})(K || (K = {}));
var $m = /* @__PURE__ */ new Map([
  [K.PRECALL_TEST_BEGIN, ce.MINOR_EVENT],
  [K.PRECALL_TEST_COMPLETE, ce.MINOR_EVENT],
  [K.CALL_JOIN_BEGIN, ce.MAJOR_EVENT],
  [K.NET_QUALITY_TEST_BEGIN, ce.MINOR_EVENT],
  [K.NET_QUALITY_TEST_END, ce.MINOR_EVENT],
  [K.WEBSOCKET_CONNECTED, ce.MINOR_EVENT],
  [K.TRANSPORT_CONNECTED, ce.MAJOR_EVENT],
  [K.AUDIO_ON, ce.MINOR_EVENT],
  [K.AUDIO_OFF, ce.MINOR_EVENT],
  [K.VIDEO_ON, ce.MINOR_EVENT],
  [K.VIDEO_OFF, ce.MINOR_EVENT],
  [K.PARTICIPANT_ROLE, ce.MINOR_EVENT],
  [K.PING_STAT, ce.MAJOR_EVENT],
  [K.DISCONNECT, ce.MAJOR_EVENT],
  [K.RECONNECT_ATTEMPT, ce.MAJOR_EVENT],
  [K.SCREENSHARE_START_REQUESTED, ce.MINOR_EVENT],
  [K.SCREENSHARE_STARTED, ce.MINOR_EVENT],
  [K.SCREENSHARE_STOPPED, ce.MINOR_EVENT],
  [K.TAB_CHANGE, ce.MINOR_EVENT],
  [K.BROWSER_BACKGROUNDED, ce.MINOR_EVENT],
  [K.BROWSER_FOREGROUNDED, ce.MINOR_EVENT],
  [K.DOMINANT_SPEAKER, ce.MINOR_EVENT],
  [K.AUDIO_DEVICES_UPDATES, ce.MINOR_EVENT],
  [K.VIDEO_DEVICES_UPDATES, ce.MINOR_EVENT],
  [K.SPEAKER_DEVICES_UPDATES, ce.MINOR_EVENT],
  [K.SELECTED_MICROHPONE_UPDATE, ce.MINOR_EVENT],
  [K.SELECTED_CAMERA_UPDATE, ce.MINOR_EVENT],
  [K.SELECTED_SPEAKER_UPDATE, ce.MINOR_EVENT],
  [K.MEDIA_PERMISSION, ce.MINOR_EVENT],
  [K.LEGACY_SWITCH, ce.MINOR_EVENT],
  [K.AUDIO_PLAY_FAILED, ce.MINOR_EVENT],
  [K.VIDEO_PLAY_FAILED, ce.MINOR_EVENT],
  [K.AUDIO_TRACK_MUTED, ce.MINOR_EVENT],
  [K.VIDEO_TRACK_MUTED, ce.MINOR_EVENT],
  // IVS Player Events
  [K.IVS_PLAYER_REBUFFERING, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_AUDIO_BLOCKED, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_PLAYBACK_BLOCKED, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_ERROR, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_RECOVERABLE_ERROR, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_WORKER_ERROR, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_NETWORK_UNAVAILABLE, ce.MAJOR_EVENT],
  // We are keeping live latency as major, so that it
  // acts as a ping alternative for livestream viewer
  [K.LIVESTREAM_LATENCY, ce.MAJOR_EVENT],
  [K.IVS_PLAYER_ANALYTICS_EVENT, ce.MINOR_EVENT],
  [K.IVS_PLAYER_PLAYBACK_RATE_CHANGED, ce.MINOR_EVENT],
  [K.IVS_PLAYER_QUALITY_CHANGED, ce.MINOR_EVENT],
  [K.IVS_PLAYER_INITIALIZED, ce.MINOR_EVENT],
  [K.EXPECTED_VIDEO_RESOLUTION, ce.MINOR_EVENT],
  [K.EXPECTED_SCREENSHARE_RESOLUTION, ce.MINOR_EVENT]
]), Nm = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this.events = void 0, this.events = [];
  }
  return P(o, [{ key: "add", value: function(e) {
    this.events.push(e);
  } }, { key: "flush", value: function() {
    var e = this.events.splice(0, 25);
    return { entries: e };
  } }]);
}(), Vm = /* @__PURE__ */ function(o) {
  function t(e) {
    var r, n = e.logger, a = e.peerId, i = e.apiHostnames;
    return w(this, t), r = R(this, t), r.logger = void 0, r.peerId = void 0, r.eventStore = void 0, r.apiEndpoint = void 0, r.logger = n, r.peerId = a, r.apiEndpoint = "https://".concat(i.daCollector, "/api/v1/message"), r.eventStore = new Nm(), r;
  }
  return A(t, o), P(t, [{ key: "sendEventsChunkToServer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return s = { payload: a, peerId: this.peerId }, d.prev = 1, d.next = 4, fetch(this.apiEndpoint, { method: "POST", body: JSON.stringify(s) });
            case 4:
              return d.abrupt("return", !0);
            case 7:
              return d.prev = 7, d.t0 = d.catch(1), this.logger.error("callStats::sendEventsChunkToServer::catch", { error: d.t0 }), (u = a.entries) === null || u === void 0 || u.forEach(function(h) {
                i.eventStore.add(h);
              }), d.abrupt("return", !1);
            case 12:
            case "end":
              return d.stop();
          }
      }, n, this, [[1, 7]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "callEvent", value: function(r) {
    r.timestamp = new Date(), this.eventStore.add(r), this.emit(r.event, r.metaData), $m.get(r.event) === ce.MAJOR_EVENT && this.flush();
  } }, { key: "flush", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (i = this.eventStore.flush(), !(i != null && (a = i.entries) !== null && a !== void 0 && a.length)) {
                u.next = 5;
                break;
              }
              return u.next = 4, this.sendEventsChunkToServer(i);
            case 4:
              return u.abrupt("return", !0);
            case 5:
              return u.abrupt("return", !1);
            case 6:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(ht), ah;
(function(o) {
  o.CHROMIUM = "chromum", o.FIREFOX = "firefox", o.SAFARI = "safari";
})(ah || (ah = {}));
var _u = { DEVEL: "devel", PREPROD: "preprod", PROD: "prod" }, yn;
(function(o) {
  o.AUDIO = "AUDIO", o.VIDEO = "VIDEO", o.SPEAKER = "SPEAKER", o.SCREENSHARE = "SCREENSHARE";
})(yn || (yn = {}));
var ih;
(function(o) {
  o[o.INIT = 0] = "INIT", o[o.ACCEPTED = 1] = "ACCEPTED", o[o.DENIED = 2] = "DENIED", o[o.SYS_DENIED = 3] = "SYS_DENIED", o[o.FAILED = 4] = "FAILED", o[o.NOTFOUND = 5] = "NOTFOUND", o[o.NOT_APPLICABLE = 6] = "NOT_APPLICABLE";
})(ih || (ih = {}));
function Ii(o) {
  return o ? o.split(".").slice(0, 2).concat(["0", "0"]).join(".") : "";
}
function Yl(o) {
  var t = o.packetsLost, e = o.packetsSent;
  return e > 0 ? t * 100 / e : 0;
}
function Ql(o) {
  var t = o.packetsLost, e = o.packetsReceived;
  return e + t > 0 ? t * 100 / (e + t) : 0;
}
var Kv = 240, zv = 720, Yv = 8, Qv = 3, dc = 10, pc = 0.02, hc = 0.03;
function Ba(o) {
  var t = o.stat, e = o.weight, r = o.rangeMin, n = o.rangeMax, a = o.rangeRankingDirection;
  return t == null ? e : r === n ? a === "UP" ? t <= r ? e : 0 : t >= n ? e : 0 : a === "UP" ? (1 - Math.max(Math.min(n, Math.abs(t)) - r, 0) / (n - r)) * e : a === "DOWN" ? Math.max(Math.min(n, Math.abs(t)) - r, 0) / (n - r) * e : e;
}
function Xv(o) {
  var t = o.isLowQualityVideo, e = o.isVideoStuck, r = o.isVideoLagging, n = o.jitterQuality, a = o.packetsLostQuality, i = 0.8 * ((t ? 0.85 : 1) * (r ? 0.7 : 1) * (e ? 0.5 : 1)) + 0.2 * (n * a);
  return Math.round((i + Number.EPSILON) * 100) / 100;
}
function Zv(o) {
  var t = o.packetsLost, e = o.packetsSent;
  return e > 0 ? t * 100 / e : 0;
}
function xv(o) {
  var t = o.packetsLost, e = o.packetsSent, r = o.jitter, n = 0.7, a = Ba({ stat: Zv({ packetsLost: t, packetsSent: e }), weight: n, rangeMin: 0, rangeMax: dc, rangeRankingDirection: "UP" }), i = 0.3, s = Ba({ stat: r, weight: i, rangeMin: pc, rangeMax: hc, rangeRankingDirection: "UP" });
  return a + s;
}
function Um(o) {
  var t = o.frameWidth, e = o.isScreenShare, r = e ? zv : Kv;
  return t < r;
}
function jm(o) {
  var t = o.framesPerSecond, e = o.isScreenShare, r = e ? Qv : Yv;
  return t < r;
}
function Fm(o) {
  var t = o.framesEncoded;
  return t === 0;
}
function ef(o) {
  var t = o.frameWidth, e = o.framesPerSecond, r = o.packetsLost, n = o.packetsSent, a = o.jitter, i = o.isScreenShare, s = o.framesEncoded, u = Ba({ stat: Zv({ packetsLost: r, packetsSent: n }), weight: 1, rangeMin: 0, rangeMax: dc, rangeRankingDirection: "UP" }), c = Ba({ stat: a, weight: 1, rangeMin: pc, rangeMax: hc, rangeRankingDirection: "UP" }), d = Um({ frameWidth: t, isScreenShare: i }), h = jm({ framesPerSecond: e, isScreenShare: i }), v = Fm({ framesEncoded: s, isScreenShare: i });
  return Xv({ isLowQualityVideo: d, isVideoLagging: h, isVideoStuck: v, jitterQuality: c, packetsLostQuality: u });
}
function rf(o) {
  var t = o.packetsLost, e = o.packetsReceived;
  return e + t > 0 ? t * 100 / (e + t) : 0;
}
function tf(o) {
  var t = o.concealmentEvents, e = o.packetsLost, r = o.packetsReceived, n = o.jitter, a = 0.2, i = Ba({ stat: t, weight: a, rangeMin: 0, rangeMax: 3, rangeRankingDirection: "UP" }), s = 0.5, u = Ba({ stat: rf({ packetsLost: e, packetsReceived: r }), weight: s, rangeMin: 0, rangeMax: dc, rangeRankingDirection: "UP" }), c = 0.3, d = Ba({ stat: n, weight: c, rangeMin: pc, rangeMax: hc, rangeRankingDirection: "UP" });
  return i + u + d;
}
function Hm(o) {
  var t = o.framesDecoded;
  return t === 0;
}
function Bm(o) {
  var t = o.framesPerSecond, e = o.isScreenShare, r = e ? Qv : Yv;
  return t < r;
}
function qm(o) {
  var t = o.frameWidth, e = o.isScreenShare, r = e ? zv : Kv;
  return t < r;
}
function nf(o) {
  var t = o.frameWidth, e = o.framesPerSecond, r = o.packetsLost, n = o.packetsReceived, a = o.jitter, i = o.isScreenShare, s = o.framesDecoded, u = Ba({ stat: rf({ packetsLost: r, packetsReceived: n }), weight: 1, rangeMin: 0, rangeMax: dc, rangeRankingDirection: "UP" }), c = Ba({ stat: a, weight: 1, rangeMin: pc, rangeMax: hc, rangeRankingDirection: "UP" }), d = qm({ frameWidth: t, isScreenShare: i }), h = Bm({ framesPerSecond: e, isScreenShare: i }), v = Hm({ framesDecoded: s, isScreenShare: i });
  return Xv({ isLowQualityVideo: d, isVideoLagging: h, isVideoStuck: v, jitterQuality: c, packetsLostQuality: u });
}
var Uo = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.pc1 = void 0, this.pc2 = void 0, this.constrainVideoBitrateKbps = void 0, this.constrainOfferToRemoveVideoFec = !1, this.iceCandidateFilter = void 0;
    var e = new RTCPeerConnection(t), r = new RTCPeerConnection(t);
    this.pc1 = e, this.pc2 = r, this.iceCandidateFilter = o.noFilter, this.pc1.addEventListener("icecandidate", this.onIceCandidate.bind(this, this.pc2)), this.pc2.addEventListener("icecandidate", this.onIceCandidate.bind(this, this.pc1));
  }
  return P(o, [{ key: "onIceCandidate", value: function(e, r) {
    if (r.candidate) {
      var n = o.parseCandidate(r.candidate.candidate);
      this.iceCandidateFilter(n) && e.addIceCandidate(r.candidate);
    }
  } }, {
    key: "setIceCandidateFilter",
    value: function(e) {
      this.iceCandidateFilter = e;
    }
    // Constraint max video bitrate by modifying the SDP when creating an answer.
  }, {
    key: "constrainVideoBitrate",
    value: function(e) {
      this.constrainVideoBitrateKbps = e;
    }
    // Remove video FEC if available on the offer.
  }, { key: "disableVideoFec", value: function() {
    this.constrainOfferToRemoveVideoFec = !0;
  } }, { key: "gotOffer", value: function(e) {
    this.constrainOfferToRemoveVideoFec && (e.sdp = e.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g, `$1\r
`), e.sdp = e.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g, ""), e.sdp = e.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g, ""), e.sdp = e.sdp.replace(/a=rtpmap:98 rtx\/90000\r\n/g, ""), e.sdp = e.sdp.replace(/a=fmtp:98 apt=116\r\n/g, "")), this.pc1.setLocalDescription(e), this.pc2.setRemoteDescription(e), this.pc2.createAnswer().then(this.gotAnswer.bind(this), this.reportFatal.bind(this));
  } }, { key: "gotAnswer", value: function(e) {
    this.constrainVideoBitrateKbps && (e.sdp = e.sdp.replace(/a=mid:video\r\n/g, `a=mid:video\r
b=AS:`.concat(this.constrainVideoBitrateKbps, `\r
`))), this.pc2.setLocalDescription(e), this.pc1.setRemoteDescription(e);
  } }, {
    key: "establishConnection",
    value: function() {
      this.pc1.createOffer().then(this.gotOffer.bind(this), this.reportFatal.bind(this));
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "reportFatal", value: function(e) {
    console.error("Error:", e);
  } }, { key: "getRoundTripTime", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return v.next = 2, Promise.all([this.pc1.getStats(), this.pc2.getStats()]);
            case 2:
              if (n = v.sent, a = He(n, 2), i = a[0], s = a[1], i.forEach(function(f) {
                f.type === "candidate-pair" && f.nominated === !0 && f.bytesSent > 0 && (u = f);
              }), s.forEach(function(f) {
                f.type === "candidate-pair" && f.nominated === !0 && f.bytesReceived > 0 && (c = f);
              }), !(u && c)) {
                v.next = 19;
                break;
              }
              if (v.prev = 9, !(u.currentRoundTripTime && c.currentRoundTripTime)) {
                v.next = 12;
                break;
              }
              return v.abrupt("return", { rtt: u.currentRoundTripTime, backendRTT: c.currentRoundTripTime });
            case 12:
              return d = (c.lastPacketReceivedTimestamp - u.lastPacketSentTimestamp) / 1e3, v.abrupt("return", { rtt: d, backendRTT: d });
            case 16:
              return v.prev = 16, v.t0 = v.catch(9), v.abrupt("return", void 0);
            case 19:
              return v.abrupt("return", void 0);
            case 20:
            case "end":
              return v.stop();
          }
      }, r, this, [[9, 16]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "close", value: function() {
    this.pc1.close(), this.pc2.close();
  } }], [{ key: "parseCandidate", value: function(e) {
    var r = "candidate:", n = e.indexOf(r) + r.length, a = e.substr(n).split(" ");
    return { type: a[7], protocol: a[2], address: a[4] };
  } }, { key: "isNotHostCandidate", value: function(e) {
    return e.type !== "host";
  } }, { key: "isHost", value: function(e) {
    return e.type === "host";
  } }, { key: "isRelay", value: function(e) {
    return e.type === "relay";
  } }, { key: "isReflexive", value: function(e) {
    return e.type === "srflx";
  } }, { key: "noFilter", value: function(e) {
    return !0;
  } }]);
}(), af = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t), r.call = void 0, r.timeOut = void 0, r.call = new Uo(e), r;
  }
  return A(t, o), P(t, [{ key: "start", value: function() {
    var r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 1e4;
    this.call.establishConnection(), this.timeOut = setTimeout(this.testFailed.bind(this), r);
  } }, { key: "testComplete", value: function(r) {
    clearTimeout(this.timeOut), this.call.close(), this.emit("done", r);
  } }, { key: "testFailed", value: function(r) {
    this.call.close(), this.emit("failed", r);
  } }]);
}(ht), Gm = 8, Wm = 1 / 1e3, Jm = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    w(this, t), r = R(this, t, [e]), r.senderChannel = void 0, r.recieveChannel = void 0, r.startTime = void 0, r.lastBitrateMeasureTime = void 0, r.sentPayloadBytes = 0, r.recievedPayloadBytes = 0, r.lastReceivedPayloadBytes = 0, r.stopSending = !1, r.testProgress = 0, r.samplePacket = "", r.finalBitrateSum = 0, r.bitRateSampels = 0, r.maxNumberOfPacketsToSend = 0, r.bytesToKeepBuffered = 0, r.testDurationSeconds = 5, r.call.setIceCandidateFilter(Uo.isNotHostCandidate), r.senderChannel = r.call.pc1.createDataChannel(null);
    for (var n = 0; n < 1024 * 256; n += 1)
      r.samplePacket += "h";
    return r.maxNumberOfPacketsToSend = 1, r.bytesToKeepBuffered = 1024 * r.maxNumberOfPacketsToSend, r.testDurationSeconds = 4, r.senderChannel.addEventListener("open", r.sendingStep.bind(r)), r.call.pc2.addEventListener("datachannel", r.onRecieverChannel.bind(r)), r;
  }
  return A(t, o), P(t, [{ key: "sendingStep", value: function() {
    var r = new Date();
    this.startTime || (this.startTime = r, this.lastBitrateMeasureTime = r);
    for (var n = 0; n !== this.maxNumberOfPacketsToSend && !(this.senderChannel.bufferedAmount >= this.bytesToKeepBuffered); n += 1) {
      this.sentPayloadBytes += this.samplePacket.length;
      try {
        this.senderChannel.send(this.samplePacket);
      } catch (i) {
      }
    }
    var a = r.getTime() - this.startTime.getTime();
    a >= 1e3 * this.testDurationSeconds ? (this.stopSending = !0, this.testProgress = 100) : (this.testProgress = a / (10 * this.testDurationSeconds), setTimeout(this.sendingStep.bind(this), 1));
  } }, { key: "onMessageRecieved", value: function(r) {
    this.recievedPayloadBytes += r.data.length;
    var n = new Date(), a = n.getTime() - this.lastBitrateMeasureTime.getTime();
    if (a >= 1e3) {
      var i = this.recievedPayloadBytes - this.lastReceivedPayloadBytes, s = i * Gm / (a / 1e3);
      this.finalBitrateSum += s, this.bitRateSampels += 1, this.lastReceivedPayloadBytes = this.recievedPayloadBytes, this.lastBitrateMeasureTime = n;
    }
    if (this.stopSending && this.sentPayloadBytes === this.recievedPayloadBytes) {
      var u = this.finalBitrateSum / this.bitRateSampels;
      this.testComplete({ throughput: Math.round(u * Wm) });
    }
  } }, { key: "testComplete", value: function(r) {
    var n = this;
    this.call.getRoundTripTime().then(function(a) {
      var i = a.rtt, s = a.backendRTT;
      return Re(t, "testComplete", n, 3)([{ RTT: i, backendRTT: s, throughput: r.throughput }]);
    });
  } }, { key: "onRecieverChannel", value: function(r) {
    this.recieveChannel = r.channel, this.recieveChannel.addEventListener("message", this.onMessageRecieved.bind(this));
  } }]);
}(af), Pp = /* @__PURE__ */ function(o) {
  function t(e) {
    var r, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : Uo.noFilter;
    w(this, t), r = R(this, t, [e]), r.ch1 = void 0, r.ch2 = void 0, r.call.setIceCandidateFilter(n);
    var a = r.call.pc1.createDataChannel(null);
    return r.ch1 = a, a.addEventListener("open", function() {
      a.send("hello");
    }), a.addEventListener("message", r.onCh1Recieve.bind(r)), r.call.pc2.addEventListener("datachannel", r.dataChannelHandler.bind(r)), r;
  }
  return A(t, o), P(t, [{ key: "onCh1Recieve", value: function(r) {
    r.data !== "world" ? this.hangup("Invalid data transmitted.") : this.testComplete({ connectivity: !0 });
  } }, { key: "onCh2Recieve", value: function(r) {
    if (r.data !== "hello")
      this.hangup("Invalid data transmitted.");
    else
      try {
        this.ch2.send("world");
      } catch (n) {
      }
  } }, { key: "dataChannelHandler", value: function(r) {
    var n = r.channel;
    this.ch2 = n, n.addEventListener("message", this.onCh2Recieve.bind(this));
  } }, { key: "hangup", value: function(r) {
    this.testFailed(r);
  } }]);
}(af), Km = /* @__PURE__ */ function(o) {
  function t(e) {
    return w(this, t), R(this, t, [e, Uo.isHost]);
  }
  return A(t, o), P(t);
}(Pp), zm = /* @__PURE__ */ function(o) {
  function t(e) {
    return w(this, t), R(this, t, [e, Uo.isRelay]);
  }
  return A(t, o), P(t);
}(Pp), Ym = /* @__PURE__ */ function(o) {
  function t(e) {
    return w(this, t), R(this, t, [e, Uo.isReflexive]);
  }
  return A(t, o), P(t);
}(Pp), Qm = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this.ipInformation = null;
  }
  return P(o, [{ key: "getIPDetails", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              if (a = n.peerId, i = n.apiHostnames, s = n.logger, this.ipInformation) {
                y.next = 33;
                break;
              }
              return y.prev = 2, c = "https://".concat(i.location), y.next = 6, fetch(c);
            case 6:
              return d = y.sent, y.next = 9, d.json();
            case 9:
              if (h = y.sent, !(((u = h.loc) === null || u === void 0 ? void 0 : u.length) > 5)) {
                y.next = 14;
                break;
              }
              return this.ipInformation = h, (v = this.ipInformation) !== null && v !== void 0 && v.ip && (this.ipInformation.ip = Ii(this.ipInformation.ip)), y.abrupt("return", h);
            case 14:
              throw Error("Insufficient data");
            case 17:
              y.prev = 17, y.t0 = y.catch(2), s.error("callstats::ipDetails:: failed to fetch ip using location service", { error: y.t0 });
            case 20:
              return y.prev = 20, y.next = 23, fetch("https://".concat(i.locationLegacy, "/?token=3c493932b0624c&peerId=").concat(a), { method: "POST" });
            case 23:
              return g = y.sent, y.next = 26, g.json();
            case 26:
              this.ipInformation = y.sent, (f = this.ipInformation) !== null && f !== void 0 && f.ip && (this.ipInformation.ip = Ii(this.ipInformation.ip)), y.next = 33;
              break;
            case 30:
              y.prev = 30, y.t1 = y.catch(20), s.error("callstats::ipDetails:: failed to fetch ip using legacy location service", { error: y.t1 });
            case 33:
              return y.abrupt("return", this.ipInformation);
            case 34:
            case "end":
              return y.stop();
          }
      }, r, this, [[2, 17], [20, 30]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "resetCache", value: function() {
    this.ipInformation = null;
  } }]);
}(), Sp = new Qm(), sh = [{ urls: "turn:turn.dyte.in:443?transport=tcp", username: "dyte", credential: "dytein", credentialType: "password" }, { urls: "turn:turn.dyte.in:3478?transport=udp", username: "dyte", credential: "dytein", credentialType: "password" }];
function oh(o) {
  var t = o.split(","), e = He(t, 2), r = e[0], n = e[1];
  return { coords: { latitude: Number(r), longitude: Number(n) } };
}
var sf = /* @__PURE__ */ P(function o() {
  w(this, o), this.transport = void 0, this.candidatePair = void 0, this.outboundVideoRtp = /* @__PURE__ */ new Map(), this.inboundVideoRtp = /* @__PURE__ */ new Map(), this.outboundAudioRtp = /* @__PURE__ */ new Map(), this.inboundAudioRtp = /* @__PURE__ */ new Map(), this.remoteInboundRtp = /* @__PURE__ */ new Map(), this.producerStreamMap = /* @__PURE__ */ new Map(), this.consumerStreamMap = /* @__PURE__ */ new Map(), this.staleProducerStreamMap = !1, this.staleConsumerStreamMap = !1;
}), of = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    return w(this, t), e = R(this, t), e.observer = void 0, e.outboundProducerMap = /* @__PURE__ */ new Map(), e.inboundConsumerMap = /* @__PURE__ */ new Map(), e.consumerPeerIdMap = /* @__PURE__ */ new Map(), e.pausedConsumerMap = /* @__PURE__ */ new Map(), e.pausedProducerMap = /* @__PURE__ */ new Map(), e.overallProducingTransportsStatsMap = {}, e.overallConsumingTransportsStatsMap = {}, e.overallConsumersStatsMap = {}, e.overallProducersStatsMap = {}, e.videoProducerToStatsMap = /* @__PURE__ */ new Map(), e.audioProducerToStatsMap = /* @__PURE__ */ new Map(), e.videoConsumerToStatsMap = /* @__PURE__ */ new Map(), e.audioConsumerToStatsMap = /* @__PURE__ */ new Map(), e.consumerIdsWithFreezedVideo = /* @__PURE__ */ new Set(), e.consumerIdsWithFreezedAudio = /* @__PURE__ */ new Set(), e.producerIdsWithFreezedVideo = /* @__PURE__ */ new Set(), e.producerIdsWithFreezedAudio = /* @__PURE__ */ new Set(), e.freezedProducingTransportIds = /* @__PURE__ */ new Set(), e.freezedConsumingTransportIds = /* @__PURE__ */ new Set(), e.screenShareProducers = /* @__PURE__ */ new Set(), e.screenShareConsumers = /* @__PURE__ */ new Set(), e.ipDetails = void 0, e.callStatsInstance = void 0, e.observer = new ht(), e;
  }
  return A(t, o), P(t, [{ key: "registerProducer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.generateProducerStreamMap(a);
            case 2:
              a.on("close", this.deregisterProducer.bind(this, a)), a.on("pause", this.pauseProducer.bind(this, a.id)), a.on("resume", this.resumeProducer.bind(this, a.id)), a.appData.screenShare === !0 && this.screenShareProducers.add(a.id);
            case 6:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "pauseProducer", value: function(r) {
    this.pausedProducerMap.set(r, { lastReportCalculated: !1 });
  } }, { key: "resumeProducer", value: function(r) {
    this.pausedProducerMap.delete(r);
  } }, { key: "processInboundConsumerVideoStats", value: function(r, n, a) {
    var i, s = (this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 || (i = i.consumerSharedMediaStatesMap) === null || i === void 0 ? void 0 : i.get(r)) || {};
    n.totalVideoPacketsReceived === a.packetsReceived ? (this.consumerIdsWithFreezedVideo.add(r), this.callStatsInstance && s.video && (this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoFreezed", { consumerId: r }), this.callStatsInstance.eventHandler.emit("consumer_video_status", "pause", r))) : (n.totalVideoPacketsReceived = a.packetsReceived, this.consumerIdsWithFreezedVideo.has(r) && (this.consumerIdsWithFreezedVideo.delete(r), this.callStatsInstance && s.video && (this.callStatsInstance.logger.debug("callstats::measurements::consumerVideoDefreezed", { consumerId: r }), this.callStatsInstance.eventHandler.emit("consumer_video_status", "resume", r))));
  } }, { key: "processInboundConsumerAudioStats", value: function(r, n, a) {
    var i, s = (this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 || (i = i.consumerSharedMediaStatesMap) === null || i === void 0 ? void 0 : i.get(r)) || {};
    n.totalAudioPacketsReceived === a.packetsReceived ? (this.consumerIdsWithFreezedAudio.add(r), this.callStatsInstance && s.audio && (this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioFreezed", { consumerId: r }), this.callStatsInstance.eventHandler.emit("consumer_audio_status", "pause", r))) : (n.totalAudioPacketsReceived = a.packetsReceived, this.consumerIdsWithFreezedAudio.has(r) && (this.consumerIdsWithFreezedAudio.delete(r), this.callStatsInstance && s.audio && (this.callStatsInstance.logger.debug("callStats::measurements::consumerAudioDefreezed", { consumerId: r }), this.callStatsInstance.eventHandler.emit("consumer_audio_status", "resume", r))));
  } }, { key: "processOutboundProducerVideoStats", value: function(r, n, a) {
    var i, s = (this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 ? void 0 : i.currentUserMediaStates) || {};
    n.totalVideoPacketsSent === a.packetsSent ? (this.producerIdsWithFreezedVideo.add(r), this.callStatsInstance && s.video && (this.callStatsInstance.logger.debug("callStats::measurements::producerVideoFreezed", { producerId: r }), this.callStatsInstance.eventHandler.emit("producer_video_status", "pause", r))) : (n.totalVideoPacketsSent = a.packetsSent, this.producerIdsWithFreezedVideo.has(r) && (this.producerIdsWithFreezedVideo.delete(r), this.callStatsInstance && s.video && (this.callStatsInstance.logger.debug("callStats::measurements::producerVideoDefreezed", { producerId: r }), this.callStatsInstance.eventHandler.emit("producer_video_status", "resume", r))));
  } }, { key: "processOutboundProducerAudioStats", value: function(r, n, a) {
    var i, s = (this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 ? void 0 : i.currentUserMediaStates) || {};
    n.totalAudioPacketsSent === a.packetsSent ? (this.producerIdsWithFreezedAudio.add(r), this.callStatsInstance && s.audio && (this.callStatsInstance.logger.debug("callStats::measurements::producerAudioFreezed", { producerId: r }), this.callStatsInstance.eventHandler.emit("producer_audio_status", "pause", r))) : (n.totalAudioPacketsSent = a.packetsSent, this.producerIdsWithFreezedAudio.has(r) && (this.producerIdsWithFreezedAudio.delete(r), this.callStatsInstance && s.audio && (this.callStatsInstance.logger.debug("callStats::measurements::producerAudioDefreezed", { producerId: r }), this.callStatsInstance.eventHandler.emit("producer_audio_status", "resume", r))));
  } }, { key: "processProducingTransportStats", value: function(r, n, a) {
    var i, s = (this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 ? void 0 : i.currentUserMediaStates) || {}, u = s.audio, c = s.video, d = s.screen, h = u || c || d;
    n.totalPacketsSent === a.packetsSent ? (this.freezedProducingTransportIds.add(r), this.callStatsInstance && h && (this.callStatsInstance.logger.debug("callStats::measurements::producingTransportFreezed", { transportId: r }), this.callStatsInstance.eventHandler.emit("producing_transport_status", "pause", r))) : (n.totalPacketsSent = a.packetsSent, this.freezedProducingTransportIds.has(r) && (this.freezedProducingTransportIds.delete(r), this.callStatsInstance && h && (this.callStatsInstance.logger.debug("callStats::measurements::producingTransportDefreezed", { transportId: r }), this.callStatsInstance.eventHandler.emit("producing_transport_status", "resume", r))));
  } }, { key: "processConsumingTransportStats", value: function(r, n, a) {
    var i, s = Array.from((this === null || this === void 0 || (i = this.callStatsInstance) === null || i === void 0 || (i = i.consumerSharedMediaStatesMap) === null || i === void 0 ? void 0 : i.values()) || []), u = !!s.reduce(function(c, d) {
      return c || d.audio || d.video || d.screen;
    }, !1);
    n.totalPacketsReceived === a.packetsSent ? (this.freezedConsumingTransportIds.add(r), this.callStatsInstance && u && (this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportFreezed", { transportId: r }), this.callStatsInstance.eventHandler.emit("consuming_transport_status", "pause", r))) : (n.totalPacketsReceived = a.packetsSent, this.freezedConsumingTransportIds.has(r) && (this.freezedConsumingTransportIds.delete(r), this.callStatsInstance && u && (this.callStatsInstance.logger.debug("callStats::measurements::consumingTransportDefreezed", { transportId: r }), this.callStatsInstance.eventHandler.emit("consuming_transport_status", "resume", r))));
  } }, { key: "registerConsumer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.generateConsumerStreamMap(a);
            case 2:
              this.consumerPeerIdMap.set(a.id, { producerId: a.producerId, peerId: a.appData.peerId, appData: a.appData }), a.on("close", this.deregisterConsumer.bind(this, a)), a.on("pause", this.pauseConsumer.bind(this, a.id)), a.on("resume", this.resumeConsumer.bind(this, a.id)), a.appData.screenShare === !0 && this.screenShareConsumers.add(a.id);
            case 7:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "pauseConsumer", value: function(r) {
    this.pausedConsumerMap.set(r, { lastReportCalculated: !1 });
  } }, { key: "resumeConsumer", value: function(r) {
    this.pausedConsumerMap.delete(r);
  } }, { key: "generateProducerStreamMap", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v = arguments;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              return i = v.length > 1 && v[1] !== void 0 ? v[1] : !1, g.next = 3, a.getStats();
            case 3:
              s = g.sent, u = i ? this.getProducerStatsFromReport(this.parseRTCReport(s, ["outbound-rtp", "remote-inbound-rtp"], !1, a.id))[0] : void 0, c = Fn(s.values()), g.prev = 6, c.s();
            case 8:
              if ((d = c.n()).done) {
                g.next = 17;
                break;
              }
              h = d.value, g.t0 = h.type, g.next = g.t0 === "outbound-rtp" ? 13 : 15;
              break;
            case 13:
              return this.outboundProducerMap.set(h.id, a.id), g.abrupt("break", 15);
            case 15:
              g.next = 8;
              break;
            case 17:
              g.next = 22;
              break;
            case 19:
              g.prev = 19, g.t1 = g.catch(6), c.e(g.t1);
            case 22:
              return g.prev = 22, c.f(), g.finish(22);
            case 25:
              return g.abrupt("return", u);
            case 26:
            case "end":
              return g.stop();
          }
      }, n, this, [[6, 19, 22, 25]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "generateConsumerStreamMap", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v = arguments;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              return i = v.length > 1 && v[1] !== void 0 ? v[1] : !1, g.next = 3, a.getStats();
            case 3:
              s = g.sent, u = i ? this.getConsumerStatsFromReport(this.parseRTCReport(s, ["inbound-rtp"], !1, a.id))[0] : void 0, c = Fn(s.values()), g.prev = 6, c.s();
            case 8:
              if ((d = c.n()).done) {
                g.next = 17;
                break;
              }
              h = d.value, g.t0 = h.type, g.next = g.t0 === "inbound-rtp" ? 13 : 15;
              break;
            case 13:
              return this.inboundConsumerMap.set(h.id, a.id), g.abrupt("break", 15);
            case 15:
              g.next = 8;
              break;
            case 17:
              g.next = 22;
              break;
            case 19:
              g.prev = 19, g.t1 = g.catch(6), c.e(g.t1);
            case 22:
              return g.prev = 22, c.f(), g.finish(22);
            case 25:
              return g.abrupt("return", u);
            case 26:
            case "end":
              return g.stop();
          }
      }, n, this, [[6, 19, 22, 25]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "deregisterProducer", value: function(r) {
    var n = this;
    this.outboundProducerMap.forEach(function(a, i) {
      a === r.id && n.outboundProducerMap.delete(i);
    }), this.pausedProducerMap.delete(r.id), this.screenShareProducers.delete(r.id);
  } }, {
    key: "deregisterConsumer",
    value: function(r) {
      var n = this;
      this.inboundConsumerMap.forEach(function(a, i) {
        a === r.id && n.inboundConsumerMap.delete(i);
      }), this.consumerPeerIdMap.delete(r.id), this.pausedConsumerMap.delete(r.id), this.screenShareConsumers.delete(r.id);
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "getIceCandidateStats",
    value: function(r) {
      var n;
      return { id: r.id, type: r.candidateType || r.type, address: r.address, port: r.port, url: r.url, protocol: (n = r.relayProtocol) !== null && n !== void 0 ? n : r.protocol, networkType: r.networkType, relatedAddress: r.relatedAddress, relatedPort: r.relatedPort };
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "getWorkingSimulcastVideoStats", value: function(r) {
    var n = r.find(function(a) {
      var i = a.framesEncoded > 0, s = a.packetsSent > 0, u = a.frameWidth && a.frameHeight;
      return i && s && !!u;
    });
    return n || r[r.length - 1];
  } }, { key: "parseRTCReport", value: function(r) {
    var n = this, a = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : [], i = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1, s = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : void 0, u = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : void 0, c = r, d = new sf(), h = a.length ? new Set(a) : void 0, v = [], f = [], g = [], k = /* @__PURE__ */ new Map(), y = /* @__PURE__ */ new Map(), b = Fn(c.values()), C;
    try {
      for (b.s(); !(C = b.n()).done; ) {
        var T = C.value;
        if (h) {
          if (h.size === 0)
            break;
          if (h.has(T.type))
            i && h.delete(T.type);
          else
            continue;
        }
        switch (T.type) {
          case "local-candidate": {
            v.push(this.getIceCandidateStats(T));
            break;
          }
          case "remote-candidate": {
            f.push(this.getIceCandidateStats(T));
            break;
          }
          case "candidate-pair": {
            var E = T.nominated, D = T.selected, I = T, _ = { nominated: E != null ? E : D, currentRoundTripTime: I.currentRoundTripTime, totalRoundTripTime: I.totalRoundTripTime, bytesReceived: I.bytesReceived, bytesSent: I.bytesSent, availableOutgoingBitrate: I.availableOutgoingBitrate, availableIncomingBitrate: I.availableIncomingBitrate, lastPacketReceivedTimestamp: I.lastPacketReceivedTimestamp, lastPacketSentTimestamp: I.lastPacketSentTimestamp, localCandidateId: I.localCandidateId, remoteCandidateId: I.remoteCandidateId, bytesDiscardedOnSend: I.bytesDiscardedOnSend, packetsSent: I.packetsSent, packetsReceived: I.packetsReceived, packetsDiscardedOnSend: I.packetsDiscardedOnSend };
            g.push(_), (T.nominated === !0 || T.selected === !0) && (d.candidatePair = _);
            break;
          }
          case "transport": {
            var V = T;
            u && (u.producing && (this.overallProducingTransportsStatsMap[u.id] || (this.overallProducingTransportsStatsMap[u.id] = { totalPacketsSent: 0 })), u.consuming && (this.overallConsumingTransportsStatsMap[u.id] || (this.overallConsumingTransportsStatsMap[u.id] = { totalPacketsReceived: 0 })));
            var F = {
              bytesReceived: V.bytesReceived,
              bytesSent: V.bytesSent,
              packetsSent: V.packetsSent,
              packetsReceived: V.packetsReceived,
              dtlsCipher: V.dtlsCipher,
              // @ts-ignore
              dtlsState: V.dtlsState,
              // @ts-ignore
              iceRole: V.iceRole
            };
            if (d.transport = F, u) {
              if (u.producing) {
                var N = this.overallProducingTransportsStatsMap[u.id];
                this.processProducingTransportStats(u.id, N, F);
              }
              if (u.consuming) {
                var L = this.overallConsumingTransportsStatsMap[u.id];
                this.processConsumingTransportStats(u.id, L, F);
              }
            }
            break;
          }
          case "remote-inbound-rtp": {
            var H = T, Q = { jitter: H.jitter, fractionLost: H.fractionLost, roundTripTime: H.roundTripTime, roundTripTimeMeasurements: H.roundTripTimeMeasurements, totalRoundTripTime: H.totalRoundTripTime, packetsLost: H.packetsLost };
            d.remoteInboundRtp.set(H.localId, Q);
            break;
          }
          case "outbound-rtp": {
            if (!this.outboundProducerMap.has(T.id))
              break;
            var B = T, G = s || this.outboundProducerMap.get(T.id), x = this.pausedProducerMap.get(G);
            if (x) {
              if (x.lastReportCalculated === !0)
                break;
              this.pausedProducerMap.set(G, { lastReportCalculated: !0 });
            }
            this.overallProducersStatsMap[G] || (this.overallProducersStatsMap[G] = { totalVideoPacketsSent: 0, totalAudioPacketsSent: 0 });
            var Pe = this.overallProducersStatsMap[G];
            if (["video", "audio"].includes(B.mediaType) || ["video", "audio"].includes(B.kind)) {
              var ie;
              if (!this.outboundProducerMap.has(T.id)) {
                d.staleProducerStreamMap = !0;
                break;
              }
              var le = this.callStatsInstance.producers.get(G);
              if ((le == null || (ie = le.track) === null || ie === void 0 ? void 0 : ie.readyState) === "ended")
                break;
              d.producerStreamMap.has(G) || d.producerStreamMap.set(G, { outboundVideoRtpId: [], outboundAudioRtpId: [] });
              var Fr = { bytesSent: B.bytesSent, packetsSent: B.packetsSent, nackCount: B.nackCount, ssrc: B.ssrc, mid: B.mid, active: B.active, codecId: B.codecId, headerBytesSent: B.headerBytesSent || 0, totalPacketSendDelay: B.totalPacketSendDelay || 0 };
              if (B.mediaType === "video" || B.kind === "video") {
                var Z = B, Lr = $({
                  frameHeight: Z.frameHeight,
                  frameWidth: Z.frameWidth,
                  framesEncoded: Z.framesEncoded,
                  framesDropped: Z.framesDropped,
                  framesPerSecond: Z.framesPerSecond,
                  framesSent: Z.framesSent,
                  keyFramesEncoded: Z.keyFramesEncoded,
                  firCount: Z.firCount,
                  encoderImplementation: Z.encoderImplementation,
                  hugeFramesSent: Z.hugeFramesSent,
                  pliCount: Z.pliCount,
                  qpSum: Z.qpSum,
                  qualityLimitationDurations: Z.qualityLimitationDurations,
                  qualityLimitationReason: Z.qualityLimitationReason,
                  qualityLimitationResolutionChanges: Z.qualityLimitationResolutionChanges,
                  // temp sending target bitrate in total encode time
                  // to avoid the delay with making the backend changes
                  totalEncodeTime: Z.targetBitrate,
                  totalPacketSendDelay: Z.totalPacketSendDelay,
                  retransmittedBytesSent: Z.retransmittedBytesSent,
                  retransmittedPacketsSent: Z.retransmittedPacketsSent,
                  scalabilityMode: Z.scalabilityMode,
                  powerEfficientEncoder: Z.powerEfficientEncoder
                }, Fr);
                d.outboundVideoRtp.set(T.id, Lr), d.producerStreamMap.get(G).outboundVideoRtpId.push(T.id), this.processOutboundProducerVideoStats(G, Pe, Lr);
              } else if (B.mediaType === "audio" || B.kind === "audio") {
                var ln = B, gt = $({ retransmittedBytesSent: ln.retransmittedBytesSent, retransmittedPacketsSent: ln.retransmittedPacketsSent }, Fr);
                d.outboundAudioRtp.set(T.id, gt), d.producerStreamMap.get(G).outboundAudioRtpId.push(T.id), this.processOutboundProducerAudioStats(G, Pe, gt);
              }
            } else
              this.callStatsInstance.logger.error("Callstats: Unknown Outbound-rtp. mediatype: ".concat(B.mediaType, " kind: ").concat(B.kind));
            break;
          }
          case "inbound-rtp": {
            if (!this.inboundConsumerMap.has(T.id))
              break;
            var ae = T, ee = s || this.inboundConsumerMap.get(T.id), Ya = this.pausedConsumerMap.get(ee);
            if (Ya) {
              if (Ya.lastReportCalculated === !0)
                break;
              this.pausedConsumerMap.set(ee, { lastReportCalculated: !0 });
            }
            if (ae.ssrc === 1234)
              break;
            this.overallConsumersStatsMap[ee] || (this.overallConsumersStatsMap[ee] = { totalVideoPacketsReceived: 0, totalAudioPacketsReceived: 0 });
            var Qa = this.overallConsumersStatsMap[ee];
            if (["video", "audio"].includes(ae.mediaType) || ["video", "audio"].includes(ae.kind)) {
              if (!this.inboundConsumerMap.has(T.id)) {
                d.staleConsumerStreamMap = !0;
                break;
              }
              d.consumerStreamMap.has(ee) || d.consumerStreamMap.set(ee, { inboundVideoRtpId: [], inboundAudioRtpId: [] });
              var ao = { bytesReceived: ae.bytesReceived, packetsReceived: ae.packetsReceived, packetsLost: ae.packetsLost >= 0 ? ae.packetsLost : 0, jitter: ae.jitter, nackCount: ae.nackCount, jitterBufferDelay: ae.jitterBufferDelay, jitterBufferEmittedCount: ae.jitterBufferEmittedCount, lastPacketReceivedTimestamp: ae.lastPacketReceivedTimestamp, ssrc: ae.ssrc, mid: ae.mid, codecId: ae.codecId, headerBytesReceived: ae.headerBytesReceived || 0, packetsDiscarded: ae.packetsDiscarded || 0, jitterBufferMinimumDelay: ae.jitterBufferMinimumDelay || 0, jitterBufferTargetDelay: ae.jitterBufferTargetDelay || 0 };
              if (ae.mediaType === "video" || ae.kind === "video") {
                var Ae, Li, $i, Ni, Vi, Ui, fe = ae, _e = $({ frameHeight: fe.frameHeight, frameWidth: fe.frameWidth, framesDecoded: fe.framesDecoded, framesDropped: fe.framesDropped, framesPerSecond: fe.framesPerSecond, framesReceived: fe.framesReceived, keyFramesDecoded: fe.keyFramesDecoded, firCount: fe.firCount, decoderImplementation: fe.decoderImplementation, pliCount: fe.pliCount, totalProcessingDelay: fe.totalProcessingDelay, qpSum: fe.qpSum || 0, totalAssemblyTime: fe.totalAssemblyTime || 0, totalDecodeTime: fe.totalDecodeTime || 0, totalFreezesDuration: fe.totalFreezesDuration || 0, totalInterFrameDelay: fe.totalInterFrameDelay || 0, totalPausesDuration: fe.totalPausesDuration || 0, totalSquaredInterFrameDelay: fe.totalSquaredInterFrameDelay || 0, freezeCount: fe.freezeCount || 0, pauseCount: fe.pauseCount || 0, powerEfficientDecoder: fe.powerEfficientDecoder }, ao);
                _e.score = nf({ frameWidth: _e.frameWidth || 0, framesDecoded: (_e.framesDecoded || 0) - (((Ae = this.videoConsumerToStatsMap.get(ee)) === null || Ae === void 0 ? void 0 : Ae.framesDecoded) || 0), framesPerSecond: _e.framesPerSecond || 0, packetsLost: (_e.packetsLost || 0) - (((Li = this.videoConsumerToStatsMap.get(ee)) === null || Li === void 0 ? void 0 : Li.packetsLost) || 0), packetsReceived: (_e.packetsReceived || 0) - ((($i = this.videoConsumerToStatsMap.get(ee)) === null || $i === void 0 ? void 0 : $i.packetsReceived) || 0), jitter: _e.jitter || 0, isScreenShare: this.screenShareConsumers.has(ee) }), y.set(ee, {
                  score: +(_e.score * 10).toFixed(),
                  frameWidth: _e.frameWidth || 0,
                  frameHeight: _e.frameHeight || 0,
                  framesPerSecond: _e.framesPerSecond || 0,
                  packetsLostPercentage: Ql({ packetsLost: (_e.packetsLost || 0) - (((Ni = this.videoConsumerToStatsMap.get(ee)) === null || Ni === void 0 ? void 0 : Ni.packetsLost) || 0), packetsReceived: (_e.packetsReceived || 0) - (((Vi = this.videoConsumerToStatsMap.get(ee)) === null || Vi === void 0 ? void 0 : Vi.packetsReceived) || 0) }),
                  jitter: _e.jitter || 0,
                  isScreenShare: this.screenShareConsumers.has(ee),
                  bitrate: ((_e.bytesReceived || 0) - (((Ui = this.videoConsumerToStatsMap.get(ee)) === null || Ui === void 0 ? void 0 : Ui.bytesReceived) || 0)) * 8 / 7
                  // Bytes received in last 7 seconds
                }), this.videoConsumerToStatsMap.set(ee, _e), d.inboundVideoRtp.set(T.id, _e), d.consumerStreamMap.get(ee).inboundVideoRtpId.push(T.id), this.processInboundConsumerVideoStats(ee, Qa, _e);
              } else if (ae.mediaType === "audio" || ae.kind === "audio") {
                var ji, Fi, Hi, Bi, qi, Gi, hr = ae, er = $({ audioLevel: hr.audioLevel, concealedSamples: hr.concealedSamples, concealmentEvents: hr.concealmentEvents, totalAudioEnergy: hr.totalAudioEnergy, totalSamplesDuration: hr.totalSamplesDuration, totalSamplesReceived: hr.totalSamplesReceived, fecPacketsDiscarded: hr.fecPacketsDiscarded || 0, fecPacketsReceived: hr.fecPacketsReceived || 0, insertedSamplesForDeceleration: hr.insertedSamplesForDeceleration || 0, removedSamplesForAcceleration: hr.removedSamplesForAcceleration || 0, silentConcealedSamples: hr.silentConcealedSamples || 0, playoutId: hr.playoutId }, ao);
                er.score = tf({ concealmentEvents: (er.concealmentEvents || 0) - (((ji = this.audioConsumerToStatsMap.get(ee)) === null || ji === void 0 ? void 0 : ji.concealmentEvents) || 0), packetsLost: (er.packetsLost || 0) - (((Fi = this.audioConsumerToStatsMap.get(ee)) === null || Fi === void 0 ? void 0 : Fi.packetsLost) || 0), packetsReceived: (er.packetsReceived || 0) - (((Hi = this.audioConsumerToStatsMap.get(ee)) === null || Hi === void 0 ? void 0 : Hi.packetsReceived) || 0), jitter: er.jitter || 0 }), y.set(ee, {
                  score: +(er.score * 10).toFixed(),
                  packetsLostPercentage: Ql({ packetsLost: (er.packetsLost || 0) - (((Bi = this.audioConsumerToStatsMap.get(ee)) === null || Bi === void 0 ? void 0 : Bi.packetsLost) || 0), packetsReceived: (er.packetsReceived || 0) - (((qi = this.audioConsumerToStatsMap.get(ee)) === null || qi === void 0 ? void 0 : qi.packetsReceived) || 0) }),
                  jitter: er.jitter || 0,
                  isScreenShare: this.screenShareConsumers.has(ee),
                  bitrate: ((er.bytesReceived || 0) - (((Gi = this.audioConsumerToStatsMap.get(ee)) === null || Gi === void 0 ? void 0 : Gi.bytesReceived) || 0)) * 8 / 7
                  // Bytes received in last 7 seconds
                }), this.audioConsumerToStatsMap.set(ee, er), d.inboundAudioRtp.set(T.id, er), d.consumerStreamMap.get(ee).inboundAudioRtpId.push(T.id), this.processInboundConsumerAudioStats(ee, Qa, er);
              }
            } else
              this.callStatsInstance.logger.error("Callstats: Unknown Inbound-rtp. mediatype: ".concat(ae.mediaType, " kind: ").concat(ae.kind));
            break;
          }
        }
      }
    } catch (re) {
      b.e(re);
    } finally {
      b.f();
    }
    if (d.producerStreamMap.forEach(function(re, ne) {
      if (re.outboundVideoRtpId.length > 0) {
        var $r, Sr, Ji, Nt, Ki, zi, Yi, Qi, Vt, Xi, Wo = [];
        re.outboundVideoRtpId.forEach(function(Nc) {
          Wo.push(d.outboundVideoRtp.get(Nc));
        });
        var Oe = n.getWorkingSimulcastVideoStats(Wo);
        Oe.score = ef({ frameWidth: Oe.frameWidth || 0, framesPerSecond: Oe.framesPerSecond || 0, jitter: (($r = Oe.remoteData) === null || $r === void 0 ? void 0 : $r.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne), packetsSent: (Oe.packetsSent || 0) - (((Sr = n.videoProducerToStatsMap.get(ne)) === null || Sr === void 0 ? void 0 : Sr.packetsSent) || 0), packetsLost: (((Ji = Oe.remoteData) === null || Ji === void 0 ? void 0 : Ji.packetsLost) || 0) - (((Nt = n.videoProducerToStatsMap.get(ne)) === null || Nt === void 0 || (Nt = Nt.remoteData) === null || Nt === void 0 ? void 0 : Nt.packetsLost) || 0), framesEncoded: (Oe.framesEncoded || 0) - (((Ki = n.videoProducerToStatsMap.get(ne)) === null || Ki === void 0 ? void 0 : Ki.framesEncoded) || 0) }), k.set(ne, { score: +(Oe.score * 10).toFixed(), frameWidth: Oe.frameWidth || 0, frameHeight: Oe.frameHeight || 0, framesPerSecond: Oe.framesPerSecond || 0, jitter: ((zi = Oe.remoteData) === null || zi === void 0 ? void 0 : zi.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne), packetsLostPercentage: Yl({ packetsSent: (Oe.packetsSent || 0) - (((Yi = n.videoProducerToStatsMap.get(ne)) === null || Yi === void 0 ? void 0 : Yi.packetsSent) || 0), packetsLost: (((Qi = Oe.remoteData) === null || Qi === void 0 ? void 0 : Qi.packetsLost) || 0) - (((Vt = n.videoProducerToStatsMap.get(ne)) === null || Vt === void 0 || (Vt = Vt.remoteData) === null || Vt === void 0 ? void 0 : Vt.packetsLost) || 0) }), bitrate: ((Oe.bytesSent || 0) - (((Xi = n.videoProducerToStatsMap.get(ne)) === null || Xi === void 0 ? void 0 : Xi.bytesSent) || 0)) * 8 / 7, cpuLimitations: Oe.qualityLimitationReason === "cpu", bandwidthLimitations: Oe.qualityLimitationReason === "bandwidth" }), n.videoProducerToStatsMap.set(ne, Oe);
      } else if (re.outboundAudioRtpId.length > 0) {
        var Zi, xi, Ut, es, rs, ts, ns, jt, as, Nr = d.outboundAudioRtp.get(re.outboundAudioRtpId[0]);
        Nr.score = xv({ packetsSent: (Nr.packetsSent || 0) - (((Zi = n.audioProducerToStatsMap.get(ne)) === null || Zi === void 0 ? void 0 : Zi.packetsSent) || 0), packetsLost: (((xi = Nr.remoteData) === null || xi === void 0 ? void 0 : xi.packetsLost) || 0) - (((Ut = n.audioProducerToStatsMap.get(ne)) === null || Ut === void 0 || (Ut = Ut.remoteData) === null || Ut === void 0 ? void 0 : Ut.packetsLost) || 0), jitter: ((es = Nr.remoteData) === null || es === void 0 ? void 0 : es.jitter) || 0 }), k.set(ne, { score: +(Nr.score * 10).toFixed(), bitrate: ((Nr.bytesSent || 0) - (((rs = n.audioProducerToStatsMap.get(ne)) === null || rs === void 0 ? void 0 : rs.bytesSent) || 0)) * 8 / 7, packetsLostPercentage: Yl({ packetsSent: (Nr.packetsSent || 0) - (((ts = n.audioProducerToStatsMap.get(ne)) === null || ts === void 0 ? void 0 : ts.packetsSent) || 0), packetsLost: (((ns = Nr.remoteData) === null || ns === void 0 ? void 0 : ns.packetsLost) || 0) - (((jt = n.audioProducerToStatsMap.get(ne)) === null || jt === void 0 || (jt = jt.remoteData) === null || jt === void 0 ? void 0 : jt.packetsLost) || 0) }), jitter: ((as = Nr.remoteData) === null || as === void 0 ? void 0 : as.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne) }), n.audioProducerToStatsMap.set(ne, Nr);
      }
    }), g.forEach(function(re) {
      var ne = v.find(function(Sr) {
        return Sr.id === re.localCandidateId ? (re.localCandidateId = Sr.id, Sr) : null;
      }), $r = f.find(function(Sr) {
        return Sr.id === re.remoteCandidateId ? (re.remoteCandidateId = Sr.id, Sr) : null;
      });
      ne && (re.localCandidateType = ne.type, re.localCandidateAddress = Ii(ne.address), re.localCandidatePort = ne.port, re.localCandidateProtocol = ne.protocol, re.localCandidateUrl = ne.url, re.localCandidateNetworkType = ne.networkType, re.localCandidateRelatedAddress = Ii(ne.relatedAddress), re.localCandidateRelatedPort = ne.relatedPort), $r && (re.remoteCandidateType = $r.type, re.remoteCandidateAddress = Ii($r.address), re.remoteCandidatePort = $r.port, re.remoteCandidateProtocol = $r.protocol, re.remoteCandidateUrl = $r.url);
    }), d.candidatePair && (d.transport ? (d.transport.totalRoundTripTime = d.candidatePair.totalRoundTripTime, d.transport.availableOutgoingBitrate = d.candidatePair.availableOutgoingBitrate, d.transport.availableIncomingBitrate = d.candidatePair.availableIncomingBitrate, d.transport.roundTripTime = d.candidatePair.currentRoundTripTime) : d.transport = {
      // candidateStats: result.candidatePair,
      bytesReceived: d.candidatePair.bytesReceived,
      bytesSent: d.candidatePair.bytesSent,
      totalRoundTripTime: d.candidatePair.totalRoundTripTime,
      availableOutgoingBitrate: d.candidatePair.availableOutgoingBitrate,
      availableIncomingBitrate: d.candidatePair.availableIncomingBitrate,
      roundTripTime: d.candidatePair.currentRoundTripTime
    }), d.transport && (d.transport.candidatePairs = g), d.transport && !d.transport.roundTripTime) {
      var Wi = 0, Go = 0;
      d.remoteInboundRtp.forEach(function(re, ne) {
        re.roundTripTime && re.roundTripTime > Wi && (Wi = re.roundTripTime, Go = re.totalRoundTripTime);
      }), d.transport.roundTripTime = Wi, d.transport.totalRoundTripTime = Go;
    }
    if (y.size > 0)
      try {
        this.observer.emit("consumer_score", y);
      } catch (re) {
      }
    if (k.size > 0)
      try {
        this.observer.emit("producer_score", k);
      } catch (re) {
      }
    return d;
  } }, { key: "getProducersReport", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return s = a.map(function(d) {
                return i.generateProducerStreamMap(d, !0);
              }), c.abrupt("return", s.length > 0 ? Promise.all(s) : void 0);
            case 2:
            case "end":
              return c.stop();
          }
      }, n);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "getConsumersReport",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i = this, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                return s = a.map(function(d) {
                  return i.generateConsumerStreamMap(d, !0);
                }), c.abrupt("return", s.length > 0 ? Promise.all(s) : void 0);
              case 2:
              case "end":
                return c.stop();
            }
        }, n);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "getTransportReport", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", a.getStats());
            case 1:
            case "end":
              return s.stop();
          }
      }, n);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "getProcessedStats",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
        var u, c, d, h, v, f, g;
        return p().wrap(function(y) {
          for (; ; )
            switch (y.prev = y.next) {
              case 0:
                return y.next = 2, this.getTransportReport(a);
              case 2:
                if (u = y.sent, c = { producing: s, consuming: i, id: a.id }, d = u, h = this.parseRTCReport(d, ["transport", "candidate-pair", "inbound-rtp", "outbound-rtp", "remote-inbound-rtp", "local-candidate", "remote-candidate"], !1, void 0, c), h) {
                  y.next = 8;
                  break;
                }
                return y.abrupt("return", void 0);
              case 8:
                return v = { stats: h.transport, transportId: a.id, consuming: i, producing: s }, f = h.staleProducerStreamMap ? void 0 : this.getProducerStatsFromReport(h), g = h.staleConsumerStreamMap ? void 0 : this.getConsumerStatsFromReport(h), y.abrupt("return", { transportReport: v, producerReport: f, consumerReport: g });
              case 12:
              case "end":
                return y.stop();
            }
        }, n, this);
      }));
      function r(n, a, i) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "getProducerStatsFromReport", value: function(r) {
    var n = this, a = [];
    try {
      r.producerStreamMap.forEach(function(i, s) {
        var u;
        a.push({ producerId: s, videoStats: i.outboundVideoRtpId.map(function(c) {
          return r.outboundVideoRtp.get(c);
        }), audioStats: i.outboundAudioRtpId.map(function(c) {
          return r.outboundAudioRtp.get(c);
        }), appData: ((u = n.callStatsInstance.producers) === null || u === void 0 || (u = u.get(s)) === null || u === void 0 ? void 0 : u.appData) || null });
      });
    } catch (i) {
      this.callStatsInstance.logger.error("callStats::measurements::getProducerStatsFromReport", { error: { reason: i.reason, message: i.message } });
    }
    return a;
  } }, {
    key: "getConsumerStatsFromReport",
    value: function(r) {
      var n = this, a = [];
      try {
        r.consumerStreamMap.forEach(function(i, s) {
          var u = n.consumerPeerIdMap.get(s), c = u.peerId, d = u.producerId, h = u.appData;
          a.push({ consumerId: s, peerId: c, producerId: d, appData: h, videoStats: i.inboundVideoRtpId.map(function(v) {
            return r.inboundVideoRtp.get(v);
          }), audioStats: i.inboundAudioRtpId.map(function(v) {
            return r.inboundAudioRtp.get(v);
          }) });
        });
      } catch (i) {
        console.error("getConsumersReport: ", i, r);
      }
      return a;
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "getUserLocation",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                return i.abrupt("return", new Promise(function(s, u) {
                  try {
                    navigator.geolocation ? navigator.geolocation.getCurrentPosition(function(c) {
                      s(c);
                    }) : u();
                  } catch (c) {
                    u(c);
                  }
                }));
              case 1:
              case "end":
                return i.stop();
            }
        }, n);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "getConnectivity",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s, u, c, d, h, v, f, g;
        return p().wrap(function(y) {
          for (; ; )
            switch (y.prev = y.next) {
              case 0:
                return y.prev = 0, i = { iceServers: a || sh }, s = new Promise(function(b, C) {
                  try {
                    var T = new Km(i);
                    T.addListener("done", b), T.addListener("failed", function() {
                      b({ connectivity: !1 });
                    }), T.start(2e3);
                  } catch (E) {
                    C(E);
                  }
                }), u = new Promise(function(b, C) {
                  try {
                    var T = new zm(i);
                    T.addListener("done", b), T.addListener("failed", function() {
                      b({ connectivity: !1 });
                    }), T.start(2e3);
                  } catch (E) {
                    C(E);
                  }
                }), c = new Promise(function(b, C) {
                  try {
                    var T = new Ym(i);
                    T.addListener("done", b), T.addListener("failed", function() {
                      b({ connectivity: !1 });
                    }), T.start(2e3);
                  } catch (E) {
                    C(E);
                  }
                }), y.next = 7, Promise.all([s, u, c]);
              case 7:
                return d = y.sent, h = He(d, 3), v = h[0], f = h[1], g = h[2], y.abrupt("return", { host: v == null ? void 0 : v.connectivity, relay: f == null ? void 0 : f.connectivity, reflexive: g == null ? void 0 : g.connectivity });
              case 15:
                return y.prev = 15, y.t0 = y.catch(0), y.abrupt("return", { host: !1, relay: !1, reflexive: !1 });
              case 18:
              case "end":
                return y.stop();
            }
        }, n, null, [[0, 15]]);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "getThroughput", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.prev = 0, i = new Promise(function(d, h) {
                try {
                  var v = { iceServers: a || sh }, f = new Jm(v);
                  f.addListener("done", d), f.addListener("failed", h), f.start(1e4);
                } catch (g) {
                  h(g);
                }
              }), c.next = 4, i;
            case 4:
              return s = c.sent, c.abrupt("return", { throughput: s.throughput, fractionalLoss: 0, RTT: s.RTT, jitter: 0, backendRTT: s.backendRTT });
            case 8:
              return c.prev = 8, c.t0 = c.catch(0), c.abrupt("return", void 0);
            case 11:
            case "end":
              return c.stop();
          }
      }, n, null, [[0, 8]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getIPDetails", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (u.prev = 0, this.ipDetails) {
                u.next = 5;
                break;
              }
              return u.next = 4, Sp.getIPDetails({ peerId: (a = this.callStatsInstance) === null || a === void 0 ? void 0 : a.peerId, apiHostnames: (i = this.callStatsInstance) === null || i === void 0 ? void 0 : i.apiHostnames, logger: this.callStatsInstance.logger });
            case 4:
              this.ipDetails = u.sent;
            case 5:
              return u.abrupt("return", this.ipDetails);
            case 8:
              return u.prev = 8, u.t0 = u.catch(0), u.abrupt("return", void 0);
            case 11:
            case "end":
              return u.stop();
          }
      }, n, this, [[0, 8]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getNetworkQuality", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return h.next = 2, Promise.all([this.getConnectivity(a), this.getThroughput(a)]);
            case 2:
              return i = h.sent, s = He(i, 2), u = s[0], c = s[1], h.abrupt("return", { connectivity: u, throughput: c == null ? void 0 : c.throughput, fractionalLoss: c == null ? void 0 : c.fractionalLoss, RTT: c == null ? void 0 : c.RTT, jitter: c == null ? void 0 : c.jitter, backendRTT: c == null ? void 0 : c.backendRTT });
            case 7:
            case "end":
              return h.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getNetworkInfo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v, f, g, k = arguments;
      return p().wrap(function(b) {
        for (; ; )
          switch (b.prev = b.next) {
            case 0:
              if (s = k.length > 1 && k[1] !== void 0 ? k[1] : !1, !s) {
                b.next = 6;
                break;
              }
              return b.next = 4, this.getIPDetails();
            case 4:
              return c = b.sent, b.abrupt("return", {
                ipDetails: c,
                effectiveNetworkType: (u = navigator.connection) === null || u === void 0 ? void 0 : u.effectiveType,
                location: c != null && c.loc ? oh(c == null ? void 0 : c.loc) : void 0
                // userLocation,
              });
            case 6:
              return b.next = 8, Promise.all([this.getConnectivity(a), this.getThroughput(a), this.getIPDetails()]);
            case 8:
              return d = b.sent, h = He(d, 3), v = h[0], f = h[1], g = h[2], b.abrupt("return", { ipDetails: g, effectiveNetworkType: (i = navigator.connection) === null || i === void 0 ? void 0 : i.effectiveType, location: g != null && g.loc ? oh(g == null ? void 0 : g.loc) : void 0, turnConnectivity: v ? v.host || v.relay || v.reflexive : !1, connectivity: v, throughput: f == null ? void 0 : f.throughput, fractionalLoss: f == null ? void 0 : f.fractionalLoss, RTT: f == null ? void 0 : f.RTT, jitter: f == null ? void 0 : f.jitter, backendRTT: f == null ? void 0 : f.backendRTT });
            case 14:
            case "end":
              return b.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(ht), Xm = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t);
}(of), uf = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    w(this, t);
    for (var r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    return e = R(this, t, [].concat(n)), e.producerMap = /* @__PURE__ */ new Map(), e.consumerMap = /* @__PURE__ */ new Map(), e;
  }
  return A(t, o), P(t, [{ key: "registerProducer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.producerMap.set(a.id, a), s.next = 3, this.generateProducerStreamMap(a);
            case 3:
              a.on("close", this.deregisterProducer.bind(this, a)), a.on("pause", this.pauseProducer.bind(this, a.id)), a.on("resume", this.resumeProducer.bind(this, a.id)), a.appData.screenShare === !0 && this.screenShareProducers.add(a.id);
            case 7:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "registerConsumer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.consumerMap.set(a.id, a), s.next = 3, this.generateConsumerStreamMap(a);
            case 3:
              this.consumerPeerIdMap.set(a.id, { producerId: a.producerId, peerId: a.appData.peerId, appData: a.appData }), a.on("close", this.deregisterConsumer.bind(this, a)), a.on("pause", this.pauseConsumer.bind(this, a.id)), a.on("resume", this.resumeConsumer.bind(this, a.id)), a.appData.screenShare === !0 && this.screenShareConsumers.add(a.id);
            case 8:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "generateConsumerStreamMap", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v, f, g = arguments;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              return i = g.length > 1 && g[1] !== void 0 ? g[1] : !1, y.next = 3, a.getStats();
            case 3:
              s = y.sent, u = this.parseRTCReport(s, ["inbound-rtp"], !1, a.id), c = Se(u.consumerStreamMap.values())[0], d = i ? this.getConsumerStatsFromParsedConsumerStats(u, c, a.id) : void 0, h = Fn(s.values()), y.prev = 8, h.s();
            case 10:
              if ((v = h.n()).done) {
                y.next = 19;
                break;
              }
              f = v.value, y.t0 = f.type, y.next = y.t0 === "inbound-rtp" ? 15 : 17;
              break;
            case 15:
              return this.inboundConsumerMap.set(f.id, a.id), y.abrupt("break", 17);
            case 17:
              y.next = 10;
              break;
            case 19:
              y.next = 24;
              break;
            case 21:
              y.prev = 21, y.t1 = y.catch(8), h.e(y.t1);
            case 24:
              return y.prev = 24, h.f(), y.finish(24);
            case 27:
              return y.abrupt("return", d);
            case 28:
            case "end":
              return y.stop();
          }
      }, n, this, [[8, 21, 24, 27]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "deregisterProducer", value: function(r) {
    var n = this;
    this.producerMap.delete(r.id), this.outboundProducerMap.forEach(function(a, i) {
      a === r.id && n.outboundProducerMap.delete(i);
    }), this.pausedProducerMap.delete(r.id), this.screenShareProducers.delete(r.id);
  } }, {
    key: "deregisterConsumer",
    value: function(r) {
      var n = this;
      this.consumerMap.delete(r.id), this.inboundConsumerMap.forEach(function(a, i) {
        a === r.id && n.inboundConsumerMap.delete(i);
      }), this.consumerPeerIdMap.delete(r.id), this.pausedConsumerMap.delete(r.id), this.screenShareConsumers.delete(r.id);
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "getIceCandidateStats", value: function(r) {
    var n;
    return { id: r.id, type: r.candidateType || r.type, address: r.address, port: r.port, url: r.url, protocol: (n = r.relayProtocol) !== null && n !== void 0 ? n : r.protocol, networkType: r.networkType, relatedAddress: r.relatedAddress, relatedPort: r.relatedPort };
  } }, { key: "parseRTCReport", value: function(r) {
    var n = this, a = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : [], i = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1, s = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : void 0, u = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : void 0, c = r, d = new sf(), h = a.length ? new Set(a) : void 0, v = [], f = [], g = [], k = /* @__PURE__ */ new Map(), y = /* @__PURE__ */ new Map(), b = Fn(c.values()), C;
    try {
      for (b.s(); !(C = b.n()).done; ) {
        var T = C.value;
        if (h) {
          if (h.size === 0)
            break;
          if (h.has(T.type))
            i && h.delete(T.type);
          else
            continue;
        }
        switch (T.type) {
          case "local-candidate": {
            v.push(this.getIceCandidateStats(T));
            break;
          }
          case "remote-candidate": {
            f.push(this.getIceCandidateStats(T));
            break;
          }
          case "candidate-pair": {
            var E = T.nominated, D = T.selected, I = T, _ = { nominated: E != null ? E : D, currentRoundTripTime: I.currentRoundTripTime, totalRoundTripTime: I.totalRoundTripTime, bytesReceived: I.bytesReceived, bytesSent: I.bytesSent, availableOutgoingBitrate: I.availableOutgoingBitrate, availableIncomingBitrate: I.availableIncomingBitrate, lastPacketReceivedTimestamp: I.lastPacketReceivedTimestamp, lastPacketSentTimestamp: I.lastPacketSentTimestamp, localCandidateId: I.localCandidateId, remoteCandidateId: I.remoteCandidateId, bytesDiscardedOnSend: I.bytesDiscardedOnSend, packetsSent: I.packetsSent, packetsReceived: I.packetsReceived, packetsDiscardedOnSend: I.packetsDiscardedOnSend };
            g.push(_), (T.nominated === !0 || T.selected === !0) && (d.candidatePair = _);
            break;
          }
          case "transport": {
            var V = T;
            u && (u.producing && (this.overallProducingTransportsStatsMap[u.id] || (this.overallProducingTransportsStatsMap[u.id] = { totalPacketsSent: 0 })), u.consuming && (this.overallConsumingTransportsStatsMap[u.id] || (this.overallConsumingTransportsStatsMap[u.id] = { totalPacketsReceived: 0 })));
            var F = { bytesReceived: V.bytesReceived, bytesSent: V.bytesSent, packetsSent: V.packetsSent, packetsReceived: V.packetsReceived, dtlsCipher: V.dtlsCipher, dtlsState: V.dtlsState, iceRole: V.iceRole };
            if (d.transport = F, u) {
              if (u.producing) {
                var N = this.overallProducingTransportsStatsMap[u.id];
                this.processProducingTransportStats(u.id, N, F);
              }
              if (u.consuming) {
                var L = this.overallConsumingTransportsStatsMap[u.id];
                this.processConsumingTransportStats(u.id, L, F);
              }
            }
            break;
          }
          case "remote-inbound-rtp": {
            var H = T, Q = { jitter: H.jitter, fractionLost: H.fractionLost, roundTripTime: H.roundTripTime, roundTripTimeMeasurements: H.roundTripTimeMeasurements, totalRoundTripTime: H.totalRoundTripTime, packetsLost: H.packetsLost };
            d.remoteInboundRtp.set(H.localId, Q);
            break;
          }
          case "outbound-rtp": {
            if (!this.outboundProducerMap.has(T.id))
              break;
            var B = T, G = s || this.outboundProducerMap.get(T.id), x = this.pausedProducerMap.get(G);
            if (x) {
              if (x.lastReportCalculated === !0)
                break;
              this.pausedProducerMap.set(G, { lastReportCalculated: !0 });
            }
            this.overallProducersStatsMap[G] || (this.overallProducersStatsMap[G] = { totalVideoPacketsSent: 0, totalAudioPacketsSent: 0 });
            var Pe = this.overallProducersStatsMap[G];
            if (["video", "audio"].includes(B.mediaType) || ["video", "audio"].includes(B.kind)) {
              var ie;
              if (!this.outboundProducerMap.has(T.id)) {
                d.staleProducerStreamMap = !0;
                break;
              }
              var le = this.callStatsInstance.producers.get(G);
              if ((le == null || (ie = le.track) === null || ie === void 0 ? void 0 : ie.readyState) === "ended")
                break;
              d.producerStreamMap.has(G) || d.producerStreamMap.set(G, { outboundVideoRtpId: [], outboundAudioRtpId: [] });
              var Fr = { bytesSent: B.bytesSent, packetsSent: B.packetsSent, nackCount: B.nackCount, ssrc: B.ssrc, mid: B.mid, active: B.active, codecId: B.codecId, headerBytesSent: B.headerBytesSent || 0, totalPacketSendDelay: B.totalPacketSendDelay || 0 };
              if (B.mediaType === "video" || B.kind === "video") {
                var Z = B, Lr = $({ frameHeight: Z.frameHeight, frameWidth: Z.frameWidth, framesEncoded: Z.framesEncoded, framesDropped: Z.framesDropped ? Z.framesDropped : Z.droppedFrames, framesPerSecond: Z.framesPerSecond ? Z.framesPerSecond : Z.framerateMean, framesSent: Z.framesSent, keyFramesEncoded: Z.keyFramesEncoded, firCount: Z.firCount, encoderImplementation: Z.encoderImplementation, hugeFramesSent: Z.hugeFramesSent, pliCount: Z.pliCount, qpSum: Z.qpSum, qualityLimitationReason: Z.qualityLimitationReason, qualityLimitationDurations: Z.qualityLimitationDurations, qualityLimitationResolutionChanges: Z.qualityLimitationResolutionChanges, totalEncodeTime: Z.totalEncodeTime, totalPacketSendDelay: Z.totalEncodeTime, retransmittedBytesSent: Z.retransmittedBytesSent, retransmittedPacketsSent: Z.retransmittedPacketsSent, scalabilityMode: Z.scalabilityMode, powerEfficientEncoder: Z.powerEfficientEncoder }, Fr);
                d.outboundVideoRtp.set(T.id, Lr), d.producerStreamMap.get(G).outboundVideoRtpId.push(T.id), this.processOutboundProducerVideoStats(G, Pe, Lr);
              } else if (B.mediaType === "audio" || B.kind === "audio") {
                var ln = B, gt = $({ retransmittedBytesSent: ln.retransmittedBytesSent, retransmittedPacketsSent: ln.retransmittedPacketsSent }, Fr);
                d.outboundAudioRtp.set(T.id, gt), d.producerStreamMap.get(G).outboundAudioRtpId.push(T.id), this.processOutboundProducerAudioStats(G, Pe, gt);
              }
            } else
              this.callStatsInstance.logger.error("Callstats: Unknown Outbound-rtp. mediatype: ".concat(B.mediaType, " kind: ").concat(B.kind));
            break;
          }
          case "inbound-rtp": {
            if (!this.inboundConsumerMap.has(T.id))
              break;
            var ae = T, ee = s || this.inboundConsumerMap.get(T.id), Ya = this.pausedConsumerMap.get(ee);
            if (Ya) {
              if (Ya.lastReportCalculated === !0)
                break;
              this.pausedConsumerMap.set(ee, { lastReportCalculated: !0 });
            }
            if (ae.ssrc === 1234)
              break;
            this.overallConsumersStatsMap[ee] || (this.overallConsumersStatsMap[ee] = { totalVideoPacketsReceived: 0, totalAudioPacketsReceived: 0 });
            var Qa = this.overallConsumersStatsMap[ee];
            if (["video", "audio"].includes(ae.mediaType) || ["video", "audio"].includes(ae.kind)) {
              if (!this.inboundConsumerMap.has(T.id)) {
                d.staleConsumerStreamMap = !0;
                break;
              }
              d.consumerStreamMap.has(ee) || d.consumerStreamMap.set(ee, { inboundVideoRtpId: [], inboundAudioRtpId: [] });
              var ao = { bytesReceived: ae.bytesReceived, packetsReceived: ae.packetsReceived, packetsLost: ae.packetsLost >= 0 ? ae.packetsLost : 0, jitter: ae.jitter, nackCount: ae.nackCount, jitterBufferDelay: ae.jitterBufferDelay, jitterBufferEmittedCount: ae.jitterBufferEmittedCount, lastPacketReceivedTimestamp: ae.lastPacketReceivedTimestamp, ssrc: ae.ssrc, mid: ae.mid, codecId: ae.codecId, headerBytesReceived: ae.headerBytesReceived || 0, packetsDiscarded: ae.packetsDiscarded || 0, jitterBufferMinimumDelay: ae.jitterBufferMinimumDelay || 0, jitterBufferTargetDelay: ae.jitterBufferTargetDelay || 0 };
              if (ae.mediaType === "video" || ae.kind === "video") {
                var Ae, Li, $i, Ni, Vi, Ui, fe = ae, _e = $({ frameHeight: fe.frameHeight, frameWidth: fe.frameWidth, framesDecoded: fe.framesDecoded, framesDropped: fe.framesDropped ? fe.framesDropped : fe.droppedFrames, framesPerSecond: fe.framesPerSecond ? fe.framesPerSecond : fe.framerateMean, framesReceived: fe.framesReceived, keyFramesDecoded: fe.keyFramesDecoded, firCount: fe.firCount, decoderImplementation: fe.decoderImplementation, pliCount: fe.pliCount, totalProcessingDelay: fe.totalProcessingDelay, qpSum: fe.qpSum || 0, totalAssemblyTime: fe.totalAssemblyTime || 0, totalDecodeTime: fe.totalDecodeTime || 0, totalFreezesDuration: fe.totalFreezesDuration || 0, totalInterFrameDelay: fe.totalInterFrameDelay || 0, totalPausesDuration: fe.totalPausesDuration || 0, totalSquaredInterFrameDelay: fe.totalSquaredInterFrameDelay || 0, freezeCount: fe.freezeCount || 0, pauseCount: fe.pauseCount || 0, powerEfficientDecoder: fe.powerEfficientDecoder }, ao);
                _e.score = nf({ frameWidth: _e.frameWidth || 0, framesDecoded: (_e.framesDecoded || 0) - (((Ae = this.videoConsumerToStatsMap.get(ee)) === null || Ae === void 0 ? void 0 : Ae.framesDecoded) || 0), framesPerSecond: _e.framesPerSecond || 0, packetsLost: (_e.packetsLost || 0) - (((Li = this.videoConsumerToStatsMap.get(ee)) === null || Li === void 0 ? void 0 : Li.packetsLost) || 0), packetsReceived: (_e.packetsReceived || 0) - ((($i = this.videoConsumerToStatsMap.get(ee)) === null || $i === void 0 ? void 0 : $i.packetsReceived) || 0), jitter: _e.jitter || 0, isScreenShare: this.screenShareConsumers.has(ee) }), y.set(ee, {
                  score: +(_e.score * 10).toFixed(),
                  frameWidth: _e.frameWidth || 0,
                  frameHeight: _e.frameHeight || 0,
                  framesPerSecond: _e.framesPerSecond || 0,
                  packetsLostPercentage: Ql({ packetsLost: (_e.packetsLost || 0) - (((Ni = this.videoConsumerToStatsMap.get(ee)) === null || Ni === void 0 ? void 0 : Ni.packetsLost) || 0), packetsReceived: (_e.packetsReceived || 0) - (((Vi = this.videoConsumerToStatsMap.get(ee)) === null || Vi === void 0 ? void 0 : Vi.packetsReceived) || 0) }),
                  jitter: _e.jitter || 0,
                  isScreenShare: this.screenShareConsumers.has(ee),
                  bitrate: ((_e.bytesReceived || 0) - (((Ui = this.videoConsumerToStatsMap.get(ee)) === null || Ui === void 0 ? void 0 : Ui.bytesReceived) || 0)) * 8 / 7
                  // Bytes received in last 7 seconds
                }), this.videoConsumerToStatsMap.set(ee, _e), d.inboundVideoRtp.set(T.id, _e), d.consumerStreamMap.get(ee).inboundVideoRtpId.push(T.id), this.processInboundConsumerVideoStats(ee, Qa, _e);
              } else if (ae.mediaType === "audio" || ae.kind === "audio") {
                var ji, Fi, Hi, Bi, qi, Gi, hr = ae, er = $({ audioLevel: hr.audioLevel, concealedSamples: hr.concealedSamples, concealmentEvents: hr.concealmentEvents, totalAudioEnergy: hr.totalAudioEnergy, totalSamplesDuration: hr.totalSamplesDuration, totalSamplesReceived: hr.totalSamplesReceived, fecPacketsDiscarded: hr.fecPacketsDiscarded || 0, fecPacketsReceived: hr.fecPacketsReceived || 0, insertedSamplesForDeceleration: hr.insertedSamplesForDeceleration || 0, removedSamplesForAcceleration: hr.removedSamplesForAcceleration || 0, silentConcealedSamples: hr.silentConcealedSamples || 0, playoutId: hr.playoutId }, ao);
                er.score = tf({ concealmentEvents: (er.concealmentEvents || 0) - (((ji = this.audioConsumerToStatsMap.get(ee)) === null || ji === void 0 ? void 0 : ji.concealmentEvents) || 0), packetsLost: (er.packetsLost || 0) - (((Fi = this.audioConsumerToStatsMap.get(ee)) === null || Fi === void 0 ? void 0 : Fi.packetsLost) || 0), packetsReceived: (er.packetsReceived || 0) - (((Hi = this.audioConsumerToStatsMap.get(ee)) === null || Hi === void 0 ? void 0 : Hi.packetsReceived) || 0), jitter: er.jitter || 0 }), y.set(ee, {
                  score: +(er.score * 10).toFixed(),
                  packetsLostPercentage: Ql({ packetsLost: (er.packetsLost || 0) - (((Bi = this.audioConsumerToStatsMap.get(ee)) === null || Bi === void 0 ? void 0 : Bi.packetsLost) || 0), packetsReceived: (er.packetsReceived || 0) - (((qi = this.audioConsumerToStatsMap.get(ee)) === null || qi === void 0 ? void 0 : qi.packetsReceived) || 0) }),
                  jitter: er.jitter || 0,
                  isScreenShare: this.screenShareConsumers.has(ee),
                  bitrate: ((er.bytesReceived || 0) - (((Gi = this.audioConsumerToStatsMap.get(ee)) === null || Gi === void 0 ? void 0 : Gi.bytesReceived) || 0)) * 8 / 7
                  // Bytes received in last 7 seconds
                }), this.audioConsumerToStatsMap.set(ee, er), d.inboundAudioRtp.set(T.id, er), d.consumerStreamMap.get(ee).inboundAudioRtpId.push(T.id), this.processInboundConsumerAudioStats(ee, Qa, er);
              }
            } else
              this.callStatsInstance.logger.error("Callstats: Unknown Inbound-rtp. mediatype: ".concat(ae.mediaType, " kind: ").concat(ae.kind));
            break;
          }
        }
      }
    } catch (re) {
      b.e(re);
    } finally {
      b.f();
    }
    if (d.producerStreamMap.forEach(function(re, ne) {
      if (re.outboundVideoRtpId.length > 0) {
        var $r, Sr, Ji, Nt, Ki, zi, Yi, Qi, Vt, Xi, Wo = [];
        re.outboundVideoRtpId.forEach(function(Nc) {
          Wo.push(d.outboundVideoRtp.get(Nc));
        });
        var Oe = n.getWorkingSimulcastVideoStats(Wo);
        Oe.score = ef({ frameWidth: Oe.frameWidth || 0, framesPerSecond: Oe.framesPerSecond || 0, jitter: (($r = Oe.remoteData) === null || $r === void 0 ? void 0 : $r.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne), packetsSent: (Oe.packetsSent || 0) - (((Sr = n.videoProducerToStatsMap.get(ne)) === null || Sr === void 0 ? void 0 : Sr.packetsSent) || 0), packetsLost: (((Ji = Oe.remoteData) === null || Ji === void 0 ? void 0 : Ji.packetsLost) || 0) - (((Nt = n.videoProducerToStatsMap.get(ne)) === null || Nt === void 0 || (Nt = Nt.remoteData) === null || Nt === void 0 ? void 0 : Nt.packetsLost) || 0), framesEncoded: (Oe.framesEncoded || 0) - (((Ki = n.videoProducerToStatsMap.get(ne)) === null || Ki === void 0 ? void 0 : Ki.framesEncoded) || 0) }), k.set(ne, { score: +(Oe.score * 10).toFixed(), frameWidth: Oe.frameWidth || 0, frameHeight: Oe.frameHeight || 0, framesPerSecond: Oe.framesPerSecond || 0, jitter: ((zi = Oe.remoteData) === null || zi === void 0 ? void 0 : zi.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne), packetsLostPercentage: Yl({ packetsSent: (Oe.packetsSent || 0) - (((Yi = n.videoProducerToStatsMap.get(ne)) === null || Yi === void 0 ? void 0 : Yi.packetsSent) || 0), packetsLost: (((Qi = Oe.remoteData) === null || Qi === void 0 ? void 0 : Qi.packetsLost) || 0) - (((Vt = n.videoProducerToStatsMap.get(ne)) === null || Vt === void 0 || (Vt = Vt.remoteData) === null || Vt === void 0 ? void 0 : Vt.packetsLost) || 0) }), bitrate: ((Oe.bytesSent || 0) - (((Xi = n.videoProducerToStatsMap.get(ne)) === null || Xi === void 0 ? void 0 : Xi.bytesSent) || 0)) * 8 / 7, cpuLimitations: Oe.qualityLimitationReason === "cpu", bandwidthLimitations: Oe.qualityLimitationReason === "bandwidth" }), n.videoProducerToStatsMap.set(ne, Oe);
      } else if (re.outboundAudioRtpId.length > 0) {
        var Zi, xi, Ut, es, rs, ts, ns, jt, as, Nr = d.outboundAudioRtp.get(re.outboundAudioRtpId[0]);
        Nr.score = xv({ packetsSent: (Nr.packetsSent || 0) - (((Zi = n.audioProducerToStatsMap.get(ne)) === null || Zi === void 0 ? void 0 : Zi.packetsSent) || 0), packetsLost: (((xi = Nr.remoteData) === null || xi === void 0 ? void 0 : xi.packetsLost) || 0) - (((Ut = n.audioProducerToStatsMap.get(ne)) === null || Ut === void 0 || (Ut = Ut.remoteData) === null || Ut === void 0 ? void 0 : Ut.packetsLost) || 0), jitter: ((es = Nr.remoteData) === null || es === void 0 ? void 0 : es.jitter) || 0 }), k.set(ne, { score: +(Nr.score * 10).toFixed(), bitrate: ((Nr.bytesSent || 0) - (((rs = n.audioProducerToStatsMap.get(ne)) === null || rs === void 0 ? void 0 : rs.bytesSent) || 0)) * 8 / 7, packetsLostPercentage: Yl({ packetsSent: (Nr.packetsSent || 0) - (((ts = n.audioProducerToStatsMap.get(ne)) === null || ts === void 0 ? void 0 : ts.packetsSent) || 0), packetsLost: (((ns = Nr.remoteData) === null || ns === void 0 ? void 0 : ns.packetsLost) || 0) - (((jt = n.audioProducerToStatsMap.get(ne)) === null || jt === void 0 || (jt = jt.remoteData) === null || jt === void 0 ? void 0 : jt.packetsLost) || 0) }), jitter: ((as = Nr.remoteData) === null || as === void 0 ? void 0 : as.jitter) || 0, isScreenShare: n.screenShareProducers.has(ne) }), n.audioProducerToStatsMap.set(ne, Nr);
      }
    }), g.forEach(function(re) {
      var ne = v.find(function(Sr) {
        return Sr.id === re.localCandidateId ? (re.localCandidateId = Sr.id, Sr) : null;
      }), $r = f.find(function(Sr) {
        return Sr.id === re.remoteCandidateId ? (re.remoteCandidateId = Sr.id, Sr) : null;
      });
      ne && (re.localCandidateType = ne.type, re.localCandidateAddress = Ii(ne.address), re.localCandidatePort = ne.port, re.localCandidateProtocol = ne.protocol, re.localCandidateUrl = ne.url, re.localCandidateNetworkType = ne.networkType, re.localCandidateRelatedAddress = Ii(ne.relatedAddress), re.localCandidateRelatedPort = ne.relatedPort), $r && (re.remoteCandidateType = $r.type, re.remoteCandidateAddress = Ii($r.address), re.remoteCandidatePort = $r.port, re.remoteCandidateProtocol = $r.protocol, re.remoteCandidateUrl = $r.url);
    }), d.candidatePair && (d.transport ? (d.transport.bytesReceived = d.candidatePair.bytesReceived, d.transport.bytesSent = d.candidatePair.bytesSent, d.transport.totalRoundTripTime = d.candidatePair.totalRoundTripTime, d.transport.availableOutgoingBitrate = d.candidatePair.availableOutgoingBitrate, d.transport.availableIncomingBitrate = d.candidatePair.availableIncomingBitrate, d.transport.roundTripTime = d.candidatePair.currentRoundTripTime) : d.transport = {
      // candidateStats: result.candidatePair,
      bytesReceived: d.candidatePair.bytesReceived,
      bytesSent: d.candidatePair.bytesSent,
      totalRoundTripTime: d.candidatePair.totalRoundTripTime,
      availableOutgoingBitrate: d.candidatePair.availableOutgoingBitrate,
      availableIncomingBitrate: d.candidatePair.availableIncomingBitrate,
      roundTripTime: d.candidatePair.currentRoundTripTime
    }), d.transport && (d.transport.candidatePairs = g), d.transport && !d.transport.roundTripTime) {
      var Wi = 0, Go = 0;
      d.remoteInboundRtp.forEach(function(re, ne) {
        re.roundTripTime && re.roundTripTime > Wi && (Wi = re.roundTripTime, Go = re.totalRoundTripTime);
      }), d.transport.roundTripTime = Wi, d.transport.totalRoundTripTime = Go;
    }
    if (y.size > 0)
      try {
        this.observer.emit("consumer_score", y);
      } catch (re) {
      }
    if (k.size > 0)
      try {
        this.observer.emit("producer_score", k);
      } catch (re) {
      }
    return d;
  } }, { key: "getProducerStatsFromReport", value: function(r) {
    var n = this, a = [];
    try {
      r.producerStreamMap.forEach(function(i, s) {
        var u = n.producerMap.get(s), c = u.track.getSettings(), d = i.outboundVideoRtpId.map(function(v) {
          var f = r.outboundVideoRtp.get(v);
          return f.frameHeight || (f.frameHeight = c.height, f.frameWidth = c.width, f.framesPerSecond = c.frameRate), f;
        }), h = { producerId: s, appData: u.appData, videoStats: d, audioStats: i.outboundAudioRtpId.map(function(v) {
          return r.outboundAudioRtp.get(v);
        }) };
        a.push(h);
      });
    } catch (i) {
      console.error("getProducersReport: ", i, r);
    }
    return a;
  } }, { key: "getConsumerStatsFromParsedConsumerStats", value: function(r, n, a) {
    var i = this, s;
    try {
      var u = this.consumerPeerIdMap.get(a), c = u.peerId, d = u.producerId, h = u.appData, v = n == null ? void 0 : n.inboundVideoRtpId.map(function(f) {
        var g = i.consumerMap.get(a), k = g.track.getSettings(), y = r.inboundVideoRtp.get(f);
        return y.frameHeight || (y.frameHeight = k.height, y.frameWidth = k.width, y.framesPerSecond = k.frameRate), y;
      });
      s = { consumerId: a, peerId: c, producerId: d, appData: h, videoStats: v, audioStats: n == null ? void 0 : n.inboundAudioRtpId.map(function(f) {
        return r.inboundAudioRtp.get(f);
      }) };
    } catch (f) {
      console.error("getConsumerStatsFromParsedConsumerStats: ", f, r);
    }
    return s;
  } }, { key: "getConsumerStatsFromReport", value: function(r) {
    var n = this, a = [];
    try {
      r.consumerStreamMap.forEach(function(i, s) {
        a.push(n.getConsumerStatsFromParsedConsumerStats(r, i, s));
      });
    } catch (i) {
      console.error("getConsumerStatsFromReport: ", i, r);
    }
    return a;
  } }]);
}(of), Zm = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t);
}(uf);
function Xl(o, t, e, r) {
  if (o != null && o.logger && o.logger.error("Callstats::handleError", { error: r }), typeof e == "function" && r instanceof t)
    e.call(null, r, o);
  else
    throw r;
}
function uh(o, t, e) {
  var r = o.value;
  return o.value = function() {
    var n = this;
    try {
      for (var a = arguments.length, i = new Array(a), s = 0; s < a; s++)
        i[s] = arguments[s];
      var u = r.apply(this, i);
      return u && u instanceof Promise ? u.catch(function(c) {
        Xl(n, t, e, c);
      }) : u;
    } catch (c) {
      Xl(this, t, e, c);
    }
    return null;
  }, o;
}
var he = function(t, e) {
  return function(r, n, a) {
    var i = a.value;
    return a.value = function() {
      var s = this;
      try {
        for (var u = arguments.length, c = new Array(u), d = 0; d < u; d++)
          c[d] = arguments[d];
        var h = i.apply(this, c);
        return h && h instanceof Promise ? h.catch(function(v) {
          Xl(s, t, e, v);
        }) : h;
      } catch (v) {
        Xl(this, t, e, v);
      }
      return null;
    }, a;
  };
}, xm = function(t, e) {
  return function(r, n, a) {
    if (a)
      return uh(a, t, e);
    var i = Fn(Reflect.ownKeys(r.prototype).filter(function(h) {
      return h !== "constructor";
    })), s;
    try {
      for (i.s(); !(s = i.n()).done; ) {
        var u = s.value, c = Object.getOwnPropertyDescriptor(r.prototype, u), d = c.value instanceof Function;
        d && Object.defineProperty(r.prototype, u, uh(c, t, e));
      }
    } catch (h) {
      i.e(h);
    } finally {
      i.f();
    }
  };
}, de = globalThis && globalThis.__decorate || function(o, t, e, r) {
  var n = arguments.length, a = n < 3 ? t : r === null ? r = Object.getOwnPropertyDescriptor(t, e) : r, i;
  if ((typeof Reflect == "undefined" ? "undefined" : be(Reflect)) === "object" && typeof Reflect.decorate == "function")
    a = Reflect.decorate(o, t, e, r);
  else
    for (var s = o.length - 1; s >= 0; s--)
      (i = o[s]) && (a = (n < 3 ? i(a) : n > 3 ? i(t, e, a) : i(t, e)) || a);
  return n > 3 && a && Object.defineProperty(t, e, a), a;
}, pe = console, ue = /* @__PURE__ */ function(o) {
  function t() {
    var e, r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : "https://api.testingv3.dyte.in", n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : "Blink", a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : _u.PROD, i = arguments.length > 3 ? arguments[3] : void 0, s = arguments.length > 4 ? arguments[4] : void 0, u = arguments.length > 5 ? arguments[5] : void 0, c = arguments.length > 6 ? arguments[6] : void 0;
    switch (w(this, t), e = R(this, t), e.observer = void 0, e.eventHandler = void 0, e.measurements = void 0, e.producingTransport = void 0, e.consumingTransport = void 0, e.producers = /* @__PURE__ */ new Map(), e.consumers = /* @__PURE__ */ new Map(), e.iceServers = void 0, e.connectionInfoPromise = void 0, e.pingStatsTimeout = void 0, e.logger = void 0, e.env = void 0, e.apiHostnames = void 0, e.peerId = void 0, e.consumerSharedMediaStatesMap = /* @__PURE__ */ new Map(), e.currentUserMediaStates = {}, e.env = a, e.apiHostnames = c, e.logger = s, e.peerId = u, e.eventHandler = new Vm({ logger: s, peerId: u, apiHostnames: c }), e.logger.debug("callStats::engineName: ", { engineName: n }), n) {
      case "Blink":
        e.measurements = new Xm();
        break;
      case "Gecko":
        e.measurements = new uf();
        break;
      case "WebKit":
        e.measurements = new Zm();
        break;
      default:
        throw Error("Unknown engineName! ".concat(n));
    }
    return e.measurements.callStatsInstance = e, e.registerProducer = e.registerProducer.bind(e), e.registerConsumer = e.registerConsumer.bind(e), e.observer = new ht(), e.measurements.observer.on("consumer_score", function(d) {
      s.debug("callStats::consumer_score ".concat(Se(d.entries()))), e.eventHandler.emit("consumer_score", d);
    }), e.measurements.observer.on("producer_score", function(d) {
      s.debug("callStats::producer_score ".concat(Se(d.entries()))), e.eventHandler.emit("producer_score", d);
    }), e;
  }
  return A(t, o), P(t, [{ key: "registerIceServers", value: function(r) {
    this.iceServers = r;
  } }, { key: "registerConsumer", value: function(r) {
    var n;
    this.consumerSharedMediaStatesMap.has(r.id) || this.consumerSharedMediaStatesMap.set(r.id, {}), this.consumers.set(r.id, r), this.measurements.registerConsumer(r), this.logger.debug("callStats::registerConsumer", { consumerId: r.id, consumerkind: r.kind, isScreenShare: !!((n = r.appData) !== null && n !== void 0 && n.screenShare) }), r.on("close", this.deRegisterConsumer.bind(this, r));
  } }, { key: "registerProducer", value: function(r) {
    var n;
    this.producers.set(r.id, r), this.measurements.registerProducer(r), this.logger.debug("callStats::registerProducer", { producerId: r.id, producerKind: r.kind, isScreenShare: !!((n = r.appData) !== null && n !== void 0 && n.screenShare) }), r.on("close", this.deRegisterProducer.bind(this, r));
  } }, { key: "sendConsumerSharedMediaStateEvent", value: function(r, n) {
    this.consumerSharedMediaStatesMap.has(r) || this.consumerSharedMediaStatesMap.set(r, {});
    var a = this.consumerSharedMediaStatesMap.get(r);
    this.consumerSharedMediaStatesMap.set(r, Object.assign(a, n));
  } }, { key: "registerProducingTransport", value: function(r) {
    var n, a = this;
    this.producingTransport = r, r.on("close", this.disconnectProducingTransport.bind(this, r)), r.on("disconnect", this.disconnectProducingTransport.bind(this, r));
    var i = Array.from(
      // eslint-disable-next-line no-underscore-dangle
      ((n = r._producers) === null || n === void 0 ? void 0 : n.values()) || []
    );
    i.forEach(function(s) {
      a.registerProducer(s);
    }), r.on("newproducer", this.registerProducer);
  } }, { key: "registerConsumingTransport", value: function(r) {
    var n, a = this;
    this.consumingTransport = r, r.on("close", this.disconnectConsumingTransport.bind(this, r)), r.on("disconnect", this.disconnectConsumingTransport.bind(this, r));
    var i = Array.from(
      // eslint-disable-next-line no-underscore-dangle
      ((n = r._consumers) === null || n === void 0 ? void 0 : n.values()) || []
    );
    i.forEach(function(s) {
      a.registerConsumer(s);
    }), r.on("newconsumer", this.registerConsumer);
  } }, { key: "deRegisterConsumer", value: function(r) {
    this.consumers.delete(r.id);
  } }, { key: "deRegisterProducer", value: function(r) {
    var n;
    this.producers.delete(r.id), this.logger.debug("callStats::deRegisterProducer", { producerId: r.id, producerKind: r.kind, isScreenShare: !!((n = r.appData) !== null && n !== void 0 && n.screenShare) });
  } }, { key: "disconnectConsumingTransport", value: function() {
    this.consumingTransport = void 0;
  } }, { key: "disconnectProducingTransport", value: function() {
    this.producingTransport = void 0;
  } }, { key: "callEvent", value: function(r) {
    this.eventHandler.callEvent(r);
  } }, { key: "sendPreCallTestBeginEvent", value: function() {
    var r = this, n = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !1, a = arguments.length > 1 ? arguments[1] : void 0;
    this.connectionInfoPromise = this.measurements.getNetworkInfo(this.iceServers, n), this.eventHandler.callEvent({ event: K.PRECALL_TEST_BEGIN, timestamp: a }), this.connectionInfoPromise && this.connectionInfoPromise.then(function(i) {
      r.eventHandler.callEvent({ event: K.PRECALL_TEST_COMPLETE, metaData: { connectionInfo: i }, timestamp: a });
    });
  } }, { key: "sendScreenShareToggleEvent", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : null, a = arguments.length > 2 ? arguments[2] : void 0;
    this.currentUserMediaStates.screen = r, this.eventHandler.callEvent({ event: r ? K.SCREENSHARE_STARTED : K.SCREENSHARE_STOPPED, metaData: { ssrc: n }, timestamp: a });
  } }, { key: "sendScreenShareRequestedEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.SCREENSHARE_START_REQUESTED, timestamp: r });
  } }, { key: "sendActiveSpeakerEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.DOMINANT_SPEAKER, metaData: { peerId: r }, timestamp: n });
  } }, { key: "devices", value: function(r, n, a) {
    this.eventHandler.callEvent({ event: r === yn.AUDIO && K.AUDIO_DEVICES_UPDATES || r === yn.VIDEO && K.VIDEO_DEVICES_UPDATES || r === yn.SPEAKER && K.SPEAKER_DEVICES_UPDATES, metaData: { deviceList: n }, timestamp: a });
  } }, { key: "selectedDevice", value: function(r, n, a) {
    this.eventHandler.callEvent({ event: r === yn.AUDIO && K.SELECTED_MICROHPONE_UPDATE || r === yn.VIDEO && K.SELECTED_CAMERA_UPDATE || r === yn.SPEAKER && K.SELECTED_SPEAKER_UPDATE, metaData: { device: n }, timestamp: a });
  } }, { key: "mediaPermission", value: function(r, n, a) {
    this.eventHandler.callEvent({ event: K.MEDIA_PERMISSION, metaData: { deviceType: r, permission: n }, timestamp: a });
  } }, { key: "mediaPlaybackFailed", value: function(r, n) {
    this.eventHandler.callEvent({ event: r === yn.AUDIO && K.AUDIO_PLAY_FAILED || r === yn.VIDEO && K.VIDEO_PLAY_FAILED, metaData: { deviceType: r }, timestamp: n });
  } }, { key: "mediaTrackMuted", value: function(r, n) {
    this.eventHandler.callEvent({ event: r === yn.AUDIO && K.AUDIO_TRACK_MUTED || r === yn.VIDEO && K.VIDEO_TRACK_MUTED, metaData: { deviceType: r }, timestamp: n });
  } }, { key: "tabChanged", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.TAB_CHANGE, metaData: { isMeetingsTabActive: r }, timestamp: n });
  } }, { key: "browserBackgrounded", value: function(r) {
    this.eventHandler.callEvent({ event: K.BROWSER_BACKGROUNDED, timestamp: r });
  } }, { key: "browserForegrounded", value: function(r) {
    this.eventHandler.callEvent({ event: K.BROWSER_FOREGROUNDED, timestamp: r });
  } }, { key: "legacySwitch", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.LEGACY_SWITCH, metadata: { on: r }, timestamp: n });
  } }, { key: "getPreCallTestResults", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.connectionInfoPromise);
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendCallJoinBeginEvent", value: function(r, n) {
    r = $($({}, r), {}, { meetingEnv: this.env }), r.deviceInfo = $($({}, r.deviceInfo), {}, { userAgent: navigator.userAgent, cpus: navigator.hardwareConcurrency, memory: navigator.deviceMemory }), this.eventHandler.callEvent({ event: K.CALL_JOIN_BEGIN, metaData: { peerMetaData: r }, timestamp: n });
  } }, { key: "sendNetworkQualityTestBeginEvent", value: function(r, n) {
    var a = this;
    this.eventHandler.callEvent({ event: K.NET_QUALITY_TEST_BEGIN, timestamp: n });
    var i = new Promise(/* @__PURE__ */ function() {
      var s = m(/* @__PURE__ */ p().mark(function u(c, d) {
        var h, v, f, g, k;
        return p().wrap(function(b) {
          for (; ; )
            switch (b.prev = b.next) {
              case 0:
                h = [], b.prev = 1, v = Fn(r), b.prev = 3, v.s();
              case 5:
                if ((f = v.n()).done) {
                  b.next = 20;
                  break;
                }
                if (g = f.value, b.prev = 7, !(g.iceServers && g.iceServers.length > 0)) {
                  b.next = 13;
                  break;
                }
                return b.next = 11, a.measurements.getNetworkQuality(g.iceServers);
              case 11:
                k = b.sent, h.push($($({}, g), {}, { networkResults: k }));
              case 13:
                b.next = 18;
                break;
              case 15:
                b.prev = 15, b.t0 = b.catch(7), console.warn("Error handling ", b.t0);
              case 18:
                b.next = 5;
                break;
              case 20:
                b.next = 25;
                break;
              case 22:
                b.prev = 22, b.t1 = b.catch(3), v.e(b.t1);
              case 25:
                return b.prev = 25, v.f(), b.finish(25);
              case 28:
                c({ regionData: h }), b.next = 35;
                break;
              case 31:
                b.prev = 31, b.t2 = b.catch(1), console.warn("Error in callstats, ", b.t2), d(b.t2);
              case 35:
              case "end":
                return b.stop();
            }
        }, u, null, [[1, 31], [3, 22, 25, 28], [7, 15]]);
      }));
      return function(u, c) {
        return s.apply(this, arguments);
      };
    }());
    i.then(function(s) {
      a.eventHandler.callEvent({ event: K.NET_QUALITY_TEST_END, timestamp: n, metaData: s });
    });
  } }, { key: "sendWebSocketConnectedEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.WEBSOCKET_CONNECTED, timestamp: r });
  } }, { key: "sendTransportConnectedEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.TRANSPORT_CONNECTED, timestamp: r });
  } }, { key: "sendAudioToggleEvent", value: function(r, n) {
    this.currentUserMediaStates.audio = r;
    var a;
    r ? a = K.AUDIO_ON : a = K.AUDIO_OFF, this.eventHandler.callEvent({ event: a, timestamp: n });
  } }, { key: "sendVideoToggleEvent", value: function(r, n) {
    this.currentUserMediaStates.video = r;
    var a;
    r ? a = K.VIDEO_ON : a = K.VIDEO_OFF, this.eventHandler.callEvent({ event: a, timestamp: n });
  } }, { key: "sendParticipantRoleToggleEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.PARTICIPANT_ROLE, timestamp: n, metaData: r });
  } }, { key: "startPingStats", value: function() {
    var r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 7e3;
    this.sendPingStatsEvent(!1, new Date()), this.pingStatsTimeout = setInterval(this.sendPingStatsEvent.bind(this), r);
  } }, { key: "stopPingStats", value: function() {
    clearInterval(this.pingStatsTimeout);
  } }, { key: "sendPingStatsEvent", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s, u, c, d, h, v, f, g, k, y, b, C, T, E = arguments;
      return p().wrap(function(I) {
        for (; ; )
          switch (I.prev = I.next) {
            case 0:
              if (h = E.length > 0 && E[0] !== void 0 ? E[0] : !0, v = E.length > 1 ? E[1] : void 0, !this.producingTransport) {
                I.next = 19;
                break;
              }
              return I.next = 5, this.measurements.getProcessedStats(this.producingTransport, !1, !0);
            case 5:
              if (f = I.sent, !(!f || !((k = f) !== null && k !== void 0 && k.producerReport))) {
                I.next = 19;
                break;
              }
              return this.logger.debug("callStats::sendPingStatsEvent::staleProducingTransport", { disclaimer: "Stale producer? Regenerating Stream Maps!" }), I.next = 10, this.measurements.getProducersReport(Se(this.producers.values()));
            case 10:
              if (y = I.sent, !(f && y)) {
                I.next = 15;
                break;
              }
              f.producerReport = y, I.next = 19;
              break;
            case 15:
              return I.next = 17, this.measurements.getProcessedStats(this.producingTransport, !1, !0);
            case 17:
              f = I.sent, (!f || !((b = f) !== null && b !== void 0 && b.producerReport)) && this.logger.debug("callStats::sendPingStatsEvent::noProducingTransportReport", { disclaimer: "Stream maps invalid despite regenerating!" });
            case 19:
              if (!this.consumingTransport) {
                I.next = 36;
                break;
              }
              return I.next = 22, this.measurements.getProcessedStats(this.consumingTransport, !0, !1);
            case 22:
              if (g = I.sent, !(!g || !g.consumerReport)) {
                I.next = 36;
                break;
              }
              return this.logger.debug("callStats::sendPingStatsEvent::staleConsumingTransport", { disclaimer: "Stale consumer? Regenerating Stream Maps!" }), I.next = 27, this.measurements.getConsumersReport(Se(this.consumers.values()));
            case 27:
              if (C = I.sent, !(g && C)) {
                I.next = 32;
                break;
              }
              g.consumerReport = C, I.next = 36;
              break;
            case 32:
              return I.next = 34, this.measurements.getProcessedStats(this.consumingTransport, !0, !1);
            case 34:
              g = I.sent, (!g || !g.consumerReport) && this.logger.debug("callStats::sendPingStatsEvent::noConsumingTransportReport", { disclaimer: "Stream maps invalid despite regenerating!" });
            case 36:
              if (T = { producingTransportStats: f ? (a = f) === null || a === void 0 ? void 0 : a.transportReport : void 0, consumingTransportStats: g ? (i = g) === null || i === void 0 ? void 0 : i.transportReport : void 0, producerStats: [].concat(((s = f) === null || s === void 0 ? void 0 : s.producerReport) || []).concat(((u = g) === null || u === void 0 ? void 0 : u.producerReport) || []), consumerStats: [].concat(((c = g) === null || c === void 0 ? void 0 : c.consumerReport) || []).concat(((d = f) === null || d === void 0 ? void 0 : d.consumerReport) || []) }, !(h && T.producerStats.length === 0 && T.consumerStats.length === 0)) {
                I.next = 41;
                break;
              }
              return I.next = 40, this.eventHandler.flush();
            case 40:
              return I.abrupt("return");
            case 41:
              this.eventHandler.callEvent({ event: K.PING_STAT, metaData: T, timestamp: v });
            case 42:
            case "end":
              return I.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendIVSPlayerRebufferEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_REBUFFERING, timestamp: r });
  } }, { key: "sendIVSPlayerAudioBlockEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_AUDIO_BLOCKED, timestamp: r });
  } }, { key: "sendIVSPlayerPlaybackBlockedEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_PLAYBACK_BLOCKED, timestamp: r });
  } }, { key: "sendIVSPlayerNetworkUnavailableEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_NETWORK_UNAVAILABLE, timestamp: r });
  } }, { key: "sendIVSPlayerInitializedEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_INITIALIZED, timestamp: r });
  } }, { key: "sendIVSPlayerWorkerErrorEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_WORKER_ERROR, timestamp: r });
  } }, { key: "sendIVSPlayerErrorEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_ERROR, timestamp: n, metaData: r });
  } }, { key: "sendIVSPlayerRecoverableErrorEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_RECOVERABLE_ERROR, timestamp: n, metaData: r });
  } }, { key: "sendIVSPlayerAnalyticsEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_ANALYTICS_EVENT, timestamp: n, metaData: r });
  } }, { key: "sendIVSPlayerPlaybackRateChangedEvent", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_PLAYBACK_RATE_CHANGED, timestamp: n, metaData: { updatedPlaybackRate: r } });
  } }, { key: "sendIVSPlayerQualityChanged", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.IVS_PLAYER_QUALITY_CHANGED, timestamp: n, metaData: r });
  } }, { key: "sendPlayerLiveLatency", value: function(r, n) {
    this.eventHandler.callEvent({ event: K.LIVESTREAM_LATENCY, timestamp: n, metaData: { latency: r } });
  } }, { key: "sendDisconnectEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.DISCONNECT, timestamp: r });
  } }, { key: "sendReconnectEvent", value: function(r) {
    this.eventHandler.callEvent({ event: K.RECONNECT_ATTEMPT, timestamp: r });
  } }, { key: "expectedVideoResolution", value: function(r, n, a) {
    this.eventHandler.callEvent({ event: K.EXPECTED_VIDEO_RESOLUTION, timestamp: a, metaData: { frameWidth: r, frameHeight: n } });
  } }, { key: "expectedScreenshareResolution", value: function(r, n, a) {
    this.eventHandler.callEvent({ event: K.EXPECTED_SCREENSHARE_RESOLUTION, timestamp: a, metaData: { frameWidth: r, frameHeight: n } });
  } }]);
}(ht);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "registerIceServers", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "registerConsumer", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "registerProducer", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendConsumerSharedMediaStateEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "registerProducingTransport", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "registerConsumingTransport", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "deRegisterConsumer", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "deRegisterProducer", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "disconnectConsumingTransport", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "disconnectProducingTransport", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendPreCallTestBeginEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendScreenShareToggleEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendScreenShareRequestedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendActiveSpeakerEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "devices", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "selectedDevice", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "mediaPermission", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "mediaPlaybackFailed", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "mediaTrackMuted", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "tabChanged", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "browserBackgrounded", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "browserForegrounded", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "legacySwitch", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "getPreCallTestResults", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendCallJoinBeginEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendNetworkQualityTestBeginEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendWebSocketConnectedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendTransportConnectedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendAudioToggleEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendVideoToggleEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendParticipantRoleToggleEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "startPingStats", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "stopPingStats", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendPingStatsEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerRebufferEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerAudioBlockEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerPlaybackBlockedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerNetworkUnavailableEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerInitializedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerWorkerErrorEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerErrorEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerRecoverableErrorEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerAnalyticsEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerPlaybackRateChangedEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendIVSPlayerQualityChanged", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendPlayerLiveLatency", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendDisconnectEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "sendReconnectEvent", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "expectedVideoResolution", null);
de([he(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue.prototype, "expectedScreenshareResolution", null);
ue = de([xm(TypeError, function(o, t) {
  return pe.error(t, o);
})], ue);
var ey = ue, lf = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    w(this, t);
    for (var r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    return e = R(this, t, [].concat(n)), e.stats = void 0, e.peerId = void 0, e.backend = void 0, e.iceServers = void 0, e.initialized = !1, e.stalled = !1, e.ipInformation = void 0, e.logger = void 0, e;
  }
  return A(t, o), P(t, [{ key: "initialize", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v, f, g, k, y, b, C, T, E;
      return p().wrap(function(I) {
        for (; ; )
          switch (I.prev = I.next) {
            case 0:
              return i = a.peerId, s = a.engineName, u = a.env, c = u === void 0 ? _u.PROD : u, d = a.iceServers, h = a.apiBase, v = h === void 0 ? "https://api.cluster.dyte.in" : h, f = a.flags, g = a.logger, k = g === void 0 ? console : g, y = a.apiHostnames, b = a.skipConnectivityChecks, C = b === void 0 ? !1 : b, I.prev = 1, this.peerId = i, this.logger = k, I.next = 6, Sp.getIPDetails({ peerId: i, apiHostnames: y, logger: k });
            case 6:
              this.ipInformation = I.sent, this.backend = new ey(v, s, c, f, k, i, y), this.iceServers = d, (T = this.backend) === null || T === void 0 || T.registerIceServers(this.iceServers), this.initialized = !0, (E = this.backend) === null || E === void 0 || (E = E.eventHandler) === null || E === void 0 || E.emit("initialized", this.ipInformation), this.emit("initialized", this.ipInformation), this.startPreCallTest(C), I.next = 20;
              break;
            case 16:
              I.prev = 16, I.t0 = I.catch(1), this.logger.error("callStats::CallStatsIntegration: ", { error: I.t0 }), this.stallCallStats();
            case 20:
            case "end":
              return I.stop();
          }
      }, n, this, [[1, 16]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "configureSendTransport", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.registerProducingTransport(r);
    });
  } }, { key: "configureRecvTransport", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.registerConsumingTransport(r);
    });
  } }, { key: "candidateRegionalNetworkQualityTest", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              s = new Date(), this.onSafeInitialization(function() {
                try {
                  var d;
                  (d = i.backend) === null || d === void 0 || d.sendNetworkQualityTestBeginEvent(a, s);
                } catch (h) {
                  i.logger.error("callStats::sendNetworkQualityTestBeginEvent", { error: { reason: h.reason } });
                }
              });
            case 2:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "roomJoined", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              s = new Date(), this.onSafeInitialization(function() {
                var d, h;
                (d = i.backend) === null || d === void 0 || d.sendCallJoinBeginEvent(a, s), i.backend, (h = i.backend) === null || h === void 0 || h.startPingStats();
              });
            case 2:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "audioOff", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.sendAudioToggleEvent(!1, n);
    });
  } }, { key: "audioOn", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.sendAudioToggleEvent(!0, n);
    });
  } }, { key: "videoOff", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.sendVideoToggleEvent(!1, n);
    });
  } }, { key: "videoOn", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.sendVideoToggleEvent(!0, n);
    });
  } }, { key: "callEnded", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a, i;
      (a = r.backend) === null || a === void 0 || a.stopPingStats(), (i = r.backend) === null || i === void 0 || i.sendDisconnectEvent(n);
    });
  } }, { key: "screenShareStart", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.sendScreenShareToggleEvent(!0, r, a);
    });
  } }, { key: "consumerSharedMediaState", value: function(r, n) {
    var a = this;
    this.onSafeInitialization(function() {
      var i;
      (i = a.backend) === null || i === void 0 || i.sendConsumerSharedMediaStateEvent(r, n);
    });
  } }, { key: "screenShareStop", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.sendScreenShareToggleEvent(!1, r, a);
    });
  } }, { key: "screenShareRequested", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.sendScreenShareRequestedEvent(n);
    });
  } }, { key: "activeSpeaker", value: function(r) {
    var n = this;
    if (r === this.peerId) {
      var a = new Date();
      this.onSafeInitialization(function() {
        var i;
        (i = n.backend) === null || i === void 0 || i.sendActiveSpeakerEvent(r, a);
      });
    }
  } }, { key: "devices", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s;
      (s = a.backend) === null || s === void 0 || s.devices(r, n, i);
    });
  } }, { key: "selectedDevice", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s;
      (s = a.backend) === null || s === void 0 || s.selectedDevice(r, n, i);
    });
  } }, { key: "mediaPermission", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s;
      (s = a.backend) === null || s === void 0 || s.mediaPermission(r, n, i);
    });
  } }, { key: "mediaPlaybackFailed", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.mediaPlaybackFailed(r, a);
    });
  } }, { key: "mediaTrackMuted", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.mediaTrackMuted(r, a);
    });
  } }, { key: "tabChanged", value: function() {
    var r = this, n = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !1, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = r.backend) === null || i === void 0 || i.tabChanged(n, a);
    });
  } }, { key: "browserBackgrounded", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.browserBackgrounded(n);
    });
  } }, { key: "browserForegrounded", value: function() {
    var r = this, n = new Date();
    this.onSafeInitialization(function() {
      var a;
      (a = r.backend) === null || a === void 0 || a.browserForegrounded(n);
    });
  } }, { key: "legacySwitch", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.legacySwitch(r, a);
    });
  } }, { key: "startPreCallTest", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a = this, i, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              i = u.length > 0 && u[0] !== void 0 ? u[0] : !1, s = new Date(), this.onSafeInitialization(function() {
                var h;
                (h = a.backend) === null || h === void 0 || h.sendPreCallTestBeginEvent(i, s);
              });
            case 3:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onPreCallTestResults", value: function(r) {
    var n = this;
    return this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.once("precall_end", r);
    }), r;
  } }, { key: "onReceivingConsumerAudioStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("consumer_audio_status", r);
    });
  } }, { key: "onReceivingConsumerVideoStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("consumer_video_status", r);
    });
  } }, { key: "onReceivingProducerAudioStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("producer_audio_status", r);
    });
  } }, { key: "onReceivingProducerVideoStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("producer_video_status", r);
    });
  } }, { key: "onReceivingProducingTransportStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("producing_transport_status", r);
    });
  } }, { key: "onReceivingConsumingTransportStatus", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("consuming_transport_status", r);
    });
  } }, { key: "onProducerScore", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("producer_score", r);
    });
  } }, { key: "onConsumerScore", value: function(r) {
    var n = this;
    this.onSafeInitialization(function() {
      var a;
      (a = n.backend) === null || a === void 0 || a.eventHandler.on("consumer_score", r);
    });
  } }, { key: "onSafeInitialization", value: function(r) {
    if (this.initialized)
      r(this.ipInformation, !1);
    else if (!this.stalled) {
      var n = function(i) {
        var s = !0;
        r(i, s);
      };
      return this.once("initialized", n), n;
    }
    return function() {
    };
  } }, { key: "removeInitializationListener", value: function(r) {
    this.removeListener("initialized", r);
  } }, { key: "stallCallStats", value: function() {
    this.stalled = !0, this.removeAllListeners("initialized");
  } }, { key: "ivsPlayerEvent", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s, u, c, d, h, v, f, g, k, y, b;
      switch (r) {
        case "PlayerRebuffering":
          (s = a.backend) === null || s === void 0 || s.sendIVSPlayerRebufferEvent(i);
          break;
        case "PlayerAudioBlocked":
          (u = a.backend) === null || u === void 0 || u.sendIVSPlayerAudioBlockEvent(i);
          break;
        case "PlayerPlaybackBlocked":
          (c = a.backend) === null || c === void 0 || c.sendIVSPlayerPlaybackBlockedEvent(i);
          break;
        case "PlayerNetworkUnavailable":
          (d = a.backend) === null || d === void 0 || d.sendIVSPlayerNetworkUnavailableEvent(i);
          break;
        case "PlayerInitialized":
          (h = a.backend) === null || h === void 0 || h.sendIVSPlayerInitializedEvent(i);
          break;
        case "PlayerWorkerError":
          (v = a.backend) === null || v === void 0 || v.sendIVSPlayerWorkerErrorEvent(i);
          break;
        case "PlayerError":
          (f = a.backend) === null || f === void 0 || f.sendIVSPlayerErrorEvent(n, i);
          break;
        case "PlayerRecoverableError":
          (g = a.backend) === null || g === void 0 || g.sendIVSPlayerRecoverableErrorEvent(n, i);
          break;
        case "PlayerAnalyticsEvent":
          (k = a.backend) === null || k === void 0 || k.sendIVSPlayerAnalyticsEvent(n, i);
          break;
        case "PlayerPlaybackRateChanged":
          (y = a.backend) === null || y === void 0 || y.sendIVSPlayerPlaybackRateChangedEvent(n, i);
          break;
        case "PlayerQualityChanged":
          (b = a.backend) === null || b === void 0 || b.sendIVSPlayerQualityChanged(n, i);
          break;
      }
    });
  } }, { key: "livestreamLatency", value: function(r) {
    var n = this, a = new Date();
    this.onSafeInitialization(function() {
      var i;
      (i = n.backend) === null || i === void 0 || i.sendPlayerLiveLatency(r, a);
    });
  } }, { key: "expectedVideoResolution", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s;
      (s = a.backend) === null || s === void 0 || s.expectedVideoResolution(r, n, i);
    });
  } }, { key: "expectedScreenshareResolution", value: function(r, n) {
    var a = this, i = new Date();
    this.onSafeInitialization(function() {
      var s;
      (s = a.backend) === null || s === void 0 || s.expectedScreenshareResolution(r, n, i);
    });
  } }]);
}(ht), ry = new lf();
ry.setMaxListeners(30);
function ty() {
  this.__data__ = [], this.size = 0;
}
function el(o, t) {
  return o === t || o !== o && t !== t;
}
function vc(o, t) {
  for (var e = o.length; e--; )
    if (el(o[e][0], t))
      return e;
  return -1;
}
var ny = Array.prototype, ay = ny.splice;
function iy(o) {
  var t = this.__data__, e = vc(t, o);
  if (e < 0)
    return !1;
  var r = t.length - 1;
  return e == r ? t.pop() : ay.call(t, e, 1), --this.size, !0;
}
function sy(o) {
  var t = this.__data__, e = vc(t, o);
  return e < 0 ? void 0 : t[e][1];
}
function oy(o) {
  return vc(this.__data__, o) > -1;
}
function uy(o, t) {
  var e = this.__data__, r = vc(e, o);
  return r < 0 ? (++this.size, e.push([o, t])) : e[r][1] = t, this;
}
function Wa(o) {
  var t = -1, e = o == null ? 0 : o.length;
  for (this.clear(); ++t < e; ) {
    var r = o[t];
    this.set(r[0], r[1]);
  }
}
Wa.prototype.clear = ty;
Wa.prototype.delete = iy;
Wa.prototype.get = sy;
Wa.prototype.has = oy;
Wa.prototype.set = uy;
function ly() {
  this.__data__ = new Wa(), this.size = 0;
}
function cy(o) {
  var t = this.__data__, e = t.delete(o);
  return this.size = t.size, e;
}
function dy(o) {
  return this.__data__.get(o);
}
function py(o) {
  return this.__data__.has(o);
}
var hy = (typeof global == "undefined" ? "undefined" : be(global)) == "object" && global && global.Object === Object && global, cf = hy, vy = (typeof self == "undefined" ? "undefined" : be(self)) == "object" && self && self.Object === Object && self, fy = cf || vy || Function("return this")(), Bn = fy, gy = Bn.Symbol, da = gy, df = Object.prototype, my = df.hasOwnProperty, yy = df.toString, Ko = da ? da.toStringTag : void 0;
function ky(o) {
  var t = my.call(o, Ko), e = o[Ko];
  try {
    o[Ko] = void 0;
    var r = !0;
  } catch (a) {
  }
  var n = yy.call(o);
  return r && (t ? o[Ko] = e : delete o[Ko]), n;
}
var by = Object.prototype, Ty = by.toString;
function wy(o) {
  return Ty.call(o);
}
var Py = "[object Null]", Sy = "[object Undefined]", lh = da ? da.toStringTag : void 0;
function Xs(o) {
  return o == null ? o === void 0 ? Sy : Py : lh && lh in Object(o) ? ky(o) : wy(o);
}
function Tn(o) {
  var t = be(o);
  return o != null && (t == "object" || t == "function");
}
var Ey = "[object AsyncFunction]", Cy = "[object Function]", Ry = "[object GeneratorFunction]", Ay = "[object Proxy]";
function Ep(o) {
  if (!Tn(o))
    return !1;
  var t = Xs(o);
  return t == Cy || t == Ry || t == Ey || t == Ay;
}
var Iy = Bn["__core-js_shared__"], Uc = Iy, ch = function() {
  var o = /[^.]+$/.exec(Uc && Uc.keys && Uc.keys.IE_PROTO || "");
  return o ? "Symbol(src)_1." + o : "";
}();
function My(o) {
  return !!ch && ch in o;
}
var _y = Function.prototype, Oy = _y.toString;
function Zs(o) {
  if (o != null) {
    try {
      return Oy.call(o);
    } catch (t) {
    }
    try {
      return o + "";
    } catch (t) {
    }
  }
  return "";
}
var Dy = /[\\^$.*+?()[\]{}|]/g, Ly = /^\[object .+?Constructor\]$/, $y = Function.prototype, Ny = Object.prototype, Vy = $y.toString, Uy = Ny.hasOwnProperty, jy = RegExp("^" + Vy.call(Uy).replace(Dy, "\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") + "$");
function Fy(o) {
  if (!Tn(o) || My(o))
    return !1;
  var t = Ep(o) ? jy : Ly;
  return t.test(Zs(o));
}
function Hy(o, t) {
  return o == null ? void 0 : o[t];
}
function xs(o, t) {
  var e = Hy(o, t);
  return Fy(e) ? e : void 0;
}
var By = xs(Bn, "Map"), Ku = By, qy = xs(Object, "create"), zu = qy;
function Gy() {
  this.__data__ = zu ? zu(null) : {}, this.size = 0;
}
function Wy(o) {
  var t = this.has(o) && delete this.__data__[o];
  return this.size -= t ? 1 : 0, t;
}
var Jy = "__lodash_hash_undefined__", Ky = Object.prototype, zy = Ky.hasOwnProperty;
function Yy(o) {
  var t = this.__data__;
  if (zu) {
    var e = t[o];
    return e === Jy ? void 0 : e;
  }
  return zy.call(t, o) ? t[o] : void 0;
}
var Qy = Object.prototype, Xy = Qy.hasOwnProperty;
function Zy(o) {
  var t = this.__data__;
  return zu ? t[o] !== void 0 : Xy.call(t, o);
}
var xy = "__lodash_hash_undefined__";
function ek(o, t) {
  var e = this.__data__;
  return this.size += this.has(o) ? 0 : 1, e[o] = zu && t === void 0 ? xy : t, this;
}
function Ks(o) {
  var t = -1, e = o == null ? 0 : o.length;
  for (this.clear(); ++t < e; ) {
    var r = o[t];
    this.set(r[0], r[1]);
  }
}
Ks.prototype.clear = Gy;
Ks.prototype.delete = Wy;
Ks.prototype.get = Yy;
Ks.prototype.has = Zy;
Ks.prototype.set = ek;
function rk() {
  this.size = 0, this.__data__ = { hash: new Ks(), map: new (Ku || Wa)(), string: new Ks() };
}
function tk(o) {
  var t = be(o);
  return t == "string" || t == "number" || t == "symbol" || t == "boolean" ? o !== "__proto__" : o === null;
}
function fc(o, t) {
  var e = o.__data__;
  return tk(t) ? e[typeof t == "string" ? "string" : "hash"] : e.map;
}
function nk(o) {
  var t = fc(this, o).delete(o);
  return this.size -= t ? 1 : 0, t;
}
function ak(o) {
  return fc(this, o).get(o);
}
function ik(o) {
  return fc(this, o).has(o);
}
function sk(o, t) {
  var e = fc(this, o), r = e.size;
  return e.set(o, t), this.size += e.size == r ? 0 : 1, this;
}
function Ja(o) {
  var t = -1, e = o == null ? 0 : o.length;
  for (this.clear(); ++t < e; ) {
    var r = o[t];
    this.set(r[0], r[1]);
  }
}
Ja.prototype.clear = rk;
Ja.prototype.delete = nk;
Ja.prototype.get = ak;
Ja.prototype.has = ik;
Ja.prototype.set = sk;
var ok = 200;
function uk(o, t) {
  var e = this.__data__;
  if (e instanceof Wa) {
    var r = e.__data__;
    if (!Ku || r.length < ok - 1)
      return r.push([o, t]), this.size = ++e.size, this;
    e = this.__data__ = new Ja(r);
  }
  return e.set(o, t), this.size = e.size, this;
}
function Hn(o) {
  var t = this.__data__ = new Wa(o);
  this.size = t.size;
}
Hn.prototype.clear = ly;
Hn.prototype.delete = cy;
Hn.prototype.get = dy;
Hn.prototype.has = py;
Hn.prototype.set = uk;
function lk(o, t) {
  for (var e = -1, r = o == null ? 0 : o.length; ++e < r && t(o[e], e, o) !== !1; )
    ;
  return o;
}
var ck = function() {
  try {
    var o = xs(Object, "defineProperty");
    return o({}, "", {}), o;
  } catch (t) {
  }
}(), Zl = ck;
function Cp(o, t, e) {
  t == "__proto__" && Zl ? Zl(o, t, { configurable: !0, enumerable: !0, value: e, writable: !0 }) : o[t] = e;
}
var dk = Object.prototype, pk = dk.hasOwnProperty;
function pf(o, t, e) {
  var r = o[t];
  (!(pk.call(o, t) && el(r, e)) || e === void 0 && !(t in o)) && Cp(o, t, e);
}
function rl(o, t, e, r) {
  var n = !e;
  e || (e = {});
  for (var a = -1, i = t.length; ++a < i; ) {
    var s = t[a], u = r ? r(e[s], o[s], s, e, o) : void 0;
    u === void 0 && (u = o[s]), n ? Cp(e, s, u) : pf(e, s, u);
  }
  return e;
}
function hk(o, t) {
  for (var e = -1, r = Array(o); ++e < o; )
    r[e] = t(e);
  return r;
}
function pa(o) {
  return o != null && be(o) == "object";
}
var vk = "[object Arguments]";
function dh(o) {
  return pa(o) && Xs(o) == vk;
}
var hf = Object.prototype, fk = hf.hasOwnProperty, gk = hf.propertyIsEnumerable, mk = dh(function() {
  return arguments;
}()) ? dh : function(o) {
  return pa(o) && fk.call(o, "callee") && !gk.call(o, "callee");
}, Yu = mk, yk = Array.isArray, tn = yk;
function kk() {
  return !1;
}
var vf = (typeof exports == "undefined" ? "undefined" : be(exports)) == "object" && exports && !exports.nodeType && exports, ph = vf && (typeof module == "undefined" ? "undefined" : be(module)) == "object" && module && !module.nodeType && module, bk = ph && ph.exports === vf, hh = bk ? Bn.Buffer : void 0, Tk = hh ? hh.isBuffer : void 0, wk = Tk || kk, Oo = wk, Pk = 9007199254740991, Sk = /^(?:0|[1-9]\d*)$/;
function Rp(o, t) {
  var e = be(o);
  return t = t == null ? Pk : t, !!t && (e == "number" || e != "symbol" && Sk.test(o)) && o > -1 && o % 1 == 0 && o < t;
}
var Ek = 9007199254740991;
function Ap(o) {
  return typeof o == "number" && o > -1 && o % 1 == 0 && o <= Ek;
}
var Ck = "[object Arguments]", Rk = "[object Array]", Ak = "[object Boolean]", Ik = "[object Date]", Mk = "[object Error]", _k = "[object Function]", Ok = "[object Map]", Dk = "[object Number]", Lk = "[object Object]", $k = "[object RegExp]", Nk = "[object Set]", Vk = "[object String]", Uk = "[object WeakMap]", jk = "[object ArrayBuffer]", Fk = "[object DataView]", Hk = "[object Float32Array]", Bk = "[object Float64Array]", qk = "[object Int8Array]", Gk = "[object Int16Array]", Wk = "[object Int32Array]", Jk = "[object Uint8Array]", Kk = "[object Uint8ClampedArray]", zk = "[object Uint16Array]", Yk = "[object Uint32Array]", yr = {};
yr[Hk] = yr[Bk] = yr[qk] = yr[Gk] = yr[Wk] = yr[Jk] = yr[Kk] = yr[zk] = yr[Yk] = !0;
yr[Ck] = yr[Rk] = yr[jk] = yr[Ak] = yr[Fk] = yr[Ik] = yr[Mk] = yr[_k] = yr[Ok] = yr[Dk] = yr[Lk] = yr[$k] = yr[Nk] = yr[Vk] = yr[Uk] = !1;
function Qk(o) {
  return pa(o) && Ap(o.length) && !!yr[Xs(o)];
}
function Ip(o) {
  return function(t) {
    return o(t);
  };
}
var ff = (typeof exports == "undefined" ? "undefined" : be(exports)) == "object" && exports && !exports.nodeType && exports, Ou = ff && (typeof module == "undefined" ? "undefined" : be(module)) == "object" && module && !module.nodeType && module, Xk = Ou && Ou.exports === ff, jc = Xk && cf.process, Zk = function() {
  try {
    var o = Ou && Ou.require && Ou.require("util").types;
    return o || jc && jc.binding && jc.binding("util");
  } catch (t) {
  }
}(), Do = Zk, vh = Do && Do.isTypedArray, xk = vh ? Ip(vh) : Qk, gc = xk, eb = Object.prototype, rb = eb.hasOwnProperty;
function gf(o, t) {
  var e = tn(o), r = !e && Yu(o), n = !e && !r && Oo(o), a = !e && !r && !n && gc(o), i = e || r || n || a, s = i ? hk(o.length, String) : [], u = s.length;
  for (var c in o)
    (t || rb.call(o, c)) && !(i && // Safari 9 has enumerable `arguments.length` in strict mode.
    (c == "length" || // Node.js 0.10 has enumerable non-index properties on buffers.
    n && (c == "offset" || c == "parent") || // PhantomJS 2 has enumerable non-index properties on typed arrays.
    a && (c == "buffer" || c == "byteLength" || c == "byteOffset") || // Skip index properties.
    Rp(c, u))) && s.push(c);
  return s;
}
var tb = Object.prototype;
function mc(o) {
  var t = o && o.constructor, e = typeof t == "function" && t.prototype || tb;
  return o === e;
}
function mf(o, t) {
  return function(e) {
    return o(t(e));
  };
}
var nb = mf(Object.keys, Object), ab = nb, ib = Object.prototype, sb = ib.hasOwnProperty;
function yf(o) {
  if (!mc(o))
    return ab(o);
  var t = [];
  for (var e in Object(o))
    sb.call(o, e) && e != "constructor" && t.push(e);
  return t;
}
function tl(o) {
  return o != null && Ap(o.length) && !Ep(o);
}
function yc(o) {
  return tl(o) ? gf(o) : yf(o);
}
function ob(o, t) {
  return o && rl(t, yc(t), o);
}
function ub(o) {
  var t = [];
  if (o != null)
    for (var e in Object(o))
      t.push(e);
  return t;
}
var lb = Object.prototype, cb = lb.hasOwnProperty;
function db(o) {
  if (!Tn(o))
    return ub(o);
  var t = mc(o), e = [];
  for (var r in o)
    r == "constructor" && (t || !cb.call(o, r)) || e.push(r);
  return e;
}
function nl(o) {
  return tl(o) ? gf(o, !0) : db(o);
}
function pb(o, t) {
  return o && rl(t, nl(t), o);
}
var kf = (typeof exports == "undefined" ? "undefined" : be(exports)) == "object" && exports && !exports.nodeType && exports, fh = kf && (typeof module == "undefined" ? "undefined" : be(module)) == "object" && module && !module.nodeType && module, hb = fh && fh.exports === kf, gh = hb ? Bn.Buffer : void 0, mh = gh ? gh.allocUnsafe : void 0;
function bf(o, t) {
  if (t)
    return o.slice();
  var e = o.length, r = mh ? mh(e) : new o.constructor(e);
  return o.copy(r), r;
}
function Tf(o, t) {
  var e = -1, r = o.length;
  for (t || (t = Array(r)); ++e < r; )
    t[e] = o[e];
  return t;
}
function vb(o, t) {
  for (var e = -1, r = o == null ? 0 : o.length, n = 0, a = []; ++e < r; ) {
    var i = o[e];
    t(i, e, o) && (a[n++] = i);
  }
  return a;
}
function wf() {
  return [];
}
var fb = Object.prototype, gb = fb.propertyIsEnumerable, yh = Object.getOwnPropertySymbols, mb = yh ? function(o) {
  return o == null ? [] : (o = Object(o), vb(yh(o), function(t) {
    return gb.call(o, t);
  }));
} : wf, Mp = mb;
function yb(o, t) {
  return rl(o, Mp(o), t);
}
function Pf(o, t) {
  for (var e = -1, r = t.length, n = o.length; ++e < r; )
    o[n + e] = t[e];
  return o;
}
var kb = mf(Object.getPrototypeOf, Object), _p = kb, bb = Object.getOwnPropertySymbols, Tb = bb ? function(o) {
  for (var t = []; o; )
    Pf(t, Mp(o)), o = _p(o);
  return t;
} : wf, Sf = Tb;
function wb(o, t) {
  return rl(o, Sf(o), t);
}
function Ef(o, t, e) {
  var r = t(o);
  return tn(o) ? r : Pf(r, e(o));
}
function md(o) {
  return Ef(o, yc, Mp);
}
function Pb(o) {
  return Ef(o, nl, Sf);
}
var Sb = xs(Bn, "DataView"), yd = Sb, Eb = xs(Bn, "Promise"), kd = Eb, Cb = xs(Bn, "Set"), Io = Cb, Rb = xs(Bn, "WeakMap"), bd = Rb, kh = "[object Map]", Ab = "[object Object]", bh = "[object Promise]", Th = "[object Set]", wh = "[object WeakMap]", Ph = "[object DataView]", Ib = Zs(yd), Mb = Zs(Ku), _b = Zs(kd), Ob = Zs(Io), Db = Zs(bd), Ss = Xs;
(yd && Ss(new yd(new ArrayBuffer(1))) != Ph || Ku && Ss(new Ku()) != kh || kd && Ss(kd.resolve()) != bh || Io && Ss(new Io()) != Th || bd && Ss(new bd()) != wh) && (Ss = function(t) {
  var e = Xs(t), r = e == Ab ? t.constructor : void 0, n = r ? Zs(r) : "";
  if (n)
    switch (n) {
      case Ib:
        return Ph;
      case Mb:
        return kh;
      case _b:
        return bh;
      case Ob:
        return Th;
      case Db:
        return wh;
    }
  return e;
});
var Lo = Ss, Lb = Object.prototype, $b = Lb.hasOwnProperty;
function Nb(o) {
  var t = o.length, e = new o.constructor(t);
  return t && typeof o[0] == "string" && $b.call(o, "index") && (e.index = o.index, e.input = o.input), e;
}
var Vb = Bn.Uint8Array, xl = Vb;
function Op(o) {
  var t = new o.constructor(o.byteLength);
  return new xl(t).set(new xl(o)), t;
}
function Ub(o, t) {
  var e = t ? Op(o.buffer) : o.buffer;
  return new o.constructor(e, o.byteOffset, o.byteLength);
}
var jb = /\w*$/;
function Fb(o) {
  var t = new o.constructor(o.source, jb.exec(o));
  return t.lastIndex = o.lastIndex, t;
}
var Sh = da ? da.prototype : void 0, Eh = Sh ? Sh.valueOf : void 0;
function Hb(o) {
  return Eh ? Object(Eh.call(o)) : {};
}
function Cf(o, t) {
  var e = t ? Op(o.buffer) : o.buffer;
  return new o.constructor(e, o.byteOffset, o.length);
}
var Bb = "[object Boolean]", qb = "[object Date]", Gb = "[object Map]", Wb = "[object Number]", Jb = "[object RegExp]", Kb = "[object Set]", zb = "[object String]", Yb = "[object Symbol]", Qb = "[object ArrayBuffer]", Xb = "[object DataView]", Zb = "[object Float32Array]", xb = "[object Float64Array]", e0 = "[object Int8Array]", r0 = "[object Int16Array]", t0 = "[object Int32Array]", n0 = "[object Uint8Array]", a0 = "[object Uint8ClampedArray]", i0 = "[object Uint16Array]", s0 = "[object Uint32Array]";
function o0(o, t, e) {
  var r = o.constructor;
  switch (t) {
    case Qb:
      return Op(o);
    case Bb:
    case qb:
      return new r(+o);
    case Xb:
      return Ub(o, e);
    case Zb:
    case xb:
    case e0:
    case r0:
    case t0:
    case n0:
    case a0:
    case i0:
    case s0:
      return Cf(o, e);
    case Gb:
      return new r();
    case Wb:
    case zb:
      return new r(o);
    case Jb:
      return Fb(o);
    case Kb:
      return new r();
    case Yb:
      return Hb(o);
  }
}
var Ch = Object.create, u0 = function() {
  function o() {
  }
  return function(t) {
    if (!Tn(t))
      return {};
    if (Ch)
      return Ch(t);
    o.prototype = t;
    var e = new o();
    return o.prototype = void 0, e;
  };
}(), l0 = u0;
function Rf(o) {
  return typeof o.constructor == "function" && !mc(o) ? l0(_p(o)) : {};
}
var c0 = "[object Map]";
function d0(o) {
  return pa(o) && Lo(o) == c0;
}
var Rh = Do && Do.isMap, p0 = Rh ? Ip(Rh) : d0, h0 = p0, v0 = "[object Set]";
function f0(o) {
  return pa(o) && Lo(o) == v0;
}
var Ah = Do && Do.isSet, g0 = Ah ? Ip(Ah) : f0, m0 = g0, y0 = 1, k0 = 2, b0 = 4, Af = "[object Arguments]", T0 = "[object Array]", w0 = "[object Boolean]", P0 = "[object Date]", S0 = "[object Error]", If = "[object Function]", E0 = "[object GeneratorFunction]", C0 = "[object Map]", R0 = "[object Number]", Mf = "[object Object]", A0 = "[object RegExp]", I0 = "[object Set]", M0 = "[object String]", _0 = "[object Symbol]", O0 = "[object WeakMap]", D0 = "[object ArrayBuffer]", L0 = "[object DataView]", $0 = "[object Float32Array]", N0 = "[object Float64Array]", V0 = "[object Int8Array]", U0 = "[object Int16Array]", j0 = "[object Int32Array]", F0 = "[object Uint8Array]", H0 = "[object Uint8ClampedArray]", B0 = "[object Uint16Array]", q0 = "[object Uint32Array]", dr = {};
dr[Af] = dr[T0] = dr[D0] = dr[L0] = dr[w0] = dr[P0] = dr[$0] = dr[N0] = dr[V0] = dr[U0] = dr[j0] = dr[C0] = dr[R0] = dr[Mf] = dr[A0] = dr[I0] = dr[M0] = dr[_0] = dr[F0] = dr[H0] = dr[B0] = dr[q0] = !0;
dr[S0] = dr[If] = dr[O0] = !1;
function Ol(o, t, e, r, n, a) {
  var i, s = t & y0, u = t & k0, c = t & b0;
  if (e && (i = n ? e(o, r, n, a) : e(o)), i !== void 0)
    return i;
  if (!Tn(o))
    return o;
  var d = tn(o);
  if (d) {
    if (i = Nb(o), !s)
      return Tf(o, i);
  } else {
    var h = Lo(o), v = h == If || h == E0;
    if (Oo(o))
      return bf(o, s);
    if (h == Mf || h == Af || v && !n) {
      if (i = u || v ? {} : Rf(o), !s)
        return u ? wb(o, pb(i, o)) : yb(o, ob(i, o));
    } else {
      if (!dr[h])
        return n ? o : {};
      i = o0(o, h, s);
    }
  }
  a || (a = new Hn());
  var f = a.get(o);
  if (f)
    return f;
  a.set(o, i), m0(o) ? o.forEach(function(y) {
    i.add(Ol(y, t, e, y, o, a));
  }) : h0(o) && o.forEach(function(y, b) {
    i.set(b, Ol(y, t, e, b, o, a));
  });
  var g = c ? u ? Pb : md : u ? nl : yc, k = d ? void 0 : g(o);
  return lk(k || o, function(y, b) {
    k && (b = y, y = o[b]), pf(i, b, Ol(y, t, e, b, o, a));
  }), i;
}
var G0 = 1, W0 = 4;
function Dp(o) {
  return Ol(o, G0 | W0);
}
var J0 = "[object Symbol]";
function kc(o) {
  return be(o) == "symbol" || pa(o) && Xs(o) == J0;
}
var K0 = /\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/, z0 = /^\w*$/;
function Lp(o, t) {
  if (tn(o))
    return !1;
  var e = be(o);
  return e == "number" || e == "symbol" || e == "boolean" || o == null || kc(o) ? !0 : z0.test(o) || !K0.test(o) || t != null && o in Object(t);
}
var Y0 = "Expected a function";
function $p(o, t) {
  if (typeof o != "function" || t != null && typeof t != "function")
    throw new TypeError(Y0);
  var e = function() {
    var n = arguments, a = t ? t.apply(this, n) : n[0], i = e.cache;
    if (i.has(a))
      return i.get(a);
    var s = o.apply(this, n);
    return e.cache = i.set(a, s) || i, s;
  };
  return e.cache = new ($p.Cache || Ja)(), e;
}
$p.Cache = Ja;
var Q0 = 500;
function X0(o) {
  var t = $p(o, function(r) {
    return e.size === Q0 && e.clear(), r;
  }), e = t.cache;
  return t;
}
var Z0 = /[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g, x0 = /\\(\\)?/g, eT = X0(function(o) {
  var t = [];
  return o.charCodeAt(0) === 46 && t.push(""), o.replace(Z0, function(e, r, n, a) {
    t.push(n ? a.replace(x0, "$1") : r || e);
  }), t;
}), rT = eT;
function tT(o, t) {
  for (var e = -1, r = o == null ? 0 : o.length, n = Array(r); ++e < r; )
    n[e] = t(o[e], e, o);
  return n;
}
var nT = 1 / 0, Ih = da ? da.prototype : void 0, Mh = Ih ? Ih.toString : void 0;
function _f(o) {
  if (typeof o == "string")
    return o;
  if (tn(o))
    return tT(o, _f) + "";
  if (kc(o))
    return Mh ? Mh.call(o) : "";
  var t = o + "";
  return t == "0" && 1 / o == -nT ? "-0" : t;
}
function aT(o) {
  return o == null ? "" : _f(o);
}
function Of(o, t) {
  return tn(o) ? o : Lp(o, t) ? [o] : rT(aT(o));
}
var iT = 1 / 0;
function bc(o) {
  if (typeof o == "string" || kc(o))
    return o;
  var t = o + "";
  return t == "0" && 1 / o == -iT ? "-0" : t;
}
function Df(o, t) {
  t = Of(t, o);
  for (var e = 0, r = t.length; o != null && e < r; )
    o = o[bc(t[e++])];
  return e && e == r ? o : void 0;
}
function sT(o, t, e) {
  var r = o == null ? void 0 : Df(o, t);
  return r === void 0 ? e : r;
}
function oT(o, t, e) {
  t = Of(t, o);
  for (var r = -1, n = t.length, a = !1; ++r < n; ) {
    var i = bc(t[r]);
    if (!(a = o != null && e(o, i)))
      break;
    o = o[i];
  }
  return a || ++r != n ? a : (n = o == null ? 0 : o.length, !!n && Ap(n) && Rp(i, n) && (tn(o) || Yu(o)));
}
var uT = Object.defineProperty, lT = function(t, e) {
  for (var r in e)
    uT(t, r, { get: e[r], enumerable: !0 });
}, cT = {};
lT(cT, { permissions: function() {
  return dT;
}, theme: function() {
  return pT;
} });
var Dt = /* @__PURE__ */ function(o) {
  return o.GroupCall = "GROUP_CALL", o.Webinar = "WEBINAR", o.AudioRoom = "AUDIO_ROOM", o.Livestream = "LIVESTREAM", o.Chat = "CHAT", o;
}(Dt || {}), te = /* @__PURE__ */ function(o) {
  return o.Allowed = "ALLOWED", o.NotAllowed = "NOT_ALLOWED", o.CanRequest = "CAN_REQUEST", o;
}(te || {}), dT = { view_type: "GROUP_CALL", accept_waiting_requests: !1, accept_present_requests: !1, request_produce: !1, can_allow_participant_audio: !1, can_allow_participant_screensharing: !1, can_allow_participant_video: !1, can_spotlight: !1, request_kick_participant: !1, kick_participant: !1, pin_participant: !1, can_edit_display_name: !1, can_record: !1, can_livestream: !1, can_present: !0, waiting_room_type: "SKIP_ON_ACCEPT", recorder_type: "NONE", plugins: { can_close: !0, can_start: !0 }, polls: { can_create: !0, can_vote: !0, can_view: !0 }, produce: { video: { allow: !0, quality: "vga", frame_rate: 24 }, audio: !0, screenshare: { allow: !0, quality: "hd", frame_rate: 5 } }, chat: { public: { can_send: !0, text: !0, files: !0 }, private: { can_send: !1, can_receive: !1, text: !1, files: !1 } }, connected_meetings: { can_alter_connected_meetings: !1, can_switch_connected_meetings: !1, can_switch_to_parent_meeting: !1 }, reactions: !1, hidden_participant: !1, is_recorder: !1, show_participant_list: !0, can_change_participant_role: !1, can_change_theme: !1, max_screenshare_count: 1 }, pT = { setup_screen: { is_enabled: !0 }, alone_here: { is_enabled: !0 }, waiting_room: { is_enabled: !1, enable_preview: !0 }, control_bar: { is_enabled: !0, elements: { plugins: !0, screenshare: !0, invite: !0, participants: !0, chat: !0, reactions: !1, polls: !0, fullscreen: !0, layout: !0 } }, header: { is_enabled: !0, elements: { timer: !0, title: !0, participant_count: !0, change_layout: !0 } }, pip_mode: !0, auto_tune: !0, grid: { multi: { maxVideoCount: 6, videoFit: "cover" }, single: { maxVideoCount: 6, videoFit: "cover" }, defaultView: "multi" }, controls: { pip_toggle: !1 } }, Lf = "hXgU8Wc8pwuGNq9ms5q9Hh";
if (typeof process != "undefined") {
  var mo;
  (mo = process) !== null && mo !== void 0 && (mo = mo.env) !== null && mo !== void 0 && mo.FLAGSMITH_ENVIRONMENT_KEY && (Lf = process.env.FLAGSMITH_ENVIRONMENT_KEY);
}
function hT() {
  var o = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : [], t = {};
  return o.forEach(function(e) {
    t[e.feature.name] = { enabled: e.enabled, value: e.feature_state_value };
  }), t;
}
var $f = /* @__PURE__ */ function() {
  function o() {
    var t = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : Lf;
    w(this, o), this.flags = {}, this.environmentKey = null, this.environmentKey = t;
  }
  return P(o, [{ key: "identifyAndFetchFlagsWithRetry", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i, s, u, c, d, h, v, f, g, k, y, b, C, T;
      return p().wrap(function(D) {
        for (; ; )
          switch (D.prev = D.next) {
            case 0:
              i = n.primaryEndpoint, s = n.secondaryEndpoint, u = n.forceEvaluate, c = n.timeout, d = n.uniqueIdentifier, h = n.traitsObj, v = n.logger, f = JSON.parse(JSON.stringify(h)), g = Object.entries(f).map(function(I) {
                return { trait_key: I[0], trait_value: I[1] };
              }), k = [i, s, s], y = /* @__PURE__ */ p().mark(function I() {
                var _, V, F, N, L, H;
                return p().wrap(function(B) {
                  for (; ; )
                    switch (B.prev = B.next) {
                      case 0:
                        return _ = T[C], B.prev = 1, V = new AbortController(), F = setTimeout(function() {
                          return V.abort();
                        }, c), N = "_" + (Math.random() + 1).toString(36).substring(2), B.next = 7, fetch("https://".concat(_, "/api/v1/identities/"), {
                          method: "POST",
                          headers: { "Content-Type": "application/json", "X-Environment-Key": a.environmentKey },
                          body: JSON.stringify({ identifier: d + (u ? N : ""), traits: g }),
                          signal: V.signal
                          // Handles the timeout
                        });
                      case 7:
                        if (L = B.sent, clearTimeout(F), L.ok) {
                          B.next = 11;
                          break;
                        }
                        throw new Error("Request failed with status ".concat(L.status));
                      case 11:
                        return B.next = 13, L.json();
                      case 13:
                        return H = B.sent, B.abrupt("return", { v: hT(H.flags || []) });
                      case 17:
                        B.prev = 17, B.t0 = B.catch(1), v.error("Flagsmith identify failed!!", { error: B.t0, url: _ });
                      case 20:
                      case "end":
                        return B.stop();
                    }
                }, I, null, [[1, 17]]);
              }), C = 0, T = k;
            case 6:
              if (!(C < T.length)) {
                D.next = 14;
                break;
              }
              return D.delegateYield(y(), "t0", 8);
            case 8:
              if (b = D.t0, !b) {
                D.next = 11;
                break;
              }
              return D.abrupt("return", b.v);
            case 11:
              C++, D.next = 6;
              break;
            case 14:
              return D.abrupt("return", {});
            case 15:
            case "end":
              return D.stop();
          }
      }, r);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "identify", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d = arguments;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return a = d.length > 1 && d[1] !== void 0 ? d[1] : {}, i = d.length > 2 && d[2] !== void 0 ? d[2] : !1, s = d.length > 3 && d[3] !== void 0 ? d[3] : 5e3, u = d.length > 4 && d[4] !== void 0 ? d[4] : "edge.api.flagsmith.com", c = d.length > 5 && d[5] !== void 0 ? d[5] : console, v.next = 7, this.identifyAndFetchFlagsWithRetry({ traitsObj: a, uniqueIdentifier: n, forceEvaluate: i, timeout: s, primaryEndpoint: u, secondaryEndpoint: "edge.api.flagsmith.com", logger: c });
            case 7:
              return this.flags = v.sent, v.abrupt("return", this.flags);
            case 9:
            case "end":
              return v.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getValue", value: function(e) {
    return this.flags && this.flags[e] && this.flags[e].value;
  } }, { key: "hasFeature", value: function(e) {
    return this.flags && this.flags[e] && this.flags[e].enabled;
  } }, { key: "getAllFlags", value: function() {
    return this.flags;
  } }]);
}(), vT = new $f();
function fT(o) {
  return new $f(o);
}
var Nf = [-2, -1, 0, 1, 2], gT = [0, 1, 2, 3, 4];
function mT(o) {
  o = o.trim();
  var t = "0", e = "0", r = "0";
  return o.length == 4 ? (t = "0x" + o[1] + o[1], e = "0x" + o[2] + o[2], r = "0x" + o[3] + o[3]) : o.length > 6 && (t = "0x" + o[1] + o[2], e = "0x" + o[3] + o[4], r = "0x" + o[5] + o[6]), [+t, +e, +r];
}
var yT = function(t, e, r) {
  var n, a, i;
  if (e == 0)
    n = a = i = r;
  else {
    var s = function(h, v, f) {
      return f < 0 && (f += 1), f > 1 && (f -= 1), f < 0.16666666666666666 ? h + (v - h) * 6 * f : f < 0.5 ? v : f < 0.6666666666666666 ? h + (v - h) * (0.6666666666666666 - f) * 6 : h;
    }, u = r < 0.5 ? r * (1 + e) : r + e - r * e, c = 2 * r - u;
    n = s(c, u, t + 1 / 3), a = s(c, u, t), i = s(c, u, t - 1 / 3);
  }
  return [Math.round(n * 255), Math.round(a * 255), Math.round(i * 255)];
}, kT = function(t, e, r) {
  t /= 255, e /= 255, r /= 255;
  var n = Math.max(t, e, r), a = Math.min(t, e, r), i, s, u = (n + a) / 2;
  if (n == a)
    i = s = 0;
  else {
    var c = n - a;
    switch (s = u > 0.5 ? c / (2 - n - a) : c / (n + a), n) {
      case t:
        i = (e - r) / c + (e < r ? 6 : 0);
        break;
      case e:
        i = (r - t) / c + 2;
        break;
      case r:
        i = (t - e) / c + 4;
        break;
    }
    i /= 6;
  }
  return [i, s, u];
}, bT = function(t, e, r) {
  var n = function(i) {
    return i.toString(16).padStart(2, "0");
  };
  return "#".concat(n(t)).concat(n(e)).concat(n(r));
}, Vf = function(t) {
  var e = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : Nf, r = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : 0.4, n = [], a = mT(t), i = He(a, 3), s = i[0], u = i[1], c = i[2], d = kT(s, u, c), h = He(d, 3), v = h[0], f = h[1], g = h[2], k = Math.round(g * 100);
  k > 70 ? r = 0.8 : k > 60 ? r = 0.9 : k < 10 ? r = 0.075 : k < 42 && (r = 0.3);
  var y = e.findIndex(function(B) {
    return B === 0;
  });
  if (y === -1)
    throw new Error("Invalid reducer provided, it must contain atleast one zero");
  var b = 5 - y, C = y + 1, T = (100 - k) / b, E = k / C, D = Fn(e), I;
  try {
    for (D.s(); !(I = D.n()).done; ) {
      var _ = I.value, V = void 0;
      _ < 0 ? V = k + _ * E * r : _ > 0 ? V = k + _ * T * r : V = k;
      var F = yT(v, f, V / 100), N = He(F, 3), L = N[0], H = N[1], Q = N[2];
      n.push(bT(L, H, Q));
    }
  } catch (B) {
    D.e(B);
  } finally {
    D.f();
  }
  return n;
}, _h = { dark: { background: { 1e3: "#252525", 900: "#2F2F2F", 800: "#323232", 700: "#3E3E3E", 600: "#4A4A4A" }, text: "#F5F5F5", "video-bg": "#1C1C1C" }, light: { background: { 1e3: "#FFFFFF", 900: "#F5F5F5", 800: "#EBEBEB", 700: "#E0E0E0", 600: "#D6D6D6" }, text: "#111111", "text-on-brand": "#ffffff", "video-bg": "#DADADA" } }, TT = function(t) {
  var e = Vf(t, Nf), r = He(e, 5), n = r[0], a = r[1], i = r[2], s = r[3], u = r[4];
  return { 300: n, 400: a, 500: i, 600: s, 700: u };
}, wT = function(t) {
  if (t === "#FFFFFF")
    return _h.light.background;
  if (t === "#000000")
    return _h.dark.background;
  var e = Vf(t, gT), r = He(e, 5), n = r[0], a = r[1], i = r[2], s = r[3], u = r[4];
  return { 1e3: n, 900: a, 800: i, 700: s, 600: u };
}, PT = { border_radius: "rounded", border_width: "thin", spacing_base: 4, theme: "dark", colors: { brand: TT("#2160FD"), background: wT("#141414"), danger: "#FF2D2D", text: "#EEEEEE", text_on_brand: "#EEEEEE", success: "#62A504", video_bg: "#191919", warning: "#FFCD07" } };
function Uf() {
  return Dp(PT);
}
var ST = { permissions: {
  // webinar
  can_accept_production_requests: !1,
  can_edit_display_name: !0,
  accept_waiting_requests: !1,
  disable_participant_audio: !1,
  disable_participant_screensharing: !1,
  disable_participant_video: !1,
  can_spotlight: !1,
  kick_participant: !1,
  pin_participant: !1,
  can_record: !1,
  can_livestream: !1,
  waiting_room_type: "SKIP",
  plugins: { can_close: !0, can_start: !0, can_edit_config: !1, config: {} },
  polls: { can_create: !0, can_vote: !0, can_view: !0 },
  media: { video: {
    can_produce: "ALLOWED",
    can_consume: "ALLOWED"
    /* Allowed */
  }, audio: {
    can_produce: "ALLOWED"
    /* Allowed */
  }, screenshare: {
    can_produce: "ALLOWED",
    can_consume: "ALLOWED"
    /* Allowed */
  } },
  chat: { public: { can_send: !0, text: !0, files: !0 }, private: { can_send: !1, can_receive: !1, text: !1, files: !1 }, channel: {
    // Make sure these are the same in default to ensure consistency in developer portal
    can_create: "ALL",
    can_delete: "ALL",
    can_update: "ALL",
    // end same
    can_read_all: !1
  }, message: {
    // Make sure these are the same in default to ensure consistency in developer portal
    can_delete: "ALL",
    can_edit: "ALL",
    // end same
    delete_cutoff_time_seconds: 0,
    edit_cutoff_time_seconds: 0
  } },
  hidden_participant: !1,
  is_recorder: !1,
  recorder_type: "NONE",
  show_participant_list: !0,
  transcription_enabled: !1,
  can_change_participant_permissions: !1,
  connected_meetings: { can_alter_connected_meetings: !1, can_switch_connected_meetings: !1, can_switch_to_parent_meeting: !1 },
  stage_enabled: !1,
  stage_access: void 0,
  accept_stage_requests: !1
}, ui: { oldTheme: { setup_screen: { is_enabled: !1 }, alone_here: { is_enabled: !1 }, waiting_room: { is_enabled: !1, enable_preview: !0 }, control_bar: { is_enabled: !0, elements: { plugins: !0, screenshare: !0, invite: !1, participants: !0, chat: !0, reactions: !1, polls: !0, fullscreen: !0, layout: !0 } }, header: { is_enabled: !0, elements: { timer: !0, title: !0, participant_count: !0, change_layout: !0 } }, pip_mode: !0, auto_tune: !0, colors: { primary: "#2160FD", secondary: "#1A1A1A", text: "#EEEEEE", background: "#1A1A1A", textPrimary: "#EEEEEE", videoBackground: "#1A1A1A" }, dimensions: { mode: "fillParent" }, grid: { multi: { maxVideoCount: 6, videoFit: "cover" }, single: { maxVideoCount: 6, videoFit: "cover" }, defaultView: "MULTI" }, controls: { pip_toggle: !1 }, plugins: [] }, design_tokens: Uf(), config_diff: {} }, config: { view_type: "GROUP_CALL", media: { audio: { enable_stereo: !1, enable_high_bitrate: !1 }, video: { quality: "vga", frame_rate: 24 }, screenshare: { quality: "hd", frame_rate: 5 } }, max_video_streams: { mobile: 6, desktop: 6 }, max_screenshare_count: 1, track_recording: { subscriptions: [] } }, version: "hybrid" };
function ET() {
  return Dp(ST);
}
var CT = { permissions: {
  // webinar
  can_accept_production_requests: !1,
  can_edit_display_name: !0,
  accept_waiting_requests: !1,
  disable_participant_audio: !1,
  disable_participant_screensharing: !1,
  disable_participant_video: !1,
  can_spotlight: !1,
  kick_participant: !1,
  pin_participant: !1,
  can_record: !1,
  can_livestream: !1,
  waiting_room_type: "SKIP",
  plugins: { can_close: !0, can_start: !0, can_edit_config: !1, config: {} },
  polls: { can_create: !0, can_vote: !0, can_view: !0 },
  media: { video: {
    can_produce: "ALLOWED"
    /* Allowed */
  }, audio: {
    can_produce: "ALLOWED"
    /* Allowed */
  }, screenshare: {
    can_produce: "ALLOWED"
    /* Allowed */
  } },
  chat: { public: { can_send: !0, text: !0, files: !0 }, private: { can_send: !1, can_receive: !1, text: !1, files: !1 } },
  hidden_participant: !1,
  is_recorder: !1,
  recorder_type: "NONE",
  show_participant_list: !0,
  transcription_enabled: !1,
  can_change_participant_permissions: !1,
  connected_meetings: { can_alter_connected_meetings: !1, can_switch_connected_meetings: !1, can_switch_to_parent_meeting: !1 },
  stage_enabled: !1,
  stage_access: void 0,
  accept_stage_requests: !1
}, ui: { design_tokens: Uf(), config_diff: {} }, config: { view_type: "GROUP_CALL", media: { audio: { enable_stereo: !1, enable_high_bitrate: !1 }, video: { quality: "vga", frame_rate: 24 }, screenshare: { quality: "hd", frame_rate: 5 } }, max_video_streams: { mobile: 6, desktop: 6 }, max_screenshare_count: 1, track_recording: { subscriptions: [] } }, version: "2.0.0" };
function Np() {
  return Dp(CT);
}
var zo = /* @__PURE__ */ S("context"), jf = /* @__PURE__ */ function() {
  function o() {
    w(this, o), Object.defineProperty(this, zo, { writable: !0, value: void 0 });
  }
  return P(o, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      var e;
      return (e = l(this, zo)[zo]) === null || e === void 0 ? void 0 : e.getValue("telemetry");
    }
  ) }, { key: "init", value: function(e) {
    l(this, zo)[zo] = e;
  } }, { key: "info", value: function(e, r, n) {
    var a;
    (a = this.telemetry) === null || a === void 0 || a.addLogInCurrentSpan("info", e, r, n);
  } }, { key: "error", value: function(e, r, n) {
    var a;
    (a = this.telemetry) === null || a === void 0 || a.addLogInCurrentSpan("error", e, r, n);
  } }, { key: "debug", value: function(e, r, n) {
    var a;
    (a = this.telemetry) === null || a === void 0 || a.addLogInCurrentSpan("debug", e, r, n);
  } }, { key: "log", value: function(e, r, n) {
    var a;
    (a = this.telemetry) === null || a === void 0 || a.addLogInCurrentSpan("log", e, r, n);
  } }, { key: "warn", value: function(e, r, n) {
    var a;
    (a = this.telemetry) === null || a === void 0 || a.addLogInCurrentSpan("warn", e, r, n);
  } }]);
}(), Ft = /* @__PURE__ */ S("eventPromises"), Ht = /* @__PURE__ */ S("asyncListeners"), RT = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t), Object.defineProperty(r, Ft, { writable: !0, value: void 0 }), Object.defineProperty(r, Ht, { writable: !0, value: void 0 }), r.asyncPromiseTimeout = void 0, r.logger = void 0, r.logger = e, l(r, Ft)[Ft] = /* @__PURE__ */ new Map(), l(r, Ht)[Ht] = /* @__PURE__ */ new Map(), r.asyncPromiseTimeout = 8e3, r;
  }
  return A(t, o), P(t, [{ key: "emitAsync", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              for (l(this, Ft)[Ft].set(a, []), s = l(this, Ht)[Ht].get(a).map(function() {
                return new Promise(function(g) {
                  l(i, Ft)[Ft].get(a).push(g);
                });
              }), u = h.length, c = new Array(u > 1 ? u - 1 : 0), d = 1; d < u; d++)
                c[d - 1] = h[d];
              return Re(t, "emit", this, 3)([a].concat(c)), f.next = 6, Promise.race([Promise.all(s), new Promise(function(g, k) {
                return setTimeout(function() {
                  return k(new Error("emitAsync failed to resolve for event ".concat(a, ".")));
                }, i.asyncPromiseTimeout);
              })]);
            case 6:
              l(this, Ft)[Ft].delete(a);
            case 7:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "onAsync",
    value: function(r, n) {
      var a = this, i = l(this, Ft)[Ft], s = /* @__PURE__ */ function() {
        var u = m(/* @__PURE__ */ p().mark(function c() {
          var d, h, v = arguments;
          return p().wrap(function(g) {
            for (; ; )
              switch (g.prev = g.next) {
                case 0:
                  return g.prev = 0, g.next = 3, n.apply(void 0, v);
                case 3:
                  g.next = 8;
                  break;
                case 5:
                  g.prev = 5, g.t0 = g.catch(0), a.logger.error("[onAsync]", { error: g.t0 });
                case 8:
                  h = (d = i.get(r)) === null || d === void 0 ? void 0 : d.shift(), h == null || h();
                case 10:
                case "end":
                  return g.stop();
              }
          }, c, null, [[0, 5]]);
        }));
        return function() {
          return u.apply(this, arguments);
        };
      }();
      return l(this, Ht)[Ht].get(r) || l(this, Ht)[Ht].set(r, []), l(this, Ht)[Ht].get(r).push(s), Re(t, "on", this, 3)([r, s]);
    }
    /**
    * removes all attached listeners
    */
  }, { key: "reset", value: function() {
    l(this, Ft)[Ft] = /* @__PURE__ */ new Map(), l(this, Ht)[Ht] = /* @__PURE__ */ new Map(), Re(t, "removeAllListeners", this, 3)([]);
  } }]);
}(ht.EventEmitter), AT = /\s/;
function IT(o) {
  for (var t = o.length; t-- && AT.test(o.charAt(t)); )
    ;
  return t;
}
var MT = /^\s+/;
function _T(o) {
  return o && o.slice(0, IT(o) + 1).replace(MT, "");
}
var Oh = 0 / 0, OT = /^[-+]0x[0-9a-f]+$/i, DT = /^0b[01]+$/i, LT = /^0o[0-7]+$/i, $T = parseInt;
function Dh(o) {
  if (typeof o == "number")
    return o;
  if (kc(o))
    return Oh;
  if (Tn(o)) {
    var t = typeof o.valueOf == "function" ? o.valueOf() : o;
    o = Tn(t) ? t + "" : t;
  }
  if (typeof o != "string")
    return o === 0 ? o : +o;
  o = _T(o);
  var e = DT.test(o);
  return e || LT.test(o) ? $T(o.slice(2), e ? 2 : 8) : OT.test(o) ? Oh : +o;
}
function Vp(o) {
  return o;
}
function NT(o, t, e) {
  switch (e.length) {
    case 0:
      return o.call(t);
    case 1:
      return o.call(t, e[0]);
    case 2:
      return o.call(t, e[0], e[1]);
    case 3:
      return o.call(t, e[0], e[1], e[2]);
  }
  return o.apply(t, e);
}
function VT() {
}
var UT = 800, jT = 16, FT = Date.now;
function HT(o) {
  var t = 0, e = 0;
  return function() {
    var r = FT(), n = jT - (r - e);
    if (e = r, n > 0) {
      if (++t >= UT)
        return arguments[0];
    } else
      t = 0;
    return o.apply(void 0, arguments);
  };
}
function BT(o) {
  return function() {
    return o;
  };
}
var qT = Zl ? function(o, t) {
  return Zl(o, "toString", { configurable: !0, enumerable: !1, value: BT(t), writable: !0 });
} : Vp, GT = qT, WT = HT(GT), JT = WT;
function KT(o, t, e, r) {
  for (var n = o.length, a = e + (r ? 1 : -1); r ? a-- : ++a < n; )
    if (t(o[a], a, o))
      return a;
  return -1;
}
function zT(o) {
  return o !== o;
}
function YT(o, t, e) {
  for (var r = e - 1, n = o.length; ++r < n; )
    if (o[r] === t)
      return r;
  return -1;
}
function QT(o, t, e) {
  return t === t ? YT(o, t, e) : KT(o, zT, e);
}
function XT(o, t) {
  var e = o == null ? 0 : o.length;
  return !!e && QT(o, t, 0) > -1;
}
var Lh = Math.max;
function ZT(o, t, e) {
  return t = Lh(t === void 0 ? o.length - 1 : t, 0), function() {
    for (var r = arguments, n = -1, a = Lh(r.length - t, 0), i = Array(a); ++n < a; )
      i[n] = r[t + n];
    n = -1;
    for (var s = Array(t + 1); ++n < t; )
      s[n] = r[n];
    return s[t] = e(i), NT(o, this, s);
  };
}
function xT(o, t) {
  return JT(ZT(o, t, Vp), o + "");
}
function ew(o, t, e) {
  if (!Tn(e))
    return !1;
  var r = be(t);
  return (r == "number" ? tl(e) && Rp(t, e.length) : r == "string" && t in e) ? el(e[t], o) : !1;
}
function rw(o) {
  return xT(function(t, e) {
    var r = -1, n = e.length, a = n > 1 ? e[n - 1] : void 0, i = n > 2 ? e[2] : void 0;
    for (a = o.length > 3 && typeof a == "function" ? (n--, a) : void 0, i && ew(e[0], e[1], i) && (a = n < 3 ? void 0 : a, n = 1), t = Object(t); ++r < n; ) {
      var s = e[r];
      s && o(t, s, r, a);
    }
    return t;
  });
}
var tw = "[object Object]", nw = Function.prototype, aw = Object.prototype, Ff = nw.toString, iw = aw.hasOwnProperty, sw = Ff.call(Object);
function ow(o) {
  if (!pa(o) || Xs(o) != tw)
    return !1;
  var t = _p(o);
  if (t === null)
    return !0;
  var e = iw.call(t, "constructor") && t.constructor;
  return typeof e == "function" && e instanceof e && Ff.call(e) == sw;
}
var uw = "__lodash_hash_undefined__";
function lw(o) {
  return this.__data__.set(o, uw), this;
}
function cw(o) {
  return this.__data__.has(o);
}
function Qu(o) {
  var t = -1, e = o == null ? 0 : o.length;
  for (this.__data__ = new Ja(); ++t < e; )
    this.add(o[t]);
}
Qu.prototype.add = Qu.prototype.push = lw;
Qu.prototype.has = cw;
function dw(o, t) {
  for (var e = -1, r = o == null ? 0 : o.length; ++e < r; )
    if (t(o[e], e, o))
      return !0;
  return !1;
}
function Hf(o, t) {
  return o.has(t);
}
var pw = 1, hw = 2;
function Bf(o, t, e, r, n, a) {
  var i = e & pw, s = o.length, u = t.length;
  if (s != u && !(i && u > s))
    return !1;
  var c = a.get(o), d = a.get(t);
  if (c && d)
    return c == t && d == o;
  var h = -1, v = !0, f = e & hw ? new Qu() : void 0;
  for (a.set(o, t), a.set(t, o); ++h < s; ) {
    var g = o[h], k = t[h];
    if (r)
      var y = i ? r(k, g, h, t, o, a) : r(g, k, h, o, t, a);
    if (y !== void 0) {
      if (y)
        continue;
      v = !1;
      break;
    }
    if (f) {
      if (!dw(t, function(b, C) {
        if (!Hf(f, C) && (g === b || n(g, b, e, r, a)))
          return f.push(C);
      })) {
        v = !1;
        break;
      }
    } else if (!(g === k || n(g, k, e, r, a))) {
      v = !1;
      break;
    }
  }
  return a.delete(o), a.delete(t), v;
}
function vw(o) {
  var t = -1, e = Array(o.size);
  return o.forEach(function(r, n) {
    e[++t] = [n, r];
  }), e;
}
function Up(o) {
  var t = -1, e = Array(o.size);
  return o.forEach(function(r) {
    e[++t] = r;
  }), e;
}
var fw = 1, gw = 2, mw = "[object Boolean]", yw = "[object Date]", kw = "[object Error]", bw = "[object Map]", Tw = "[object Number]", ww = "[object RegExp]", Pw = "[object Set]", Sw = "[object String]", Ew = "[object Symbol]", Cw = "[object ArrayBuffer]", Rw = "[object DataView]", $h = da ? da.prototype : void 0, Fc = $h ? $h.valueOf : void 0;
function Aw(o, t, e, r, n, a, i) {
  switch (e) {
    case Rw:
      if (o.byteLength != t.byteLength || o.byteOffset != t.byteOffset)
        return !1;
      o = o.buffer, t = t.buffer;
    case Cw:
      return !(o.byteLength != t.byteLength || !a(new xl(o), new xl(t)));
    case mw:
    case yw:
    case Tw:
      return el(+o, +t);
    case kw:
      return o.name == t.name && o.message == t.message;
    case ww:
    case Sw:
      return o == t + "";
    case bw:
      var s = vw;
    case Pw:
      var u = r & fw;
      if (s || (s = Up), o.size != t.size && !u)
        return !1;
      var c = i.get(o);
      if (c)
        return c == t;
      r |= gw, i.set(o, t);
      var d = Bf(s(o), s(t), r, n, a, i);
      return i.delete(o), d;
    case Ew:
      if (Fc)
        return Fc.call(o) == Fc.call(t);
  }
  return !1;
}
var Iw = 1, Mw = Object.prototype, _w = Mw.hasOwnProperty;
function Ow(o, t, e, r, n, a) {
  var i = e & Iw, s = md(o), u = s.length, c = md(t), d = c.length;
  if (u != d && !i)
    return !1;
  for (var h = u; h--; ) {
    var v = s[h];
    if (!(i ? v in t : _w.call(t, v)))
      return !1;
  }
  var f = a.get(o), g = a.get(t);
  if (f && g)
    return f == t && g == o;
  var k = !0;
  a.set(o, t), a.set(t, o);
  for (var y = i; ++h < u; ) {
    v = s[h];
    var b = o[v], C = t[v];
    if (r)
      var T = i ? r(C, b, v, t, o, a) : r(b, C, v, o, t, a);
    if (!(T === void 0 ? b === C || n(b, C, e, r, a) : T)) {
      k = !1;
      break;
    }
    y || (y = v == "constructor");
  }
  if (k && !y) {
    var E = o.constructor, D = t.constructor;
    E != D && "constructor" in o && "constructor" in t && !(typeof E == "function" && E instanceof E && typeof D == "function" && D instanceof D) && (k = !1);
  }
  return a.delete(o), a.delete(t), k;
}
var Dw = 1, Nh = "[object Arguments]", Vh = "[object Array]", Tl = "[object Object]", Lw = Object.prototype, Uh = Lw.hasOwnProperty;
function $w(o, t, e, r, n, a) {
  var i = tn(o), s = tn(t), u = i ? Vh : Lo(o), c = s ? Vh : Lo(t);
  u = u == Nh ? Tl : u, c = c == Nh ? Tl : c;
  var d = u == Tl, h = c == Tl, v = u == c;
  if (v && Oo(o)) {
    if (!Oo(t))
      return !1;
    i = !0, d = !1;
  }
  if (v && !d)
    return a || (a = new Hn()), i || gc(o) ? Bf(o, t, e, r, n, a) : Aw(o, t, u, e, r, n, a);
  if (!(e & Dw)) {
    var f = d && Uh.call(o, "__wrapped__"), g = h && Uh.call(t, "__wrapped__");
    if (f || g) {
      var k = f ? o.value() : o, y = g ? t.value() : t;
      return a || (a = new Hn()), n(k, y, e, r, a);
    }
  }
  return v ? (a || (a = new Hn()), Ow(o, t, e, r, n, a)) : !1;
}
function Tc(o, t, e, r, n) {
  return o === t ? !0 : o == null || t == null || !pa(o) && !pa(t) ? o !== o && t !== t : $w(o, t, e, r, Tc, n);
}
var Nw = 1, Vw = 2;
function Uw(o, t, e, r) {
  var n = e.length, a = n, i = !r;
  if (o == null)
    return !a;
  for (o = Object(o); n--; ) {
    var s = e[n];
    if (i && s[2] ? s[1] !== o[s[0]] : !(s[0] in o))
      return !1;
  }
  for (; ++n < a; ) {
    s = e[n];
    var u = s[0], c = o[u], d = s[1];
    if (i && s[2]) {
      if (c === void 0 && !(u in o))
        return !1;
    } else {
      var h = new Hn();
      if (r)
        var v = r(c, d, u, o, t, h);
      if (!(v === void 0 ? Tc(d, c, Nw | Vw, r, h) : v))
        return !1;
    }
  }
  return !0;
}
function qf(o) {
  return o === o && !Tn(o);
}
function jw(o) {
  for (var t = yc(o), e = t.length; e--; ) {
    var r = t[e], n = o[r];
    t[e] = [r, n, qf(n)];
  }
  return t;
}
function Gf(o, t) {
  return function(e) {
    return e == null ? !1 : e[o] === t && (t !== void 0 || o in Object(e));
  };
}
function Fw(o) {
  var t = jw(o);
  return t.length == 1 && t[0][2] ? Gf(t[0][0], t[0][1]) : function(e) {
    return e === o || Uw(e, o, t);
  };
}
function Hw(o, t) {
  return o != null && t in Object(o);
}
function Bw(o, t) {
  return o != null && oT(o, t, Hw);
}
var qw = 1, Gw = 2;
function Ww(o, t) {
  return Lp(o) && qf(t) ? Gf(bc(o), t) : function(e) {
    var r = sT(e, o);
    return r === void 0 && r === t ? Bw(e, o) : Tc(t, r, qw | Gw);
  };
}
function Jw(o) {
  return function(t) {
    return t == null ? void 0 : t[o];
  };
}
function Kw(o) {
  return function(t) {
    return Df(t, o);
  };
}
function zw(o) {
  return Lp(o) ? Jw(bc(o)) : Kw(o);
}
function Yw(o) {
  return typeof o == "function" ? o : o == null ? Vp : be(o) == "object" ? tn(o) ? Ww(o[0], o[1]) : Fw(o) : zw(o);
}
function Qw(o) {
  return function(t, e, r) {
    for (var n = -1, a = Object(t), i = r(t), s = i.length; s--; ) {
      var u = i[o ? s : ++n];
      if (e(a[u], u, a) === !1)
        break;
    }
    return t;
  };
}
var Xw = Qw(), Zw = Xw, xw = function() {
  return Bn.Date.now();
}, Hc = xw, eP = "Expected a function", rP = Math.max, tP = Math.min;
function jp(o, t, e) {
  var r, n, a, i, s, u, c = 0, d = !1, h = !1, v = !0;
  if (typeof o != "function")
    throw new TypeError(eP);
  t = Dh(t) || 0, Tn(e) && (d = !!e.leading, h = "maxWait" in e, a = h ? rP(Dh(e.maxWait) || 0, t) : a, v = "trailing" in e ? !!e.trailing : v);
  function f(I) {
    var _ = r, V = n;
    return r = n = void 0, c = I, i = o.apply(V, _), i;
  }
  function g(I) {
    return c = I, s = setTimeout(b, t), d ? f(I) : i;
  }
  function k(I) {
    var _ = I - u, V = I - c, F = t - _;
    return h ? tP(F, a - V) : F;
  }
  function y(I) {
    var _ = I - u, V = I - c;
    return u === void 0 || _ >= t || _ < 0 || h && V >= a;
  }
  function b() {
    var I = Hc();
    if (y(I))
      return C(I);
    s = setTimeout(b, k(I));
  }
  function C(I) {
    return s = void 0, v && r ? f(I) : (r = n = void 0, i);
  }
  function T() {
    s !== void 0 && clearTimeout(s), c = 0, r = u = n = s = void 0;
  }
  function E() {
    return s === void 0 ? i : C(Hc());
  }
  function D() {
    var I = Hc(), _ = y(I);
    if (r = arguments, n = this, u = I, _) {
      if (s === void 0)
        return g(u);
      if (h)
        return clearTimeout(s), s = setTimeout(b, t), f(u);
    }
    return s === void 0 && (s = setTimeout(b, t)), i;
  }
  return D.cancel = T, D.flush = E, D;
}
function Td(o, t, e) {
  (e !== void 0 && !el(o[t], e) || e === void 0 && !(t in o)) && Cp(o, t, e);
}
function nP(o) {
  return pa(o) && tl(o);
}
function wd(o, t) {
  if (!(t === "constructor" && typeof o[t] == "function") && t != "__proto__")
    return o[t];
}
function aP(o) {
  return rl(o, nl(o));
}
function iP(o, t, e, r, n, a, i) {
  var s = wd(o, e), u = wd(t, e), c = i.get(u);
  if (c) {
    Td(o, e, c);
    return;
  }
  var d = a ? a(s, u, e + "", o, t, i) : void 0, h = d === void 0;
  if (h) {
    var v = tn(u), f = !v && Oo(u), g = !v && !f && gc(u);
    d = u, v || f || g ? tn(s) ? d = s : nP(s) ? d = Tf(s) : f ? (h = !1, d = bf(u, !0)) : g ? (h = !1, d = Cf(u, !0)) : d = [] : ow(u) || Yu(u) ? (d = s, Yu(s) ? d = aP(s) : (!Tn(s) || Ep(s)) && (d = Rf(u))) : h = !1;
  }
  h && (i.set(u, d), n(d, u, r, a, i), i.delete(u)), Td(o, e, d);
}
function Wf(o, t, e, r, n) {
  o !== t && Zw(t, function(a, i) {
    if (n || (n = new Hn()), Tn(a))
      iP(o, t, i, e, Wf, r, n);
    else {
      var s = r ? r(wd(o, i), a, i + "", o, t, n) : void 0;
      s === void 0 && (s = a), Td(o, i, s);
    }
  }, nl);
}
function sP(o, t, e) {
  for (var r = -1, n = o == null ? 0 : o.length; ++r < n; )
    if (e(t, o[r]))
      return !0;
  return !1;
}
var oP = "[object Map]", uP = "[object Set]", lP = Object.prototype, cP = lP.hasOwnProperty;
function dP(o) {
  if (o == null)
    return !0;
  if (tl(o) && (tn(o) || typeof o == "string" || typeof o.splice == "function" || Oo(o) || gc(o) || Yu(o)))
    return !o.length;
  var t = Lo(o);
  if (t == oP || t == uP)
    return !o.size;
  if (mc(o))
    return !yf(o).length;
  for (var e in o)
    if (cP.call(o, e))
      return !1;
  return !0;
}
function pP(o, t) {
  return Tc(o, t);
}
var hP = rw(function(o, t, e) {
  Wf(o, t, e);
}), yi = hP, vP = 1 / 0, fP = Io && 1 / Up(new Io([, -0]))[1] == vP ? function(o) {
  return new Io(o);
} : VT, gP = fP, mP = 200;
function Jf(o, t, e) {
  var r = -1, n = XT, a = o.length, i = !0, s = [], u = s;
  if (e)
    i = !1, n = sP;
  else if (a >= mP) {
    var c = t ? null : gP(o);
    if (c)
      return Up(c);
    i = !1, n = Hf, u = new Qu();
  } else
    u = t ? [] : s;
  e:
    for (; ++r < a; ) {
      var d = o[r], h = t ? t(d) : d;
      if (d = e || d !== 0 ? d : 0, i && h === h) {
        for (var v = u.length; v--; )
          if (u[v] === h)
            continue e;
        t && u.push(h), s.push(d);
      } else
        n(u, h, e) || (u !== s && u.push(h), s.push(d));
    }
  return s;
}
function yP(o) {
  return o && o.length ? Jf(o) : [];
}
function kP(o, t) {
  return o && o.length ? Jf(o, Yw(t)) : [];
}
var Pd = /* @__PURE__ */ function(o) {
  return o.PARTICIPANT = "PARTICIPANT", o.PEER = "PEER", o.CLIENT = "CLIENT", o;
}(Pd || {}), me = { PROPAGATE_KICK_ALL: "propagate_kick_across_rooms", REFRESH_ID_ON_DISCONNECTION: "refresh_id_on_disconnection", SKIP_OTEL_TRACES: "skip_otel_traces", USE_USERIDS_IN_CHAT: "use_userids_in_chat", ENABLE_CF_SIMULCAST: "enable_cf_simulcast", CF_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED: "cf_transport_force_relay_on_ice_failed", LOG_LEVEL: "log_level", V1_PLUGINS: "v1_plugins", LIVESTREAM: "feat_livestream", FEAT_PAGINATED_CHAT: "feat_paginated_chat", VAL_MIN_FRAMERATE: "val_min_framerate", SCREEENSHARE_ERR_HACK: "screenshare_err_hack", SCREEENSHARE_CONSTRAINTS_RETRY: "screenshare_constraints_retry", VIDEO_CONSTRAINTS: "video_constraints", SCREENSHARE_CONSTRAINTS: "screenshare_constraints", FEAT_CHAT_SDK: "feat_chat_sdk", FEAT_CHAT_SDK_SEARCH: "chat_search", OBS_QUALITY: "obs_quality", ALLOW_SAFARI_MEDIA_MIDDLEWARES: "allow_safari_media_middlewares", EXP_RESHARE: "exp_reshare", SKIP_SETTING_IN_USE_DEVICE: "skip_setting_in_use_device", PRECALL_BANDWIDTH_TEST: "precall_bandwidth_test", DEBUG_SOCKET_JOIN: "debug_socket_join", FORCE_RELAY: "force_relay", FORCE_VIDEO_CODEC: "force_video_codec", TRACK_HINT: "track_hint", OVERRIDE_SIMULCAST_DYNAMIC: "override_simulcast_dynamic", PRECREATE_PRODUCERS: "precreate_producers", DISABLE_OPUS_DTX_CF: "disable_opus_dtx_cf", ENABLE_AUDIO_ACTIVITY_DEBUG_LOGS: "enable_audio_activity_debug_logs", DISABLE_LAYER_SWITCH: "disable_layer_switch" };
function Dl(o) {
  var t = {};
  return typeof (o == null ? void 0 : o.code) == "number" && (t.code = o.code), typeof (o == null ? void 0 : o.code) == "string" && (t.code = o.code.substring(0, 100)), typeof (o == null ? void 0 : o.name) == "string" && (t.name = o.name.substring(0, 500)), typeof (o == null ? void 0 : o.message) == "string" && (t.message = o.message.substring(0, 500)), typeof (o == null ? void 0 : o.reason) == "string" && (t.reason = o.reason.substring(0, 500)), typeof (o == null ? void 0 : o.stack) == "string" && (t.stack = o.stack.substring(0, 500)), t;
}
var bP = { audio: !0, video: !0, screenshareAudio: !0, screenshareVideo: !0 }, Yo = { baseURL: "http://localhost:5000", createdAt: "2021-08-05T10:49:56.602Z", description: "Develop plugins locally", id: "09259e3b-7be8-46f6-9801-106bf1866e1c", name: "Localhost Dev", organizationId: "4ad15a19-80e2-4105-bf43-48039fd2963e", picture: "https://dyte-uploads.s3.ap-south-1.amazonaws.com/dyte.png", private: !1, published: !0, staggered: !1, tags: ["#localhost", "#dev"], type: "self_hosted", updatedAt: "2021-08-05T10:50:07.681Z" }, TP = { pip: !0, poll: !0, chat: !0, stage: !0, theme: !0, plugin: !0, tracing: !0, internals: !0, recording: !0, livestream: !0, participant: !0, connectedMeetings: !0, devTools: { logs: !1 } };
function $o(o, t) {
  var e = o.getValue("overrides");
  return e && e[t] ? e[t] : !1;
}
function wP(o) {
  var t = o.baseURI;
  return t.includes("preprod.dyte") || t.includes("preprod.realtime") ? _u.PREPROD : t.includes("devel.dyte") || t.includes("devel.realtime") ? _u.DEVEL : _u.PROD;
}
function Fs(o) {
  var t = o.servicePrefix, e = o.baseURI;
  return "".concat(t, ".").concat(e);
}
function Kf(o) {
  var t = o.getValue("baseURI");
  return { location: Fs({ servicePrefix: "location", baseURI: t }), locationLegacy: Fs({ servicePrefix: "location-legacy", baseURI: t }), daCollector: Fs({
    servicePrefix: "da-collector",
    /**
    * FIXME(ravindra-cloudflare): Need to port da-collector to CF.
    * Remove the replace logic once realtime da-collector is up.
    * * */
    baseURI: t.replace("realtime.cloudflare.com", "dyte.io")
  }) };
}
var PP = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m16.242 2.932 4.826 4.826a2.75 2.75 0 0 1-.715 4.404l-4.87 2.435a.75.75 0 0 0-.374.426l-1.44 4.166a1.25 1.25 0 0 1-2.065.476L8.5 16.561 4.06 21H3v-1.06l4.44-4.44-3.105-3.104a1.25 1.25 0 0 1 .476-2.066l4.166-1.44a.75.75 0 0 0 .426-.373l2.435-4.87a2.75 2.75 0 0 1 4.405-.715Zm3.766 5.886-4.826-4.826a1.25 1.25 0 0 0-2.002.325l-2.435 4.871a2.25 2.25 0 0 1-1.278 1.12l-3.789 1.31 6.705 6.704 1.308-3.789a2.25 2.25 0 0 1 1.12-1.277l4.872-2.436a1.25 1.25 0 0 0 .325-2.002Z" fill="currentColor"/></svg>', SP = '<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 12.02c0 1.06.2 2.1.6 3.08l.6 1.42c.22.55.64 1.01 1.17 1.29.27.14.56.21.86.21h2.55c.77 0 1.49-.41 1.87-1.08.5-.87 1.02-1.7 1.72-2.43l1.32-1.39c.44-.46.97-.84 1.49-1.23l.59-.45a.6.6 0 0 0 .23-.47c0-.75-.54-1.57-1.22-1.79a3.34 3.34 0 0 0-2.78.29V4.5a1.5 1.5 0 0 0-2.05-1.4 1.5 1.5 0 0 0-2.9 0A1.5 1.5 0 0 0 6 4.5v.09A1.5 1.5 0 0 0 4 6v6.02ZM8 4.5v4a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0v5a.5.5 0 0 0 1 0v-4a.5.5 0 0 1 1 0v6a.5.5 0 0 0 .85.37h.01c.22-.22.44-.44.72-.58.7-.35 2.22-.57 2.4.5l-.53.4c-.52.4-1.04.78-1.48 1.24l-1.33 1.38c-.75.79-1.31 1.7-1.85 2.63-.21.36-.6.58-1.01.58H7.23a.87.87 0 0 1-.4-.1 1.55 1.55 0 0 1-.71-.78l-.59-1.42a7.09 7.09 0 0 1-.53-2.7V6a.5.5 0 0 1 1 0v3.5a.5.5 0 0 0 1 0v-5a.5.5 0 0 1 1 0Z" fill="currentColor"></path></svg>', wl = function(t) {
  if (t) {
    var e = t.startsWith("<svg");
    if (!e)
      return new Promise(function(i) {
        i(t);
      });
    var r = new Blob([t], { type: "image/svg+xml" }), n = new Image(), a = window.URL.createObjectURL(r);
    return new Promise(function(i, s) {
      n.onload = function() {
        i(n), window.URL.revokeObjectURL(a);
      }, n.onerror = function() {
        s(), window.URL.revokeObjectURL(a);
      }, n.src = a;
    });
  }
}, $s = { logs: "https://api-silos.dyte.io/otel/logs", mock: { url: "https://mock.dyte.io", domain: "mock.dyte.io", app: "https://app.dyte.io/v2/meeting", stagingApp: "https://app.devel.dyte.io/v2/meeting" }, apiBase: { prod: "https://api.dyte.io", staging: "https://api.devel.dyte.io", prodAlternate: "https://api.cluster.dyte.in" }, baseURI: { prod: "dyte.io", staging: "devel.dyte.io" } };
function EP(o) {
  var t, e, r = typeof navigator != "undefined" && !navigator.isReactNative && typeof window != "undefined" && ((t = window.location.host) === null || t === void 0 ? void 0 : t.includes($s.baseURI.staging)), n = !!(o != null && (e = o.getValue("modules")) !== null && e !== void 0 && (e = e.devTools) !== null && e !== void 0 && e.logs);
  return r || n;
}
function CP(o, t) {
  if (o != null && o.getValue("flagsmith").hasFeature(me.LOG_LEVEL)) {
    var e, r = ((e = o.getValue("flagsmith").getValue(me.LOG_LEVEL)) === null || e === void 0 ? void 0 : e.toString()) || "all";
    if (r = r.toLowerCase().trim(), r === "off")
      return !1;
    if (r !== "all") {
      var n = ["debug", "log", "info", "warn", "error"], a = n.indexOf(t), i = n.indexOf(r);
      if (a < i)
        return !1;
    }
  }
  return !0;
}
function zf(o, t) {
  var e = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {};
  return Object.getOwnPropertyNames(o).forEach(function(r) {
    var n;
    if (![null, void 0, NaN].includes(o[r]) && !(t && (((n = t.match(/\./g)) === null || n === void 0 ? void 0 : n.length) || 0) >= 10)) {
      var a = t ? "".concat(t, ".").concat(r) : r;
      be(o[r]) === "object" ? zf(o[r], a, e) : ["number", "string", "boolean"].includes(be(o[r])) && (e[a] = o[r]);
    }
  }), e;
}
function jh(o, t) {
  var e = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {}, r = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : "", n = {};
  try {
    var a = JSON.stringify(e), i = JSON.parse(a), s = zf(i, r), u = JSON.stringify(s);
    return JSON.parse(u);
  } catch (d) {
    var c = Dl(d);
    n["".concat(r, ".error.message")] = c.message || "", n["".concat(r, ".error.stack")] = c.stack || "", n["".concat(r, ".error.reason")] = c.reason || "", n["".concat(r, ".error.source")] = "safelyFlattenObjForOpenTelemetry";
  }
  return n;
}
var O = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this.logsCache = [], this.logsProcessorTimer = void 0, this.tracingEnabled = !0, this.initialized = !1, this.logsProcessingInterval = 7e3, this.logExclusionList = ["message", "websocket/message", "roomMessage", "websocket/room-message", "websocket/room-legacy-mode", "chatMessage", "websocket/new-chat-message", "websocket/no-active-speaker", "websocket/selected-peers", "websocket/active-speaker", "ping", "websocket/new-consumer", "websocket/producer-score", "websocket/consumer-score", "websocket/plugin-event", "websocket/plugin-data", "websocket/plugin-internal-data"], this.meetingMetadata = {};
  }
  return P(o, [{ key: "logsEndpoint", get: function() {
    var e = Ha.getContext(this.meetingMetadata.peerId), r = Fs({ servicePrefix: "api-silos", baseURI: e.getValue("baseURI") });
    return "https://".concat(r, "/otel/logs");
  } }, { key: "resetPeerId", value: function(e) {
    this.meetingMetadata.peerId = e;
  } }, { key: "init", value: function(e, r, n) {
    this.tracingEnabled = !0, this.initialized = !1, this.logsCache = [];
    var a = e.getValue("peerId");
    this.meetingMetadata = r, this.tracingEnabled = n, this.meetingMetadata.peerId = a, this.meetingMetadata.sdkVersion = e.getValue("sdkVersion");
    var i = navigator, s = i.RNDeviceInfoImpl;
    this.meetingMetadata.deviceInfo = navigator.isReactNative ? s == null ? void 0 : s.getDeviceInfo() : kr.getDeviceInfo(), this.meetingMetadata.visitedUrl = !navigator.isReactNative && typeof window != "undefined" && window.location.href, this.logsProcessorTimer = setInterval(this.processCachedLogs.bind(this), this.logsProcessingInterval), n && (this.initialized = !0);
  } }, {
    key: "injectContext",
    value: function(e) {
      var r, n = Js().replace(/-/g, "").substring(0, 16), a = (r = this.meetingMetadata.peerId) === null || r === void 0 ? void 0 : r.replace(/-/g, "");
      e.TRACEPARENT = "00-".concat(a, "-").concat(n, "-01");
    }
    /**
    * Adds event into the current span or the main span.
    * Event(or this method) is not a replacement for a log.
    * Tip :: Heavy objects should be logged.
    * Tip :: Light objects with `to the point` info should be added as events.
    * @param eventSeverity severity of the passed event to create better dashboards
    * @param eventName name of event in format
    *	fileName::functionName::eventName or functionName::eventName or whatever seems fit
    * @param metadata pass any information which makes sense for analytics or debugging
    * @param noCache optionally pass if log can be cached in FE or it has to be sent instantly
    * @returns nothing
    */
  }, { key: "addLogInCurrentSpan", value: function(e, r) {
    var n = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : {}, a = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !1;
    n != null && n.error && Object.assign(n, { error: Dl(n.error) });
    var i = Ha.getContext(this.meetingMetadata.peerId);
    EP(i) && (dP(n) ? console[e]("InternalLogs:: ", e, r) : console[e]("InternalLogs:: ", e, r, n));
    var s = CP(i, e);
    if (s)
      try {
        var u = jh(i, r, n, "metadata"), c = new Date(), d = $($({ message: r, level: e }, u), {}, { loggedAt: c.toISOString(), loggedAtTzOffset: c.getTimezoneOffset() });
        a ? this.sendOtelLogsToNewRelic([d]) : this.logsCache.push(d);
      } catch (h) {
        this.addLogInCurrentSpan("error", "opentelemetry::addLogInCurrentSpan_failed", { error: Dl(h) });
      }
  } }, { key: "sendOtelLogsToNewRelic", value: function(e) {
    var r = this, n = Ha.getContext(this.meetingMetadata.peerId);
    fetch(this.logsEndpoint, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ meetingMetadata: jh(n, "sendOtelLogsToNewRelic", this.meetingMetadata, "meetingMetadata"), serviceName: n.getValue("sdkName"), logs: e }) }).catch(function(a) {
      var i;
      r.addLogInCurrentSpan("error", "opentelemetry::sendOtelLogToNewRelic_failed", { error: Dl(a) }), (i = r.logsCache).push.apply(i, Se(e));
    });
  } }, { key: "processCachedLogs", value: function() {
    var e = this.logsCache.splice(0, 25);
    e != null && e.length && this.sendOtelLogsToNewRelic(e);
  } }, { key: "destruct", value: function() {
    clearInterval(this.logsProcessorTimer), this.processCachedLogs();
  } }], [{ key: "trace", value: function(e) {
    var r = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : void 0;
    return function(n, a, i) {
      var s = i.value;
      return i.value = function() {
        for (var c, d = this === null || this === void 0 ? void 0 : this.telemetry, h = arguments.length, v = new Array(h), f = 0; f < h; f++)
          v[f] = arguments[f];
        if (!d || !d.initialized || navigator.isReactNative || !d.tracingEnabled || (c = Ha.getContext(d.meetingMetadata.peerId)) !== null && c !== void 0 && c.getValue("flagsmith").hasFeature(me.SKIP_OTEL_TRACES))
          return s.apply(this, v);
        d.addLogInCurrentSpan("info", e, r);
        var g = performance.now(), k = s.apply(this, v);
        return Promise.resolve(k).then(function() {
          var y = performance.now();
          y - g > 10 && d.addLogInCurrentSpan("info", "".concat(e, "_timing"), { execTime: y - g, country: o.location.country });
        }).catch(function() {
          var y = performance.now();
          d.addLogInCurrentSpan("info", "".concat(e, "_timing"), { execTime: y - g });
        }), k;
      }, i;
    };
  } }]);
}();
O.location = { country: void 0 };
function RP(o) {
  var t = $({}, o), e = /* @__PURE__ */ new Map(), r = function(d, h) {
    return e.has(d) || e.set(d, /* @__PURE__ */ new Set()), e.get(d).add(h), function() {
      var v;
      return (v = e.get(d)) === null || v === void 0 ? void 0 : v.delete(h);
    };
  }, n = function(d, h) {
    var v;
    (v = e.get(d)) === null || v === void 0 || v.delete(h);
  }, a = function(d) {
    var h;
    (h = e.get(d)) === null || h === void 0 || h.forEach(function(v) {
      try {
        v(t[d]);
      } catch (f) {
      }
    });
  }, i = function(d, h) {
    var v = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !0;
    t[d] = h, v && a(d);
  }, s = function(d) {
    return t[d];
  }, u = function() {
    return t;
  };
  return { subscribe: r, unsubscribe: n, notify: a, setValue: i, getValue: s, getAllValues: u };
}
var AP = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this.contexts = /* @__PURE__ */ new Map(), this.mostRecentPeerId = null;
  }
  return P(o, [{
    key: "createContext",
    value: function(e, r) {
      if (this.contexts.has(e))
        return this.contexts.get(e);
      var n = new O(), a = new jf();
      this.contexts.set(e, RP(r)), this.contexts.get(e).setValue("peerSessionStore", new RT(a));
      var i = new lf();
      return i.setMaxListeners(50), this.contexts.get(e).setValue("logger", a), this.contexts.get(e).setValue("telemetry", n), this.contexts.get(e).setValue("callstats", i), this.contexts.get(e).setValue("flagsmith", fT()), this.mostRecentPeerId = e, this.contexts.get(e);
    }
    /**
    * NOTE(ishita1805): Used to remap the context
    * when we regnerate a peerId during reconnection.
    */
  }, { key: "remapContext", value: function(e, r) {
    var n = r.getValue("peerId");
    n !== e && (r.setValue("peerId", e), this.mostRecentPeerId = e, this.contexts.set(e, r), this.contexts.delete(n));
  } }, {
    key: "getContext",
    value: function(e) {
      return this.contexts.get(e);
    }
    /**
    * @deprecated
    * This is currently done as a hack to expose the current peer Id.
    * However this would not work in future, if we want to support multiple ongoing meetings per page
    * This hack works for now, because a lot more components will fail, before this,
    * if someone decides to initialize multiple meetings on the same page.
    */
  }, { key: "getMostRecentPeerId", value: function() {
    return this.mostRecentPeerId;
  } }]);
}(), Ha = new AP(), IP = {
  "00": "Client",
  "01": "Controller",
  "02": "RoomNodeClient",
  "03": "HiveNodeClient",
  // (Reserved for Legacy SFU)
  "04": "SocketService",
  "05": "Chat",
  "06": "Plugin",
  "07": "Polls",
  "08": "Meta",
  "09": "Preset",
  10: "Recording",
  11: "Self",
  12: "Participant",
  13: "Spotlight",
  14: "Remote Request",
  15: "Webinar",
  16: "LocalMediaHandler",
  17: "End-End Encryption",
  18: "AI",
  19: "Livestream",
  20: "Stage"
}, Ll = {
  "0000": "Internal exception.",
  "0001": "Failed to initialize.",
  "0002": "Failed to join room.",
  "0003": "Failed to leave room.",
  "0004": "Invalid auth token",
  "0010": "Browser not supported",
  "0011": "HTTP Network Error",
  "0012": "Websocket Network Error",
  "0013": "Rate Limited",
  "0100": "Internal exception",
  "0101": "Permission denied",
  "0102": "Prerequisite module missing",
  "0200": "Internal exception.",
  "0300": "Internal exception",
  "0400": "Internal exception",
  "0404": "Missing prerequisites to establish a websocket connection",
  "0500": "Internal exception",
  "0501": "Permission denied.",
  "0502": "Invalid message body.",
  "0503": "Text Message is too large",
  "0504": "Message not found by the given id",
  "0505": "Action not permitted without joining room",
  "0506": "Message search is disabled",
  "0510": "Invalid channel name.",
  "0600": "Internal exception",
  "0601": "Permission denied.",
  "0602": "Auth token not set for plugin",
  "0603": "Iframe was not provided",
  "0700": "Internal exception",
  "0705": "Action not permitted without joining room",
  "0800": "Internal exception",
  "0801": "Permission denied",
  "0900": "Internal exception",
  "0904": "Could not load preset",
  1e3: "Internal exception",
  1001: "Permission denied",
  1004: "Could not find specified recording",
  1005: "Action not permitted in given recording state",
  1100: "Internal exception",
  1101: "Permission denied",
  1102: "Unsupported",
  1103: "Name cannot be empty",
  1104: "No device selected while calling meeting.self.setDevice",
  1105: "Action not permitted without joining room",
  1106: "Can't set currently used device",
  1200: "Internal exception",
  1201: "Permission denied",
  1202: "Invalid page number was requested",
  1203: "Invalid participant count per page was requested",
  1204: "No participants exists with the given UserIds",
  1205: "Action not permitted without joining room",
  1206: "Manual Subscription Mode was not ACTIVATED",
  1207: "Invalid view mode",
  1208: "Manual Subscription not enabled for organization",
  1209: "Broadcast message type must be a non-empty string",
  1300: "Internal exception",
  1400: "Internal exception",
  1402: "No existing remote requests",
  1403: "No peer exists with given id",
  1500: "Internal exception",
  1600: "Internal exception",
  1601: "Failed to get audio track",
  1602: "Failed to get video track",
  1603: "Incorrect device",
  1604: "Failed to change device",
  1605: "Failed to get audio & video track",
  1606: "No audio input devices are available",
  1607: "No video input devices are available",
  1608: "No audio output devices (speakers) are available",
  1609: "Failed to fetch list of media devices",
  1610: "No media track exists",
  1611: "Failed to unmute track",
  1612: "Failed to get screenshare tracks",
  1701: "Crypto error",
  // 18xx is for AI
  1800: "Internal exception",
  1801: "Can't fetch transcript file",
  // 19xx for livestream
  1900: "Internal exception",
  1901: "Permission denied.",
  1902: "Livestream that has not yet started, can't be stopped",
  2e3: "Internal exception",
  2001: "Permission denied",
  2002: "Unsupported",
  2003: "Stage is disabled",
  2004: "Method not implemented",
  2005: "Action not permitted without joining room",
  2006: "Action not permitted in current stage status",
  9900: "Internal exception"
};
Object.keys(Ll).forEach(function(o) {
  Ll[o] = "{".concat(IP[o.slice(0, 2)], "} ").concat(Ll[o]);
});
var U = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : void 0, i = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !1;
    w(this, t), n = R(this, t, [e]), n.code = void 0, n.code = r, n.name = "ClientError", n.message = "[ERR".concat(n.code, "]: ").concat(Ll[n.code], `
`).concat(n.message);
    try {
      var s = i && !!a;
      r && r.endsWith("00") && a && (s = !0), s && a.error("ClientError", { error: { message: n.message, name: n.name, code: r } });
      var u = Ha.getContext(Ha.getMostRecentPeerId());
      if (u) {
        var c = u.getValue("onError");
        try {
          c(n);
        } catch (d) {
        }
      }
      typeof window != "undefined" && window.dispatchEvent(new CustomEvent("ClientError", { detail: n }));
    } catch (d) {
    }
    return n;
  }
  return A(t, o), P(t);
}(/* @__PURE__ */ Gs(Error));
function Pl(o, t, e, r) {
  if (r instanceof U)
    throw r;
  if (r instanceof t) {
    var n = new U(r.message, e);
    throw n.stack = r.stack, n;
  } else
    throw r;
}
function Fh(o, t, e) {
  if (!o.value) {
    var r = o.get, n = o.set;
    return r && (o.get = function() {
      try {
        return r.apply(this);
      } catch (i) {
        Pl(this, t, e, i);
      }
    }), n && (o.set = function(i) {
      try {
        return n.apply(this, [i]);
      } catch (s) {
        Pl(this, t, e, s);
      }
    }), o;
  }
  var a = o.value;
  return o.value = function() {
    var i = this;
    try {
      for (var s = arguments.length, u = new Array(s), c = 0; c < s; c++)
        u[c] = arguments[c];
      var d = a.apply(this, u);
      return d && d instanceof Promise ? d.catch(function(h) {
        Pl(i, t, e, h);
      }) : d;
    } catch (h) {
      Pl(this, t, e, h);
    }
  }, o;
}
function MP(o, t) {
  return function(e, r, n) {
    if (n)
      return Fh(n, o, t);
    var a = Fn(Reflect.ownKeys(e.prototype).filter(function(d) {
      return d !== "constructor";
    })), i;
    try {
      for (a.s(); !(i = a.n()).done; ) {
        var s = i.value, u = Object.getOwnPropertyDescriptor(e.prototype, s), c = u.value instanceof Function || u.get instanceof Function || u.set instanceof Function;
        c && Object.defineProperty(e.prototype, s, Fh(u, o, t));
      }
    } catch (d) {
      a.e(d);
    } finally {
      a.f();
    }
  };
}
var vt = function(t) {
  return MP(Error, t);
};
function _P(o) {
  var t = 0, e, r;
  if (!o)
    return t;
  for (e = 0; e < o.length; e += 1)
    r = o.charCodeAt(e), t = (t << 5) - t + r, t |= 0;
  return Math.abs(t) % 100 + 1;
}
function OP() {
  kr.isElectron() && window.electronGetDisplayMediaSource && (navigator.mediaDevices.getDisplayMedia = /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function o() {
    var t, e, r, n, a, i;
    return p().wrap(function(u) {
      for (; ; )
        switch (u.prev = u.next) {
          case 0:
            return u.next = 2, window.electronGetDisplayMediaSource({ types: ["window", "screen"] });
          case 2:
            if (e = u.sent, r = [], e && (Array.isArray(e) ? r = e : r = [e]), (t = r) !== null && t !== void 0 && t.length) {
              u.next = 7;
              break;
            }
            throw new Error("Couldn't find any media source for screen share.");
          case 7:
            return n = r.find(function(c) {
              var d;
              return (d = c.id) === null || d === void 0 ? void 0 : d.includes("screen");
            }), n = n != null ? n : r[0], a = { audio: !1, video: { mandatory: { chromeMediaSource: "desktop", chromeMediaSourceId: n.id } } }, u.next = 12, navigator.mediaDevices.getUserMedia(a);
          case 12:
            return i = u.sent, u.abrupt("return", i);
          case 14:
          case "end":
            return u.stop();
        }
    }, o);
  })));
}
var j = /* @__PURE__ */ function(o) {
  return o.NEW_PRODUCER = "NEW_PRODUCER", o.ROOM_NODE_CONNECTION_ERROR = "ROOM_NODE_CONNECTION_ERROR", o.SOCKET_SERVICE_ROOM_JOINED = "SOCKET_SERVICE_ROOM_JOINED", o.SOCKET_SERVICE_RECONNECTED = "SOCKET_SERVICE_RECONNECTED", o.SOCKET_SERVICE_DISCONNECTED = "SOCKET_SERVICE_DISCONNECTED", o.SOCKET_SERVICE_FAILED = "SOCKET_SERVICE_FAILED", o.SOCKET_STATE_UPDATE = "SOCKET_STATE_UPDATE", o.ROOM_NODE_RECONNECTED = "ROOM_NODE_RECONNECTED", o.ROOM_NODE_DISCONNECTED = "ROOM_NODE_DISCONNECTED", o.ROOM_NODE_FAILED = "ROOM_NODE_FAILED", o.TRANSPORT_STATE_UPDATE = "TRANSPORT_STATE_UPDATE", o.PRODUCER_SCORE_UPDATE = "PRODUCER_SCORE_UPDATE", o.CONSUMER_SCORE_UPDATE = "CONSUMER_SCORE_UPDATE", o.PRODUCER_STATUS_UPDATE = "PRODUCER_STATUS_UPDATE", o.CONSUMER_STATUS_UPDATE = "CONSUMER_STATUS_UPDATE", o.LOW_CONSUMER_SCORE = "LOW_CONSUMER_SCORE", o.MEDIA_PERMISSION_ERROR = "MEDIA_PERMISSION_ERROR", o.MEDIA_PERMISSION_UPDATE = "MEDIA_PERMISSION_UPDATE", o.MESSAGE = "websocket/message", o.ROOM_MESSAGE = "websocket/room-message", o.PEER_JOINED_INTERNAL = "peer/joined-internal", o.PEER_CLOSED = "websocket/peer-closed", o.CONSUMER_CLOSED = "websocket/consumer-closed", o.CONSUMER_PAUSED = "websocket/consumer-paused", o.CONSUMER_RESUMED = "websocket/consumer-resumed", o.PRODUCER_CLOSED = "websocket/producer-closed", o.NEW_CONSUMER = "websocket/new-consumer", o.PRODUCER_SCORE = "websocket/producer-score", o.CONSUMER_SCORE = "websocket/consumer-score", o.PRODUCER_TOGGLE = "cf/producer-toggle", o.UPDATE_ACTIVE = "media/update-active", o.RESET_PRODUCER_STATE = "cf/reset-producer-state", o.ROOM_STATE = "sockethub/room-state", o.GET_STAGE_REQUESTS = "GET_STAGE_REQUESTS", o.UPDATE_STAGE_REQUESTS = "UPDATE_STAGE_REQUESTS", o.KICK_PEER = "KICK_PEER", o.UPDATE_PEER_STAGE_STATUS = "UPDATE_PEER_STAGE_STATUS", o.JOIN_MEDIA_ROOM = "JOIN_MEDIA_ROOM", o.LEAVE_MEDIA_ROOM = "LEAVE_MEDIA_ROOM", o.PIP_HANGUP = "PIP_HANGUP", o.E2EE_ACTIVE_PRODUCER = "E2EE_ACTIVE_PRODUCER", o.E2EE_INACTIVE_PRODUCER = "E2EE_INACTIVE_PRODUCER", o.E2EE_ACTIVE_CONSUMER = "E2EE_ACTIVE_CONSUMER", o.E2EE_INACTIVE_CONSUMER = "E2EE_INACTIVE_CONSUMER", o.SOCKET_PEERS = "SOCKET_PEERS", o.UPDATE_PERMISSIONS = "UPDATE_PERMISSIONS", o.MAX_SPATIAL_LAYER_CHANGE = "MAX_SPATIAL_LAYER_CHANGE", o.MUTE_SELF = "MUTE_SELF", o.MUTE_SELF_VIDEO = "MUTE_SELF_VIDEO", o;
}(j || {}), jo = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t), r.logger = void 0, r.logger = e, Re(t, "setMaxListeners", r, 3)([25]), r;
  }
  return A(t, o), P(t, [{ key: "emit", value: function(r) {
    for (var n = arguments.length, a = new Array(n > 1 ? n - 1 : 0), i = 1; i < n; i++)
      a[i - 1] = arguments[i];
    return Re(t, "emit", this, 3)(["*", r].concat(a)), Re(t, "emit", this, 3)([r].concat(a));
  } }, { key: "on", value: function(r, n) {
    try {
      var a = this.listenerCount(r);
      if (a > 25 && a % 25 === 0) {
        var i;
        (i = this.logger) === null || i === void 0 || i.warn("CustomEventEmitter::maxListenersExceeded", { eventListener: { eventName: r.toString(), listenerCount: this.listenerCount(r) } });
      }
    } catch (s) {
    }
    return Re(t, "on", this, 3)([r, n]);
  } }, { key: "addListener", value: function(r, n) {
    try {
      var a = this.listenerCount(r);
      if (a > 25 && a % 25 === 0) {
        var i;
        (i = this.logger) === null || i === void 0 || i.warn("CustomEventEmitter::maxListenersExceeded", { eventListener: { eventName: r.toString(), listenerCount: this.listenerCount(r) } });
      }
    } catch (s) {
    }
    return Re(t, "addListener", this, 3)([r, n]);
  } }, { key: "off", value: function(r, n) {
    return Re(t, "off", this, 3)([r, n]);
  } }, { key: "once", value: function(r, n) {
    return Re(t, "once", this, 3)([r, n]);
  } }, { key: "prependListener", value: function(r, n) {
    return Re(t, "prependListener", this, 3)([r, n]);
  } }, { key: "prependOnceListener", value: function(r, n) {
    return Re(t, "prependOnceListener", this, 3)([r, n]);
  } }, { key: "removeListener", value: function(r, n) {
    return Re(t, "removeListener", this, 3)([r, n]);
  } }, { key: "removeAllListeners", value: function(r) {
    return Re(t, "removeAllListeners", this, 3)([r]);
  } }, { key: "listeners", value: function(r) {
    return Re(t, "listeners", this, 3)([r]);
  } }, { key: "listenerCount", value: function(r) {
    return Re(t, "listenerCount", this, 3)([r]);
  } }]);
}(ht.EventEmitter), an = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t), r.logger = void 0, r.logger = e, Re(t, "setMaxListeners", r, 3)([25]), r;
  }
  return A(t, o), P(t, [{ key: "emit", value: function(r) {
    for (var n = arguments.length, a = new Array(n > 1 ? n - 1 : 0), i = 1; i < n; i++)
      a[i - 1] = arguments[i];
    return Re(t, "emit", this, 3)(["*", r].concat(a)), Re(t, "emit", this, 3)([r].concat(a));
  } }, { key: "on", value: function(r, n) {
    try {
      var a = this.listenerCount(r);
      if (a > 25 && a % 25 === 0) {
        var i;
        (i = this.logger) === null || i === void 0 || i.warn("CustomEventEmitter::maxListenersExceeded", { eventListener: { eventName: r.toString(), listenerCount: this.listenerCount(r) } });
      }
    } catch (s) {
    }
    return Re(t, "on", this, 3)([r, n]);
  } }, { key: "addListener", value: function(r, n) {
    try {
      var a = this.listenerCount(r);
      if (a > 25 && a % 25 === 0) {
        var i;
        (i = this.logger) === null || i === void 0 || i.warn("CustomEventEmitter::maxListenersExceeded", { eventListener: { eventName: r.toString(), listenerCount: this.listenerCount(r) } });
      }
    } catch (s) {
    }
    return Re(t, "addListener", this, 3)([r, n]);
  } }, { key: "off", value: function(r, n) {
    return Re(t, "off", this, 3)([r, n]);
  } }, { key: "once", value: function(r, n) {
    return Re(t, "once", this, 3)([r, n]);
  } }, { key: "prependListener", value: function(r, n) {
    return Re(t, "prependListener", this, 3)([r, n]);
  } }, { key: "prependOnceListener", value: function(r, n) {
    return Re(t, "prependOnceListener", this, 3)([r, n]);
  } }, { key: "removeListener", value: function(r, n) {
    return Re(t, "removeListener", this, 3)([r, n]);
  } }, { key: "removeAllListeners", value: function(r) {
    return Re(t, "removeAllListeners", this, 3)([r]);
  } }, { key: "listeners", value: function(r) {
    return Re(t, "listeners", this, 3)([r]);
  } }, { key: "listenerCount", value: function(r) {
    return Re(t, "listenerCount", this, 3)([r]);
  } }]);
}(ht.EventEmitter);
function DP(o) {
  var t = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 2, e = o.replace(/[^\u00BF-\u1FFF\u2C00-\uD7FF\w\s]/g, ""), r = e.trim().split(/\s+/).slice(0, t);
  return r.map(function(n) {
    return n.charAt(0);
  }).join("").toUpperCase();
}
var Hh = 1080, Bh = 1920, LP = function(t, e, r, n, a, i) {
  var s = 0.5, u = 0.5, c = a, d = i, h = Math.min(r / c, n / d), v = c * h, f = d * h, g, k, y, b, C = 1;
  return v < r && (C = r / v), Math.abs(C - 1) < 1e-14 && f < n && (C = n / f), v *= C, f *= C, y = c / (v / r), b = d / (f / n), g = (c - y) * s, k = (d - b) * u, g < 0 && (g = 0), k < 0 && (k = 0), y > c && (y = c), b > d && (b = d), [g, k, y, b, t, e, r, n];
}, Jr = /* @__PURE__ */ S("canvas"), ha = /* @__PURE__ */ S("context"), rr = /* @__PURE__ */ S("videoContainer"), Kr = /* @__PURE__ */ S("video"), Ee = /* @__PURE__ */ S("dimensions"), at = /* @__PURE__ */ S("colors"), Bt = /* @__PURE__ */ S("rafRequest"), vr = /* @__PURE__ */ S("sources"), De = /* @__PURE__ */ S("self"), is = /* @__PURE__ */ S("pinIcon"), ss = /* @__PURE__ */ S("handRaiseIcon"), qt = /* @__PURE__ */ S("state"), os = /* @__PURE__ */ S("initComplete"), $P = /* @__PURE__ */ function(o) {
  function t(e, r, n, a) {
    var i;
    w(this, t);
    var s = e.getValue("logger");
    return i = R(this, t, [s]), Object.defineProperty(i, Jr, { writable: !0, value: void 0 }), Object.defineProperty(i, ha, { writable: !0, value: void 0 }), Object.defineProperty(i, rr, { writable: !0, value: void 0 }), Object.defineProperty(i, Kr, { writable: !0, value: void 0 }), Object.defineProperty(i, Ee, { writable: !0, value: { height: Hh, width: Bh } }), Object.defineProperty(i, at, { writable: !0, value: { brand: "#2160FD", background: "#141414", text: "#000000", videoBackground: "#191919", textOnBrand: "#EEEEEE" } }), Object.defineProperty(i, Bt, { writable: !0, value: void 0 }), Object.defineProperty(i, vr, { writable: !0, value: {} }), Object.defineProperty(i, De, { writable: !0, value: void 0 }), Object.defineProperty(i, is, { writable: !0, value: void 0 }), Object.defineProperty(i, ss, { writable: !0, value: void 0 }), Object.defineProperty(i, qt, { writable: !0, value: void 0 }), Object.defineProperty(i, os, { writable: !0, value: !1 }), i.cleanupEventListeners = function() {
      l(i, ha)[ha].unsubscribe("stageStatus", i.handlePipMediaControls), l(i, De)[De].removeListener("videoUpdate", i.onSelfVideoUpdateListener), l(i, De)[De].removeListener("audioUpdate", i.onSelfAudioUpdateListener), l(i, De)[De].removeListener("roomLeft", function() {
        return i.disable();
      });
    }, i.enablePipMediaControls = function() {
      i.mountAudioEvents(), i.mountVideoEvents();
    }, i.onSelfVideoUpdateListener = function(u) {
      var c = u.videoEnabled;
      i.updateMediaSession("CAMERA", c);
    }, i.onSelfAudioUpdateListener = function(u) {
      var c = u.audioEnabled;
      i.updateMediaSession("MIC", c);
    }, i.handlePipMediaControls = function(u) {
      u === "ON_STAGE" ? i.enablePipMediaControls() : i.unmountEvents();
    }, i.eventCallback = function(u) {
      u === "CAMERA" && (l(i, De)[De].videoEnabled ? l(i, De)[De].disableVideo() : l(i, De)[De].enableVideo(), i.emit("cameraToggled")), u === "MIC" && (l(i, De)[De].audioEnabled ? l(i, De)[De].disableAudio() : l(i, De)[De].enableAudio(), i.emit("micToggled")), u === "END" && (l(i, ha)[ha].getValue("peerSessionStore").emit(j.PIP_HANGUP), i.cleanupEventListeners(), i.emit("hangup"), i.cleanup());
    }, i.unmountEvents = function() {
      navigator.mediaSession === void 0 || navigator.mediaSession.setCameraActive === void 0 || (navigator.mediaSession.setActionHandler("togglemicrophone", void 0), navigator.mediaSession.setActionHandler("togglecamera", void 0));
    }, i.animate = function() {
      if (!i.isActive && l(i, qt)[qt] === "active") {
        i.disable(!0);
        return;
      }
      l(i, vr)[vr] !== void 0 && i.paintCanvas(), l(i, Bt)[Bt] !== void 0 && (l(i, Bt)[Bt] = requestAnimationFrame(function() {
        return i.animate();
      }));
    }, i.disable = function() {
      var u = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !1;
      l(i, qt)[qt] = "idle", i.cleanupEventListeners(), cancelAnimationFrame(l(i, Bt)[Bt]), u !== !0 && document.body.removeChild(l(i, rr)[rr]), l(i, Bt)[Bt] = void 0, document.pictureInPictureElement && document.exitPictureInPicture();
    }, l(i, ha)[ha] = e, l(i, qt)[qt] = "idle", l(i, De)[De] = r, l(i, at)[at] = { brand: r.config.designTokens.colors.brand[500], background: r.config.designTokens.colors.background[1e3], text: r.config.designTokens.colors.text, videoBackground: r.config.designTokens.colors.videoBg, textOnBrand: r.config.designTokens.colors.textOnBrand }, n && i.setupIcon("pin", n), a && i.setupIcon("handRaise", a), i;
  }
  return A(t, o), P(t, [{ key: "setupIcon", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              u.t0 = a, u.next = u.t0 === "handRaise" ? 3 : u.t0 === "pin" ? 5 : 7;
              break;
            case 3:
              return l(this, ss)[ss] = i, u.abrupt("break", 7);
            case 5:
              return l(this, is)[is] = i, u.abrupt("break", 7);
            case 7:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "overrideIcon", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              u.t0 = a, u.next = u.t0 === "handRaise" ? 3 : u.t0 === "pin" ? 7 : 11;
              break;
            case 3:
              return u.next = 5, wl(i);
            case 5:
              return l(this, ss)[ss] = u.sent, u.abrupt("break", 11);
            case 7:
              return u.next = 9, wl(i);
            case 9:
              return l(this, is)[is] = u.sent, u.abrupt("break", 11);
            case 11:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "constructImage", value: function(r) {
    var n = new Image(), a = new Blob([r], { type: "image/svg+xml" }), i = window.URL.createObjectURL(a);
    return new Promise(function(s) {
      n.onload = function() {
        s(n), window.URL.revokeObjectURL(i);
      }, n.src = i;
    });
  } }, { key: "createVideoContainer", value: function() {
    l(this, rr)[rr] = document.createElement("div"), l(this, rr)[rr].style.width = "0.1px", l(this, rr)[rr].style.height = "0.1px", l(this, rr)[rr].style.overflow = "hidden", l(this, rr)[rr].style.position = "absolute", l(this, rr)[rr].style.bottom = "0", l(this, rr)[rr].style.right = "0", l(this, rr)[rr].style.opacity = "0", l(this, rr)[rr].appendChild(l(this, Kr)[Kr]);
  } }, { key: "setupEventListeners", value: function() {
    var r = this;
    l(this, ha)[ha].subscribe("stageStatus", this.handlePipMediaControls), l(this, De)[De].addListener("videoUpdate", this.onSelfVideoUpdateListener), l(this, De)[De].addListener("audioUpdate", this.onSelfAudioUpdateListener), l(this, De)[De].addListener("roomLeft", function() {
      return r.disable();
    });
  } }, { key: "createCanvas", value: function() {
    var r = document.createElement("canvas");
    r.height = l(this, Ee)[Ee].height, r.width = l(this, Ee)[Ee].width, l(this, Jr)[Jr] = r;
  } }, { key: "setupMediaSessionEvents", value: function() {
    var r = this;
    navigator.mediaSession === void 0 || navigator.mediaSession.setCameraActive === void 0 || (navigator.mediaSession.setActionHandler("hangup", function() {
      r.eventCallback("END");
    }), this.mountAudioEvents(), this.mountVideoEvents());
  } }, { key: "mountAudioEvents", value: function() {
    var r = this;
    navigator.mediaSession === void 0 || navigator.mediaSession.setMicrophoneActive === void 0 || l(this, De)[De].permissions.canProduceAudio && navigator.mediaSession.setActionHandler("togglemicrophone", function() {
      r.eventCallback("MIC");
    });
  } }, { key: "mountVideoEvents", value: function() {
    var r = this;
    navigator.mediaSession === void 0 || navigator.mediaSession.setCameraActive === void 0 || l(this, De)[De].permissions.canProduceVideo && navigator.mediaSession.setActionHandler("togglecamera", function() {
      r.eventCallback("CAMERA");
    });
  } }, { key: "getSources", value: function() {
    var r = Object.values(l(this, vr)[vr]), n = r.reduce(function(a, i) {
      return a[i.pinned ? "pinned" : "regular"].push(i), a;
    }, { pinned: [], regular: [] });
    return [].concat(Se(n.pinned), Se(n.regular));
  } }, { key: "drawEmptyTile", value: function(r, n, a, i) {
    if (l(this, Jr)[Jr] !== void 0) {
      var s = l(this, Jr)[Jr].getContext("2d"), u = l(this, Jr)[Jr].width, c = 0, d = 0, h = n - c * 2, v = a - c * 2, f = Math.floor(u / h), g = Math.floor(r / f), k = r % f, y = k * (h + c) + c, b = g * (v + c) + c, C = i != null ? i : {}, T = C.displayText, E = C.image;
      s.fillStyle = T || E ? l(this, at)[at].videoBackground : l(this, at)[at].background, s.strokeStyle = l(this, at)[at].brand, s.beginPath(), s.moveTo(y + d, b), s.arcTo(y + h, b, y + h, b + d, d), s.arcTo(y + h, b + v, y + h - d, b + v, d), s.arcTo(y, b + v, y, b + v - d, d), s.arcTo(y, b, y + d, b, d), s.closePath(), s.fill(), s.stroke();
      var D = h / 6, I = h / 2 + y, _ = v / 2 + b;
      s.save(), (T || E) && (s.beginPath(), s.arc(I, _, D, 0, Math.PI * 2), s.fillStyle = l(this, at)[at].brand, s.fill(), E ? (s.clip(), s.drawImage(E, I - D, _ - D, D * 2, D * 2), s.restore()) : T && (s.fillStyle = l(this, at)[at].textOnBrand, s.font = "".concat(D / 2, "px sans-serif"), s.textAlign = "center", s.textBaseline = "middle", s.fillText(T, I, _)), this.drawIcons(i, y, b, Math.max(h, v)));
    }
  } }, { key: "drawIcons", value: function(r, n, a, i) {
    var s = this, u = Math.min(Math.max(i * 0.15, 100), 200), c = u * 0.2, d = u * 0.2, h = n + c, v = a + c, f = function(k) {
      var y = l(s, Jr)[Jr].getContext("2d");
      y.save(), y.fillStyle = l(s, at)[at].background, y.beginPath(), y.moveTo(h + d, v), y.arcTo(h + u, v, h + u, v + d, d), y.arcTo(h + u, v + u, h + u - d, v + u, d), y.arcTo(h, v + u, h, v + u - d, d), y.arcTo(h, v, h + d, v, d), y.closePath(), y.fill(), typeof k == "string" ? (y.font = "".concat(u / 1.5, "px sans-serif"), y.fillStyle = l(s, at)[at].text, y.textAlign = "center", y.textBaseline = "top", y.fillText(k, u / 2 + h, v + c)) : y.drawImage(k, h + c, v + c, u - c * 2, u - c * 2), h += u + c, y.restore();
    };
    r.pinned && f(l(this, is)[is]), r.handRaised && f(l(this, ss)[ss]);
  } }, { key: "drawTile", value: function(r, n, a) {
    if (l(this, Jr)[Jr] !== void 0)
      for (var i = l(this, Jr)[Jr].getContext("2d"), s = this.getSources(), u = 0, c = 0; u < l(this, Ee)[Ee].height - 5; ) {
        for (var d = 0; d < l(this, Ee)[Ee].width - 5 && c < a; ) {
          var h;
          if ((h = s[c]) !== null && h !== void 0 && h.enabled) {
            var v, f = s[c].element, g = LP(d, u, r, n, f.videoWidth, f.videoHeight), k = He(g, 8), y = k[0], b = k[1], C = k[2], T = k[3], E = k[4], D = k[5], I = k[6], _ = k[7], V = f == null || (v = f.classList) === null || v === void 0 ? void 0 : v.contains("mirror");
            V ? (i.save(), i.scale(-1, 1), i.drawImage(f, y, b, C, T, -1 * E, D, -1 * I, _), i.restore()) : i.drawImage(f, y, b, C, T, E, D, I, _), this.drawIcons(s[c], E, D, Math.max(I, _));
          } else
            this.drawEmptyTile(c, r, n, s[c]);
          c += 1, d += r;
        }
        u += n;
      }
  } }, { key: "calcGridElemSize", value: function(r) {
    switch (r) {
      case 0:
      case 1:
        return [l(this, Ee)[Ee].width, l(this, Ee)[Ee].height];
      case 2:
        return [Math.floor(l(this, Ee)[Ee].width / 2), l(this, Ee)[Ee].height];
      case 3:
      case 4:
        return [Math.floor(l(this, Ee)[Ee].width / 2), Math.floor(l(this, Ee)[Ee].height / 2)];
      case 5:
      case 6:
        return [Math.floor(l(this, Ee)[Ee].width / 3), Math.floor(l(this, Ee)[Ee].height / 2)];
      case 7:
      case 8:
      case 9:
        return [Math.floor(l(this, Ee)[Ee].width / 3), Math.floor(l(this, Ee)[Ee].height / 3)];
      default:
        return [Math.floor(l(this, Ee)[Ee].width / 3), Math.floor(l(this, Ee)[Ee].height / 2)];
    }
  } }, { key: "paintCanvas", value: function() {
    var r = this.getSources().length;
    r !== 1 && (r = r % 2 > 0 ? r + 1 : r);
    var n = this.calcGridElemSize(r), a = He(n, 2), i = a[0], s = a[1];
    this.drawTile(i, s, r);
  } }, { key: "isSupported", value: function() {
    var r;
    return !!window.chrome && document.pictureInPictureEnabled && ((r = l(this, De)[De].config) === null || r === void 0 ? void 0 : r.viewType) !== "LIVESTREAM";
  } }, { key: "isActive", get: function() {
    return document.pictureInPictureElement !== null;
  } }, {
    key: "cleanup",
    value: function() {
      if (l(this, os)[os] = !1, this.isSupported() && document.exitPictureInPicture !== void 0 && document.pictureInPictureElement !== null && document.exitPictureInPicture(), l(this, rr)[rr])
        try {
          document.body.removeChild(l(this, rr)[rr]);
        } catch (r) {
        }
      this.removeAllSources(), l(this, Jr)[Jr] = void 0, l(this, Kr)[Kr] = void 0, l(this, Bt)[Bt] = void 0;
    }
    /**
    * Initialize PiP and prepare sources
    */
  }, { key: "init", value: function() {
    var r = this, n = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {}, a = n.height, i = n.width;
    if (!this.isSupported())
      throw this.logger.error("Pip.unsupported"), new Error("Picture-in-picture is not available in this environment");
    if (!l(this, os)[os]) {
      l(this, os)[os] = !0, this.createCanvas(), this.setupMediaSessionEvents();
      var s = document.createElement("video");
      l(this, Ee)[Ee] = { height: a != null ? a : Hh, width: i != null ? i : Bh }, s.height = l(this, Ee)[Ee].height, s.width = l(this, Ee)[Ee].width, s.autoplay = !0, s.muted = !0, s.srcObject = l(this, Jr)[Jr].captureStream(24), l(this, Kr)[Kr] = s, l(this, Kr)[Kr].onloadedmetadata = function() {
        try {
          r.emit("pipStarted"), l(r, Kr)[Kr].onleavepictureinpicture = function() {
            r.emit("pipEnded");
          };
        } catch (u) {
          r.emit("pipEnded");
        }
      }, this.createVideoContainer(), this.paintCanvas();
    }
  } }, { key: "updateMediaSession", value: function(r, n) {
    navigator.mediaSession !== void 0 && (r === "CAMERA" && navigator.mediaSession.setCameraActive !== void 0 && navigator.mediaSession.setCameraActive(n), r === "MIC" && navigator.mediaSession.setMicrophoneActive !== void 0 && navigator.mediaSession.setMicrophoneActive(n));
  } }, { key: "enableSource", value: function(r) {
    l(this, vr)[vr][r] !== void 0 && (l(this, vr)[vr][r].enabled = !0);
  } }, { key: "disableSource", value: function(r) {
    l(this, vr)[vr][r] !== void 0 && (l(this, vr)[vr][r].enabled = !1);
  } }, {
    key: "generateAvatar",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        var s = this, u, c, d;
        return p().wrap(function(v) {
          for (; ; )
            switch (v.prev = v.next) {
              case 0:
                if (i) {
                  v.next = 2;
                  break;
                }
                return v.abrupt("return");
              case 2:
                return u = new Image(), v.prev = 3, v.next = 6, fetch(i);
              case 6:
                return v.next = 8, v.sent.blob();
              case 8:
                c = v.sent, d = window.URL.createObjectURL(c), u.onload = function() {
                  s.updateSource(a, { image: u }), window.URL.revokeObjectURL(d);
                }, u.src = d, v.next = 17;
                break;
              case 14:
                v.prev = 14, v.t0 = v.catch(3), this.logger.error("Pip::GenerateAvatar", { error: v.t0 });
              case 17:
              case "end":
                return v.stop();
            }
        }, n, this, [[3, 14]]);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Add a video source from the participant grid
    * @param {string} id id for the source (ex. participant id)
    * @param {HTMLVideoElement} element HTMLVideoElement for the video source
    * @param {boolean} enabled if source is enabled
    * @param {?string} [displayText] two character display text
    */
  }, {
    key: "addSource",
    value: function(r, n, a) {
      var i = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !1, s = arguments.length > 4 && arguments[4] !== void 0 ? arguments[4] : void 0, u = arguments.length > 5 && arguments[5] !== void 0 ? arguments[5] : void 0, c = arguments.length > 6 && arguments[6] !== void 0 ? arguments[6] : !1;
      this.logger.debug("Pip::AddSource", { pip: { id: r, handRaised: c } }), l(this, vr)[vr][r] = { id: r, element: n, enabled: a, pinned: i, displayText: s ? DP(s) : void 0, imageUrl: u, handRaised: c }, u && this.generateAvatar(r, u);
    }
    /** Update a video source */
  }, {
    key: "updateSource",
    value: function(r, n) {
      this.logger.info("Pip::UpdateSource", { pip: { id: r, handRaised: n.handRaised } });
      var a = l(this, vr)[vr][r];
      a && (l(this, vr)[vr][r] = $($({}, a), n));
    }
    /**
    * Remove the video source for the participant
    * @param id id for the source (ex. participant id)
    */
  }, {
    key: "removeSource",
    value: function(r) {
      delete l(this, vr)[vr][r];
    }
    /**
    * Remove the pinned source
    * @param id id for the source (ex. participant id)
    */
  }, {
    key: "removePinnedSource",
    value: function() {
      var r = this, n = Object.values(l(this, vr)[vr]);
      n.forEach(function(a) {
        a.pinned && r.removeSource(a.id);
      });
    }
    /**
    * Remove all sources
    */
  }, {
    key: "removeAllSources",
    value: function() {
      l(this, vr)[vr] = {};
    }
    /**
    * Enable PiP
    */
  }, { key: "enable", value: function() {
    var r = this;
    l(this, qt)[qt] = "activating", this.setupEventListeners(), this.updateMediaSession("CAMERA", l(this, De)[De].videoEnabled), this.updateMediaSession("MIC", l(this, De)[De].audioEnabled), document.body.appendChild(l(this, rr)[rr]), l(this, Bt)[Bt] = requestAnimationFrame(function() {
      return r.animate();
    }), l(this, Kr)[Kr].onloadedmetadata = function() {
      l(r, Kr)[Kr].requestPictureInPicture().then(function() {
        l(r, qt)[qt] = "active";
      });
    }, l(this, Kr)[Kr].readyState === 4 && l(this, Kr)[Kr].requestPictureInPicture().then(function() {
      l(r, qt)[qt] = "active";
    });
  } }], [{ key: "_init", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.prev = 0, d.next = 3, wl(PP);
            case 3:
              return s = d.sent, d.next = 6, wl(SP);
            case 6:
              u = d.sent, d.next = 11;
              break;
            case 9:
              d.prev = 9, d.t0 = d.catch(0);
            case 11:
              return d.abrupt("return", new t(a, i, s, u));
            case 12:
            case "end":
              return d.stop();
          }
      }, n, null, [[0, 9]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an), qa;
(function(o) {
  o[o.PUBLISHER = 0] = "PUBLISHER", o[o.SUBSCRIBER = 1] = "SUBSCRIBER";
})(qa || (qa = {}));
var ca;
(function(o) {
  o[o.AUDIO = 0] = "AUDIO", o[o.VIDEO = 1] = "VIDEO";
})(ca || (ca = {}));
var NP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.Codec", [{
      no: 1,
      name: "channels",
      kind: "scalar",
      opt: !0,
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "clock_rate",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "mime_type",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "sdp_fmtp_line",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "payload_type",
      kind: "scalar",
      opt: !0,
      T: 13
      /*ScalarType.UINT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Yf = new NP(), VP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.HeaderExtension", [{
      no: 1,
      name: "direction",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "uri",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), UP = new VP(), jP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.Fingerprint", [{
      no: 1,
      name: "algorithm",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "value",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new jP();
var FP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.SessionDescription", [{ no: 1, name: "target", kind: "enum", T: function() {
      return ["media.Target", qa];
    } }, {
      no: 2,
      name: "type",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "sdp",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), qn = new FP(), HP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ProducerPayload", [{
      no: 1,
      name: "kind",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "paused",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "screen_share",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "msid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "app_data",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "mime_type",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), BP = new HP(), qP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.CreateTransportRequest", [{
      no: 1,
      name: "consuming",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "force_tcp",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 3, name: "description", kind: "message", T: function() {
      return qn;
    } }, {
      no: 4,
      name: "private_ice",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 5, name: "producers", kind: "message", repeat: 1, T: function() {
      return BP;
    } }]]);
  }
  return A(t, o), P(t);
}(M), GP = new qP(), WP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.AudioActivityRequest", [{
      no: 1,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "energy",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "silent",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), JP = new WP(), KP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.CreateTransportResponse", [{
      no: 1,
      name: "transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "description", kind: "message", T: function() {
      return qn;
    } }, {
      no: 3,
      name: "transcription_enabled",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "producer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Qf = new KP(), zP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.RenegotiateRequest", [{
      no: 1,
      name: "transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M), YP = new zP(), QP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.RenegotiateResponse", [{
      no: 1,
      name: "transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new QP();
var XP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.NestedScore", [{
      no: 1,
      name: "encoding_idx",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "rid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "score",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 4,
      name: "ssrc",
      kind: "scalar",
      T: 3,
      L: 0
      /*LongType.BIGINT*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ZP = new XP(), xP = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ProducerTrack", [{
      no: 1,
      name: "track_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "stream_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), eS = new xP(), rS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ProducerEntry", [{
      no: 1,
      name: "producing_transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new rS();
var tS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ConsumerEntry", [{
      no: 1,
      name: "consuming_transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "consumer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new tS();
var nS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ProducerState", [{
      no: 1,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "kind", kind: "enum", T: function() {
      return ["media.ProducerKind", ca];
    } }, {
      no: 3,
      name: "pause",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "screen_share",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "app_data",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "producing_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 7,
      name: "mime_type",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 8, name: "codec", kind: "message", T: function() {
      return Yf;
    } }]]);
  }
  return A(t, o), P(t);
}(M), al = new nS(), aS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ConsumerState", [{
      no: 1,
      name: "consumer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "producer_state", kind: "message", T: function() {
      return al;
    } }, { no: 3, name: "producer_track", kind: "message", T: function() {
      return eS;
    } }, {
      no: 4,
      name: "error_code",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), iS = new aS(), sS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.ProducerIdToConsumerMap", [{ no: 1, name: "map", kind: "map", K: 9, V: { kind: "message", T: function() {
      return iS;
    } } }]]);
  }
  return A(t, o), P(t);
}(M), Xf = new sS(), oS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.PeerRtpCapabilitites", [{ no: 1, name: "sender", kind: "message", T: function() {
      return Gh;
    } }, { no: 2, name: "receiver", kind: "message", T: function() {
      return Gh;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Zf = new oS(), uS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.RtpCapability", [{ no: 1, name: "codecs", kind: "message", repeat: 1, T: function() {
      return Yf;
    } }, { no: 2, name: "header_extensions", kind: "message", repeat: 1, T: function() {
      return UP;
    } }]]);
  }
  return A(t, o), P(t);
}(M), qh = new uS(), lS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.RtpCapabilitites", [{ no: 1, name: "audio", kind: "message", T: function() {
      return qh;
    } }, { no: 2, name: "video", kind: "message", T: function() {
      return qh;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Gh = new lS(), cS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.PreferredCodec", [{
      no: 1,
      name: "audio",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "video",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), dS = new cS(), pS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.Simulcast", [{
      no: 1,
      name: "preferred_rid",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "priority_ordering",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "rid_not_available",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), xf = new pS(), hS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GeoLocation", [{
      no: 1,
      name: "latitude",
      kind: "scalar",
      T: 2
      /*ScalarType.FLOAT*/
    }, {
      no: 2,
      name: "longitude",
      kind: "scalar",
      T: 2
      /*ScalarType.FLOAT*/
    }, {
      no: 3,
      name: "region",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), vS = new hS(), fS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerJoinRequest", [{
      no: 1,
      name: "display_name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "prejoined",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "room_uuid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "preset",
      kind: "scalar",
      opt: !0,
      T: 12
      /*ScalarType.BYTES*/
    }, {
      no: 6,
      name: "user_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 7,
      name: "organization_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 8, name: "location", kind: "message", T: function() {
      return vS;
    } }, { no: 9, name: "capabilities", kind: "message", T: function() {
      return Zf;
    } }]]);
  }
  return A(t, o), P(t);
}(M), gS = new fS(), mS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerJoinCompleteRequest", []]);
  }
  return A(t, o), P(t);
}(M), yS = new mS(), kS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerLeaveRequest", [{
      no: 1,
      name: "close_room",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), bS = new kS(), TS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumeMultipleProducerRequest", [{
      no: 1,
      name: "producer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "paused",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new TS();
var wS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumePeerRequest", [{
      no: 1,
      name: "producing_peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "paused",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "producer_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 4, name: "preferred_codec", kind: "message", T: function() {
      return dS;
    } }, {
      no: 5,
      name: "producing_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 6, name: "simulcast", kind: "message", T: function() {
      return xf;
    } }]]);
  }
  return A(t, o), P(t);
}(M), PS = new wS(), SS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumePeersRequest", [{ no: 1, name: "requests", kind: "message", repeat: 1, T: function() {
      return PS;
    } }, {
      no: 2,
      name: "consuming_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ES = new SS(), CS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.UpdateConsumerSimulcastConfigRequest", [{
      no: 1,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "simulcast", kind: "message", T: function() {
      return xf;
    } }, {
      no: 3,
      name: "producing_transport_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "mid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), RS = new CS(), AS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.UpdateConsumersSimulcastConfigRequest", [{ no: 1, name: "requests", kind: "message", repeat: 1, T: function() {
      return RS;
    } }, {
      no: 2,
      name: "consuming_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), IS = new AS(), MS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerCreateRequest", [{
      no: 1,
      name: "kind",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "paused",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "screen_share",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 4, name: "description", kind: "message", T: function() {
      return qn;
    } }, {
      no: 5,
      name: "msid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "app_data",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 7,
      name: "mime_type",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 8,
      name: "producing_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), _S = new MS(), OS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.SelectedPeersRequest", []]);
  }
  return A(t, o), P(t);
}(M);
new OS();
var DS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GlobalPeerPinningRequest", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), LS = new DS(), $S = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerToggleRequest", [{
      no: 1,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "pause",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Sl = new $S(), NS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumerToggleRequest", [{
      no: 1,
      name: "consumer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "pause",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new NS();
var VS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerCloseRequest", [{
      no: 1,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "description", kind: "message", T: function() {
      return qn;
    } }, {
      no: 3,
      name: "producing_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), US = new VS(), jS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumerCloseRequest", [{
      no: 1,
      name: "consumer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "description", kind: "message", T: function() {
      return qn;
    } }, {
      no: 3,
      name: "consuming_transport_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), FS = new jS(), HS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.KickPeerRequest", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new HS();
var BS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.KickAllPeersRequest", [{
      no: 1,
      name: "propagate_kick_across_rooms",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), eg = new BS(), qS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerDisplayNameEditRequest", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), GS = new qS(), WS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.HostMediaControlForPeerRequest", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "audio",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "video",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "scree_share",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), JS = new WS(), KS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.HostMediaControlForAllPeerRequest", [{
      no: 1,
      name: "audio",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "video",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "screen_share",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), zS = new KS(), YS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GetRoomStateResponse", [{
      no: 1,
      name: "display_title",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "locked_mode",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "room_uuid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "room_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "current_peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "is_recording",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 7,
      name: "recorder_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 8,
      name: "pinned_peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), QS = new YS(), XS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ErrorResponse", [{
      no: 1,
      name: "error_message",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "event_id",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ZS = new XS(), xS = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.EmptyResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new xS();
var eE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.RoomParticipants", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "producer_states", kind: "message", repeat: 1, T: function() {
      return al;
    } }, {
      no: 3,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "user_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 5, name: "capabilities", kind: "message", T: function() {
      return Zf;
    } }]]);
  }
  return A(t, o), P(t);
}(M), rg = new eE(), rE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.SelectedPeersResponse", [{
      no: 1,
      name: "audio_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "compulsory_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Sd = new rE(), tE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.SelectedPeersDiffEntry", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "priority",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M), nE = new tE(), aE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.SelectedPeersDiffResponse", [{ no: 1, name: "entries", kind: "message", repeat: 1, T: function() {
      return nE;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Wh = new aE(), iE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerJoinResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new iE();
var sE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerJoinCompleteResponse", [{ no: 1, name: "room_state", kind: "message", T: function() {
      return QS;
    } }, { no: 2, name: "participants", kind: "message", repeat: 1, T: function() {
      return rg;
    } }, { no: 3, name: "selected_peers", kind: "message", T: function() {
      return Sd;
    } }, {
      no: 4,
      name: "max_preferred_streams",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Ed = new sE(), oE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerLeaveResponse", [{
      no: 1,
      name: "closed",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), uE = new oE(), lE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumeMultipleProducerResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 2, name: "consumer_ids_map", kind: "message", T: function() {
      return Xf;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new lE();
var cE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumePeerResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 2, name: "consumer_ids_map", kind: "message", T: function() {
      return Xf;
    } }, { no: 3, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M), dE = new cE(), pE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerCreateResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "producer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 4, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M), hE = new pE(), vE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerScoreResponse", [{
      no: 1,
      name: "responseid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "score", kind: "message", T: function() {
      return ZP;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new vE();
var fE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ActiveSpeakerResponse", [{
      no: 1,
      name: "responsepeer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "volume",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new fE();
var gE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.NoActiveSpeakerResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new gE();
var mE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerToggleResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new mE();
var yE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumerToggleResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new yE();
var kE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ProducerClosingResponse", [{ no: 1, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M), bE = new kE(), TE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.ConsumerClosingResponse", [{ no: 1, name: "description", kind: "message", T: function() {
      return qn;
    } }]]);
  }
  return A(t, o), P(t);
}(M), wE = new TE(), PE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GlobalPeerPinningResponse", []]);
  }
  return A(t, o), P(t);
}(M);
new PE();
var SE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.KickPeerResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new SE();
var EE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.KickAllPeersResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new EE();
var CE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.HostMediaControlForPeerResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), RE = new CE(), AE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.HostMediaControlForAllPeerResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), IE = new AE(), ME = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerDisplayNameEditResponse", [{
      no: 1,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), _E = new ME(), OE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerJoinBroadcastResponse", [{ no: 1, name: "participant", kind: "message", T: function() {
      return rg;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Jh = new OE(), DE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.TrackSubscriptionKind", [{
      no: 1,
      name: "audio",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "video",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Kh = new DE(), LE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.TrackSubscription", [{
      no: 1,
      name: "label",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "webcam", kind: "message", T: function() {
      return Kh;
    } }, { no: 3, name: "screenshare", kind: "message", T: function() {
      return Kh;
    } }]]);
  }
  return A(t, o), P(t);
}(M), $E = new LE(), NE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerProducingTransportCreateBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "transport_details", kind: "message", T: function() {
      return Qf;
    } }, { no: 3, name: "track_subscriptions", kind: "message", repeat: 1, T: function() {
      return $E;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new NE();
var VE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerProducerCreateBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "producer_state", kind: "message", T: function() {
      return al;
    } }]]);
  }
  return A(t, o), P(t);
}(M), UE = new VE(), jE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerProducerToggleBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "producer_state", kind: "message", T: function() {
      return al;
    } }, {
      no: 3,
      name: "initiator_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), zh = new jE(), FE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerProducerCloseBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "producer_state", kind: "message", T: function() {
      return al;
    } }]]);
  }
  return A(t, o), P(t);
}(M), HE = new FE(), BE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerLeaveBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Cd = new BE(), qE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GlobalPeerPinningBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Yh = new qE(), GE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.GlobalPeerUnPinningBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new GE();
var WE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.RecordingStartedBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new WE();
var JE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.RecordingStoppedBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new JE();
var KE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerDisplayNameEditBroadcastResponse", [{
      no: 1,
      name: "participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new KE();
var zE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.PeerPingRequestBroadcastResponse", [{
      no: 1,
      name: "password",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new zE();
var YE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["media.edge.MediaRoomTerminationBroadcastResponse", [{
      no: 1,
      name: "reason",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new YE();
var QE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.ai.MeetingTranscript", [{
      no: 1,
      name: "meeting_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "transcript",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "is_partial",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Bc = new QE(), XE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.api.BaseSocketHubMessage", [{
      no: 1,
      name: "event",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "room_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "payload",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }, {
      no: 7,
      name: "error",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 8,
      name: "sid",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new XE();
var ZE = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.api.ErrorMessage", [{
      no: 1,
      name: "code",
      kind: "scalar",
      opt: !0,
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "message",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), xE = new ZE(), Hs;
(function(o) {
  o[o.BROWSER = 0] = "BROWSER", o[o.TRACK = 1] = "TRACK", o[o.COMPOSITE = 2] = "COMPOSITE";
})(Hs || (Hs = {}));
var Va;
(function(o) {
  o[o.UNSPECIFIED = 0] = "UNSPECIFIED", o[o.ON_STAGE = 1] = "ON_STAGE", o[o.APPROVED_STAGE = 2] = "APPROVED_STAGE", o[o.REQUESTED_STAGE = 3] = "REQUESTED_STAGE", o[o.OFF_STAGE = 4] = "OFF_STAGE";
})(Va || (Va = {}));
var Rd;
(function(o) {
  o[o.NONE = 0] = "NONE", o[o.RECORDER = 1] = "RECORDER", o[o.LIVESTREAMER = 2] = "LIVESTREAMER";
})(Rd || (Rd = {}));
var Ad;
(function(o) {
  o[o.PEERS = 0] = "PEERS", o[o.ROOMS = 1] = "ROOMS";
})(Ad || (Ad = {}));
var ec;
(function(o) {
  o[o.HIVE = 0] = "HIVE", o[o.CHAT = 1] = "CHAT", o[o.PING = 2] = "PING";
})(ec || (ec = {}));
var eC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.PeerFlags", [{
      no: 1,
      name: "preset_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "recorder_type",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "hidden_participant",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), rC = new eC(), tC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.Peer", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 4, name: "stage_type", kind: "enum", opt: !0, T: function() {
      return ["socket.room.StageType", Va, "STAGE_TYPE_"];
    } }, {
      no: 5,
      name: "custom_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "preset_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 7,
      name: "display_picture_url",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 8,
      name: "waitlisted",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 9, name: "flags", kind: "message", T: function() {
      return rC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), wc = new tC(), nC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.PeerInfoResponse", [{ no: 1, name: "peer", kind: "message", T: function() {
      return wc;
    } }]]);
  }
  return A(t, o), P(t);
}(M), ko = new nC(), aC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.PeerStatusUpdate", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "stage_type", kind: "enum", opt: !0, T: function() {
      return ["socket.room.StageType", Va, "STAGE_TYPE_"];
    } }]]);
  }
  return A(t, o), P(t);
}(M), Qh = new aC(), iC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.RoomPeersInfoRequest", [{
      no: 1,
      name: "seach_query",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "limit",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "offset",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t);
}(M), sC = new iC(), oC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.RoomPeersInfoResponse", [{ no: 1, name: "peers", kind: "message", repeat: 1, T: function() {
      return wc;
    } }]]);
  }
  return A(t, o), P(t);
}(M), qc = new oC(), uC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.RoomPeerCountResponse", [{
      no: 1,
      name: "count",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Xh = new uC(), lC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.Room", [{
      no: 1,
      name: "room_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "title",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "created_at",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, { no: 5, name: "active_recordings", kind: "message", repeat: 1, T: function() {
      return dC;
    } }, {
      no: 6,
      name: "room_uuid",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), tg = new lC(), cC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.ActiveRecording", [{
      no: 1,
      name: "recording_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "recording_type", kind: "enum", T: function() {
      return ["common.RecordingType", Hs];
    } }, {
      no: 3,
      name: "recording_status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), dC = new cC(), pC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.RoomInfoResponse", [{ no: 1, name: "room", kind: "message", T: function() {
      return tg;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Zh = new pC(), hC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetPeerInfoRequest", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ng = new hC(), vC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.UpdatePeerInfoRequest", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new vC();
var fC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.JoinRoomRequest", [{ no: 1, name: "peer", kind: "message", T: function() {
      return wc;
    } }, {
      no: 3,
      name: "room_uuid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "organization_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "use_hive",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 6,
      name: "preset",
      kind: "scalar",
      opt: !0,
      T: 12
      /*ScalarType.BYTES*/
    }, { no: 7, name: "capabilities", kind: "enum", repeat: 1, T: function() {
      return ["socket.room.Capabilities", ec, "CAPABILITIES_"];
    } }, {
      no: 8,
      name: "timestamp",
      kind: "scalar",
      opt: !0,
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }]]);
  }
  return A(t, o), P(t);
}(M), gC = new fC(), mC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.LeaveRoomRequest", [{ no: 1, name: "peer", kind: "message", T: function() {
      return wc;
    } }, {
      no: 2,
      name: "timestamp",
      kind: "scalar",
      opt: !0,
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }]]);
  }
  return A(t, o), P(t);
}(M), yC = new mC(), kC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.UpdateRoomInfoRequest", [{ no: 1, name: "room", kind: "message", T: function() {
      return tg;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new kC();
var bC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetConnectedRoomsDumpRequest", []]);
  }
  return A(t, o), P(t);
}(M);
new bC();
var TC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.ServiceError", [{
      no: 1,
      name: "message",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "code",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Fp = new TC(), wC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.ConnectedMeetingPeer", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "custom_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "preset_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "display_picture_url",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), PC = new wC(), SC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.ConnectedMeetingDump", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "title",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "participants", kind: "message", repeat: 1, T: function() {
      return PC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), xh = new SC(), EC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetConnectedRoomsDumpResponse", [{ no: 1, name: "parent_meeting", kind: "message", T: function() {
      return xh;
    } }, { no: 2, name: "meetings", kind: "message", repeat: 1, T: function() {
      return xh;
    } }]]);
  }
  return A(t, o), P(t);
}(M), CC = new EC(), RC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.CreateRoomRequestPayload", [{
      no: 1,
      name: "title",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), AC = new RC(), IC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.CreateConnectedRoomsRequest", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return AC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), MC = new IC(), _C = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.CreateRoomResponsePayload", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "title",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "error", kind: "message", T: function() {
      return Fp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), OC = new _C(), DC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.CreateConnectedRoomsResponse", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return OC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), ev = new DC(), LC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.UpdateRoomRequestPayload", [{
      no: 1,
      name: "meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "title",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), $C = new LC(), NC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.UpdateConnectedRoomsRequest", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return $C;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new NC();
var VC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.DisableRoomPayload", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), UC = new VC(), jC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.DisableConnectedRoomsRequest", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return UC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), FC = new jC(), HC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.DisableConnectedRoomsResponse", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return GC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), BC = new HC(), qC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.DisableConnectedRoomPayload", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "status",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "title",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 4, name: "error", kind: "message", T: function() {
      return Fp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), GC = new qC(), WC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.MovePeerPayload", [{
      no: 1,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "preset_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), JC = new WC(), KC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.MovePeersBetweenRoomsRequest", [{
      no: 1,
      name: "source_meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "destination_meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "participants", kind: "message", repeat: 1, T: function() {
      return JC;
    } }]]);
  }
  return A(t, o), P(t);
}(M), zC = new KC(), YC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.MovedPeer", [{
      no: 1,
      name: "meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "custom_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "error", kind: "message", T: function() {
      return Fp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), ag = new YC(), QC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.MovePeersBetweenRoomsResponse", [{ no: 1, name: "payloads", kind: "message", repeat: 1, T: function() {
      return ag;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new QC();
var XC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.TransferPeer", [{
      no: 1,
      name: "meeting_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "auth_token",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ZC = new XC(), xC = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetAllAddedParticipantsResponse", [{ no: 1, name: "participants", kind: "message", repeat: 1, T: function() {
      return tR;
    } }]]);
  }
  return A(t, o), P(t);
}(M), eR = new xC(), rR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.AddedParticipant", [{
      no: 1,
      name: "id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "picture",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "custom_participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), tR = new rR(), nR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.RemoveParticipantsRequest", [{
      no: 1,
      name: "peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ig = new nR(), aR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.BroadcastMessage", [{
      no: 1,
      name: "type",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "payload",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }, {
      no: 3,
      name: "timestamp",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, {
      no: 4,
      name: "ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, { no: 5, name: "broadcast_type", kind: "enum", opt: !0, T: function() {
      return ["socket.room.BroadcastType", Ad, "BROADCAST_TYPE_"];
    } }]]);
  }
  return A(t, o), P(t);
}(M), Qo = new aR(), iR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.AcceptWaitingRoomRequests", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), sR = new iR(), oR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.DenyWaitingRoomRequests", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), uR = new oR(), lR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.WaitingRoomRequest", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "picture",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "custom_participant_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "preset_name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), cR = new lR(), dR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetWaitingRoomRequests", [{ no: 1, name: "requests", kind: "message", repeat: 1, T: function() {
      return cR;
    } }]]);
  }
  return A(t, o), P(t);
}(M), rv = new dR(), pR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.room.GetRoomStageStateResponse", [{
      no: 1,
      name: "on_stage_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "approved_stage_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "requested_stage_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), tv = new pR(), Id;
(function(o) {
  o[o.NONE = 0] = "NONE", o[o.SKIP = 1] = "SKIP", o[o.ON_PRIVILEGED_USER_ENTRY = 2] = "ON_PRIVILEGED_USER_ENTRY", o[o.SKIP_ON_ACCEPT = 3] = "SKIP_ON_ACCEPT";
})(Id || (Id = {}));
var Ri;
(function(o) {
  o[o.NONE = 0] = "NONE", o[o.ALLOWED = 1] = "ALLOWED", o[o.NOT_ALLOWED = 2] = "NOT_ALLOWED", o[o.CAN_REQUEST = 3] = "CAN_REQUEST";
})(Ri || (Ri = {}));
var hR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PollsPermissionUpdate", [{
      no: 1,
      name: "can_create",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "can_vote",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "can_view",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), vR = new hR(), fR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PluginsPermissionsUpdate", [{
      no: 1,
      name: "can_close",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "can_start",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), gR = new fR(), mR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PublicChatPermission", [{
      no: 1,
      name: "can_send",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "text",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "files",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), yR = new mR(), kR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PrivateChatPermission", [{
      no: 1,
      name: "can_send",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "can_receive",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "text",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "files",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), bR = new kR(), TR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.ChatPermissionUpdate", [{ no: 1, name: "public", kind: "message", T: function() {
      return yR;
    } }, { no: 2, name: "private", kind: "message", T: function() {
      return bR;
    } }]]);
  }
  return A(t, o), P(t);
}(M), wR = new TR(), PR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.ConnectedMeetingPermissionUpdate", [{
      no: 1,
      name: "can_alter_connected_meetings",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 2,
      name: "can_switch_to_parent_meeting",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "can_switch_connected_meetings",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), SR = new PR(), ER = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.StreamPermission", [{ no: 1, name: "can_produce", kind: "enum", opt: !0, T: function() {
      return ["socket.preset.StreamPermissionType", Ri, "STREAM_PERMISSION_TYPE_"];
    } }, { no: 2, name: "can_consume", kind: "enum", opt: !0, T: function() {
      return ["socket.preset.StreamPermissionType", Ri, "STREAM_PERMISSION_TYPE_"];
    } }]]);
  }
  return A(t, o), P(t);
}(M), Gc = new ER(), CR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.MediaPermissionUpdate", [{ no: 1, name: "video", kind: "message", T: function() {
      return Gc;
    } }, { no: 2, name: "audio", kind: "message", T: function() {
      return Gc;
    } }, { no: 3, name: "screenshare", kind: "message", T: function() {
      return Gc;
    } }]]);
  }
  return A(t, o), P(t);
}(M), RR = new CR(), AR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PresetUpdates", [{ no: 1, name: "polls", kind: "message", T: function() {
      return vR;
    } }, { no: 2, name: "plugins", kind: "message", T: function() {
      return gR;
    } }, { no: 3, name: "chat", kind: "message", T: function() {
      return wR;
    } }, {
      no: 4,
      name: "accept_waiting_requests",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "can_accept_production_requests",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 6,
      name: "can_edit_display_name",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 7,
      name: "can_record",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 8,
      name: "can_livestream",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 9,
      name: "can_spotlight",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 10,
      name: "disable_participant_audio",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 11,
      name: "disable_participant_screensharing",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 12,
      name: "disable_participant_video",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 13,
      name: "kick_participant",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 14,
      name: "pin_participant",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 15,
      name: "transcription_enabled",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 16, name: "waiting_room_type", kind: "enum", opt: !0, T: function() {
      return ["socket.preset.WaitingRoomType", Id, "WAITING_ROOM_TYPE_"];
    } }, {
      no: 17,
      name: "is_recorder",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 18, name: "recorder_type", kind: "enum", opt: !0, T: function() {
      return ["socket.room.RecorderType", Rd, "RECORDER_TYPE_"];
    } }, {
      no: 19,
      name: "hidden_participant",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 20,
      name: "show_participant_list",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 21,
      name: "can_change_participant_permissions",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 22, name: "connected_meetings", kind: "message", T: function() {
      return SR;
    } }, { no: 23, name: "media", kind: "message", T: function() {
      return RR;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Hp = new AR(), IR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.ReadPeersPresetRequest", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), MR = new IR(), _R = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PeerPreset", [{
      no: 1,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "preset",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), OR = new _R(), DR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.ReadPeersPresetResponse", [{ no: 1, name: "peer_presets", kind: "message", repeat: 1, T: function() {
      return OR;
    } }]]);
  }
  return A(t, o), P(t);
}(M), LR = new DR(), $R = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.UpdatePeerPreset", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 2, name: "patch", kind: "message", T: function() {
      return Hp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), sg = new $R(), NR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.UpdatePeersPresetRequest", [{ no: 1, name: "update_peers_presets", kind: "message", repeat: 1, T: function() {
      return sg;
    } }]]);
  }
  return A(t, o), P(t);
}(M), VR = new NR(), UR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.UpdatePeersPresetResponse", [{ no: 1, name: "update_peers_presets", kind: "message", repeat: 1, T: function() {
      return sg;
    } }]]);
  }
  return A(t, o), P(t);
}(M), nv = new UR(), jR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.PeerUserIDMap", [{
      no: 1,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), FR = new jR(), HR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.BulkUpdatePeerPresetRequest", [{ no: 1, name: "peers", kind: "message", repeat: 1, T: function() {
      return FR;
    } }, { no: 2, name: "patch", kind: "message", T: function() {
      return Hp;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new HR();
var BR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.preset.BulkUpdatePeerPresetResponse", [{ no: 2, name: "patch", kind: "message", T: function() {
      return Hp;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new BR();
var qR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.ChatMessage", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "pinned",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 6,
      name: "is_edited",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 7,
      name: "payload_type",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 8,
      name: "payload",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 10,
      name: "target_user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 11,
      name: "created_at",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, {
      no: 12,
      name: "created_at_ms",
      kind: "scalar",
      opt: !0,
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, {
      no: 13,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 14,
      name: "channel_index",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), eo = new qR(), GR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetPaginatedChatMessageRoomRequest", [{
      no: 1,
      name: "time_stamp",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, {
      no: 2,
      name: "size",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "from",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 4,
      name: "reversed",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), WR = new GR(), JR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetPaginatedChatMessageRoomResponse", [{ no: 1, name: "messages", kind: "message", repeat: 1, T: function() {
      return eo;
    } }, {
      no: 2,
      name: "next",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), KR = new JR(), zR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetChatMessagesResponse", [{ no: 1, name: "messages", kind: "message", repeat: 1, T: function() {
      return eo;
    } }]]);
  }
  return A(t, o), P(t);
}(M), og = new zR(), YR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToRoomRequest", [{
      no: 1,
      name: "payload_type",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "payload",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), QR = new YR(), XR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToRoomResponse", [{ no: 1, name: "message", kind: "message", T: function() {
      return eo;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Wc = new XR(), ZR = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToPeersRequest", [{
      no: 1,
      name: "peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "payload_type",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "payload",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), xR = new ZR(), e1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToPeersResponse", [{ no: 1, name: "message", kind: "message", T: function() {
      return eo;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Jc = new e1(), r1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToChannelRequest", [{
      no: 1,
      name: "channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "payload_type",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "payload",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), t1 = new r1(), n1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SendChatMessageToChannelResponse", [{ no: 1, name: "message", kind: "message", T: function() {
      return eo;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new n1();
var a1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.EditChatMessageRequest", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "payload_type",
      kind: "scalar",
      opt: !0,
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "payload",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "pinned",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), i1 = new a1(), s1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.PinChatMessageRequest", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "pinned",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), o1 = new s1(), u1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.PinChatMessageResponse", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "pinned",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 3,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), El = new u1(), l1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.EditChatMessageResponse", [{ no: 1, name: "message", kind: "message", T: function() {
      return eo;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Cl = new l1(), c1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.DeleteChatMessageRequest", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), d1 = new c1(), p1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.DeleteChatMessageResponse", [{
      no: 1,
      name: "chat_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Rl = new p1(), h1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.SearchChatMessagesRequest", [{
      no: 1,
      name: "time_stamp",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, {
      no: 2,
      name: "size",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 3,
      name: "from",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 4,
      name: "reversed",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "channel_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "search_term",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), v1 = new h1(), f1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.MarkChannelIndexAsReadRequest", [{
      no: 1,
      name: "channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "channel_index",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), g1 = new f1(), m1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.MarkChannelIndexAsReadResponse", [{
      no: 1,
      name: "channel_index",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), y1 = new m1(), k1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.CreateChatChannelRequest", [{
      no: 1,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "target_user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "display_picture_url",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "visibility",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "is_direct_message",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), b1 = new k1(), T1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.UpdateChatChannelRequest", [{
      no: 1,
      name: "chat_channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "target_user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "display_picture_url",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "visibility",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "is_direct_message",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), w1 = new T1(), P1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.CreateChatChannelResponse", [{
      no: 1,
      name: "chat_channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M);
new P1();
var S1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetChatChannelRequest", [{
      no: 1,
      name: "chat_channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), E1 = new S1(), C1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.LatestMessageAndUnreadCount", [{ no: 1, name: "message", kind: "message", T: function() {
      return eo;
    } }, {
      no: 2,
      name: "unread_count",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }]]);
  }
  return A(t, o), P(t);
}(M), R1 = new C1(), A1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.ChatChannel", [{
      no: 1,
      name: "chat_channel_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "display_picture_url",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "visibility",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "is_direct_message",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, { no: 6, name: "latest_message_and_unread_count", kind: "message", T: function() {
      return R1;
    } }, {
      no: 7,
      name: "target_user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), I1 = new A1(), M1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetChatChannelResponse", [{ no: 1, name: "chat_channels", kind: "message", repeat: 1, T: function() {
      return I1;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Ma = new M1(), _1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.ChannelMember", [{
      no: 1,
      name: "id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "name",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "picture",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "custom_participant_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), O1 = new _1(), D1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.chat.GetChatChannelMembersResponse", [{ no: 1, name: "channel_members", kind: "message", repeat: 1, T: function() {
      return O1;
    } }]]);
  }
  return A(t, o), P(t);
}(M), L1 = new D1(), $1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.AddPluginRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "staggered",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), N1 = new $1(), V1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.RemovePluginRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "staggered",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), U1 = new V1(), j1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.EnablePluginForRoomRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), F1 = new j1(), H1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.DisablePluginForRoomRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), B1 = new H1(), q1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.EnablePluginForPeersRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), G1 = new q1(), W1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.DisablePluginForPeersRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), J1 = new W1(), K1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginEventToRoomRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "plugin_data",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), z1 = new K1(), Y1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginEventToPeersRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "plugin_data",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Q1 = new Y1(), X1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.StoreKeys", [{
      no: 1,
      name: "store_key",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "payload",
      kind: "scalar",
      opt: !0,
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Bp = new X1(), Z1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreInsertKeysRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "store_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "insert_keys", kind: "message", repeat: 1, T: function() {
      return Bp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), av = new Z1(), x1 = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreGetKeysRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "store_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "get_keys", kind: "message", repeat: 1, T: function() {
      return Bp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), eA = new x1(), rA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreDeleteKeysRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "store_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "delete_keys", kind: "message", repeat: 1, T: function() {
      return Bp;
    } }]]);
  }
  return A(t, o), P(t);
}(M), tA = new rA(), nA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreDeleteRequest", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "store_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), aA = new nA(), iA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.EnablePluginResponse", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "enabled_by",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Md = new iA(), sA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.EnablePluginsResponse", [{ no: 1, name: "plugins", kind: "message", repeat: 1, T: function() {
      return Md;
    } }]]);
  }
  return A(t, o), P(t);
}(M), oA = new sA(), uA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.DisablePluginResponse", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "disabled_by",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), iv = new uA(), lA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreItem", [{
      no: 1,
      name: "timestamp",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "store_key",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "payload",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), cA = new lA(), dA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginStoreResponse", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "store_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "store_items", kind: "message", repeat: 1, T: function() {
      return cA;
    } }]]);
  }
  return A(t, o), P(t);
}(M), sv = new dA(), pA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.plugin.PluginEventResponse", [{
      no: 1,
      name: "plugin_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "plugin_data",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ov = new pA(), hA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.LiveStreamingEvent", [{
      no: 1,
      name: "livestream_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "err_message",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "meeting_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "playback_url",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "org_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 7,
      name: "room_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 8,
      name: "room_uuid",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 9,
      name: "status",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 10,
      name: "manual_ingest",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), uv = new hA(), vA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.GetStagePeersResponse", [{
      no: 1,
      name: "stage_peers",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), lv = new vA(), fA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.StageRequest", [{
      no: 1,
      name: "display_name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), gA = new fA(), mA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.GetStageRequestsResponse", [{ no: 1, name: "stage_requests", kind: "message", repeat: 1, T: function() {
      return gA;
    } }]]);
  }
  return A(t, o), P(t);
}(M), Kc = new mA(), yA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.GrantStageAccessRequest", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), kA = new yA(), bA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.DenyStageAccessRequest", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), TA = new bA(), wA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.livestreaming.LeaveStageRequest", [{
      no: 1,
      name: "user_ids",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), cv = new wA(), PA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.Poll", [{
      no: 1,
      name: "poll_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "created_by",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "created_by_user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "question",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 5, name: "options", kind: "message", repeat: 1, T: function() {
      return EA;
    } }, {
      no: 6,
      name: "hide_votes",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 7,
      name: "anonymous",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 8,
      name: "votes",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), ug = new PA(), SA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.PollOption", [{
      no: 1,
      name: "text",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "count",
      kind: "scalar",
      opt: !0,
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }, { no: 3, name: "votes", kind: "message", repeat: 1, T: function() {
      return RA;
    } }]]);
  }
  return A(t, o), P(t);
}(M), EA = new SA(), CA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.PollVote", [{
      no: 1,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "name",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), RA = new CA(), AA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.NewPollRequest", [{
      no: 1,
      name: "question",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "options",
      kind: "scalar",
      repeat: 2,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "anonymous",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 4,
      name: "hide_votes",
      kind: "scalar",
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 5,
      name: "created_by",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "created_by_user_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }]]);
  }
  return A(t, o), P(t);
}(M), IA = new AA(), MA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.VotePollRequest", [{
      no: 1,
      name: "poll_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "index",
      kind: "scalar",
      T: 4,
      L: 2
      /*LongType.NUMBER*/
    }]]);
  }
  return A(t, o), P(t);
}(M), _A = new MA(), OA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.UpdatePollResponse", [{ no: 1, name: "poll", kind: "message", T: function() {
      return ug;
    } }]]);
  }
  return A(t, o), P(t);
}(M), zc = new OA(), DA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.polls.GetPollsResponse", [{ no: 1, name: "polls", kind: "message", repeat: 1, T: function() {
      return ug;
    } }]]);
  }
  return A(t, o), P(t);
}(M), LA = new DA(), $A = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["socket.recording.RecordingEvent", [{
      no: 1,
      name: "recording_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 2,
      name: "err_message",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, { no: 3, name: "recording_type", kind: "enum", T: function() {
      return ["common.RecordingType", Hs];
    } }]]);
  }
  return A(t, o), P(t);
}(M), dv = new $A(), NA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["google.protobuf.Timestamp", [{
      no: 1,
      name: "seconds",
      kind: "scalar",
      T: 3,
      L: 0
      /*LongType.BIGINT*/
    }, {
      no: 2,
      name: "nanos",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }]]);
  }
  return A(t, o), P(t, [{
    key: "now",
    value: function() {
      var r = this.create(), n = Date.now();
      return r.seconds = Jo.from(Math.floor(n / 1e3)).toBigInt(), r.nanos = n % 1e3 * 1e6, r;
    }
    /**
    * Converts a `Timestamp` to a JavaScript Date.
    */
  }, {
    key: "toDate",
    value: function(r) {
      return new Date(Jo.from(r.seconds).toNumber() * 1e3 + Math.ceil(r.nanos / 1e6));
    }
    /**
    * Converts a JavaScript Date to a `Timestamp`.
    */
  }, {
    key: "fromDate",
    value: function(r) {
      var n = this.create(), a = r.getTime();
      return n.seconds = Jo.from(Math.floor(a / 1e3)).toBigInt(), n.nanos = a % 1e3 * 1e6, n;
    }
    /**
    * In JSON format, the `Timestamp` type is encoded as a string
    * in the RFC 3339 format.
    */
  }, {
    key: "internalJsonWrite",
    value: function(r, n) {
      var a = Jo.from(r.seconds).toNumber() * 1e3;
      if (a < Date.parse("0001-01-01T00:00:00Z") || a > Date.parse("9999-12-31T23:59:59Z"))
        throw new Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");
      if (r.nanos < 0)
        throw new Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");
      var i = "Z";
      if (r.nanos > 0) {
        var s = (r.nanos + 1e9).toString().substring(1);
        s.substring(3) === "000000" ? i = "." + s.substring(0, 3) + "Z" : s.substring(6) === "000" ? i = "." + s.substring(0, 6) + "Z" : i = "." + s + "Z";
      }
      return new Date(a).toISOString().replace(".000Z", i);
    }
    /**
    * In JSON format, the `Timestamp` type is encoded as a string
    * in the RFC 3339 format.
    */
  }, { key: "internalJsonRead", value: function(r, n, a) {
    if (typeof r != "string")
      throw new Error("Unable to parse Timestamp from JSON " + mm(r) + ".");
    var i = r.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);
    if (!i)
      throw new Error("Unable to parse Timestamp from JSON. Invalid format.");
    var s = Date.parse(i[1] + "-" + i[2] + "-" + i[3] + "T" + i[4] + ":" + i[5] + ":" + i[6] + (i[8] ? i[8] : "Z"));
    if (Number.isNaN(s))
      throw new Error("Unable to parse Timestamp from JSON. Invalid value.");
    if (s < Date.parse("0001-01-01T00:00:00Z") || s > Date.parse("9999-12-31T23:59:59Z"))
      throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");
    return a || (a = this.create()), a.seconds = Jo.from(s / 1e3).toBigInt(), a.nanos = 0, i[7] && (a.nanos = parseInt("1" + i[7] + "0".repeat(9 - i[7].length)) - 1e9), a;
  } }]);
}(M);
new NA();
var VA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["common.BaseHubMessage", [{
      no: 1,
      name: "event",
      kind: "scalar",
      T: 5
      /*ScalarType.INT32*/
    }, {
      no: 2,
      name: "id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "peer_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 4,
      name: "room_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 5,
      name: "user_id",
      kind: "scalar",
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 6,
      name: "payload",
      kind: "scalar",
      T: 12
      /*ScalarType.BYTES*/
    }, {
      no: 7,
      name: "error",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }, {
      no: 8,
      name: "sid",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 9,
      name: "room_object_id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 10,
      name: "preset",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 11,
      name: "use_start_session",
      kind: "scalar",
      opt: !0,
      T: 8
      /*ScalarType.BOOL*/
    }]]);
  }
  return A(t, o), P(t);
}(M), _d = new VA(), UA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["common.BulkedHubMessage", [{ no: 1, name: "messages", kind: "message", repeat: 1, T: function() {
      return _d;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new UA();
var jA = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["common.CFWorkersResponse", [{ no: 1, name: "responses", kind: "message", repeat: 1, T: function() {
      return _d;
    } }, { no: 2, name: "broadcast_responses", kind: "message", repeat: 1, T: function() {
      return _d;
    } }]]);
  }
  return A(t, o), P(t);
}(M);
new jA();
var FA = 0, HA = 1, BA = 2, qA = 3, GA = 4, WA = 5, JA = {
  getPeerInfo: 0,
  updatePeerInfo: 1,
  getRoomPeersInfo: 2,
  joinRoom: 3,
  leaveRoom: 4,
  getRoomInfo: 5,
  updateRoomInfo: 6,
  closeRoom: 7,
  startedLivestream: 8,
  stoppedLivestream: 9,
  erroredLivestream: 10,
  getStagePeers: 11,
  getStageRequests: 12,
  requestStageAccess: 13,
  cancelStageRequest: 14,
  grantStageAccess: 15,
  denyStageAccess: 16,
  roomPeerCount: 17,
  joinStage: 18,
  leaveStage: 19,
  // getConnectedRoomsDump returns entire dump for a breakout rooms meeting
  // This details which peer is in which meeting currently, and which is the parent meeting
  getConnectedRoomsDump: 20,
  // createConnectedRooms to create breakout rooms
  createConnectedRooms: 21,
  // deleteConnectedRooms to delete breakout rooms
  deleteConnectedRooms: 22,
  // move peers between breakout rooms
  movePeers: 23,
  // transfer peer to new room
  transferPeer: 24,
  // message sent by socket service to inform client of a participant joining a breakout room
  movedPeer: 25,
  // message sent by socket service to inform client of updates in connected rooms
  connectedRoomsUpdated: 26,
  // message sent by socket service to inform client of deletion in connected rooms
  connectedRoomsDeleted: 27,
  // get all participants that have been added to the meeting irrespective of their live status
  getAllAddedParticipants: 28,
  // broadcast api
  broadcastMessage: 29,
  kick: 30,
  kickAll: 31,
  transcript: 32,
  // waitlist events
  getWaitingRoomRequests: 33,
  acceptWaitingRoomRequests: 34,
  waitingRoomRequestAccepted: 35,
  denyWaitingRoomRequests: 36,
  waitingRoomRequestDenied: 37,
  peerStageStatusUpdate: 38,
  broadcastToEntity: 39,
  recordingStarted: 40,
  recordingStopped: 41,
  recordingPaused: 42,
  getRoomStageState: 43,
  livestreamingInvoked: 44
}, KA = { getMessages: 0, sendMessageToRoom: 1, sendMessageToPeers: 2, editMessage: 3, deleteMessage: 4, getPaginatedMessages: 5, sendMessageToChannel: 6, searchChannelMessages: 7, getAllChatChannels: 8, markChannelIndexAsRead: 9, pinMessage: 10 }, zA = { getPlugins: 0, addPlugin: 1, enablePluginForRoom: 2, disablePluginForPeers: 3, enablePluginForPeers: 4, disablePluginForRoom: 5, removePlugin: 6, customPluginEventToRoom: 7, customPluginEventToPeers: 8, storeInsertKeys: 9, storeGetKeys: 10, storeDeleteKeys: 11, storeDelete: 12 }, YA = { createPoll: 0, getPolls: 1, votePoll: 2, updatePoll: 3 }, lg = {
  unknown: 0,
  createWebRTCTransport: 1,
  produce: 2,
  consume: 3,
  toggleProducer: 4,
  toggleConsumer: 5,
  closeProducer: 6,
  closeConsumer: 7,
  updateConsumersSimulcastConfig: 8,
  // adding some buffers for new media events.
  joinRoom: 16,
  leaveRoom: 17,
  selectedPeer: 18,
  globalPinPeer: 19,
  selfJoinComplete: 20,
  // some additional buffer for broadcast events.
  peerJoinedBroadcast: 25,
  peerLeaveBroadcast: 26,
  peerProducerCreateBroadcast: 27,
  peerProducerToggleBroadcast: 28,
  peerProducerCloseBroadcast: 29,
  globalPeerPinBroadcast: 30,
  recordingStartedBroadcast: 31,
  recordingStoppedBroadcast: 32,
  peerDisplayNameEditBroadcast: 33,
  mediaRoomTerminationBroadcastResponse: 36,
  selectedPeerDiff: 40,
  renegotiateSessionDescription: 50,
  errorResponse: 60,
  kickPeer: 90,
  kickAll: 91,
  changeDisplayName: 92,
  hostControlPeer: 93,
  hostControlAllPeers: 94,
  // only for CF
  audioActivity: 100
}, QA = { createChatChannel: 0, getChatChannel: 1, deprecatedGetAllChatChannels: 2, getChannelMembers: 3, updateChatChannel: 4 }, XA = { getUserPresets: 0, updateUserPreset: 1 };
function Fo(o, t) {
  return Object.keys(t).reduce(function(e, r) {
    return e[r] = (o << 16) + t[r], e;
  }, {});
}
function cg(o, t) {
  return Object.keys(o).reduce(function(e, r) {
    return e[r] = t | o[r], e;
  }, {});
}
var Y = Fo(FA, JA), Rr = Fo(HA, KA), se = Fo(BA, zA), $a = Fo(qA, YA), As = Fo(GA, QA), Ci = cg(lg, 16777216), Vn = cg(lg, 50331648), $l = Fo(WA, XA), ZA = Object.defineProperty, xA = Object.getOwnPropertyDescriptor, qp = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? xA(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && ZA(e, r, a), a;
}, Od = (cn = /* @__PURE__ */ S("socket"), Xa = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, cn, { writable: !0, value: void 0 }), Object.defineProperty(this, Xa, { writable: !0, value: void 0 }), l(this, cn)[cn] = e, l(this, Xa)[Xa] = t;
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Xa)[Xa].getValue("telemetry");
      }
    )
    /**
    * @private access
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, Xa)[Xa].getValue("logger");
  } }, { key: "createChannel", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s, u, c, d, h, v = arguments;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              return s = v.length > 3 && v[3] !== void 0 ? v[3] : "public", u = v.length > 4 && v[4] !== void 0 ? v[4] : !1, c = { displayName: n, targetUserIds: a, displayPictureUrl: i, visibility: s, isDirectMessage: u }, u && (c.visibility = "private"), g.next = 6, l(this, cn)[cn].sendMessagePromise(As.createChatChannel, b1.toBinary(c));
            case 6:
              return d = g.sent, h = Ma.fromBinary(d.payload).chatChannels, g.abrupt("return", Od.formatChannel(h[0]));
            case 9:
            case "end":
              return g.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "updateChannel", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, l(this, cn)[cn].sendMessagePromise(As.updateChatChannel, w1.toBinary({ chatChannelId: n, targetUserIds: a.memberIds, displayName: a.displayName, displayPictureUrl: a.displayPictureUrl, visibility: a.visibility }));
            case 2:
              return i = c.sent, s = Ma.fromBinary(i.payload).chatChannels, c.abrupt("return", Od.formatChannel(s[0]));
            case 5:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getChannelMembers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.prev = 0, s.next = 3, l(this, cn)[cn].sendMessagePromise(As.getChannelMembers, E1.toBinary({ chatChannelId: n }));
            case 3:
              return a = s.sent, s.abrupt("return", L1.fromBinary(a.payload).channelMembers.map(function(u) {
                var c = u.id, d = lc(u, Zg);
                return $($({}, d), {}, { userId: c });
              }));
            case 7:
              return s.prev = 7, s.t0 = s.catch(0), s.abrupt("return", []);
            case 10:
            case "end":
              return s.stop();
          }
      }, r, this, [[0, 7]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "on", value: function(e, r) {
    var n = this, a, i;
    switch (e) {
      case As.createChatChannel: {
        a = Ma.fromBinary.bind(Ma), i = Ma.create();
        break;
      }
      case As.updateChatChannel: {
        a = Ma.fromBinary.bind(Ma), i = Ma.create();
        break;
      }
    }
    if (!a) {
      this.logger.warn("ChatChannelSocketHandler::Event ".concat(e, " is not recognized"));
      return;
    }
    l(this, cn)[cn].on(e, function(s) {
      var u = s.payload, c = i;
      try {
        c = a(u);
      } catch (d) {
        n.logger.error("ChatChannelSocketHandler::on::binary_decode_error", { error: d });
      }
      return r(c);
    });
  } }], [{ key: "formatChannel", value: function(e) {
    var r, n = e.latestMessageAndUnreadCount, a = $($({}, e), {}, { id: e.chatChannelId, memberIds: e.targetUserIds, unreadCount: (r = n == null ? void 0 : n.unreadCount) !== null && r !== void 0 ? r : 0 });
    return n != null && n.message && (a.latestMessage = Un.formatSocketPeerMessage(n.message)), delete a.chatChannelId, delete a.targetUserIds, delete a.latestMessageAndUnreadCount, a;
  } }]);
}()), zs = Od;
qp([O.trace("ChatChannelHandler.createChannel")], zs.prototype, "createChannel", 1);
qp([O.trace("ChatChannelHandler.updateChannel")], zs.prototype, "updateChannel", 1);
qp([O.trace("ChatChannelHandler.getChannelMembers")], zs.prototype, "getChannelMembers", 1);
var eI = Object.defineProperty, rI = Object.getOwnPropertyDescriptor, Gn = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? rI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && eI(e, r, a), a;
}, Pt = /* @__PURE__ */ function(o) {
  return o[o.TEXT = 0] = "TEXT", o[o.IMAGE = 1] = "IMAGE", o[o.FILE = 2] = "FILE", o[o.CUSTOM = 3] = "CUSTOM", o;
}(Pt || {}), tr = /* @__PURE__ */ S("socket"), us = /* @__PURE__ */ S("context"), wn = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, tr, { writable: !0, value: void 0 }), Object.defineProperty(this, us, { writable: !0, value: void 0 }), l(this, tr)[tr] = e, l(this, us)[us] = t;
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, us)[us].getValue("telemetry");
      }
    )
    /**
    * @private access
    * Not available for external use
    */
  }, { key: "logger", get: function() {
    return l(this, us)[us].getValue("logger");
  } }, { key: "getChatMessages", value: function() {
    return l(this, tr)[tr].sendMessagePromise(Rr.getMessages);
  } }, { key: "getChatMessagesPaginated", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s, u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              return s = h.length > 3 && h[3] !== void 0 ? h[3] : 0, u = h.length > 4 && h[4] !== void 0 ? h[4] : "", c = { timeStamp: n, size: a, from: s, reversed: i, channelId: u }, f.next = 5, l(this, tr)[tr].sendMessagePromise(Rr.getPaginatedMessages, WR.toBinary(c));
            case 5:
              if (d = f.sent, d.payload) {
                f.next = 8;
                break;
              }
              return f.abrupt("return", { messages: [], next: !1 });
            case 8:
              return f.abrupt("return", KR.fromBinary(d.payload));
            case 9:
            case "end":
              return f.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "sendMessageToRoom", value: function(e, r) {
    var n = { payloadType: r, payload: e };
    l(this, tr)[tr].sendMessage(Rr.sendMessageToRoom, QR.toBinary(n));
  } }, { key: "sendMessageToPeers", value: function(e, r, n) {
    var a = { payloadType: r, peerIds: n, payload: e };
    l(this, tr)[tr].sendMessage(Rr.sendMessageToPeers, xR.toBinary(a));
  } }, { key: "sendMessageToChannel", value: function(e, r, n) {
    var a = { payloadType: r, channelId: n, payload: e };
    l(this, tr)[tr].sendMessage(Rr.sendMessageToChannel, t1.toBinary(a));
  } }, { key: "sendMessage", value: function(e, r, n, a) {
    if (a && this.sendMessageToChannel(e, r, a), n && n.length > 0) {
      this.sendMessageToPeers(e, r, n);
      return;
    }
    this.sendMessageToRoom(e, r);
  } }, { key: "editMessage", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u) {
      var c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return c = { chatId: n, payloadType: i, payload: a }, s && (c.channelId = s), u !== void 0 && (c.pinned = u), v.next = 5, l(this, tr)[tr].sendMessagePromise(Rr.editMessage, i1.toBinary(c));
            case 5:
              return d = v.sent, v.abrupt("return", Cl.fromBinary(d.payload).message);
            case 7:
            case "end":
              return v.stop();
          }
      }, r, this);
    }));
    function e(r, n, a, i, s) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "deleteMessage", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return i = { chatId: n }, a && (i.channelId = a), d.next = 4, l(this, tr)[tr].sendMessagePromise(Rr.deleteMessage, d1.toBinary(i));
            case 4:
              return s = d.sent, u = Rl.fromBinary(s.payload), d.abrupt("return", $({ id: u.chatId }, u.channelId ? { channelId: u.channelId } : {}));
            case 7:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "searchMessages", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s, u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return c = { searchTerm: n, timeStamp: (i = a.timestamp) !== null && i !== void 0 ? i : Date.now(), size: (s = a.size) !== null && s !== void 0 ? s : 75, from: 0, reversed: (u = a.reversed) !== null && u !== void 0 ? u : !0 }, a.channelId && (c.channelId = a.channelId), v.prev = 2, v.next = 5, l(this, tr)[tr].sendMessagePromise(Rr.searchChannelMessages, v1.toBinary(c));
            case 5:
              return d = v.sent, v.abrupt("return", og.fromBinary(d.payload).messages);
            case 9:
              return v.prev = 9, v.t0 = v.catch(2), v.abrupt("return", []);
            case 12:
            case "end":
              return v.stop();
          }
      }, r, this, [[2, 9]]);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getAllChannels", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.prev = 0, i.next = 3, l(this, tr)[tr].sendMessagePromise(Rr.getAllChatChannels);
            case 3:
              return n = i.sent, i.abrupt("return", Ma.fromBinary(n.payload).chatChannels.map(zs.formatChannel));
            case 7:
              return i.prev = 7, i.t0 = i.catch(0), i.abrupt("return", []);
            case 10:
            case "end":
              return i.stop();
          }
      }, r, this, [[0, 7]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "markLastReadMessage", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, l(this, tr)[tr].sendMessagePromise(Rr.markChannelIndexAsRead, g1.toBinary({ channelId: n, userId: a.userId, channelIndex: a.channelIndex }));
            case 2:
              return i = u.sent, u.abrupt("return", y1.fromBinary(i.payload).channelIndex);
            case 4:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setPinState", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = { chatId: n.id, pinned: a, channelId: n.channelId }, c.next = 3, l(this, tr)[tr].sendMessagePromise(Rr.pinMessage, o1.toBinary(i));
            case 3:
              return s = c.sent, c.abrupt("return", El.fromBinary(s.payload));
            case 5:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "on", value: function(e, r) {
    var n = this, a, i;
    switch (e) {
      case Rr.sendMessageToRoom: {
        a = Wc.fromBinary.bind(Wc), i = Wc.create();
        break;
      }
      case Rr.sendMessageToPeers: {
        a = Jc.fromBinary.bind(Jc), i = Jc.create();
        break;
      }
      case Rr.editMessage: {
        a = Cl.fromBinary.bind(Cl), i = Cl.create();
        break;
      }
      case Rr.pinMessage: {
        a = El.fromBinary.bind(El), i = El.create();
        break;
      }
      case Rr.deleteMessage: {
        a = Rl.fromBinary.bind(Rl), i = Rl.create();
        break;
      }
    }
    if (!a) {
      this.logger.warn("ChatSocketHandler::Event ".concat(e, " is not recognized"));
      return;
    }
    l(this, tr)[tr].on(e, function(s) {
      var u = s.payload, c = i;
      try {
        c = a(u);
      } catch (d) {
        n.logger.error("chatSocketHandler::on::binary_decode_error", { error: d });
      }
      return r(c);
    });
  } }]);
}();
Gn([O.trace("SocketService.getChatMessages")], wn.prototype, "getChatMessages", 1);
Gn([O.trace("SocketService.getChatMessagesPaginated")], wn.prototype, "getChatMessagesPaginated", 1);
Gn([O.trace("SocketService.sendMessageToRoom")], wn.prototype, "sendMessageToRoom", 1);
Gn([O.trace("SocketService.sendMessageToPeers")], wn.prototype, "sendMessageToPeers", 1);
Gn([O.trace("SocketService.sendMessageToChannel")], wn.prototype, "sendMessageToChannel", 1);
Gn([O.trace("SocketService.sendMessage")], wn.prototype, "sendMessage", 1);
Gn([O.trace("SocketService.editMessage")], wn.prototype, "editMessage", 1);
Gn([O.trace("SocketService.deleteMessage")], wn.prototype, "deleteMessage", 1);
Gn([O.trace("SocketService.searchMessages")], wn.prototype, "searchMessages", 1);
Gn([O.trace("SocketService.getAllChannels")], wn.prototype, "getAllChannels", 1);
Gn([O.trace("SocketService.markLastReadMessage")], wn.prototype, "markLastReadMessage", 1);
function tI(o) {
  return o.replace(/([-_]\w)/g, function(t) {
    return t[1].toUpperCase();
  });
}
function jn(o) {
  if (!o || be(o) !== "object")
    return o;
  if (Array.isArray(o))
    return o.map(function(e) {
      return jn(e);
    });
  var t = {};
  return Object.keys(o).forEach(function(e) {
    var r = Mv(e) ? e : tI(e);
    t[r] = jn(o[e]);
  }), t;
}
function nI(o) {
  return o.replace(/[A-Z]/g, function(t) {
    return "_".concat(t.toLowerCase());
  });
}
function dg(o) {
  if (!o || be(o) !== "object")
    return o;
  if (Array.isArray(o))
    return o.map(function(e) {
      return dg(e);
    });
  var t = {};
  return Object.keys(o).forEach(function(e) {
    var r = Mv(e) ? e : nI(e);
    t[r] = o[e];
  }), t;
}
function rc(o) {
  var t = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {};
  return o == null ? {} : (Object.getOwnPropertyNames(o).forEach(function(e) {
    if (typeof o[e] != "function") {
      if (be(o[e]) === "object") {
        rc(o[e], t[e] = {});
        return;
      }
      t[e] = o[e];
    }
  }), t);
}
var pv = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.defaults = void 0, this.defaults = { baseURL: t.baseURL, headers: { common: {} }, timeout: t.timeout, retry: t.retry, retryDelay: t.retryDelay };
  }
  return P(o, [{ key: "buildURL", value: function(e, r) {
    var n = this.defaults.baseURL, a = e.startsWith("http") ? e : "".concat(n).concat(e.startsWith("/") ? e : "/".concat(e));
    if (r) {
      var i = new URLSearchParams();
      return Object.entries(r).forEach(function(s) {
        var u = He(s, 2), c = u[0], d = u[1];
        i.append(c, d);
      }), "".concat(a).concat(a.includes("?") ? "&" : "?").concat(i.toString());
    }
    return a;
  } }, { key: "request", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k, y, b, C, T, E, D;
      return p().wrap(function(_) {
        for (; ; )
          switch (_.prev = _.next) {
            case 0:
              return i = ((a = n.method) === null || a === void 0 ? void 0 : a.toUpperCase()) || "GET", s = this.buildURL(n.url || "", n.params), u = $($({}, this.defaults.headers.common), n.headers), i !== "GET" && i !== "HEAD" && n.data && !u["Content-Type"] && (u["Content-Type"] = "application/json"), c = u["Content-Type"], d = c === "application/json" ? JSON.stringify(n.data) : n.data, h = { method: i, headers: u, body: i !== "GET" && i !== "HEAD" && n.data ? d : void 0 }, v = n.timeout || this.defaults.timeout, f = n.retry !== void 0 ? n.retry : this.defaults.retry, g = n.retryDelay || this.defaults.retryDelay, _.prev = 10, k = new AbortController(), y = setTimeout(function() {
                return k.abort();
              }, v), h.signal = k.signal, _.next = 16, fetch(s, h);
            case 16:
              if (b = _.sent, clearTimeout(y), C = null, T = b.headers.get("content-type"), !(T && T.includes("application/json"))) {
                _.next = 26;
                break;
              }
              return _.next = 23, b.json();
            case 23:
              C = _.sent, _.next = 29;
              break;
            case 26:
              return _.next = 28, b.text();
            case 28:
              C = _.sent;
            case 29:
              if (E = {}, b.headers.forEach(function(V, F) {
                E[F] = V;
              }), D = { data: C, status: b.status, statusText: b.statusText, headers: E, config: n }, b.ok) {
                _.next = 34;
                break;
              }
              throw D;
            case 34:
              return _.abrupt("return", D);
            case 37:
              if (_.prev = 37, _.t0 = _.catch(10), !(_.t0 instanceof Error && f > 0)) {
                _.next = 44;
                break;
              }
              return _.next = 42, new Promise(function(V) {
                return setTimeout(V, g);
              });
            case 42:
              return this.defaults.baseURL === $s.apiBase.prod ? this.defaults.baseURL = $s.apiBase.prodAlternate : this.defaults.baseURL === $s.apiBase.prodAlternate && (this.defaults.baseURL = $s.apiBase.prod), _.abrupt("return", this.request($($({}, n), {}, { retry: f - 1 })));
            case 44:
              throw _.t0;
            case 45:
            case "end":
              return _.stop();
          }
      }, r, this, [[10, 37]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "get", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i = arguments;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return a = i.length > 1 && i[1] !== void 0 ? i[1] : {}, u.abrupt("return", this.request($($({}, a), {}, { method: "GET", url: n })));
            case 2:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "post", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s = arguments;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = s.length > 2 && s[2] !== void 0 ? s[2] : {}, c.abrupt("return", this.request($($({}, i), {}, { method: "POST", url: n, data: a })));
            case 2:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "put", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s = arguments;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = s.length > 2 && s[2] !== void 0 ? s[2] : {}, c.abrupt("return", this.request($($({}, i), {}, { method: "PUT", url: n, data: a })));
            case 2:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), aI = 3, iI = 30, sI = 8e3, oI = /* @__PURE__ */ function() {
  function o(t, e) {
    var r = this;
    w(this, o), this.ipInfo = void 0, this.fetchClient = void 0, this.requests = void 0, this.roomName = void 0, this.roomUUID = void 0, this.authToken = void 0, this.organizationId = void 0, this.iceServers = void 0, this.pluginInformation = void 0, this.userDetails = void 0, this.roomDetails = void 0, this.context = void 0, this.context = t;
    var n = e || {}, a = n.timeout, i = a === void 0 ? sI : a, s = n.retry, u = s === void 0 ? aI : s, c = n.retryDelay, d = c === void 0 ? iI : c, h = n.baseURL, v = h === void 0 ? $s.apiBase.prod : h, f = n.authToken, g = n.cachedUserDetails;
    this.iceServers = g == null ? void 0 : g.iceServers, this.pluginInformation = g == null ? void 0 : g.pluginInformation, this.userDetails = g == null ? void 0 : g.userDetails, this.roomDetails = g == null ? void 0 : g.roomDetails, this.requests = new pv({ baseURL: v, timeout: i, retry: u, retryDelay: d, responseType: "json" }), this.fetchClient = new pv({
      baseURL: "",
      // Empty baseURL for direct fetch calls
      timeout: i,
      retry: u,
      retryDelay: d,
      responseType: "json"
    }), this.setAuthToken(f, { bearer: !0 });
    var k = this.requests.request.bind(this.requests);
    this.requests.request = /* @__PURE__ */ function() {
      var y = m(/* @__PURE__ */ p().mark(function b(C) {
        var T, E, D, I, _, V, F;
        return p().wrap(function(L) {
          for (; ; )
            switch (L.prev = L.next) {
              case 0:
                return T = t.getValue("telemetry"), L.prev = 1, T.injectContext(r.requests.defaults.headers.common), L.next = 5, k(C);
              case 5:
                return E = L.sent, C.url !== T.logsEndpoint && r.logger.debug("xhr::fetch", { networkCall: { status: E.status, statusText: E.statusText, baseURL: C.baseURL || r.requests.defaults.baseURL, url: C.url, method: C.method } }), L.abrupt("return", E);
              case 10:
                if (L.prev = 10, L.t0 = L.catch(1), L.t0) {
                  L.next = 14;
                  break;
                }
                throw new U("Unknown network error occurred", "0011");
              case 14:
                throw ((D = L.t0.config) === null || D === void 0 ? void 0 : D.url) !== T.logsEndpoint && r.logger.error("xhr::fetch", { error: L.t0, networkCall: { status: L.t0.status, statusText: L.t0.statusText, baseURL: ((I = L.t0.config) === null || I === void 0 ? void 0 : I.baseURL) || r.requests.defaults.baseURL, url: (_ = L.t0.config) === null || _ === void 0 ? void 0 : _.url, retries: (V = L.t0.config) === null || V === void 0 ? void 0 : V.retry, method: (F = L.t0.config) === null || F === void 0 ? void 0 : F.method, isOnline: navigator.onLine ? "online" : "offline" } }), new U(L.t0.message || "Network request failed", "0011");
              case 16:
              case "end":
                return L.stop();
            }
        }, b, null, [[1, 10]]);
      }));
      return function(b) {
        return y.apply(this, arguments);
      };
    }();
  }
  return P(o, [{ key: "peerId", get: function() {
    return this.context.getValue("peerId");
  } }, { key: "logger", get: function() {
    return this.context.getValue("logger");
  } }, { key: "setAuthToken", value: function(e, r) {
    var n = r || {}, a = n.bearer;
    this.authToken = e, this.requests.defaults.headers.common.Authorization = a ? "Bearer ".concat(e) : e;
  } }, { key: "setHeader", value: function(e, r) {
    this.requests.defaults.headers.common[e] = r;
  } }, { key: "setRoomName", value: function(e) {
    this.roomName = e;
  } }, { key: "setRoomUUID", value: function(e) {
    this.roomUUID = e;
  } }, { key: "setOrganizationId", value: function(e) {
    this.organizationId = e;
  } }]);
}(), uI = Object.defineProperty, lI = Object.getOwnPropertyDescriptor, Pn = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? lI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && uI(e, r, a), a;
}, sn = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    return w(this, t), n = R(this, t, [e, r]), n.telemetry = void 0, n.telemetry = e.getValue("telemetry"), n.setHeader("x-realtimekit-version", e.getValue("sdkVersion")), n;
  }
  return A(t, o), P(t, [{ key: "getIPDetails", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return a = this.peerId, c.prev = 1, c.next = 4, Sp.getIPDetails({ peerId: a, apiHostnames: Kf(this.context), logger: jf });
            case 4:
              if (s = c.sent, this.logger.log("ipInfo", { ipInfo: s }), !((s == null || (i = s.loc) === null || i === void 0 ? void 0 : i.length) > 5)) {
                c.next = 8;
                break;
              }
              return c.abrupt("return", s);
            case 8:
              throw Error("Insufficient data");
            case 11:
              return c.prev = 11, c.t0 = c.catch(1), this.logger.warn("APIClient.getIPDetails Failed to get ip details", { error: { name: c.t0.name, message: c.t0.message } }), c.abrupt("return", void 0);
            case 15:
            case "end":
              return c.stop();
          }
      }, n, this, [[1, 11]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getICEServers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (!this.iceServers) {
                c.next = 2;
                break;
              }
              return c.abrupt("return", this.iceServers);
            case 2:
              return c.next = 4, this.requests.get("/iceservers");
            case 4:
              if (a = c.sent.data, i = a.success, s = a.iceServers, !i) {
                c.next = 10;
                break;
              }
              return (s == null ? void 0 : s.length) > 0 && (this.iceServers = s), c.abrupt("return", s);
            case 10:
              return c.abrupt("return", void 0);
            case 11:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPlugins", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s = this, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              if (!this.pluginInformation) {
                f.next = 2;
                break;
              }
              return f.abrupt("return", this.pluginInformation);
            case 2:
              return f.next = 4, this.requests.get("/v2/plugins/user");
            case 4:
              return u = f.sent.data.data.plugins, c = ((a = this.context.getValue("flagsmith").getValue(me.V1_PLUGINS)) === null || a === void 0 || (a = a.toString()) === null || a === void 0 ? void 0 : a.split(",")) || [], d = u.reduce(function(g, k) {
                return g[c.includes(k.id) ? "v1" : "v2"].push($($({}, k), {}, { name: k.name.replace("v2", "") })), g;
              }, { v1: [], v2: [] }), (i = this.context.getValue("modules")) !== null && i !== void 0 && (i = i.devTools) !== null && i !== void 0 && (i = i.plugins) !== null && i !== void 0 && i.length && ((h = this.context.getValue("modules")) === null || h === void 0 || (h = h.devTools) === null || h === void 0 || h.plugins.forEach(function(g) {
                var k, y, b, C = $($({}, Yo), {}, { tags: Se(Yo.tags), baseUrl: "http://localhost:".concat(g.port), name: g.name, picture: (k = g.picture) !== null && k !== void 0 ? k : Yo.picture, createdAt: new Date().toISOString(), updatedAt: new Date().toISOString(), id: g.id, organizationId: s.organizationId, description: (y = g.description) !== null && y !== void 0 ? y : Yo.description, staggered: (b = g.staggered) !== null && b !== void 0 ? b : Yo.staggered });
                d.v2.push(C);
              })), f.abrupt("return", d.v2);
            case 9:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPluginDetails", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, this.requests.get("/v2/plugins/view/".concat(a));
            case 2:
              return i = u.sent.data.data.plugin, u.abrupt("return", i);
            case 4:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPluginConfig", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, this.fetchClient.get("".concat(a, "/dyte-config.json"));
            case 2:
              return i = u.sent.data, u.abrupt("return", i);
            case 4:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "authorizePlugin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = { peerId: this.peerId }, c.next = 3, this.requests.post("/v2/plugins/authorize/".concat(a), i);
            case 3:
              return s = c.sent.data.data.token, c.abrupt("return", s);
            case 5:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPresignedUrls", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              return s = $o(this.context, "chat_upload_expiry"), u = { roomUUID: this.roomUUID, filename: a, expiry: typeof s == "number" ? s : void 0 }, this.context.getValue("flagsmith").hasFeature(me.FEAT_CHAT_SDK) && (u.viewType = i), f.next = 5, this.requests.post("/v1/meetings/genPreSignedUploadUrl", u);
            case 5:
              return c = f.sent.data.data, d = c.getLocation, h = c.putLocation, f.abrupt("return", { getLocation: d, putLocation: h });
            case 9:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "uploadFile",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                if (!(navigator.isReactNative && "uri" in a)) {
                  u.next = 11;
                  break;
                }
                return u.prev = 1, u.next = 4, fetch(i, { method: "PUT", headers: { "Content-Type": "application/octet-stream" }, body: { uri: a.uri, name: a.name } });
              case 4:
                u.next = 9;
                break;
              case 6:
                u.prev = 6, u.t0 = u.catch(1), this.logger.error("sendFileMessage::".concat(u.t0));
              case 9:
                u.next = 13;
                break;
              case 11:
                return u.next = 13, this.fetchClient.put(i, a, { headers: { "Content-Type": a.type } });
              case 13:
              case "end":
                return u.stop();
            }
        }, n, this, [[1, 6]]);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "startLivestreaming",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                return i = a.manualIngestion, c.t0 = jn, c.next = 4, this.requests.post("/v2/meetings/".concat(this.context.getValue("meetingId"), "/livestreams"), { manual_ingest: !!i });
              case 4:
                return c.t1 = c.sent, s = (0, c.t0)(c.t1).data.data, c.abrupt("return", { playbackUrl: s.playbackUrl, status: s.status, manualIngest: s.manualIngest, ingestionCredentials: s.streamKey ? { ingestionServer: s.ingestServer, streamKey: s.streamKey } : null });
              case 7:
              case "end":
                return c.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "stopLivestreaming", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.requests.post("/v2/meetings/".concat(this.context.getValue("meetingId"), "/active-livestream/stop")));
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getActiveLivestream", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.t0 = jn, s.next = 3, this.requests.get("/v2/meetings/".concat(this.context.getValue("meetingId"), "/active-livestream"));
            case 3:
              return s.t1 = s.sent.data.data, a = (0, s.t0)(s.t1), s.abrupt("return", { playbackUrl: a.playbackUrl, status: a.status, manualIngest: a.manualIngest, ingestionCredentials: a.streamKey ? { ingestionServer: a.ingestServer, streamKey: a.streamKey } : null });
            case 6:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getUserDetails", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!this.userDetails) {
                s.next = 2;
                break;
              }
              return s.abrupt("return", this.userDetails);
            case 2:
              return s.next = 4, this.requests.get("v2/internals/participant-details");
            case 4:
              return a = s.sent.data.data, s.abrupt("return", jn(a));
            case 6:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "startRecording", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, this.requests.post("/v2/recordings", $($({}, dg(a)), {}, { meeting_id: this.context.getValue("meetingId"), allow_multiple_recordings: !!i }));
            case 2:
              return s = c.sent, c.abrupt("return", s.data.data.id);
            case 4:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateRecording", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", this.requests.put("v2/recordings/".concat(a), { action: i }));
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getActiveRecording", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, this.requests.get("v2/recordings/active-recording/".concat(this.context.getValue("meetingId")));
            case 2:
              return a = c.sent.data.data, i = a.status, s = a.id, c.abrupt("return", { status: i, id: s });
            case 6:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getActiveTranscript", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, this.requests.get("v2/meetings/".concat(this.context.getValue("meetingId"), "/active-transcript"));
            case 2:
              return a = u.sent.data.data.transcript_download_url, u.prev = 3, u.next = 6, this.fetchClient.get(a);
            case 6:
              return i = u.sent, u.abrupt("return", { transcript: i.data });
            case 10:
              throw u.prev = 10, u.t0 = u.catch(3), new U("Cant fetch transcript s3 url", "1801");
            case 13:
            case "end":
              return u.stop();
          }
      }, n, this, [[3, 10]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getRoomNodeData", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, this.getIPDetails();
            case 2:
              if (a = c.sent, this.ipInfo = a, !this.roomDetails) {
                c.next = 6;
                break;
              }
              return c.abrupt("return", this.roomDetails);
            case 6:
              return c.t0 = jn, c.next = 9, this.requests.post("v2/internals/rooms", { ip_information: a });
            case 9:
              return c.t1 = c.sent.data.data, i = (0, c.t0)(c.t1), s = i.title, c.abrupt("return", { meetingTitle: s });
            case 13:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(oI);
Pn([O.trace("APIClient.getIPDetails")], sn.prototype, "getIPDetails", 1);
Pn([O.trace("APIClient.getICEServers")], sn.prototype, "getICEServers", 1);
Pn([O.trace("APIClient.getPlugins")], sn.prototype, "getPlugins", 1);
Pn([O.trace("APIClient.startLivestreaming")], sn.prototype, "startLivestreaming", 1);
Pn([O.trace("APIClient.stopLivestreaming")], sn.prototype, "stopLivestreaming", 1);
Pn([O.trace("APIClient.getActiveLivestream")], sn.prototype, "getActiveLivestream", 1);
Pn([O.trace("APIClient.getUserDetails")], sn.prototype, "getUserDetails", 1);
Pn([O.trace("APIClient.startRecording")], sn.prototype, "startRecording", 1);
Pn([O.trace("APIClient.stopRecording")], sn.prototype, "updateRecording", 1);
Pn([O.trace("APIClient.getActiveRecording")], sn.prototype, "getActiveRecording", 1);
Pn([O.trace("APIClient.getActiveTranscript")], sn.prototype, "getActiveTranscript", 1);
Pn([O.trace("APIClient.getRoomNodeData")], sn.prototype, "getRoomNodeData", 1);
var Dd;
function cI(o, t) {
  return Dd = new sn(o, t), Dd;
}
function pt() {
  return Dd;
}
function dI(o, t) {
  var e = t.replace(/<blockquote>[.\s\S]*<\/blockquote>\n\n/m, "");
  return "<blockquote>".concat(e, `</blockquote>

`).concat(o);
}
var Ho = { maxInvocations: 5, period: 1 };
function Lt(o, t) {
  return function(e, r, n) {
    var a = n.value, i = 0, s = Date.now();
    return n.value = function() {
      var u = Date.now(), c = t ? this[t] : o;
      if (u - s > c.period * 1e3 && (s = u, i = 0), i >= c.maxInvocations)
        throw new U("Method rate limit ".concat(c.maxInvocations, " invocations/").concat(c.period, "sec exceeded"), "0013");
      i += 1;
      for (var d = arguments.length, h = new Array(d), v = 0; v < d; v++)
        h[v] = arguments[v];
      return a.apply(this, h);
    }, n;
  };
}
var pI = Object.defineProperty, hI = Object.getOwnPropertyDescriptor, ft = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? hI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && pI(e, r, a), a;
}, vI = ["text", "image", "file", "custom", "poll"], Nl = { maxInvocations: 180, period: 60 }, tt = (z = /* @__PURE__ */ S("self"), Jn = /* @__PURE__ */ S("participants"), $e = /* @__PURE__ */ S("chatSocketHandler"), Kn = /* @__PURE__ */ S("chatChannelSocketHandler"), oa = /* @__PURE__ */ S("context"), Fl = /* @__PURE__ */ S("connectionHandler"), io = /* @__PURE__ */ S("socketJoined"), /* @__PURE__ */ function(o) {
  function t(e, r, n, a, i) {
    var s;
    w(this, t);
    var u = e.getValue("logger");
    return s = R(this, t, [u]), Object.defineProperty(s, io, { get: gI, set: void 0 }), Object.defineProperty(s, Fl, { get: fI, set: void 0 }), s.messages = void 0, s.channels = [], Object.defineProperty(s, z, { writable: !0, value: void 0 }), Object.defineProperty(s, Jn, { writable: !0, value: void 0 }), Object.defineProperty(s, $e, { writable: !0, value: void 0 }), Object.defineProperty(s, Kn, { writable: !0, value: void 0 }), Object.defineProperty(s, oa, { writable: !0, value: void 0 }), s.maxTextLimit = 2e3, l(s, oa)[oa] = e, l(s, $e)[$e] = r, l(s, Kn)[Kn] = n, l(s, z)[z] = a, l(s, Jn)[Jn] = i, s.messages = [], s;
  }
  return A(t, o), P(t, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, oa)[oa].getValue("telemetry");
      }
    )
    /**
    	Set the max character limit of a text message
    */
  }, { key: "setMaxTextLimit", value: function(r) {
    this.maxTextLimit = r;
  } }, { key: "sendMessageInternal", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d = arguments;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              u = d.length > 3 && d[3] !== void 0 ? d[3] : {}, v.t0 = a.type, v.next = v.t0 === "text" ? 4 : v.t0 === "image" ? 8 : v.t0 === "file" ? 11 : 14;
              break;
            case 4:
              return c = u.replyTo && u.replyTo.type === "text" ? dI(a.message, u.replyTo.message) : a.message, v.next = 7, this.sendTextMessageInternal(c, i, s);
            case 7:
              return v.abrupt("break", 16);
            case 8:
              return v.next = 10, this.sendImageMessageInternal(a.image, i, s);
            case 10:
              return v.abrupt("break", 16);
            case 11:
              return v.next = 13, this.sendFileMessageInternal(a.file, i, s);
            case 13:
              return v.abrupt("break", 16);
            case 14:
              return this.logger.error("sendMessage::message_type_not_supported", { chat: { messageType: a.type } }), v.abrupt("break", 16);
            case 16:
            case "end":
              return v.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendTextMessageInternal", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d, h, v;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              if (!(a.length > this.maxTextLimit)) {
                g.next = 2;
                break;
              }
              throw new U("Max character limit breached", "0503");
            case 2:
              if (!(i && i.length > 0)) {
                g.next = 8;
                break;
              }
              if (!(!((d = l(this, z)[z].permissions) !== null && d !== void 0 && d.chatPrivate.canSend) || !((h = l(this, z)[z].permissions) !== null && h !== void 0 && h.chatPrivate.text))) {
                g.next = 6;
                break;
              }
              throw this.logger.error("sendTextMessage::private_chat_permission_denied"), new U("Could not send message to private chat.", "0501");
            case 6:
              g.next = 11;
              break;
            case 8:
              if (!(!((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.canSend) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.text))) {
                g.next = 11;
                break;
              }
              throw this.logger.error("sendTextMessage::public_chat_permission_denied"), new U("Could not send message to public chat.", "0501");
            case 11:
              if (a) {
                g.next = 14;
                break;
              }
              throw this.logger.error("sendTextMessage::message_can_not_be_empty"), new U("Message can not be empty.", "0502");
            case 14:
              if (!s) {
                g.next = 17;
                break;
              }
              return l(this, $e)[$e].sendMessageToChannel(a, Pt.TEXT, s), g.abrupt("return");
            case 17:
              v = [], i && i.length > 0 && (i.push(l(this, z)[z].id), v = l(this, Jn)[Jn].joined.toArray().filter(function(k) {
                return i.includes(k.id);
              }).map(function(k) {
                return k.userId;
              }), v.push(l(this, z)[z].userId)), l(this, $e)[$e].sendMessage(a, Pt.TEXT, i);
            case 20:
            case "end":
              return g.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendImageMessageInternal", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d, h, v, f, g, k, y, b;
      return p().wrap(function(T) {
        for (; ; )
          switch (T.prev = T.next) {
            case 0:
              if (!(i && i.length > 0)) {
                T.next = 6;
                break;
              }
              if (!(!((d = l(this, z)[z].permissions) !== null && d !== void 0 && d.chatPrivate.canSend) || !((h = l(this, z)[z].permissions) !== null && h !== void 0 && h.chatPrivate.files))) {
                T.next = 4;
                break;
              }
              return this.logger.error("sendImageMessage::private_chat_permission_denied"), T.abrupt("return");
            case 4:
              T.next = 9;
              break;
            case 6:
              if (!(!((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.canSend) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.files))) {
                T.next = 9;
                break;
              }
              return this.logger.error("sendImageMessage::permission_denied"), T.abrupt("return");
            case 9:
              if (a) {
                T.next = 12;
                break;
              }
              return this.logger.error("sendImageMessage::required_argument_image_can_not_be_empty"), T.abrupt("return");
            case 12:
              if (v = ["image/gif", "image/jpeg", "image/png"], v.includes(a.type)) {
                T.next = 16;
                break;
              }
              return this.logger.error("sendImageMessage::image_type_not_supported", { chat: { imageType: a.type } }), T.abrupt("return");
            case 16:
              return T.prev = 16, f = pt(), T.next = 20, f.getPresignedUrls(a.name, l(this, z)[z].config.viewType);
            case 20:
              return g = T.sent, k = g.getLocation, y = g.putLocation, T.next = 25, f.uploadFile(a, y);
            case 25:
              if (!s) {
                T.next = 28;
                break;
              }
              return l(this, $e)[$e].sendMessageToChannel(k, Pt.IMAGE, s), T.abrupt("return");
            case 28:
              b = [], i && i.length > 0 && (i.push(l(this, z)[z].id), b = l(this, Jn)[Jn].joined.toArray().filter(function(E) {
                return i.includes(E.id);
              }).map(function(E) {
                return E.userId;
              }), b.push(l(this, z)[z].userId)), l(this, $e)[$e].sendMessage(k, Pt.IMAGE, i), T.next = 36;
              break;
            case 33:
              throw T.prev = 33, T.t0 = T.catch(16), new U("Error sending image message.", "0500", this.logger);
            case 36:
            case "end":
              return T.stop();
          }
      }, n, this, [[16, 33]]);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "sendFileMessageInternal",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
        var u, c, d, h, v, f, g, k, y, b;
        return p().wrap(function(T) {
          for (; ; )
            switch (T.prev = T.next) {
              case 0:
                if (!(i && i.length > 0)) {
                  T.next = 6;
                  break;
                }
                if (!(!((d = l(this, z)[z].permissions) !== null && d !== void 0 && d.chatPrivate.canSend) || !((h = l(this, z)[z].permissions) !== null && h !== void 0 && h.chatPrivate.files))) {
                  T.next = 4;
                  break;
                }
                return this.logger.error("sendFileMessage::private_chat_permission_denied"), T.abrupt("return");
              case 4:
                T.next = 9;
                break;
              case 6:
                if (!(!((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.canSend) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.files))) {
                  T.next = 9;
                  break;
                }
                return this.logger.error("sendFileMessage::permission_denied"), T.abrupt("return");
              case 9:
                if (a) {
                  T.next = 12;
                  break;
                }
                return this.logger.error("sendFileMessage::required_argument_file_can_not_be_empty"), T.abrupt("return");
              case 12:
                return T.prev = 12, v = pt(), T.next = 16, v.getPresignedUrls(a.name, l(this, z)[z].config.viewType);
              case 16:
                return f = T.sent, g = f.getLocation, k = f.putLocation, T.next = 21, v.uploadFile(a, k);
              case 21:
                if (!s) {
                  T.next = 24;
                  break;
                }
                return l(this, $e)[$e].sendMessageToChannel(JSON.stringify({ link: g, name: a.name, size: "size" in a ? a.size : 0 }), Pt.FILE, s), T.abrupt("return");
              case 24:
                y = [], i && i.length > 0 && (i.push(l(this, z)[z].id), y = l(this, Jn)[Jn].joined.toArray().filter(function(E) {
                  return i.includes(E.id);
                }).map(function(E) {
                  return E.userId;
                }), y.push(l(this, z)[z].userId)), b = JSON.stringify({ link: g, name: a.name, size: "size" in a ? a.size : 0 }), l(this, $e)[$e].sendMessage(b, Pt.FILE, i), T.next = 33;
                break;
              case 30:
                throw T.prev = 30, T.t0 = T.catch(12), new U("Error sending file message.", "0500", this.logger);
              case 33:
              case "end":
                return T.stop();
            }
        }, n, this, [[12, 30]]);
      }));
      function r(n, a, i) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "rateLimits",
    get: function() {
      return Nl;
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "updateRateLimits", value: function(r, n) {
    Nl.maxInvocations = r, Nl.period = n;
  } }, { key: "sendTextMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", this.sendTextMessageInternal(a, i));
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendCustomMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d = this, h, v, f, g, k, y, b, C, T, E, D;
      return p().wrap(function(_) {
        for (; ; )
          switch (_.prev = _.next) {
            case 0:
              if (!(i && i.length > 0)) {
                _.next = 6;
                break;
              }
              if (!(!((b = l(this, z)[z].permissions) !== null && b !== void 0 && b.chatPrivate.canSend) || !((C = l(this, z)[z].permissions) !== null && C !== void 0 && C.chatPrivate.files) || !((T = l(this, z)[z].permissions) !== null && T !== void 0 && T.chatPrivate.text))) {
                _.next = 4;
                break;
              }
              return this.logger.error("sendCustomMessage::private_chat_permission_denied"), _.abrupt("return");
            case 4:
              _.next = 9;
              break;
            case 6:
              if (!(!((s = l(this, z)[z].permissions) !== null && s !== void 0 && (s = s.chatPublic) !== null && s !== void 0 && s.canSend) || !((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.files) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.text))) {
                _.next = 9;
                break;
              }
              return this.logger.error("sendCustomMessage::permission_denied"), _.abrupt("return");
            case 9:
              return E = /* @__PURE__ */ function() {
                var V = m(/* @__PURE__ */ p().mark(function F(N) {
                  var L, H, Q, B;
                  return p().wrap(function(x) {
                    for (; ; )
                      switch (x.prev = x.next) {
                        case 0:
                          if (x.prev = 0, typeof N != "string") {
                            x.next = 3;
                            break;
                          }
                          return x.abrupt("return", { link: N });
                        case 3:
                          return L = pt(), x.next = 6, L.getPresignedUrls(N.name, l(d, z)[z].config.viewType);
                        case 6:
                          return H = x.sent, Q = H.getLocation, B = H.putLocation, x.next = 11, L.uploadFile(N, B);
                        case 11:
                          return x.abrupt("return", { link: Q, type: N.type, name: N.name, size: N.size });
                        case 14:
                          throw x.prev = 14, x.t0 = x.catch(0), new U("Error sending image message.", "0500", d.logger);
                        case 17:
                        case "end":
                          return x.stop();
                      }
                  }, F, null, [[0, 14]]);
                }));
                return function(N) {
                  return V.apply(this, arguments);
                };
              }(), _.t0 = $, _.t1 = $({}, a), _.t2 = {}, _.next = 15, Promise.all((h = (v = a.files) !== null && v !== void 0 ? v : []) === null || h === void 0 ? void 0 : h.map(/* @__PURE__ */ function() {
                var V = m(/* @__PURE__ */ p().mark(function F(N) {
                  return p().wrap(function(H) {
                    for (; ; )
                      switch (H.prev = H.next) {
                        case 0:
                          return H.abrupt("return", E(N));
                        case 1:
                        case "end":
                          return H.stop();
                      }
                  }, F);
                }));
                return function(F) {
                  return V.apply(this, arguments);
                };
              }()));
            case 15:
              return _.t3 = _.sent, _.next = 18, Promise.all((f = (g = a.images) !== null && g !== void 0 ? g : []) === null || f === void 0 ? void 0 : f.map(/* @__PURE__ */ function() {
                var V = m(/* @__PURE__ */ p().mark(function F(N) {
                  return p().wrap(function(H) {
                    for (; ; )
                      switch (H.prev = H.next) {
                        case 0:
                          return H.abrupt("return", E(N));
                        case 1:
                        case "end":
                          return H.stop();
                      }
                  }, F);
                }));
                return function(F) {
                  return V.apply(this, arguments);
                };
              }()));
            case 18:
              return _.t4 = _.sent, _.next = 21, Promise.all((k = (y = a.videos) !== null && y !== void 0 ? y : []) === null || k === void 0 ? void 0 : k.map(/* @__PURE__ */ function() {
                var V = m(/* @__PURE__ */ p().mark(function F(N) {
                  return p().wrap(function(H) {
                    for (; ; )
                      switch (H.prev = H.next) {
                        case 0:
                          return H.abrupt("return", E(N));
                        case 1:
                        case "end":
                          return H.stop();
                      }
                  }, F);
                }));
                return function(F) {
                  return V.apply(this, arguments);
                };
              }()));
            case 21:
              _.t5 = _.sent, _.t6 = { files: _.t3, images: _.t4, videos: _.t5 }, D = (0, _.t0)(_.t1, _.t2, _.t6), l(this, $e)[$e].sendMessage(JSON.stringify(D), Pt.CUSTOM, i);
            case 25:
            case "end":
              return _.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendImageMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", this.sendImageMessageInternal(a, i));
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendFileMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", this.sendFileMessageInternal(a, i));
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", this.sendMessageInternal(a, i));
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "editTextMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              if (((u = l(this, z)[z].permissions) === null || u === void 0 || (u = u.chatMessage) === null || u === void 0 ? void 0 : u.canEdit) !== "NONE") {
                v.next = 2;
                break;
              }
              throw new U("Not permitted to edit messages", "0501");
            case 2:
              if (!(!((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.canSend) || !((d = l(this, z)[z].permissions) !== null && d !== void 0 && (d = d.chatPublic) !== null && d !== void 0 && d.text))) {
                v.next = 5;
                break;
              }
              return this.logger.error("editTextMessage::permission_denied"), v.abrupt("return");
            case 5:
              if (i) {
                v.next = 8;
                break;
              }
              return this.logger.error("editTextMessage::message_can_not_be_empty"), v.abrupt("return");
            case 8:
              l(this, $e)[$e].editMessage(a, i, Pt.TEXT, s);
            case 9:
            case "end":
              return v.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "editImageMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              if (!(!((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.canSend) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.files))) {
                y.next = 3;
                break;
              }
              return this.logger.error("editImageMessage::permission_denied"), y.abrupt("return");
            case 3:
              if (i) {
                y.next = 6;
                break;
              }
              return this.logger.error("editImageMessage::required_argument_image_can_not_be_empty"), y.abrupt("return");
            case 6:
              if (d = ["image/gif", "image/jpeg", "image/png"], d.includes(i.type)) {
                y.next = 10;
                break;
              }
              return this.logger.error("sendImageMessage::image_type_not_supported", { chat: { imageType: i.type } }), y.abrupt("return");
            case 10:
              return y.prev = 10, h = pt(), y.next = 14, h.getPresignedUrls(i.name, l(this, z)[z].config.viewType);
            case 14:
              return v = y.sent, f = v.getLocation, g = v.putLocation, y.next = 19, h.uploadFile(i, g);
            case 19:
              l(this, $e)[$e].editMessage(a, f, Pt.IMAGE, s), y.next = 25;
              break;
            case 22:
              throw y.prev = 22, y.t0 = y.catch(10), new U("Error editing image message.", "0500", this.logger);
            case 25:
            case "end":
              return y.stop();
          }
      }, n, this, [[10, 22]]);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "editFileMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d, h, v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              if (!(!((u = l(this, z)[z].permissions) !== null && u !== void 0 && (u = u.chatPublic) !== null && u !== void 0 && u.canSend) || !((c = l(this, z)[z].permissions) !== null && c !== void 0 && (c = c.chatPublic) !== null && c !== void 0 && c.files))) {
                k.next = 3;
                break;
              }
              return this.logger.error("sendFileMessage::permission_denied"), k.abrupt("return");
            case 3:
              if (i) {
                k.next = 6;
                break;
              }
              return this.logger.error("sendFileMessage::required_argument_file_can_not_be_empty"), k.abrupt("return");
            case 6:
              return k.prev = 6, d = pt(), k.next = 10, d.getPresignedUrls(i.name, l(this, z)[z].config.viewType);
            case 10:
              return h = k.sent, v = h.getLocation, f = h.putLocation, k.next = 15, d.uploadFile(i, f);
            case 15:
              l(this, $e)[$e].editMessage(a, JSON.stringify({ link: v, name: i.name, size: "size" in i ? i.size : 0 }), Pt.FILE, s), k.next = 21;
              break;
            case 18:
              throw k.prev = 18, k.t0 = k.catch(6), new U("Error editing file message.", "0500", this.logger);
            case 21:
            case "end":
              return k.stop();
          }
      }, n, this, [[6, 18]]);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "editMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              c.t0 = i.type, c.next = c.t0 === "text" ? 3 : c.t0 === "image" ? 5 : c.t0 === "file" ? 7 : 9;
              break;
            case 3:
              return this.editTextMessage(a, i.message, s), c.abrupt("break", 11);
            case 5:
              return this.editImageMessage(a, i.image, s), c.abrupt("break", 11);
            case 7:
              return this.editFileMessage(a, i.file, s), c.abrupt("break", 11);
            case 9:
              return this.logger.error("editMessage::message_type_not_supported", { chat: { messageType: i.type } }), c.abrupt("break", 11);
            case 11:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "deleteMessage",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        var s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                if (((s = l(this, z)[z].permissions) === null || s === void 0 || (s = s.chatMessage) === null || s === void 0 ? void 0 : s.canDelete) !== "NONE") {
                  c.next = 2;
                  break;
                }
                throw new U("Not permitted to delete messages", "0501");
              case 2:
                l(this, $e)[$e].deleteMessage(a, i);
              case 3:
              case "end":
                return c.stop();
            }
        }, n, this);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Returns an array of messages sent by a specific userId.
    * @param userId The user id of the user that sent the message.
    */
  }, {
    key: "getMessagesByUser",
    value: function(r) {
      return this.messages.filter(function(n) {
        return n.userId === r;
      });
    }
    /**
    * Returns an array of 'text', 'image' or 'file' messages.
    * @param type 'text', 'image', or 'file'.
    */
  }, {
    key: "getMessagesByType",
    value: function(r) {
      return this.messages.filter(function(n) {
        return n.type === r;
      });
    }
    /**
    * Pins a chat message
    * @param id ID of the message to be pinned
    */
  }, { key: "pin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (l(this, io)[io]) {
                u.next = 2;
                break;
              }
              throw new U("Can`t pin message without joining room", "0505");
            case 2:
              if (l(this, z)[z].permissions.pinParticipant) {
                u.next = 4;
                break;
              }
              throw new U("You do not have permission to pin messages.", "0501");
            case 4:
              if (i = this.messages.find(function(c) {
                return c.id === a;
              }), !i) {
                u.next = 8;
                break;
              }
              return l(this, $e)[$e].setPinState(i, !0), u.abrupt("return");
            case 8:
              throw new U("No message found with id: ".concat(a), "0504");
            case 9:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "unpin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (l(this, io)[io]) {
                u.next = 2;
                break;
              }
              throw new U("Can`t unpin message without joining room", "0505");
            case 2:
              if (l(this, z)[z].permissions.pinParticipant) {
                u.next = 4;
                break;
              }
              throw new U("You do not have permission to unpin messages.", "0501");
            case 4:
              if (i = this.messages.find(function(c) {
                return c.id === a;
              }), !i) {
                u.next = 8;
                break;
              }
              return l(this, $e)[$e].setPinState(i, !1), u.abrupt("return");
            case 8:
              throw new U("No message found with id: ".concat(a), "0504");
            case 9:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getMessages", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              return u = h.length > 3 && h[3] !== void 0 ? h[3] : 0, c = h.length > 4 && h[4] !== void 0 ? h[4] : void 0, f.next = 4, l(this, $e)[$e].getChatMessagesPaginated(a, i, s, u, c);
            case 4:
              return d = f.sent, f.abrupt("return", { messages: d.messages.map(function(g) {
                return Un.formatSocketPeerMessage(g);
              }), next: d.next });
            case 6:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "createChannel", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d, h, v = arguments;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              if (u = v.length > 2 && v[2] !== void 0 ? v[2] : {}, c = (s = l(this, z)[z].permissions) === null || s === void 0 ? void 0 : s.chatChannel, !c) {
                g.next = 9;
                break;
              }
              if (c.canCreate !== "NONE") {
                g.next = 5;
                break;
              }
              throw new U("Not permitted to create channels", "0501");
            case 5:
              if (!(u.visibility === "public" && !(c.canCreate === "PUBLIC" || c.canCreate === "ALL"))) {
                g.next = 7;
                break;
              }
              throw new U("Not permitted to create public channels", "0501");
            case 7:
              if (!(u.visibility === "private" && !(c.canCreate === "PRIVATE" || c.canCreate === "ALL"))) {
                g.next = 9;
                break;
              }
              throw new U("Not permitted to create private channels", "0501");
            case 9:
              if (!(!a || a.trim().length === 0)) {
                g.next = 11;
                break;
              }
              throw new U("channel name cannot be empty.", "0510");
            case 11:
              return d = Se(/* @__PURE__ */ new Set([].concat(Se(i), [l(this, z)[z].userId]))), g.next = 14, l(this, Kn)[Kn].createChannel(a.trim(), d, u.displayPictureUrl, u.visibility, u.isDirectMessage);
            case 14:
              return h = g.sent, g.abrupt("return", h);
            case 16:
            case "end":
              return g.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateChannel", value: function(r, n) {
    var a, i, s, u, c, d = this.channels.find(function(f) {
      return f.id === r;
    }), h = (a = l(this, z)[z].permissions) === null || a === void 0 ? void 0 : a.chatChannel;
    if (h) {
      if (h.canUpdate === "NONE")
        throw new U("Not permitted to update channels", "0501");
      if (d.visibility === "public" && !(h.canUpdate === "PUBLIC" || h.canUpdate === "ALL"))
        throw new U("Not permitted to update public channels", "0501");
      if (d.visibility === "private" && !(h.canUpdate === "PRIVATE" || h.canUpdate === "ALL"))
        throw new U("Not permitted to update private channels", "0501");
    }
    var v = { memberIds: (i = n.memberIds) !== null && i !== void 0 ? i : d.memberIds, displayName: (s = n.displayName) !== null && s !== void 0 ? s : d.displayName, displayPictureUrl: (u = n.displayPictureUrl) !== null && u !== void 0 ? u : d.displayPictureUrl, visibility: (c = n.visibility) !== null && c !== void 0 ? c : d.visibility };
    return l(this, Kn)[Kn].updateChannel(r, v);
  } }, { key: "sendMessageToChannel", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return s = u.length > 2 && u[2] !== void 0 ? u[2] : {}, d.abrupt("return", this.sendMessageInternal(a, null, i, s));
            case 2:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getChannelMembers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", l(this, Kn)[Kn].getChannelMembers(a));
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "searchMessages", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (i = u.length > 1 && u[1] !== void 0 ? u[1] : {}, l(this, oa)[oa].getValue("flagsmith").hasFeature(me.FEAT_CHAT_SDK_SEARCH)) {
                d.next = 3;
                break;
              }
              throw new U("searchMessages is temporarily disabled!", "0506");
            case 3:
              return d.next = 5, l(this, $e)[$e].searchMessages(a, i);
            case 5:
              return s = d.sent, d.abrupt("return", s.map(Un.formatSocketPeerMessage));
            case 7:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "markLastReadMessage",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        var s, u;
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                return d.next = 2, l(this, $e)[$e].markLastReadMessage(a, i);
              case 2:
                s = this.channels.find(function(h) {
                  return h.id === a;
                }), s && (u = $($({}, s), {}, { unreadCount: 0 }), this.channels = this.channels.map(function(h) {
                  return h.id === a ? u : h;
                }), this.emit("channelMessageUpdate", u));
              case 4:
              case "end":
                return d.stop();
            }
        }, n, this);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Returns an array of pinned messages.
    */
  }, { key: "pinned", get: function() {
    return this.messages.filter(function(r) {
      return r.pinned;
    });
  } }]);
}(an));
function fI() {
  return l(this, oa)[oa].getValue("connectionHandler");
}
function gI() {
  return l(this, Fl)[Fl].socketJoined === !0;
}
ft([O.trace("Chat.sendTextMessage"), Lt(Nl)], tt.prototype, "sendTextMessage", 1);
ft([O.trace("Chat.sendImageMessage"), Lt({ maxInvocations: 20, period: 60 })], tt.prototype, "sendImageMessage", 1);
ft([O.trace("Chat.sendFileMessage"), Lt({ maxInvocations: 20, period: 60 })], tt.prototype, "sendFileMessage", 1);
ft([O.trace("Chat.sendMessage"), Lt({ maxInvocations: 180, period: 60 })], tt.prototype, "sendMessage", 1);
ft([O.trace("Chat.editTextMessage")], tt.prototype, "editTextMessage", 1);
ft([O.trace("Chat.editImageMessage")], tt.prototype, "editImageMessage", 1);
ft([O.trace("Chat.editFileMessage")], tt.prototype, "editFileMessage", 1);
ft([O.trace("Chat.editMessage")], tt.prototype, "editMessage", 1);
ft([O.trace("Chat.deleteMessage")], tt.prototype, "deleteMessage", 1);
ft([O.trace("Chat.createChannel")], tt.prototype, "createChannel", 1);
ft([O.trace("Chat.updateChannel")], tt.prototype, "updateChannel", 1);
ft([O.trace("Chat.sendMessageToChannel")], tt.prototype, "sendMessageToChannel", 1);
ft([O.trace("Chat.getChannelMembers")], tt.prototype, "getChannelMembers", 1);
ft([O.trace("Chat.searchMessages")], tt.prototype, "searchMessages", 1);
ft([O.trace("Chat.markLastReadMessage")], tt.prototype, "markLastReadMessage", 1);
tt = ft([vt("0500")], tt);
var mI = Object.defineProperty, yI = Object.getOwnPropertyDescriptor, kI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? yI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && mI(e, r, a), a;
}, Es = (dn = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t, e, r, n, a) {
    w(this, o), this.chat = void 0, this.chatSocketHandler = void 0, this.chatChannelSocketHandler = void 0, this.self = void 0, Object.defineProperty(this, dn, { writable: !0, value: void 0 }), l(this, dn)[dn] = t, this.chatSocketHandler = e, this.chatChannelSocketHandler = r, this.chat = new tt(t, e, r, n, a), this.self = n, this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, dn)[dn].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, dn)[dn].getValue("logger");
  } }, { key: "getChatMessages", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!(this.self.config.viewType === "LIVESTREAM" || this.self.config.viewType === "CHAT" || l(this, dn)[dn].getValue("flagsmith").hasFeature(me.FEAT_PAGINATED_CHAT))) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              return s.next = 4, this.chatSocketHandler.getChatMessages();
            case 4:
              if (n = s.sent, n != null && n.payload) {
                s.next = 7;
                break;
              }
              return s.abrupt("return");
            case 7:
              a = og.fromBinary(n.payload).messages, this.chat.messages = a.map(function(u) {
                return Es.formatSocketPeerMessage(u);
              });
            case 9:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, dn)[dn].getValue("peerSessionStore").on(j.SOCKET_SERVICE_ROOM_JOINED, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              e.getChatMessages();
            case 1:
            case "end":
              return a.stop();
          }
      }, r);
    }))), this.chatSocketHandler.on(Rr.sendMessageToRoom, function(r) {
      var n = Es.formatSocketPeerMessage(r.message);
      if (!n.channelId)
        e.chat.messages = [].concat(Se(e.chat.messages), [n]);
      else {
        var a = e.chat.channels.find(function(i) {
          return i.id === n.channelId;
        });
        a && (a.latestMessage = n, a.unreadCount += 1, e.chat.emit("channelMessageUpdate", a));
      }
      e.chat.emit("chatUpdate", { action: "add", message: n, messages: e.chat.messages });
    }), this.chatSocketHandler.on(Rr.sendMessageToPeers, function(r) {
      var n = Es.formatSocketPeerMessage(r.message);
      e.chat.messages = [].concat(Se(e.chat.messages), [n]), e.chat.emit("chatUpdate", { action: "add", message: n, messages: e.chat.messages });
    }), this.chatSocketHandler.on(Rr.editMessage, function(r) {
      var n = Es.formatSocketPeerMessage(r.message);
      if (n.channelId) {
        e.chat.emit("chatUpdate", { action: "edit", message: n, messages: e.chat.messages });
        return;
      }
      var a = e.chat.messages.findIndex(function(i) {
        return i.id === n.id;
      });
      a !== -1 && (e.chat.messages[a] = n, e.chat.emit("chatUpdate", { action: "edit", message: n, messages: e.chat.messages }));
    }), this.chatSocketHandler.on(Rr.deleteMessage, function(r) {
      if (r.channelId) {
        e.chat.emit("chatUpdate", { action: "delete", message: { id: r.chatId, channelId: r.channelId }, messages: e.chat.messages });
        return;
      }
      var n = e.chat.messages.findIndex(function(u) {
        return u.id === r.chatId;
      });
      if (n !== -1) {
        var a = e.chat.messages.splice(n, 1), i = He(a, 1), s = i[0];
        e.chat.emit("chatUpdate", { action: "delete", message: s, messages: e.chat.messages });
      }
    }), this.chatChannelSocketHandler.on(As.createChatChannel, function(r) {
      var n = He(r.chatChannels, 1), a = n[0], i = zs.formatChannel(a);
      e.chat.channels.push(i), e.chat.emit("channelCreate", i);
    }), this.chatSocketHandler.on(Rr.pinMessage, function(r) {
      var n = e.chat.messages.findIndex(function(i) {
        return i.id === r.chatId;
      });
      if (n !== -1) {
        var a = e.chat.messages[n];
        a.pinned = r.pinned, e.chat.messages[n] = a, e.chat.emit("chatUpdate", { action: "edit", message: a, messages: e.chat.messages });
      }
    }), this.chatChannelSocketHandler.on(As.updateChatChannel, function(r) {
      var n = He(r.chatChannels, 1), a = n[0], i = zs.formatChannel(a);
      e.chat.channels = e.chat.channels.map(function(s) {
        return s.id === i.id ? i : s;
      }), e.chat.emit("channelUpdate", i);
    });
  } }], [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u) {
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.abrupt("return", new Es(n, a, i, s, u));
            case 1:
            case "end":
              return d.stop();
          }
      }, r);
    }));
    function e(r, n, a, i, s) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "formatMessage",
    value: function(e) {
      return $($({}, e), {}, { time: new Date(e.time), type: vI[e.type] });
    }
    /**
    * @access private
    * This function formates the chat message coming from
    * socket service. This is not meant for external use.
    */
  }, { key: "formatSocketPeerMessage", value: function(e) {
    var r = e.createdAt * 1e3, n = { displayName: e.displayName, id: e.chatId, time: r, timeMs: e.createdAtMs, type: e.payloadType, isEdited: e.isEdited, userId: e.userId, targetUserIds: e.targetUserIds, channelId: e.channelId, channelIndex: e.channelIndex, message: "", link: "", name: "", html: "", images: [], videos: [], files: [], size: 0, pinned: e.pinned };
    switch (n.type) {
      case Pt.TEXT: {
        n.message = e.payload;
        break;
      }
      case Pt.IMAGE: {
        n.link = e.payload;
        break;
      }
      case Pt.FILE: {
        var a = JSON.parse(e.payload), i = a.link, s = a.name, u = a.size;
        n.link = i, n.name = s, n.size = u;
        break;
      }
      case Pt.CUSTOM: {
        var c = JSON.parse(e.payload), d = c.html, h = c.images, v = c.message, f = c.videos, g = c.files;
        n.message = v, n.html = d, n.images = h, n.videos = f, n.files = g;
        break;
      }
    }
    return Es.formatMessage(n);
  } }]);
}()), Un = Es;
kI([O.trace("ChatController.setupEvents")], Un.prototype, "setupEvents", 1);
var bI = Object.defineProperty, TI = Object.getOwnPropertyDescriptor, wI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? TI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && bI(e, r, a), a;
}, Ld = (Hl = /* @__PURE__ */ S("connectionHandler"), pl = /* @__PURE__ */ S("socketJoined"), Za = /* @__PURE__ */ S("self"), xa = /* @__PURE__ */ S("pollSocketHandler"), So = /* @__PURE__ */ S("context"), /* @__PURE__ */ function(o) {
  function t(e, r, n) {
    var a;
    w(this, t);
    var i = e.getValue("logger");
    return a = R(this, t, [i]), Object.defineProperty(a, pl, { get: SI, set: void 0 }), Object.defineProperty(a, Hl, { get: PI, set: void 0 }), a.items = void 0, Object.defineProperty(a, Za, { writable: !0, value: void 0 }), Object.defineProperty(a, xa, { writable: !0, value: void 0 }), Object.defineProperty(a, So, { writable: !0, value: void 0 }), l(a, So)[So] = e, l(a, Za)[Za] = r, l(a, xa)[xa] = n, a.items = [], a;
  }
  return A(t, o), P(t, [{ key: "create", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c = arguments;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (s = c.length > 2 && c[2] !== void 0 ? c[2] : !1, u = c.length > 3 && c[3] !== void 0 ? c[3] : !1, l(this, pl)[pl]) {
                h.next = 4;
                break;
              }
              throw new U("Can't create polls without joining room", "0705");
            case 4:
              if (l(this, Za)[Za].permissions.polls.canCreate) {
                h.next = 7;
                break;
              }
              return this.logger.error("Polls::create::permission_denied"), h.abrupt("return");
            case 7:
              if (!(!a || !i)) {
                h.next = 10;
                break;
              }
              return this.logger.error("Polls::question_and_options_can_not_be_empty", { polls: { hasQuestion: !!a, optionsLength: i == null ? void 0 : i.length } }), h.abrupt("return");
            case 10:
              if (!(i.length < 2)) {
                h.next = 13;
                break;
              }
              return this.logger.error("Polls::there_must_be_at_least_two_options", { polls: { hasQuestion: !!a, optionsLength: i.length } }), h.abrupt("return");
            case 13:
              return h.next = 15, l(this, xa)[xa].createPoll(a, i, s, u);
            case 15:
            case "end":
              return h.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "vote", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (l(this, Za)[Za].permissions.polls.canVote) {
                u.next = 3;
                break;
              }
              return this.logger.error("Polls::vote::permission_denied"), u.abrupt("return");
            case 3:
              return u.next = 5, l(this, xa)[xa].votePoll(a, i);
            case 5:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an));
function PI() {
  return l(this, So)[So].getValue("connectionHandler");
}
function SI() {
  var o;
  return ((o = l(this, Hl)[Hl]) === null || o === void 0 ? void 0 : o.socketJoined) === !0;
}
Ld = wI([vt("0700")], Ld);
var EI = Object.defineProperty, CI = Object.getOwnPropertyDescriptor, RI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? CI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && EI(e, r, a), a;
}, bo = (pn = /* @__PURE__ */ S("context"), ei = /* @__PURE__ */ S("self"), zn = /* @__PURE__ */ S("pollSocketHandler"), /* @__PURE__ */ function() {
  function o(t, e, r) {
    w(this, o), this.polls = void 0, Object.defineProperty(this, pn, { writable: !0, value: void 0 }), Object.defineProperty(this, ei, { writable: !0, value: void 0 }), Object.defineProperty(this, zn, { writable: !0, value: void 0 }), this.polls = new Ld(t, e, r), l(this, ei)[ei] = e, l(this, pn)[pn] = t, l(this, zn)[zn] = r, this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, pn)[pn].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, pn)[pn].getValue("logger");
  } }, { key: "canViewPolls", value: function() {
    return l(this, ei)[ei].permissions.polls.canView;
  } }, { key: "setupEvents", value: function() {
    var e = this, r = { [$a.createPoll]: function(i) {
      i.poll && e.updatePoll(bo.formatSocketServicePoll(i.poll));
    }, [$a.updatePoll]: function(i) {
      i.poll && e.updatePoll(bo.formatSocketServicePoll(i.poll));
    }, [$a.votePoll]: function(i) {
      i.poll && e.updatePoll(bo.formatSocketServicePoll(i.poll));
    } }, n = function() {
      l(e, pn)[pn].getValue("peerSessionStore").on(j.SOCKET_SERVICE_ROOM_JOINED, function() {
        e.getPolls();
      }), Object.keys(r).map(Number).forEach(function(s) {
        l(e, zn)[zn].on(s, r[s]);
      });
    }, a = function() {
      l(e, pn)[pn].getValue("peerSessionStore").on(j.SOCKET_SERVICE_ROOM_JOINED, function() {
        e.getPolls();
      }), Object.keys(r).map(Number).forEach(function(s) {
        l(e, zn)[zn].removeListeners(s);
      });
    };
    l(this, ei)[ei].permissions.on("permissionsUpdate", /* @__PURE__ */ function() {
      var i = m(/* @__PURE__ */ p().mark(function s(u) {
        var c;
        return p().wrap(function(h) {
          for (; ; )
            switch (h.prev = h.next) {
              case 0:
                if (u != null && u.polls) {
                  h.next = 2;
                  break;
                }
                return h.abrupt("return");
              case 2:
                if (!(u != null && (c = u.polls) !== null && c !== void 0 && c.canView)) {
                  h.next = 8;
                  break;
                }
                return h.next = 5, e.getPolls();
              case 5:
                n(), h.next = 10;
                break;
              case 8:
                e.polls.items = [], a();
              case 10:
              case "end":
                return h.stop();
            }
        }, s);
      }));
      return function(s) {
        return i.apply(this, arguments);
      };
    }()), this.canViewPolls() && n();
  } }, { key: "updatePoll", value: function(e) {
    if (this.canViewPolls()) {
      var r = this.polls.items.findIndex(function(a) {
        return a.id === e.id;
      });
      if (r > -1) {
        var n = JSON.stringify(this.polls.items[r]);
        this.polls.items[r] = e, n !== JSON.stringify(e) && this.polls.emit("pollsUpdate", { polls: this.polls.items, newPoll: !1 });
        return;
      }
      this.polls.items = [].concat(Se(this.polls.items), [e]), this.polls.emit("pollsUpdate", { polls: this.polls.items, newPoll: !0 });
    }
  } }, { key: "getPolls", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, l(this, zn)[zn].getPolls();
            case 2:
              if (n = u.sent, n != null && n.payload) {
                u.next = 5;
                break;
              }
              return u.abrupt("return");
            case 5:
              a = LA.fromBinary(n.payload), i = a.polls, this.polls.items = i.map(function(c) {
                return bo.formatSocketServicePoll(c);
              });
            case 7:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }], [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.abrupt("return", new bo(n, a, i));
            case 1:
            case "end":
              return u.stop();
          }
      }, r);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "formatSocketServicePoll", value: function(e) {
    var r = e.options.map(function(n) {
      return { count: n.count, text: n.text, votes: n.votes.map(function(a) {
        return { id: a.userId, name: a.name };
      }) };
    });
    return { anonymous: e.anonymous, createdBy: e.createdBy, createdByUserId: e.createdByUserId, hideVotes: e.hideVotes, id: e.pollId, options: r, question: e.question, voted: e.votes };
  } }]);
}()), pg = bo;
RI([O.trace("PollController.setupEvents")], pg.prototype, "setupEvents", 1);
var AI = Object.defineProperty, II = Object.getOwnPropertyDescriptor, MI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? II(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && AI(e, r, a), a;
}, hg = /* @__PURE__ */ function(o) {
  return o[o.User = 0] = "User", o[o.Meeting = 1] = "Meeting", o;
}(hg || {}), $d = (Ti = /* @__PURE__ */ S("context"), so = /* @__PURE__ */ S("connectionHandler"), Yn = /* @__PURE__ */ S("self"), oo = /* @__PURE__ */ S("roomSocketHandler"), /* @__PURE__ */ function(o) {
  function t(e, r, n, a, i) {
    var s;
    w(this, t);
    var u = e.getValue("logger");
    return s = R(this, t, [u]), Object.defineProperty(s, so, { get: _I, set: void 0 }), s.selfActiveTab = void 0, s.broadcastTabChanges = void 0, Object.defineProperty(s, Ti, { writable: !0, value: void 0 }), Object.defineProperty(s, Yn, { writable: !0, value: void 0 }), Object.defineProperty(s, oo, { writable: !0, value: void 0 }), s.viewType = void 0, s.meetingStartedTimestamp = void 0, s.meetingTitle = void 0, s.sessionId = void 0, l(s, Ti)[Ti] = e, l(s, Yn)[Yn] = r, s.viewType = n, l(s, oo)[oo] = a, s.meetingTitle = i, s.broadcastTabChanges = r.permissions.canSpotlight, s;
  }
  return A(t, o), P(t, [{ key: "socketState", get: function() {
    return l(this, so)[so].socketState;
  } }, { key: "mediaState", get: function() {
    return l(this, so)[so].mediaState;
  } }, {
    key: "meetingId",
    get: function() {
      return l(this, Ti)[Ti].getValue("meetingId");
    }
    /**
    * Sets current user as broadcasting tab changes
    * @param broadcastTabChanges
    */
  }, {
    key: "setBroadcastTabChanges",
    value: function(r) {
      if (!l(this, Yn)[Yn].permissions.canSpotlight)
        throw this.logger.error("Spotlight::setSpotlighted::permission_denied"), new U("User does not have permission to toggle spotlight", "0801");
      this.broadcastTabChanges = r, this.emit("broadcastTabChangesUpdate", this.broadcastTabChanges), this.broadcastTabChanges && this.assertActiveTabToRoom();
    }
    /**
    * Sets current active tab for user
    * @param spotlightTab
    */
  }, { key: "setSelfActiveTab", value: function(r, n) {
    var a;
    this.logger.info("Spotlight::setActiveTab", { spotlight: { currentTab: { id: r.id, type: r.type } } }), this.selfActiveTab = r, n === 0 && this.emit("selfTabUpdate", r), (a = l(this, Yn)[Yn].permissions) !== null && a !== void 0 && a.canSpotlight && this.broadcastTabChanges && n === 0 && this.assertActiveTabToRoom();
  } }, { key: "assertActiveTabToRoom", value: function() {
    l(this, oo)[oo].broadcastMessage("spotlight", { userId: l(this, Yn)[Yn].userId, currentTab: this.selfActiveTab });
  } }]);
}(an));
function _I() {
  return l(this, Ti)[Ti].getValue("connectionHandler");
}
$d = MI([vt("0800")], $d);
function OI(o) {
  var t = "", e = [""], r = [e], n = 0, a = 0, i = !0, s, u = Fn(o), c;
  try {
    for (u.s(); !(c = u.n()).done; )
      s = c.value, s === '"' ? (i && s === t && (e[n] += s), i = !i) : s === "," && i ? s = e[++n] = "" : s === `
` && i ? (t === "\r" && (e[n] = e[n].slice(0, -1)), e = r[++a] = [s = ""], n = 0) : e[n] += s, t = s;
  } catch (d) {
    u.e(d);
  } finally {
    u.f();
  }
  return r;
}
var DI = Object.defineProperty, LI = Object.getOwnPropertyDescriptor, vg = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? LI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && DI(e, r, a), a;
}, Mi = (uo = /* @__PURE__ */ S("context"), /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    w(this, t);
    var n = e.getValue("logger");
    return r = R(this, t, [n]), r.transcripts = void 0, Object.defineProperty(r, uo, { writable: !0, value: void 0 }), l(r, uo)[uo] = e, r.transcripts = [], r;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, uo)[uo].getValue("telemetry");
    }
  ) }, { key: "getActiveTranscript", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.prev = 0, a = pt(), c.next = 4, a.getActiveTranscript();
            case 4:
              i = c.sent, s = i.transcript, this.transcripts = Mi.parseTranscripts(s), c.next = 11;
              break;
            case 9:
              c.prev = 9, c.t0 = c.catch(0);
            case 11:
            case "end":
              return c.stop();
          }
      }, n, this, [[0, 9]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onTranscript", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = this.transcripts.filter(function(h) {
                var v = h.peerId;
                return v === a.peerId;
              }), !(s != null && (i = s.at(-1)) !== null && i !== void 0 && i.isPartialTranscript)) {
                d.next = 7;
                break;
              }
              return u = s.at(-1), u.transcript = a.transcript, u.isPartialTranscript = a.isPartialTranscript, this.emit("transcript", u), d.abrupt("return");
            case 7:
              this.transcripts = [].concat(Se(this.transcripts), [a]), this.emit("transcript", a);
            case 9:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }], [{
    key: "init",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        var s, u;
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                s = new Mi(a), u = a.getValue("logger");
                try {
                  i && s.getActiveTranscript();
                } catch (h) {
                  u.error("Error fetching active transcriptions ", h);
                }
                return d.abrupt("return", s);
              case 4:
              case "end":
                return d.stop();
            }
        }, n);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Parse a single line transcript
    */
  }, {
    key: "parseTranscript",
    value: function(r) {
      var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
      if (r) {
        var a = OI(r), i = He(a, 1), s = He(i[0], 6), u = s[0], c = s[1], d = s[2], h = s[3], v = s[4], f = s[5], g = { id: Js(), name: v, peerId: c, userId: d, customParticipantId: h, transcript: f, isPartialTranscript: n, date: new Date(parseInt(u, 10) * 1e3) };
        return g;
      }
    }
    /**
    * Parse a multi-line transcript
    */
  }, { key: "parseTranscripts", value: function(r) {
    return r ? r.split(`
`).map(function(n) {
      return Mi.parseTranscript(n, !1);
    }).filter(Boolean) : [];
  } }]);
}(an));
vg([O.trace("Ai.getActiveTranscript")], Mi.prototype, "getActiveTranscript", 1);
Mi = vg([vt("0000")], Mi);
var $I = Object.defineProperty, NI = Object.getOwnPropertyDescriptor, VI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? NI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && $I(e, r, a), a;
}, fg = (hn = /* @__PURE__ */ S("self"), ri = /* @__PURE__ */ S("roomSocketHandler"), Ir = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t, e, r, n, a, i) {
    w(this, o), this.meta = void 0, this.ai = void 0, Object.defineProperty(this, hn, { writable: !0, value: void 0 }), Object.defineProperty(this, ri, { writable: !0, value: void 0 }), this.aiSocketHandler = void 0, Object.defineProperty(this, Ir, { writable: !0, value: void 0 }), l(this, Ir)[Ir] = t, this.meta = new $d(t, e, e.config.viewType, r, i), this.ai = n, l(this, hn)[hn] = e, l(this, ri)[ri] = r, this.aiSocketHandler = a, e.config.viewType !== Dt.Chat && this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Ir)[Ir].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, Ir)[Ir].getValue("logger");
  } }, { key: "conditionallySetActiveTab", value: function(e) {
    var r;
    e != null && e.currentTab && ((r = this.meta.selfActiveTab) === null || r === void 0 ? void 0 : r.id) !== e.currentTab.id && (this.meta.setSelfActiveTab(e.currentTab, hg.Meeting), this.meta.emit("activeTabUpdate", e.currentTab));
  } }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, Ir)[Ir].getValue("peerSessionStore").on(j.TRANSPORT_STATE_UPDATE, function(r) {
      e.meta.emit("mediaConnectionUpdate", r);
    }), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.SOCKET_STATE_UPDATE, function(r) {
      e.meta.emit("socketConnectionUpdate", r);
    }), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.ROOM_STATE, function(r) {
      var n = r.createdAt, a = r.roomUuid, i = e.meta.meetingStartedTimestamp;
      if (a && (e.meta.sessionId = a), n && !i) {
        var s = new Date(n * 1e3);
        e.meta.meetingStartedTimestamp = s, e.meta.emit("meetingStartTimeUpdate", { meetingStartedTimestamp: e.meta.meetingStartedTimestamp });
      }
    }), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.PRODUCER_SCORE_UPDATE, function(r) {
      var n = r.score;
      n < 5 && e.meta.emit("poorConnection", { score: n });
    }), l(this, hn)[hn].permissions.canSpotlight && (this.logger.info("MetaController::Asserting Spotlight"), this.meta.selfActiveTab && l(this, ri)[ri].broadcastMessage("spotlight", { userId: l(this, hn)[hn].userId, currentTab: this.meta.selfActiveTab })), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.PEER_JOINED_INTERNAL, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                l(e, hn)[hn].permissions.canSpotlight && e.meta.selfActiveTab && l(e, ri)[ri].broadcastToPeers("spotlight", [a.id], { userId: l(e, hn)[hn].userId, currentTab: e.meta.selfActiveTab });
              case 1:
              case "end":
                return s.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.ROOM_MESSAGE, function(r) {
      var n, a, i;
      if ("type" in r) {
        if (r.type !== "spotlight")
          return;
        i = $($({}, r), r.payload);
      } else if ("roomMessageType" in r) {
        if (r.roomMessageType !== "spotlight")
          return;
        i = r;
      } else
        return;
      e.logger.info("Spotlight Assertion Received", { spotlight: { spotlighter: { id: i.userId }, currentTab: { id: (n = i.currentTab) === null || n === void 0 ? void 0 : n.id, type: (a = i.currentTab) === null || a === void 0 ? void 0 : a.type } } }), e.conditionallySetActiveTab(i);
    }), l(this, Ir)[Ir].getValue("peerSessionStore").on(j.MESSAGE, function(r) {
      var n, a, i;
      if ("type" in r) {
        if (r.type !== "spotlight")
          return;
        i = $($({}, r), r.payload);
      } else if ("roomMessageType" in r) {
        if (r.roomMessageType !== "spotlight")
          return;
        i = r;
      } else
        return;
      e.logger.info("Spotlight Assertion Received", { spotlight: { spotlighter: { id: i.userId }, currentTab: { id: (n = i.currentTab) === null || n === void 0 ? void 0 : n.id, type: (a = i.currentTab) === null || a === void 0 ? void 0 : a.type } } }), e.conditionallySetActiveTab(i);
    }), this.aiSocketHandler.on(Y.transcript, function(r) {
      var n = r.meetingId, a = r.transcript, i = r.isPartial, s;
      try {
        s = Mi.parseTranscript(a, i);
      } catch (v) {
        e.logger.error("Failed to parse transcript: ".concat(a), v);
      }
      if (!s) {
        e.logger.warn("Received empty transcript data");
        return;
      }
      e.ai.onTranscript(s), e.meta.emit("transcript", s);
      var u = s, c = u.peerId, d = u.name, h = u.transcript;
      e.logger.debug("".concat(n, " Received transcript for peer ").concat(c, " - ").concat(d, ": ").concat(h));
    });
  } }], [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u) {
      var c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return h.next = 2, Mi.init(n, a.permissions.transcriptionEnabled);
            case 2:
              return c = h.sent, h.abrupt("return", new fg(n, a, i, c, s, u));
            case 4:
            case "end":
              return h.stop();
          }
      }, r);
    }));
    function e(r, n, a, i, s) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}()), gg = fg;
VI([O.trace("MetaController.setupEvents")], gg.prototype, "setupEvents", 1);
var Xo = {}, Ka = {
  /**
  * Lock a method to prevent concurrency
  * @param config - configuration for the lock
  * @param config.methodName - config.methodName Name of method to expose in logs
  *	and to the user (if necessary).
  * @param config.lockName - Unique string to differentiate the method from others.
  * @param config.timeout - Release lock in given milliseconds if method doesn't get resolved.
  *
  *	Do not use common function names such as joinRoom as the lockName,
  *	instead use filename.functionname, if a suitable name couldn't be found.
  * @returns locked instance.
  *
  * It will throw error with name `UnsupportedConcurrentMethodExecution`,
  *	if lock couldn't be acquired.
  *
  * Note:
  *	Make sure that the methodName is explanatory on its own, if exposed to end users.
  * Eg: `meeting.joinRoom` is a much better choice than `joinRoom`.
  */
  executeWithLock(o) {
    var t = o.methodName, e = o.lockName, r = o.timeout;
    return function(n, a, i) {
      var s = i.value;
      return i.value = function() {
        for (var c, d, h = arguments.length, v = new Array(h), f = 0; f < h; f++)
          v[f] = arguments[f];
        var g = (c = (this === null || this === void 0 ? void 0 : this.peerId) || ((d = v[0]) === null || d === void 0 ? void 0 : d.authToken)) !== null && c !== void 0 ? c : "", k = "".concat(e, "-").concat(g), y = this === null || this === void 0 ? void 0 : this.logger;
        if (Xo[k]) {
          var b = new Error("Unsupported concurrent calls on method: ".concat(t, "."));
          throw b.name = "UnsupportedConcurrentMethodExecution", y == null || y.error("Locker::UnsupportedConcurrentMethodExecution", { error: { stack: b.stack }, locker: { methodName: t, lockName: k } }), b;
        }
        Xo[k] = !0;
        var C = setTimeout(function() {
          return delete Xo[k];
        }, r), T = s.apply(this, v);
        return Promise.resolve(T).then(function() {
          delete Xo[k], clearTimeout(C);
        }).catch(function() {
          delete Xo[k], clearTimeout(C);
        }), T;
      }, i;
    };
  }
}, UI = Object.defineProperty, jI = Object.getOwnPropertyDescriptor, ro = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? jI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && UI(e, r, a), a;
}, zr = /* @__PURE__ */ S("stageSocketHandler"), Yc = /* @__PURE__ */ S("roomSocketHandler"), oe = /* @__PURE__ */ S("self"), Zo = /* @__PURE__ */ S("participants"), mt = /* @__PURE__ */ S("stageRequests"), qe = /* @__PURE__ */ S("context"), xo = /* @__PURE__ */ S("roomNodeClient"), ls = /* @__PURE__ */ S("setStatus"), Oi = /* @__PURE__ */ function(o) {
  function t(e, r, n, a, i) {
    var s;
    w(this, t);
    var u = e.getValue("logger");
    return s = R(this, t, [u]), Object.defineProperty(s, ls, { value: HI }), Object.defineProperty(s, xo, { get: FI, set: void 0 }), Object.defineProperty(s, zr, { writable: !0, value: void 0 }), Object.defineProperty(s, Yc, { writable: !0, value: void 0 }), Object.defineProperty(s, oe, { writable: !0, value: void 0 }), Object.defineProperty(s, Zo, { writable: !0, value: void 0 }), Object.defineProperty(s, mt, { writable: !0, value: void 0 }), Object.defineProperty(s, qe, { writable: !0, value: void 0 }), l(s, qe)[qe] = e, l(s, zr)[zr] = a, l(s, Yc)[Yc] = i, l(s, oe)[oe] = r, l(s, Zo)[Zo] = n, l(s, mt)[mt] = [], s.setupEvents(), s;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, qe)[qe].getValue("telemetry");
    }
  ) }, { key: "status", get: function() {
    return l(this, qe)[qe].getValue("stageStatus");
  } }, { key: "setupEvents", value: function() {
    var r = this, n = {
      /**
      * NOTE(ishita1805): Update stageRequests when socket sends them.
      */
      [j.GET_STAGE_REQUESTS]: function() {
        var s = m(/* @__PURE__ */ p().mark(function u(c) {
          return p().wrap(function(h) {
            for (; ; )
              switch (h.prev = h.next) {
                case 0:
                  l(r, mt)[mt] = c;
                case 1:
                case "end":
                  return h.stop();
              }
          }, u);
        }));
        return function(u) {
          return s.apply(this, arguments);
        };
      }(),
      /**
      * NOTE(ishita1805): Update stageRequests when a peer
      * who has requested leaves/joins the meeting
      */
      [j.UPDATE_STAGE_REQUESTS]: function() {
        var s = m(/* @__PURE__ */ p().mark(function u(c) {
          var d, h, v, f;
          return p().wrap(function(k) {
            for (; ; )
              switch (k.prev = k.next) {
                case 0:
                  d = c.add, h = l(r, mt)[mt].length, v = r.getAccessRequests(), f = v.stageRequests, (d || f.length > h) && r.emit("newStageRequest", { count: f.length }), r.emit("stageAccessRequestUpdate", f);
                case 5:
                case "end":
                  return k.stop();
              }
          }, u);
        }));
        return function(u) {
          return s.apply(this, arguments);
        };
      }()
    }, a = function() {
      Object.entries(n).forEach(function(u) {
        var c = He(u, 2), d = c[0], h = c[1];
        l(r, qe)[qe].getValue("peerSessionStore").onAsync(d, h);
      });
    }, i = function() {
      Object.entries(n).forEach(function(u) {
        var c = He(u, 2), d = c[0], h = c[1];
        l(r, qe)[qe].getValue("peerSessionStore").removeListener(d, h);
      });
    };
    l(this, oe)[oe].permissions.on("permissionsUpdate", function(s) {
      var u = s.canAcceptProductionRequests;
      u !== void 0 && (l(r, oe)[oe].permissions.acceptStageRequests ? (a(), l(r, zr)[zr].getStageRequests()) : (i(), l(r, mt)[mt] = [], r.emit("stageAccessRequestUpdate", l(r, mt)[mt])));
    }), l(this, oe)[oe].permissions.acceptStageRequests && a();
  } }, { key: "getAccessRequests", value: function() {
    if (!l(this, oe)[oe].permissions.stageEnabled)
      throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
    if (!l(this, oe)[oe].permissions.acceptStageRequests)
      throw this.logger.error("Stage::get_access_request::permission_denied"), new U("You do not have permission to perform this action", "2001");
    var r = l(this, Zo)[Zo].joined.toArray().filter(function(n) {
      return n.stageStatus === "REQUESTED_TO_JOIN_STAGE";
    }).map(function(n) {
      return { displayName: n.name, userId: n.userId, peerId: n.id };
    });
    return l(this, mt)[mt] = r, { stageRequests: l(this, mt)[mt] };
  } }, { key: "requestAccess", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, oe)[oe].permissions.stageEnabled) {
                i.next = 3;
                break;
              }
              throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
            case 3:
              if (this.status === "OFF_STAGE") {
                i.next = 5;
                break;
              }
              throw new U("Unable to request access you are currently ".concat(this.status), "2006");
            case 5:
              if (l(this, oe)[oe].permissions.stageAccess !== te.Allowed) {
                i.next = 8;
                break;
              }
              return l(this, ls)[ls]("ACCEPTED_TO_JOIN_STAGE"), i.abrupt("return");
            case 8:
              l(this, zr)[zr].requestAccess(), l(this, ls)[ls]("REQUESTED_TO_JOIN_STAGE");
            case 10:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "cancelRequestAccess", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, oe)[oe].permissions.stageEnabled) {
                i.next = 3;
                break;
              }
              throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
            case 3:
              l(this, zr)[zr].cancelRequestAccess(), l(this, ls)[ls]("OFF_STAGE");
            case 5:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "grantAccess", value: function(r) {
    if (!l(this, oe)[oe].roomJoined)
      throw new U("Can`t grant for participant without joining room");
    if (!l(this, oe)[oe].permissions.stageEnabled)
      throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
    if (!l(this, oe)[oe].permissions.acceptStageRequests)
      throw this.logger.error("Stage::grant_access::permission_denied"), new U("You do not have permission to perform this action", "2001");
    return l(this, zr)[zr].grantAccess(r);
  } }, {
    key: "denyAccess",
    value: function(r) {
      if (!l(this, oe)[oe].roomJoined)
        throw new U("Can`t rejectRequestToJoinStage for participant without joining room", "2005");
      if (!l(this, oe)[oe].permissions.stageEnabled)
        throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
      if (!l(this, oe)[oe].permissions.acceptStageRequests)
        throw this.logger.error("Stage::deny_access::permission_denied"), new U("You do not have permission to perform this action", "2001");
      return l(this, zr)[zr].denyAccess(r);
    }
    /**
    * Returns the peerId of the current user
    */
  }, { key: "peerId", get: function() {
    return l(this, qe)[qe].getValue("peerId");
  } }, { key: "join", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = l(this, qe)[qe].getValue("viewType"), this.status !== "ON_STAGE") {
                s.next = 3;
                break;
              }
              throw new U("You are already on stage.", "2006");
            case 3:
              if (!(this.status !== "ACCEPTED_TO_JOIN_STAGE" || l(this, oe)[oe].permissions.stageAccess === te.NotAllowed)) {
                s.next = 5;
                break;
              }
              throw new U("Unable to join stage you are currently ".concat(this.status), "2006");
            case 5:
              return l(this, qe)[qe].setValue("stageStatus", "ON_STAGE", !1), s.next = 8, l(this, zr)[zr].joinStage();
            case 8:
              if (a !== Dt.Livestream) {
                s.next = 12;
                break;
              }
              return s.next = 11, l(this, qe)[qe].getValue("selfController").joinRoom();
            case 11:
              return s.abrupt("return");
            case 12:
              l(this, qe)[qe].notify("stageStatus"), l(this, oe)[oe].audioEnabled && l(this, xo)[xo].shareMic(l(this, oe)[oe].audioTrack), l(this, oe)[oe].videoEnabled && l(this, xo)[xo].shareWebcam(l(this, oe)[oe].videoTrack);
            case 15:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "leave",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                if (l(this, oe)[oe].permissions.stageEnabled) {
                  i.next = 3;
                  break;
                }
                throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
              case 3:
                if (this.status === "ON_STAGE" || this.status === "ACCEPTED_TO_JOIN_STAGE") {
                  i.next = 5;
                  break;
                }
                throw new U("Unable to leave stage you are currently ".concat(this.status), "2006");
              case 5:
                return l(this, oe)[oe].setIsPinned(!1), l(this, qe)[qe].setValue("stageStatus", "OFF_STAGE", !1), i.next = 9, l(this, zr)[zr].leaveStage(l(this, oe)[oe].userId);
              case 9:
                return i.prev = 9, i.next = 12, l(this, qe)[qe].getValue("peerSessionStore").emitAsync(j.LEAVE_MEDIA_ROOM, "stageLeft");
              case 12:
                i.next = 17;
                break;
              case 14:
                i.prev = 14, i.t0 = i.catch(9), this.logger.error("Stage::leave::emitAsync::failed", { error: i.t0 });
              case 17:
                l(this, qe)[qe].notify("stageStatus");
              case 18:
              case "end":
                return i.stop();
            }
        }, n, this, [[9, 14]]);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Method to kick a user off the stage
    *
    * `permissions.acceptStageRequests` privilege required
    */
  }, { key: "kick", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (l(this, oe)[oe].roomJoined) {
                s.next = 2;
                break;
              }
              throw new U("Can`t kick participant without joining room", "2005");
            case 2:
              if (l(this, oe)[oe].permissions.stageEnabled) {
                s.next = 5;
                break;
              }
              throw this.logger.error("Stage::stage_disabled"), new U("Stage is disabled", "2003");
            case 5:
              if (l(this, oe)[oe].permissions.acceptStageRequests) {
                s.next = 8;
                break;
              }
              throw this.logger.error("Stage::kick::permission_denied"), new U("You do not have permissions for kick", "2001");
            case 8:
              return s.abrupt("return", l(this, zr)[zr].kick(a));
            case 9:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an);
function FI() {
  return l(this, qe)[qe].getValue("roomNodeClient");
}
function HI(o) {
  return Nd.apply(this, arguments);
}
function Nd() {
  return Nd = m(/* @__PURE__ */ p().mark(function o(t) {
    return p().wrap(function(r) {
      for (; ; )
        switch (r.prev = r.next) {
          case 0:
            if (this.status !== t) {
              r.next = 2;
              break;
            }
            return r.abrupt("return");
          case 2:
            l(this, qe)[qe].setValue("stageStatus", t);
          case 3:
          case "end":
            return r.stop();
        }
    }, o, this);
  })), Nd.apply(this, arguments);
}
ro([O.trace("Stage.getStageRequests")], Oi.prototype, "getAccessRequests", 1);
ro([O.trace("Stage.requestAccess")], Oi.prototype, "requestAccess", 1);
ro([O.trace("Stage.cancelRequestAccess")], Oi.prototype, "cancelRequestAccess", 1);
ro([O.trace("Stage.grantAccess")], Oi.prototype, "grantAccess", 1);
ro([O.trace("Stage.denyAccess")], Oi.prototype, "denyAccess", 1);
ro([Ka.executeWithLock({ methodName: "joinStage", lockName: "Stage.join", timeout: 5e3 }), O.trace("Stage.joinStage")], Oi.prototype, "join", 1);
ro([O.trace("Stage.leaveStage")], Oi.prototype, "leave", 1);
function BI(o) {
  return !(o.viewType === "LIVESTREAM" || o.viewType === "CHAT");
}
function Gp(o) {
  switch (o) {
    case Va.UNSPECIFIED:
      return "OFF_STAGE";
    case Va.REQUESTED_STAGE:
      return "REQUESTED_TO_JOIN_STAGE";
    case Va.APPROVED_STAGE:
      return "ACCEPTED_TO_JOIN_STAGE";
    case Va.OFF_STAGE:
      return "OFF_STAGE";
    case Va.ON_STAGE:
      return "ON_STAGE";
    default:
      return "OFF_STAGE";
  }
}
var qI = Object.defineProperty, GI = Object.getOwnPropertyDescriptor, WI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? GI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && qI(e, r, a), a;
}, Sn = /* @__PURE__ */ S("self"), it = /* @__PURE__ */ S("participants"), En = /* @__PURE__ */ S("stageSocketHandler"), eu = /* @__PURE__ */ S("stageRequestCount"), fr = /* @__PURE__ */ S("context"), mg = /* @__PURE__ */ function() {
  function o(t, e, r, n, a) {
    w(this, o), this.stage = void 0, Object.defineProperty(this, Sn, { writable: !0, value: void 0 }), Object.defineProperty(this, it, { writable: !0, value: void 0 }), Object.defineProperty(this, En, { writable: !0, value: void 0 }), Object.defineProperty(this, eu, { writable: !0, value: 0 }), Object.defineProperty(this, fr, { writable: !0, value: void 0 }), l(this, fr)[fr] = t, this.stage = new Oi(t, n, a, e, r), l(this, En)[En] = e, l(this, Sn)[Sn] = n, l(this, it)[it] = a, this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, fr)[fr].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, fr)[fr].getValue("logger");
  } }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, fr)[fr].subscribe("stageStatus", function(r) {
      e.stage.emit("stageStatusUpdate", r);
    }), l(this, En)[En].on(Y.grantStageAccess, function() {
      l(e, Sn)[Sn].permissions.stageAccess !== te.Allowed && (e.stage.emit("stageRequestApproved"), e.setStageStatus("ACCEPTED_TO_JOIN_STAGE"));
    }), l(this, En)[En].on(Y.peerStageStatusUpdate, function(r) {
      r !== void 0 && (r.peerId === l(e, Sn)[Sn].id ? e.selfStageStatusHandler(r) : e.peerStageStatusHandler(r));
    }), l(this, En)[En].on(Y.denyStageAccess, function() {
      l(e, Sn)[Sn].permissions.stageAccess !== te.Allowed && (e.stage.emit("stageRequestRejected"), e.setStageStatus("OFF_STAGE"));
    }), l(this, En)[En].on(Y.getStageRequests, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                if (l(e, Sn)[Sn].permissions.stageAccess === te.Allowed) {
                  c.next = 2;
                  break;
                }
                return c.abrupt("return");
              case 2:
                return s = (i = a == null ? void 0 : a.stageRequests) !== null && i !== void 0 ? i : [], c.next = 5, l(e, fr)[fr].getValue("peerSessionStore").emitAsync(j.GET_STAGE_REQUESTS, s);
              case 5:
                l(e, eu)[eu] < s.length && s.length > 0 && e.stage.emit("newStageRequest", { count: s.length }), l(e, eu)[eu] = s.length, e.stage.emit("stageAccessRequestUpdate", s);
              case 8:
              case "end":
                return c.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }());
  } }, { key: "getCurrentStageRequests", value: function() {
    var e = l(this, it)[it].joined.toArray().filter(function(r) {
      return r.stageStatus === "REQUESTED_TO_JOIN_STAGE";
    }).map(function(r) {
      return { displayName: r.name, userId: r.userId, peerId: r.id };
    });
    return e;
  } }, {
    key: "setStageStatus",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                if (this.stage.status !== n) {
                  i.next = 2;
                  break;
                }
                return i.abrupt("return");
              case 2:
                l(this, fr)[fr].setValue("stageStatus", n);
              case 3:
              case "end":
                return i.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * NOTE(ishita1805): Runs for cases like:
    * - Being kicked from stage
    * - Socket-Client inconsistency
    */
  }, {
    key: "selfStageStatusHandler",
    value: function(e) {
      var r = Gp(e.stageType), n = l(this, fr)[fr].getValue("stageStatus");
      if (n !== r)
        switch (e.stageType) {
          case 1:
            l(this, fr)[fr].setValue("stageStatus", "ACCEPTED_TO_JOIN_STAGE", !1), this.stage.join();
            break;
          case 2:
          case 3:
            this.setStageStatus(n);
            break;
          case 0:
          case 4:
          default:
            l(this, fr)[fr].setValue("stageStatus", "ACCEPTED_TO_JOIN_STAGE", !1), this.stage.leave();
            break;
        }
    }
    /**
    * NOTE(ishita1805): Source of truth for updating peer stage status
    */
  }, { key: "peerStageStatusHandler", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (a = l(this, it)[it].joined.get(n.peerId), i = l(this, it)[it].viewMode === "ACTIVE_GRID", a) {
                u.next = 5;
                break;
              }
              return this.logger.warn("err::peerStageStatusUpdate: participant not found"), u.abrupt("return");
            case 5:
              u.t0 = n.stageType, u.next = u.t0 === 1 ? 8 : u.t0 === 2 ? 11 : u.t0 === 3 ? 13 : (u.t0 === 0 || u.t0 === 4, 15);
              break;
            case 8:
              return a.setStageStatus("ON_STAGE"), i && l(this, fr)[fr].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: l(this, it)[it].viewMode, page: l(this, it)[it].currentPage }), u.abrupt("break", 18);
            case 11:
              return a.setStageStatus("ACCEPTED_TO_JOIN_STAGE"), u.abrupt("break", 18);
            case 13:
              return a.setStageStatus("REQUESTED_TO_JOIN_STAGE"), u.abrupt("break", 18);
            case 15:
              return a.setStageStatus("OFF_STAGE"), i && l(this, fr)[fr].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: l(this, it)[it].viewMode, page: l(this, it)[it].currentPage }), u.abrupt("break", 18);
            case 18:
              l(this, fr)[fr].getValue("peerSessionStore").emit(j.UPDATE_PEER_STAGE_STATUS, { id: a.id, status: a.stageStatus });
            case 19:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}();
WI([O.trace("Stage.setupEvents")], mg.prototype, "setupEvents", 1);
var JI = Object.defineProperty, KI = Object.getOwnPropertyDescriptor, Pc = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? KI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && JI(e, r, a), a;
}, _r = { getPeer: 14, getPeers: 15, chatMessage: 16, getRoomName: 17, getDisplayTitle: 18, getPluginInitiator: 19, customPluginEventToParent: 20, peerJoined: 22, peerLeft: 23, sendData: 24, stageStatusUpdate: 25, peerStageStatusUpdate: 26 }, No = (Ye = /* @__PURE__ */ S("pluginSocketHandler"), Mr = /* @__PURE__ */ S("self"), ti = /* @__PURE__ */ S("participants"), ni = /* @__PURE__ */ S("chat"), At = /* @__PURE__ */ S("startedAt"), ai = /* @__PURE__ */ S("authToken"), vn = /* @__PURE__ */ S("context"), ii = /* @__PURE__ */ S("meetingTitle"), /* @__PURE__ */ function(o) {
  function t(e, r, n, a, i, s, u) {
    var c, d = r.baseURL, h = r.createdAt, v = r.description, f = r.id, g = r.name, k = r.organizationId, y = r.picture, b = r.private, C = r.published, T = r.staggered, E = r.tags, D = r.type, I = r.updatedAt;
    w(this, t);
    var _ = e.getValue("logger");
    return c = R(this, t, [_]), Object.defineProperty(c, Ye, { writable: !0, value: void 0 }), c.baseURL = void 0, c.createdAt = void 0, c.description = void 0, c.id = void 0, c.name = void 0, Object.defineProperty(c, Mr, { writable: !0, value: void 0 }), Object.defineProperty(c, ti, { writable: !0, value: void 0 }), Object.defineProperty(c, ni, { writable: !0, value: void 0 }), c.organizationId = void 0, c.picture = void 0, c.private = void 0, c.published = void 0, c.staggered = void 0, c.tags = void 0, c.type = void 0, c.updatedAt = void 0, Object.defineProperty(c, At, { writable: !0, value: void 0 }), c.config = void 0, Object.defineProperty(c, ai, { writable: !0, value: void 0 }), c.active = void 0, c.iframes = void 0, c.enabledBy = void 0, Object.defineProperty(c, vn, { writable: !0, value: void 0 }), Object.defineProperty(c, ii, { writable: !0, value: void 0 }), l(c, vn)[vn] = e, c.baseURL = d, c.createdAt = new Date(h), c.description = v, c.id = f, c.name = g, l(c, Mr)[Mr] = a, c.organizationId = k, c.picture = y, c.private = b, c.published = C, c.staggered = T, c.tags = E, c.type = D, c.updatedAt = new Date(I), c.active = !1, c.iframes = /* @__PURE__ */ new Map(), l(c, Ye)[Ye] = n, l(c, ti)[ti] = i, l(c, ni)[ni] = s, c.enabledBy = "", l(c, ii)[ii] = u, c;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, vn)[vn].getValue("telemetry");
    }
  ) }, { key: "sendIframeEvent", value: function(r) {
    this.iframes.size && this.iframes.forEach(function(n) {
      var a = n.iframe;
      a && (navigator.isReactNative ? a.postMessage(JSON.stringify(r)) : a.contentWindow.postMessage(r, "*"));
    });
  } }, { key: "handleIframeMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h, v, f, g, k, y;
      return p().wrap(function(C) {
        for (; ; )
          switch (C.prev = C.next) {
            case 0:
              if (this.active) {
                C.next = 2;
                break;
              }
              return C.abrupt("return");
            case 2:
              i = a, s = i.payload, u = i.uuid, c = i.type, C.t0 = c, C.next = C.t0 === se.customPluginEventToRoom ? 7 : C.t0 === se.customPluginEventToPeers ? 9 : C.t0 === se.enablePluginForRoom ? 11 : C.t0 === se.enablePluginForPeers ? 13 : C.t0 === se.disablePluginForRoom ? 15 : C.t0 === se.disablePluginForPeers ? 17 : C.t0 === se.storeInsertKeys ? 19 : C.t0 === se.storeGetKeys ? 21 : C.t0 === se.storeDeleteKeys ? 23 : C.t0 === se.storeDelete ? 25 : C.t0 === _r.chatMessage ? 27 : C.t0 === _r.getPeer ? 41 : C.t0 === _r.getPeers ? 46 : C.t0 === _r.getPluginInitiator ? 49 : C.t0 === _r.getDisplayTitle ? 51 : C.t0 === _r.getRoomName ? 53 : C.t0 === _r.customPluginEventToParent ? 55 : 57;
              break;
            case 7:
              return l(this, Ye)[Ye].customPluginEventToRoom(this.id, s, u), C.abrupt("break", 57);
            case 9:
              return l(this, Ye)[Ye].customPluginEventToPeers(this.id, s.peerIds, s, u), C.abrupt("break", 57);
            case 11:
              return l(this, Ye)[Ye].enablePluginForRoom(this.id, u), C.abrupt("break", 57);
            case 13:
              return l(this, Ye)[Ye].enablePluginForPeers(this.id, s.peerIds, u), C.abrupt("break", 57);
            case 15:
              return l(this, Ye)[Ye].disablePluginForRoom(this.id, u), C.abrupt("break", 57);
            case 17:
              return l(this, Ye)[Ye].disablePluginForPeers(this.id, s.peerIds, u), C.abrupt("break", 57);
            case 19:
              return l(this, Ye)[Ye].storeInsertKeys(this.id, s.store, s.insertKeys, u), C.abrupt("break", 57);
            case 21:
              return l(this, Ye)[Ye].storeGetKeys(this.id, s.store, s.getKeys, u), C.abrupt("break", 57);
            case 23:
              return l(this, Ye)[Ye].storeDeleteKeys(this.id, s.store, s.deleteKeys, u), C.abrupt("break", 57);
            case 25:
              return l(this, Ye)[Ye].storeDelete(this.id, s.store, u), C.abrupt("break", 57);
            case 27:
              if (d = s.messagePayload, h = s.peerIds, l(this, ni)[ni]) {
                C.next = 31;
                break;
              }
              return this.sendIframeEvent({ type: _r.chatMessage, uuid: i.uuid, payload: { error: "Chat is disabled for this room." } }), C.abrupt("return");
            case 31:
              return C.prev = 31, C.next = 34, l(this, ni)[ni].sendMessage(d, h);
            case 34:
              this.sendIframeEvent({ type: _r.chatMessage, uuid: i.uuid, payload: { success: !0 } }), C.next = 40;
              break;
            case 37:
              C.prev = 37, C.t1 = C.catch(31), this.sendIframeEvent({ type: _r.chatMessage, uuid: i.uuid, payload: { error: C.t1 } });
            case 40:
              return C.abrupt("break", 57);
            case 41:
              return g = s.peerId, k = $($({}, l(this, Mr)[Mr]), {}, { id: l(this, Mr)[Mr].id, isRecorder: (v = l(this, Mr)[Mr].permissions) === null || v === void 0 ? void 0 : v.isRecorder, isHidden: l(this, Mr)[Mr].permissions.hiddenParticipant, stageStatus: l(this, Mr)[Mr].stageStatus }), g ? (f = l(this, ti)[ti].joined.get(s.peerId), l(this, Mr)[Mr].id === g && (f = k)) : f = k, this.sendIframeEvent({ type: _r.getPeer, payload: { peer: f && rc(f) }, uuid: i.uuid }), C.abrupt("break", 57);
            case 46:
              return y = l(this, ti)[ti].joined.toArray().map(function(T) {
                return rc(T);
              }), this.sendIframeEvent({ type: _r.getPeers, payload: { peers: y }, uuid: i.uuid }), C.abrupt("break", 57);
            case 49:
              return this.sendIframeEvent({ type: _r.getPluginInitiator, payload: { enabledBy: this.enabledBy }, uuid: i.uuid }), C.abrupt("break", 57);
            case 51:
              return this.sendIframeEvent({ type: _r.getDisplayTitle, payload: { displayTitle: l(this, ii)[ii] }, uuid: i.uuid }), C.abrupt("break", 57);
            case 53:
              return this.sendIframeEvent({ type: _r.getRoomName, payload: { roomName: l(this, vn)[vn].getValue("meetingId") }, uuid: i.uuid }), C.abrupt("break", 57);
            case 55:
              return this.emit(i.payload.eventName, i.payload.data), C.abrupt("break", 57);
            case 57:
            case "end":
              return C.stop();
          }
      }, n, this, [[31, 37]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "sendData",
    value: function(r) {
      this.active && (this.logger.info("Plugin::SendData", { plugin: { id: this.id, name: this.name, data: { eventName: r.eventName } } }), this.sendIframeEvent({ type: _r.sendData, uuid: "", payload: r }));
    }
    /**
    * This method is used for cleaning up event listeners attached to an iframe. It must
    * be used before the iframe is removed from the DOM.
    * @param viewId ID of the view corresponding to this iframe. Default is 'default'.
    */
  }, {
    key: "removePluginView",
    value: function() {
      var r, n = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : "default", a = (r = this.iframes.get(n)) !== null && r !== void 0 ? r : {}, i = a.iframe, s = a.listener;
      (i || s) && (navigator.isReactNative ? i.props.onMessage = void 0 : window.removeEventListener("message", s), this.iframes.delete(n));
    }
    /**
    * This method adds the communcation layer between the plugin inside the iframe
    * and the core application (meeting object) in the main window.
    * @param iframe Iframe element to display this plugin.
    * @param viewId ID of the view corresponding to this iframe. Default is 'default'.
    */
  }, { key: "addPluginView", value: function(r) {
    var n, a = this, i = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : "default";
    if (!l(this, ai)[ai])
      throw this.logger.error("Plugin::addPluginView::no_auth_token_set_for_plugin"), new U("No auth token set for plugin.", "0602");
    if (!r)
      throw this.logger.error("Plugin::addPluginView::iframe_was_not_provided"), new U("Iframe was not provided.", "0603");
    this.removePluginView(i);
    var s = r, u = new URL(this.baseURL), c = { auth: l(this, ai)[ai], parent: navigator.isReactNative ? this.baseURL : window.location.origin, backend: l(this, vn)[vn].getValue("apiBase"), pluginId: this.id, roomName: (n = l(this, vn)[vn].getValue("meetingId")) !== null && n !== void 0 ? n : "", displayTitle: l(this, ii)[ii] };
    if (Object.keys(c).forEach(function(h) {
      u.searchParams.set(h, c[h]);
    }), s.src = u.href, s.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture", s.title = i, navigator.isReactNative)
      s.props.onMessage = function(h) {
        a.handleIframeMessage(JSON.parse(h.nativeEvent.data));
      }, this.iframes.set(i, { iframe: s });
    else {
      var d = /* @__PURE__ */ function() {
        var h = m(/* @__PURE__ */ p().mark(function v(f) {
          return p().wrap(function(k) {
            for (; ; )
              switch (k.prev = k.next) {
                case 0:
                  if (f.source !== r.contentWindow) {
                    k.next = 3;
                    break;
                  }
                  return k.next = 3, a.handleIframeMessage(f.data);
                case 3:
                case "end":
                  return k.stop();
              }
          }, v);
        }));
        return function(f) {
          return h.apply(this, arguments);
        };
      }();
      window.addEventListener("message", d), this.iframes.set(i, { iframe: s, listener: d });
    }
  } }, {
    key: "setActive",
    value: function(r) {
      var n;
      if (this.active = r, r) {
        var a;
        this.emit("stateUpdate", { active: this.active, pluginId: this.id, bind: this.addPluginView.bind(this), views: (a = this.config) === null || a === void 0 ? void 0 : a.views });
        return;
      }
      this.active = !1, this.emit("stateUpdate", { active: this.active, pluginId: this.id, views: (n = this.config) === null || n === void 0 ? void 0 : n.views });
    }
    /**
    * @access private
    * Not for external use
    */
    // NOTE(roerohan): Enable this plugin for the current user.
  }, { key: "activateForSelf", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return a = pt(), c.next = 3, a.authorizePlugin(this.id);
            case 3:
              return i = c.sent, l(this, ai)[ai] = i, l(this, At)[At] = new Date(), c.prev = 6, c.next = 9, a.getPluginConfig(this.baseURL);
            case 9:
              s = c.sent, this.config = s, c.next = 16;
              break;
            case 13:
              c.prev = 13, c.t0 = c.catch(6), this.logger.error("Plugin::activateForSelf", { error: c.t0 });
            case 16:
              this.setActive(!0), this.emit("enabled");
            case 18:
            case "end":
              return c.stop();
          }
      }, n, this, [[6, 13]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "deactivateForSelf",
    value: function() {
      var r = this;
      Array.from(this.iframes.keys()).forEach(function(n) {
        r.removePluginView(n);
      }), l(this, At)[At] = void 0, this.iframes.clear(), this.setActive(!1), this.emit("closed");
    }
    /**
    * @deprecated
    */
  }, { key: "enable", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.activateForSelf());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disable", value: function() {
    return this.deactivateForSelf();
  } }, { key: "activate", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!this.active) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              if ((a = l(this, Mr)[Mr].permissions) !== null && a !== void 0 && (a = a.plugins) !== null && a !== void 0 && a.canStart) {
                s.next = 4;
                break;
              }
              return s.abrupt("return");
            case 4:
              l(this, Ye)[Ye].addPlugin(this.id, this.staggered), l(this, At)[At] = new Date(), this.logger.info("plugin::activated", { plugin: { id: this.id, enabledBy: this.enabledBy, name: this.name } });
            case 7:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "deactivate", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.active) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              if (!(!((a = l(this, Mr)[Mr].permissions) !== null && a !== void 0 && (a = a.plugins) !== null && a !== void 0 && a.canClose) && this.enabledBy !== l(this, Mr)[Mr].id)) {
                s.next = 4;
                break;
              }
              return s.abrupt("return");
            case 4:
              l(this, Ye)[Ye].removePlugin(this.id), this.logger.info("plugin::deactivated", { plugin: { id: this.id, name: this.name, duration: l(this, At)[At] ? new Date().getTime() - l(this, At)[At].getTime() : 0 } }), l(this, At)[At] = void 0;
            case 7:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(jo));
Pc([Lt({ maxInvocations: 5, period: 1 })], No.prototype, "sendData", 1);
Pc([O.trace("Plugin.activatePlugin")], No.prototype, "activate", 1);
Pc([O.trace("Plugin.deactivatePlugin")], No.prototype, "deactivate", 1);
No = Pc([vt("0600")], No);
var Le = /* @__PURE__ */ S("eventEmitter"), va = /* @__PURE__ */ S("listeners"), yg = /* @__PURE__ */ function(o) {
  function t(e) {
    var r, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : void 0;
    w(this, t);
    var a = e.onAddEvent, i = e.onDeleteEvent, s = e.onClearEvent;
    return r = R(this, t), Object.defineProperty(r, Le, { writable: !0, value: void 0 }), Object.defineProperty(r, va, { writable: !0, value: void 0 }), r.onAddEvent = void 0, r.onDeleteEvent = void 0, r.onClearEvent = void 0, l(r, Le)[Le] = new jo(n), r.onAddEvent = a, r.onDeleteEvent = i, r.onClearEvent = s, l(r, va)[va] = /* @__PURE__ */ new Map(), r;
  }
  return A(t, o), P(t, [{ key: "emit", value: function(r) {
    for (var n, a = arguments.length, i = new Array(a > 1 ? a - 1 : 0), s = 1; s < a; s++)
      i[s - 1] = arguments[s];
    return (n = l(this, Le)[Le]).emit.apply(n, [r].concat(i));
  } }, { key: "on", value: function(r, n) {
    return l(this, Le)[Le].on(r, n);
  } }, { key: "addListener", value: function(r, n) {
    return l(this, Le)[Le].addListener(r, n);
  } }, { key: "off", value: function(r, n) {
    return l(this, Le)[Le].off(r, n);
  } }, { key: "once", value: function(r, n) {
    return l(this, Le)[Le].once(r, n);
  } }, { key: "prependListener", value: function(r, n) {
    return l(this, Le)[Le].prependListener(r, n);
  } }, { key: "prependOnceListener", value: function(r, n) {
    return l(this, Le)[Le].prependOnceListener(r, n);
  } }, { key: "removeListener", value: function(r, n) {
    return l(this, Le)[Le].removeListener(r, n);
  } }, { key: "removeAllListeners", value: function(r) {
    return l(this, Le)[Le].removeAllListeners(r);
  } }, { key: "listeners", value: function(r) {
    return l(this, Le)[Le].listeners(r);
  } }, { key: "listenerCount", value: function(r) {
    return l(this, Le)[Le].listenerCount(r);
  } }, { key: "getMaxListeners", value: function() {
    return l(this, Le)[Le].getMaxListeners();
  } }, { key: "setMaxListeners", value: function(r) {
    return l(this, Le)[Le].setMaxListeners(r);
  } }, { key: "eventNames", value: function() {
    return l(this, Le)[Le].eventNames();
  } }, { key: "add", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    return this.set(r.id, r, n);
  } }, { key: "set", value: function(r, n) {
    var a = this, i = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !0, s = Re(t, "set", this, 3)([r, n]), u = function(d) {
      for (var h = arguments.length, v = new Array(h > 1 ? h - 1 : 0), f = 1; f < h; f++)
        v[f - 1] = arguments[f];
      a.emit.apply(a, [d, n].concat(v));
    };
    return l(this, va)[va].set(r, u), n.on("*", u), i && l(this, Le)[Le].emit(this.onAddEvent, n), s;
  } }, { key: "delete", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1, i = this.get(r);
    if (!i)
      return !1;
    i.removeListener("*", l(this, va)[va].get(r));
    var s = Re(t, "delete", this, 3)([r]);
    return a && i.removeAllListeners(), n && l(this, Le)[Le].emit(this.onDeleteEvent, i), s;
  } }, { key: "clear", value: function() {
    var r = this, n = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !0, a = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    this.forEach(function(s) {
      s.removeListener("*", l(r, va)[va].get(s.id)), a && s.removeAllListeners();
    });
    var i = Re(t, "clear", this, 3)([]);
    return n && l(this, Le)[Le].emit(this.onClearEvent), i;
  } }, { key: "toArray", value: function() {
    return Array.from(this.values());
  } }]);
}(/* @__PURE__ */ Gs(Map)), hv = /* @__PURE__ */ function(o) {
  function t(e) {
    return w(this, t), R(this, t, [{ onAddEvent: "pluginAdded", onDeleteEvent: "pluginDeleted" }, e]);
  }
  return A(t, o), P(t, [{ key: "add", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    return Re(t, "add", this, 3)([r, n]);
  } }, { key: "delete", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1;
    return Re(t, "delete", this, 3)([r, n, a]);
  } }]);
}(yg), zI = Object.defineProperty, YI = Object.getOwnPropertyDescriptor, QI = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? YI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && zI(e, r, a), a;
}, Vd = /* @__PURE__ */ P(function o(t) {
  w(this, o), this.all = void 0, this.active = void 0, this.all = new hv(t), this.active = new hv(t);
});
Vd = QI([vt("0600")], Vd);
var XI = Object.defineProperty, ZI = Object.getOwnPropertyDescriptor, Sc = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? ZI(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && XI(e, r, a), a;
}, kg = (Hr = /* @__PURE__ */ S("pluginSocketHandler"), si = /* @__PURE__ */ S("chatSocketHandler"), Zr = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t, e, r, n) {
    w(this, o), this.plugins = void 0, Object.defineProperty(this, Hr, { writable: !0, value: void 0 }), Object.defineProperty(this, si, { writable: !0, value: void 0 }), Object.defineProperty(this, Zr, { writable: !0, value: void 0 }), l(this, Hr)[Hr] = e, l(this, si)[si] = r, l(this, Zr)[Zr] = t, this.plugins = n, this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Zr)[Zr].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, Zr)[Zr].getValue("logger");
  } }, { key: "getRoomPlugins", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a = this, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, l(this, Hr)[Hr].getActivePlugins();
            case 2:
              return i = c.sent, s = i.plugins, (n = this.plugins.active) === null || n === void 0 || n.toArray().forEach(function(d) {
                a.disablePlugin({ id: d.id });
              }), c.next = 7, Promise.all(s.map(function(d) {
                return a.enablePlugin({ id: d.pluginId, enabledBy: d.enabledBy });
              }));
            case 7:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "enablePlugin", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (a = n.id, i = n.enabledBy, s = this.plugins.all.get(a), s) {
                c.next = 4;
                break;
              }
              return c.abrupt("return");
            case 4:
              return c.next = 6, s.activateForSelf();
            case 6:
              s.enabledBy = i;
            case 7:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disablePlugin", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (a = n.id, i = this.plugins.all.get(a), i) {
                u.next = 4;
                break;
              }
              return u.abrupt("return");
            case 4:
              i.deactivateForSelf();
            case 5:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "sendIframeEvent", value: function(e, r, n, a) {
    var i = this.plugins.all.get(r);
    i && i.sendIframeEvent({ type: e, uuid: n, payload: a });
  } }, { key: "broadcastIframeEvent", value: function(e, r) {
    var n = this;
    this.plugins.active.forEach(function(a) {
      n.sendIframeEvent(e, a.id, "", r);
    });
  } }, { key: "setupEvents", value: function() {
    var e = this;
    this.plugins.all.on("stateUpdate", function(r) {
      var n = r.active, a = r.id;
      if (n) {
        e.plugins.active.add(e.plugins.all.get(a));
        return;
      }
      e.plugins.active.delete(a);
    }), l(this, Zr)[Zr].getValue("peerSessionStore").onAsync(j.SOCKET_SERVICE_ROOM_JOINED, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              return a.next = 2, e.getRoomPlugins();
            case 2:
              e.logger.debug("[SOCKET_SERVICE_ROOM_JOINED] resolved request to fetch plugins.");
            case 3:
            case "end":
              return a.stop();
          }
      }, r);
    }))), l(this, Hr)[Hr].on(se.addPlugin, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                if (s = a.pluginId, !((i = e.plugins.all.get(s)) !== null && i !== void 0 && i.active)) {
                  c.next = 3;
                  break;
                }
                return c.abrupt("return");
              case 3:
                return c.next = 5, e.enablePlugin({ id: s, enabledBy: a.enabledBy });
              case 5:
              case "end":
                return c.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), l(this, Hr)[Hr].on(se.removePlugin, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                if (s = a.pluginId, (i = e.plugins.all.get(s)) !== null && i !== void 0 && i.active) {
                  c.next = 3;
                  break;
                }
                return c.abrupt("return");
              case 3:
                return c.next = 5, e.disablePlugin({ id: s });
              case 5:
              case "end":
                return c.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), [se.enablePluginForPeers, se.enablePluginForRoom].forEach(function(r) {
      l(e, Hr)[Hr].on(r, /* @__PURE__ */ function() {
        var n = m(/* @__PURE__ */ p().mark(function a(i, s) {
          return p().wrap(function(c) {
            for (; ; )
              switch (c.prev = c.next) {
                case 0:
                  e.sendIframeEvent(r, i.pluginId, s, { enabledBy: i.enabledBy });
                case 1:
                case "end":
                  return c.stop();
              }
          }, a);
        }));
        return function(a, i) {
          return n.apply(this, arguments);
        };
      }());
    }), [se.disablePluginForPeers, se.disablePluginForRoom].forEach(function(r) {
      l(e, Hr)[Hr].on(r, /* @__PURE__ */ function() {
        var n = m(/* @__PURE__ */ p().mark(function a(i, s) {
          return p().wrap(function(c) {
            for (; ; )
              switch (c.prev = c.next) {
                case 0:
                  e.sendIframeEvent(r, i.pluginId, s, { disabledBy: i.disabledBy });
                case 1:
                case "end":
                  return c.stop();
              }
          }, a);
        }));
        return function(a, i) {
          return n.apply(this, arguments);
        };
      }());
    }), [se.customPluginEventToPeers, se.customPluginEventToRoom].forEach(function(r) {
      l(e, Hr)[Hr].on(r, /* @__PURE__ */ function() {
        var n = m(/* @__PURE__ */ p().mark(function a(i, s) {
          return p().wrap(function(c) {
            for (; ; )
              switch (c.prev = c.next) {
                case 0:
                  e.sendIframeEvent(r, i.pluginId, s, { data: JSON.parse(new TextDecoder().decode(i.pluginData)) });
                case 1:
                case "end":
                  return c.stop();
              }
          }, a);
        }));
        return function(a, i) {
          return n.apply(this, arguments);
        };
      }());
    }), [se.storeInsertKeys, se.storeGetKeys, se.storeDeleteKeys].forEach(function(r) {
      l(e, Hr)[Hr].on(r, /* @__PURE__ */ function() {
        var n = m(/* @__PURE__ */ p().mark(function a(i, s) {
          var u, c;
          return p().wrap(function(h) {
            for (; ; )
              switch (h.prev = h.next) {
                case 0:
                  c = (u = i.storeItems) === null || u === void 0 ? void 0 : u.map(function(v) {
                    var f;
                    return { timestamp: v.timestamp, peerId: v.peerId, payload: JSON.parse((f = v.payload) !== null && f !== void 0 && f.length ? new TextDecoder().decode(v.payload) : "{}"), key: v.storeKey };
                  }), e.sendIframeEvent(r, i.pluginId, s, { storeName: i.storeName, storeItems: c });
                case 2:
                case "end":
                  return h.stop();
              }
          }, a);
        }));
        return function(a, i) {
          return n.apply(this, arguments);
        };
      }());
    }), l(this, Hr)[Hr].on(se.storeDelete, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a, i) {
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                e.sendIframeEvent(se.storeDelete, a.pluginId, i, { storeName: a.storeName });
              case 1:
              case "end":
                return u.stop();
            }
        }, n);
      }));
      return function(n, a) {
        return r.apply(this, arguments);
      };
    }()), l(this, si)[si].on(Rr.sendMessageToPeers, function(r) {
      var n = Un == null ? void 0 : Un.formatSocketPeerMessage(r.message);
      e.broadcastIframeEvent(_r.chatMessage, { message: n });
    }), l(this, si)[si].on(Rr.sendMessageToRoom, function(r) {
      var n = Un == null ? void 0 : Un.formatSocketPeerMessage(r.message);
      e.broadcastIframeEvent(_r.chatMessage, { message: n });
    }), l(this, Zr)[Zr].getValue("peerSessionStore").on(j.PEER_JOINED_INTERNAL, function(r) {
      var n = rc(r);
      e.broadcastIframeEvent(_r.peerJoined, n);
    }), l(this, Zr)[Zr].getValue("peerSessionStore").on(j.PEER_CLOSED, function(r) {
      e.broadcastIframeEvent(_r.peerLeft, r);
    }), l(this, Zr)[Zr].getValue("peerSessionStore").on(j.UPDATE_PEER_STAGE_STATUS, function(r) {
      e.broadcastIframeEvent(_r.peerStageStatusUpdate, r);
    }), l(this, Zr)[Zr].subscribe("stageStatus", function(r) {
      e.broadcastIframeEvent(_r.stageStatusUpdate, r);
    });
  } }], [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u, c, d, h) {
      var v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              return v = n.getValue("logger"), f = new Vd(v), a.forEach(function(y) {
                var b = new No(n, y, i, c, d, u, h);
                f.all.add(b);
              }), k.abrupt("return", new kg(n, i, s, f));
            case 4:
            case "end":
              return k.stop();
          }
      }, r);
    }));
    function e(r, n, a, i, s, u, c, d) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}()), il = kg;
Sc([O.trace("PluginController.getRoomPlugins")], il.prototype, "getRoomPlugins", 1);
Sc([O.trace("PluginController.enableForSelf")], il.prototype, "enablePlugin", 1);
Sc([O.trace("PluginController.disableForSelf")], il.prototype, "disablePlugin", 1);
Sc([O.trace("PluginController.setupEvents")], il.prototype, "setupEvents", 1);
var ru = /* @__PURE__ */ S("context"), xI = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.mediaJoined = void 0, this.socketJoined = void 0, this.socketJoinAttempted = void 0, this.mediaJoinAttempted = void 0, this.socketState = void 0, this.mediaState = void 0, Object.defineProperty(this, ru, { writable: !0, value: void 0 }), this.mediaJoined = !1, this.socketJoined = !1, this.socketJoinAttempted = !1, this.mediaJoinAttempted = !1, this.socketState = { state: void 0, reconnected: !1, reconnectionAttempt: void 0 }, this.mediaState = { recv: void 0, send: void 0 }, l(this, ru)[ru] = t;
  }
  return P(o, [{ key: "joinAttempted", get: function() {
    return this.mediaJoinAttempted || this.socketJoinAttempted;
  } }, { key: "roomJoined", get: function() {
    return this.mediaJoined && this.socketJoined;
  } }, { key: "updateSocketConnectionState", value: function(e, r) {
    var n, a = this.socketState.reconnected;
    switch (e) {
      case "connected":
        n = { state: "connected", reconnected: a, reconnectionAttempt: void 0 };
        break;
      case "disconnected":
        n = { state: "disconnected", reconnected: !1, reconnectionAttempt: 0 }, this.socketJoined = !1;
        break;
      case "reconnected":
        n = { state: "connected", reconnected: !0, reconnectionAttempt: void 0 };
        break;
      case "reconnecting":
        n = { state: "reconnecting", reconnected: a, reconnectionAttempt: 0 };
        break;
      case "reconnectAttempt":
        n = { state: "reconnecting", reconnected: a, reconnectionAttempt: r };
        break;
      case "failed":
        n = { state: "failed", reconnected: a, reconnectionAttempt: void 0 }, this.socketJoined = !1;
        break;
    }
    n && (l(this, ru)[ru].getValue("peerSessionStore").emit(j.SOCKET_STATE_UPDATE, n), this.socketState = n);
  } }]);
}(), eM = Object.defineProperty, rM = Object.getOwnPropertyDescriptor, sl = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? rM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && eM(e, r, a), a;
}, Ys = (wi = /* @__PURE__ */ S("self"), oi = /* @__PURE__ */ S("context"), ui = /* @__PURE__ */ S("update"), /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    w(this, t);
    var a = e.getValue("logger");
    return n = R(this, t, [a]), Object.defineProperty(n, ui, { value: tM }), Object.defineProperty(n, wi, { writable: !0, value: void 0 }), Object.defineProperty(n, oi, { writable: !0, value: void 0 }), n.recordingPeerIds = [], n.recordings = [], l(n, oi)[oi] = e, l(n, wi)[wi] = r, n;
  }
  return A(t, o), P(t, [{ key: "recordingState", get: function() {
    return this.recordings.some(function(r) {
      return r.state === "RECORDING";
    }) ? "RECORDING" : this.recordings.some(function(r) {
      return r.state === "PAUSED";
    }) ? "PAUSED" : this.recordings.some(function(r) {
      return r.state === "STARTING";
    }) ? "STARTING" : this.recordings.some(function(r) {
      return r.state === "STOPPING";
    }) ? "STOPPING" : "IDLE";
  } }, { key: "telemetry", get: function() {
    return l(this, oi)[oi].getValue("telemetry");
  } }, { key: "updateRecordings", value: function(r) {
    this.recordings = r, this.emit("recordingUpdate", this.recordingState);
  } }, { key: "start", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              if (l(this, wi)[wi].permissions.canRecord) {
                v.next = 3;
                break;
              }
              throw this.logger.error("Recording::start::permission_denied"), new U("User does not have permission to start recording", "1001");
            case 3:
              if (!((a == null ? void 0 : a.allowMultiple) !== !0 && (this.recordingState === "STARTING" || this.recordingState === "RECORDING" || this.recordingState === "STOPPING"))) {
                v.next = 6;
                break;
              }
              throw this.logger.error("Recording::start::recording_in_progress", { recording: { state: this.recordingState } }), new U("Cant start recording, recordingState irregular: ".concat(this.recordingState), "1005");
            case 6:
              return v.prev = 6, i = pt(), s = l(this, oi)[oi].getValue("defaults"), u = s.recording, c = u === void 0 ? {} : u, v.next = 11, i.startRecording(c, a == null ? void 0 : a.allowMultiple);
            case 11:
              d = v.sent, this.updateRecordings([].concat(Se(this.recordings), [{ id: d, state: "STARTING", type: "BROWSER" }])), v.next = 19;
              break;
            case 15:
              throw v.prev = 15, v.t0 = v.catch(6), this.logger.error("Recording::stop::recording_failed_to_start", { error: v.t0 }), new U("Error while starting recording", "1000", this.logger);
            case 19:
            case "end":
              return v.stop();
          }
      }, n, this, [[6, 15]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "stop", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, ui)[ui]("stop", ["RECORDING", "PAUSED"], a);
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "pause", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, ui)[ui]("pause", ["RECORDING"], a);
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "resume", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, ui)[ui]("resume", ["PAUSED"], a);
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an));
function tM(o, t, e) {
  return Ud.apply(this, arguments);
}
function Ud() {
  return Ud = m(/* @__PURE__ */ p().mark(function o(t, e, r) {
    var n = this, a, i;
    return p().wrap(function(u) {
      for (; ; )
        switch (u.prev = u.next) {
          case 0:
            if (l(this, wi)[wi].permissions.canRecord) {
              u.next = 3;
              break;
            }
            throw this.logger.error("Recording::stop::permission_denied"), new U("User does not have permission to stop recording", "1001");
          case 3:
            if (a = [], r === void 0) {
              u.next = 14;
              break;
            }
            if (i = this.recordings.find(function(c) {
              return c.id === r;
            }), i !== void 0) {
              u.next = 8;
              break;
            }
            throw new U("Could not find the specified recording", "1004");
          case 8:
            if (!e.includes(i.state)) {
              u.next = 11;
              break;
            }
            return this.logger.error("Recording::stop::recording_not_in_expected_state", { recording: { state: i.state } }), u.abrupt("return");
          case 11:
            a.push(i), u.next = 15;
            break;
          case 14:
            a = this.recordings.filter(function(c) {
              return e.includes(c.state);
            });
          case 15:
            a.forEach(/* @__PURE__ */ function() {
              var c = m(/* @__PURE__ */ p().mark(function d(h) {
                var v, f;
                return p().wrap(function(k) {
                  for (; ; )
                    switch (k.prev = k.next) {
                      case 0:
                        return v = h.state, t === "stop" && (h.state = "STOPPING", n.emit("recordingUpdate", "STOPPING")), k.prev = 2, f = pt(), k.next = 6, f.updateRecording(h.id, t);
                      case 6:
                        k.next = 13;
                        break;
                      case 8:
                        throw k.prev = 8, k.t0 = k.catch(2), n.logger.error("Recording::stop::recording_failed_to_stop", { error: k.t0 }), h.state !== v && (h.state = v, n.emit("recordingUpdate", v)), new U("Error while stopping recording", "1000", n.logger);
                      case 13:
                      case "end":
                        return k.stop();
                    }
                }, d, null, [[2, 8]]);
              }));
              return function(d) {
                return c.apply(this, arguments);
              };
            }());
          case 16:
          case "end":
            return u.stop();
        }
    }, o, this);
  })), Ud.apply(this, arguments);
}
sl([O.trace("Recording.start")], Ys.prototype, "start", 1);
sl([O.trace("Recording.stop")], Ys.prototype, "stop", 1);
sl([O.trace("Recording.stop")], Ys.prototype, "pause", 1);
sl([O.trace("Recording.stop")], Ys.prototype, "resume", 1);
Ys = sl([vt("1000")], Ys);
var nM = Object.defineProperty, aM = Object.getOwnPropertyDescriptor, iM = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? aM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && nM(e, r, a), a;
}, fa = /* @__PURE__ */ S("context"), bg = /* @__PURE__ */ function() {
  function o(t, e, r) {
    w(this, o), this.recording = void 0, this.room = void 0, Object.defineProperty(this, fa, { writable: !0, value: void 0 }), l(this, fa)[fa] = t, this.recording = new Ys(t, e), this.room = r, this.setupEvents();
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, fa)[fa].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, fa)[fa].getValue("logger");
  } }, { key: "getRecordingTypeFromProtoType", value: function(e) {
    var r;
    switch (e) {
      case Hs.BROWSER:
        r = "BROWSER";
        break;
      case Hs.COMPOSITE:
        r = "COMPOSITE";
        break;
      case Hs.TRACK:
        r = "TRACK";
        break;
      default:
        r = "BROWSER";
    }
    return r;
  } }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, fa)[fa].getValue("peerSessionStore").on(j.ROOM_STATE, function(r) {
      r.activeRecordings.length !== 0 ? e.recording.updateRecordings(r.activeRecordings.map(function(n) {
        var a = e.getRecordingTypeFromProtoType(n.recordingType);
        return { id: n.recordingId, state: n.recordingStatus, type: a };
      })) : e.recording.recordings.length && e.recording.updateRecordings([]);
    }), this.room.on(Y.recordingStarted, function(r) {
      var n = !1, a = Se(e.recording.recordings);
      if (a.forEach(function(s) {
        s.id === r.recordingId && (n = !0, s.state = "RECORDING");
      }), n === !1) {
        var i = e.getRecordingTypeFromProtoType(r.recordingType);
        a.push({ id: r.recordingId, state: "RECORDING", type: i });
      }
      e.recording.updateRecordings(a);
    }), this.room.on(Y.recordingPaused, function(r) {
      var n = Se(e.recording.recordings);
      n.forEach(function(a) {
        a.id === r.recordingId && (a.state = "PAUSED");
      }), e.recording.updateRecordings(n);
    }), this.room.on(Y.recordingStopped, function(r) {
      var n = Se(e.recording.recordings.filter(function(a) {
        return a.id !== r.recordingId;
      }));
      e.recording.updateRecordings(n);
    });
  } }]);
}();
iM([O.trace("RecordingController.setupEvents")], bg.prototype, "setupEvents", 1);
var ga = /* @__PURE__ */ S("context"), sM = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, ga, { writable: !0, value: void 0 }), l(this, ga)[ga] = t;
  }
  return P(o, [{ key: "hasFeature", value: function(e) {
    var r;
    return (r = l(this, ga)[ga].getValue("flagsmith").hasFeature(e)) !== null && r !== void 0 ? r : !1;
  } }, { key: "getFeatureValue", value: function(e) {
    return l(this, ga)[ga].getValue("flagsmith").getValue(e);
  } }, { key: "getAllFeatures", value: function() {
    return l(this, ga)[ga].getValue("flagsmith").getAllFlags();
  } }]);
}(), oM = /* @__PURE__ */ function() {
  function o(t, e, r) {
    w(this, o), this.logger = void 0, this.features = void 0, this.browserSpecs = void 0, this.callStats = void 0, this.logger = t, this.features = e, this.browserSpecs = kr, this.callStats = r;
  }
  return P(o, null, [{ key: "init", value: function(e) {
    return new o(e.getValue("logger"), new sM(e), e.getValue("callstats"));
  } }]);
}(), uM = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.internals = void 0, this.internals = t;
  }
  return P(o, null, [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return a = oM.init(n), s.abrupt("return", new o(a));
            case 2:
            case "end":
              return s.stop();
          }
      }, r);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), lM = Object.defineProperty, cM = Object.getOwnPropertyDescriptor, on = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? cM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && lM(e, r, a), a;
}, je = /* @__PURE__ */ S("mediaInterface"), ye = /* @__PURE__ */ S("audioMediaHandler"), ge = /* @__PURE__ */ S("videoMediaHandler"), Gt = /* @__PURE__ */ S("audioOutputMediaHandler"), Yr = /* @__PURE__ */ S("screenShareMediaHandler"), tu = /* @__PURE__ */ S("autoSwitchDevice"), Ce = /* @__PURE__ */ S("context"), $t = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : jd, i = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !0;
    w(this, t);
    var s = e.getValue("logger");
    return n = R(this, t, [s]), Object.defineProperty(n, je, { writable: !0, value: void 0 }), Object.defineProperty(n, ye, { writable: !0, value: void 0 }), Object.defineProperty(n, ge, { writable: !0, value: void 0 }), Object.defineProperty(n, Gt, { writable: !0, value: void 0 }), Object.defineProperty(n, Yr, { writable: !0, value: void 0 }), Object.defineProperty(n, tu, { writable: !0, value: void 0 }), Object.defineProperty(n, Ce, { writable: !0, value: void 0 }), n.audioUpdateInProgress = void 0, n.videoUpdateInProgress = void 0, l(n, Ce)[Ce] = e, n.audioUpdateInProgress = !1, n.videoUpdateInProgress = !1, l(n, je)[je] = new Tg(e, r), l(n, ye)[ye] = new DM(e, l(n, je)[je], void 0, a), l(n, ge)[ge] = new FM(e, l(n, je)[je], void 0, a), l(n, Yr)[Yr] = new VM(l(n, Ce)[Ce], l(n, je)[je]), l(n, Gt)[Gt] = new $M(l(n, je)[je]), l(n, tu)[tu] = i, l(n, ye)[ye].on("trackMuted", n.onAudioTrackMuted.bind(n)), l(n, ye)[ye].on("trackChanged", n.onAudioTrackChanged.bind(n)), l(n, ge)[ge].on("trackChanged", n.onVideoTrackChanged.bind(n)), l(n, ge)[ge].on("trackEnded", n.onVideoTrackEnded.bind(n)), l(n, Yr)[Yr].on("trackEnded", n.onScreenShareEnded.bind(n)), n.onVisibilityChange = n.onVisibilityChange.bind(n), document.addEventListener("visibilitychange", n.onVisibilityChange), n;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, Ce)[Ce].getValue("telemetry");
    }
  ) }, {
    key: "context",
    set: function(r) {
      l(this, Ce)[Ce] = r;
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "onVisibilityChange",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                if (l(this, Ce)[Ce].getValue("callstats").tabChanged(document.visibilityState === "visible"), document.visibilityState === "visible") {
                  i.next = 5;
                  break;
                }
                l(this, Ce)[Ce].getValue("callstats").browserBackgrounded(), i.next = 8;
                break;
              case 5:
                return l(this, Ce)[Ce].getValue("callstats").browserForegrounded(), i.next = 8, this.setupSpeaker();
              case 8:
              case "end":
                return i.stop();
            }
        }, n, this);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "repopulateAvailableDevices", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", !0);
            case 1:
            case "end":
              return i.stop();
          }
      }, n);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setupStreams", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s = this, u, c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              if (u = a.audio, c = a.video, u ? l(this, Ce)[Ce].getValue("callstats").audioOn() : l(this, Ce)[Ce].getValue("callstats").audioOff(), c ? l(this, Ce)[Ce].getValue("callstats").videoOn() : l(this, Ce)[Ce].getValue("callstats").videoOff(), !(u && c)) {
                y.next = 15;
                break;
              }
              return y.prev = 4, y.next = 7, l(this, je)[je].getAudioAndVideoTrack(l(this, ye)[ye].userSelectedDevice, l(this, ge)[ge].userSelectedDevice);
            case 7:
              v = y.sent, d = v.audioTrack, h = v.videoTrack, y.next = 15;
              break;
            case 12:
              y.prev = 12, y.t0 = y.catch(4), this.logger.error("LocalMediaHandler::init::Failed to get audio video tracks", { error: y.t0 });
            case 15:
              if (!(!d && u)) {
                y.next = 25;
                break;
              }
              return y.prev = 16, y.next = 19, l(this, je)[je].getAudioTrack(!1, l(this, ye)[ye].userSelectedDevice);
            case 19:
              d = y.sent, y.next = 25;
              break;
            case 22:
              y.prev = 22, y.t1 = y.catch(16), this.logger.error("LocalMediaHandler::init::Failed to get audio track", { error: y.t1 });
            case 25:
              if (!(!h && c)) {
                y.next = 35;
                break;
              }
              return y.prev = 26, y.next = 29, l(this, je)[je].getVideoTrack(l(this, ge)[ge].userSelectedDevice);
            case 29:
              h = y.sent, y.next = 35;
              break;
            case 32:
              y.prev = 32, y.t2 = y.catch(26), this.logger.error("LocalMediaHandler::init::Failed to get video track", { error: y.t2 });
            case 35:
              return u && !d && l(this, Ce)[Ce].getValue("callstats").audioOff(), c && !h && l(this, Ce)[Ce].getValue("callstats").videoOff(), y.next = 39, l(this, ye)[ye].setMediaTrack(d);
            case 39:
              return y.next = 41, l(this, ge)[ge].setMediaTrack(h);
            case 41:
              return y.prev = 41, y.next = 44, this.setupSpeaker();
            case 44:
              y.next = 48;
              break;
            case 46:
              y.prev = 46, y.t3 = y.catch(41);
            case 48:
              if (!h) {
                y.next = 53;
                break;
              }
              return y.next = 51, this.getDeviceById(h.getSettings().deviceId);
            case 51:
              f = y.sent, l(this, Ce)[Ce].getValue("callstats").selectedDevice("VIDEO", f);
            case 53:
              if (!d) {
                y.next = 58;
                break;
              }
              return y.next = 56, this.getDeviceById(d.getSettings().deviceId);
            case 56:
              g = y.sent, l(this, Ce)[Ce].getValue("callstats").selectedDevice("AUDIO", g);
            case 58:
              (i = l(this, Gt)[Gt].currentDevice) !== null && i !== void 0 && i.deviceId && l(this, Ce)[Ce].getValue("callstats").selectedDevice("SPEAKER", l(this, Gt)[Gt].currentDevice), l(this, je)[je].onDeviceChange(function(b, C, T) {
                s.onDeviceChange(C, T);
              });
            case 60:
            case "end":
              return y.stop();
          }
      }, n, this, [[4, 12], [16, 22], [26, 32], [41, 46]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getCurrentDevices", value: function() {
    return { audio: l(this, ye)[ye].currentDevice, video: l(this, ge)[ge].currentDevice, speaker: l(this, Gt)[Gt].currentDevice };
  } }, { key: "permissions", get: function() {
    return l(this, je)[je].permissions;
  } }, { key: "getAllDevices", value: function() {
    return l(this, je)[je].getAvailableDevices();
  } }, {
    key: "getDeviceById",
    value: function(r, n) {
      return l(this, je)[je].getDevice(r);
    }
    /**
    * Audio Input Handler
    */
  }, { key: "onAudioTrackMuted", value: function() {
    this.emit("AUDIO_TRACK_SILENT");
  } }, { key: "onAudioTrackChanged", value: function() {
    this.emit("AUDIO_TRACK_CHANGE");
  } }, { key: "rawAudioTrack", get: function() {
    return l(this, ye)[ye].mediaTrack;
  } }, { key: "audioTrack", get: function() {
    return l(this, ye)[ye].transformedMediaTrack;
  } }, { key: "audioEnabled", get: function() {
    return l(this, ye)[ye].trackEnabled;
  } }, { key: "enableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!this.audioUpdateInProgress) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              if (this.audioUpdateInProgress = !0, s.prev = 3, !a) {
                s.next = 9;
                break;
              }
              return s.next = 7, l(this, ye)[ye].enableTrack(!1, a);
            case 7:
              s.next = 11;
              break;
            case 9:
              return s.next = 11, l(this, ye)[ye].unmuteTrack();
            case 11:
              s.next = 15;
              break;
            case 13:
              s.prev = 13, s.t0 = s.catch(3);
            case 15:
              return s.prev = 15, this.audioUpdateInProgress = !1, s.finish(15);
            case 18:
            case "end":
              return s.stop();
          }
      }, n, this, [[3, 13, 15, 18]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAudio", value: function() {
    l(this, ye)[ye].mediaTrack && !l(this, ye)[ye].isCustomTrack ? l(this, ye)[ye].muteTrack() : l(this, ye)[ye].disableTrack();
  } }, { key: "getAudioDevices", value: function(r) {
    return l(this, je)[je].getAudioInputDevices(r);
  } }, {
    key: "setAudioDevice",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return s.next = 2, l(this, ye)[ye].setDevice(a);
              case 2:
                a != null && a.deviceId && l(this, Ce)[Ce].getValue("callstats").selectedDevice("AUDIO", a), this.emit("AUDIO_TRACK_CHANGE"), this.emit("DEVICE_CHANGE", { device: a });
              case 5:
              case "end":
                return s.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Audio Output Handler
    */
  }, { key: "setupSpeaker", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return a = this.getCurrentDevices(), i = a.speaker, d.next = 3, l(this, Gt)[Gt].setupSpeaker();
            case 3:
              if (s = this.getCurrentDevices(), u = s.speaker, (i == null ? void 0 : i.deviceId) !== (u == null ? void 0 : u.deviceId)) {
                d.next = 6;
                break;
              }
              return d.abrupt("return");
            case 6:
              u && this.emit("DEVICE_CHANGE", { device: u });
            case 7:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "setSpeakerDevice",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return s.next = 2, l(this, Gt)[Gt].setupSpeaker(a);
              case 2:
                a != null && a.deviceId && l(this, Ce)[Ce].getValue("callstats").selectedDevice("SPEAKER", a), this.emit("DEVICE_CHANGE", { device: a });
              case 4:
              case "end":
                return s.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Video Handler
    */
  }, { key: "onVideoTrackChanged", value: function() {
    this.emit("VIDEO_TRACK_CHANGE");
  } }, { key: "onVideoTrackEnded", value: function() {
    this.emit("VIDEO_TRACK_CHANGE");
  } }, { key: "rawVideoTrack", get: function() {
    return l(this, ge)[ge].mediaTrack;
  } }, { key: "videoTrack", get: function() {
    return l(this, ge)[ge].transformedMediaTrack;
  } }, { key: "videoEnabled", get: function() {
    return l(this, ge)[ge].trackEnabled;
  } }, { key: "enableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!this.videoUpdateInProgress) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              if (this.videoUpdateInProgress = !0, s.prev = 3, !a) {
                s.next = 9;
                break;
              }
              return s.next = 7, l(this, ge)[ge].enableTrack(!1, a);
            case 7:
              s.next = 11;
              break;
            case 9:
              return s.next = 11, l(this, ge)[ge].unmuteTrack();
            case 11:
              s.next = 15;
              break;
            case 13:
              s.prev = 13, s.t0 = s.catch(3);
            case 15:
              return s.prev = 15, this.videoUpdateInProgress = !1, s.finish(15);
            case 18:
            case "end":
              return s.stop();
          }
      }, n, this, [[3, 13, 15, 18]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableVideo", value: function() {
    l(this, ge)[ge].disableTrack();
  } }, { key: "getVideoDevices", value: function(r) {
    return l(this, je)[je].getVideoInputDevices(r);
  } }, { key: "setVideoDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, ge)[ge].setDevice(a);
            case 2:
              a != null && a.deviceId && l(this, Ce)[Ce].getValue("callstats").selectedDevice("VIDEO", a), this.emit("VIDEO_TRACK_CHANGE"), this.emit("DEVICE_CHANGE", { device: a });
            case 5:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "updateVideoConstraints",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return s.next = 2, l(this, ge)[ge].updateConstraints(a);
              case 2:
              case "end":
                return s.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Screen Share Handler
    */
  }, { key: "onScreenShareEnded", value: function() {
    this.emit("SCREENSHARE_ENDED");
  } }, { key: "screenShareTracks", get: function() {
    return { audio: l(this, Yr)[Yr].audioMediaTrack, video: l(this, Yr)[Yr].videoMediaTrack };
  } }, { key: "screenShareEnabled", get: function() {
    return l(this, Yr)[Yr].trackEnabled;
  } }, { key: "enableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, l(this, Yr)[Yr].enableScreenShare();
            case 2:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              l(this, Yr)[Yr].disableScreenShare();
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateScreenshareConstraints", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, Yr)[Yr].updateConstraints(a);
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "getSpeakerDevices",
    value: function(r) {
      return l(this, je)[je].getAudioOutputDevices(r);
    }
    /**
    * Middleware Utility
    */
  }, { key: "addAudioMiddleware", value: function(r) {
    return l(this, ye)[ye].addMiddleware(r);
  } }, { key: "removeAudioMiddleware", value: function(r) {
    return l(this, ye)[ye].removeMiddleware(r);
  } }, { key: "removeAllAudioMiddlewares", value: function() {
    return l(this, ye)[ye].removeAllMiddlewares();
  } }, { key: "addVideoMiddleware", value: function(r) {
    return l(this, ge)[ge].addMiddleware(r);
  } }, { key: "removeVideoMiddleware", value: function(r) {
    return l(this, ge)[ge].removeMiddleware(r);
  } }, { key: "removeAllVideoMiddlewares", value: function() {
    return l(this, ge)[ge].removeAllMiddlewares();
  } }, { key: "setVideoMiddlewareGlobalConfig", value: function(r) {
    return l(this, ge)[ge].setVideoMiddlewareGlobalConfig(r);
  } }, { key: "destruct", value: function() {
    l(this, ye)[ye].disableTrack(), l(this, ge)[ge].disableTrack(), l(this, ge)[ge].terminateMiddlewareWebWorker(), l(this, Yr)[Yr].disableScreenShare(), l(this, je)[je].destruct();
  } }, {
    key: "onDeviceChange",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
        var s, u = this, c;
        return p().wrap(function(h) {
          for (; ; )
            switch (h.prev = h.next) {
              case 0:
                if (this.emit("DEVICE_LIST_UPDATED", a), !(i || !l(this, tu)[tu])) {
                  h.next = 3;
                  break;
                }
                return h.abrupt("return");
              case 3:
                a == null || (s = a.added) === null || s === void 0 || s.forEach(/* @__PURE__ */ function() {
                  var v = m(/* @__PURE__ */ p().mark(function f(g) {
                    var k;
                    return p().wrap(function(b) {
                      for (; ; )
                        switch (b.prev = b.next) {
                          case 0:
                            if (!(g && !jd(g))) {
                              b.next = 9;
                              break;
                            }
                            if (!(g.kind === "audioinput" && ((k = u.audioTrack) === null || k === void 0 ? void 0 : k.enabled) === !0)) {
                              b.next = 6;
                              break;
                            }
                            return b.next = 4, u.setAudioDevice(g);
                          case 4:
                            b.next = 9;
                            break;
                          case 6:
                            if (g.kind !== "audiooutput") {
                              b.next = 9;
                              break;
                            }
                            return b.next = 9, u.setSpeakerDevice(g);
                          case 9:
                          case "end":
                            return b.stop();
                        }
                    }, f);
                  }));
                  return function(f) {
                    return v.apply(this, arguments);
                  };
                }()), a == null || (c = a.removed) === null || c === void 0 || c.forEach(/* @__PURE__ */ function() {
                  var v = m(/* @__PURE__ */ p().mark(function f(g) {
                    var k, y;
                    return p().wrap(function(C) {
                      for (; ; )
                        switch (C.prev = C.next) {
                          case 0:
                            if (!(g.kind === "audiooutput" && ((k = u.getCurrentDevices().speaker) === null || k === void 0 ? void 0 : k.deviceId) === g.deviceId)) {
                              C.next = 7;
                              break;
                            }
                            return C.next = 3, u.getSpeakerDevices();
                          case 3:
                            if (y = C.sent.find(function(T) {
                              return T.deviceId !== g.deviceId;
                            }), !y) {
                              C.next = 7;
                              break;
                            }
                            return C.next = 7, u.setSpeakerDevice(y);
                          case 7:
                          case "end":
                            return C.stop();
                        }
                    }, f);
                  }));
                  return function(f) {
                    return v.apply(this, arguments);
                  };
                }());
              case 5:
              case "end":
                return h.stop();
            }
        }, n, this);
      }));
      function r(n, a) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Backward Compatibility
    */
  }, {
    key: "removeAllTracks",
    value: function() {
      this.destruct();
    }
    /**
    * NOTE(ravindra-cloudflare):
    * Purpose of this function is to ensure a way to reset tracks.
    * Our EdTech clients also call getUserMedia for their own proctoring systems,
    * which can cause our tracks to be blank despite having enabled true.
    *
    * To ensure that they can cleanup our tracks and re-request tracks,
    *  we need to remove the existing tracks.
    */
  }, {
    key: "removeAudioTrack",
    value: function() {
      l(this, ye)[ye].disableTrack();
    }
    /**
    * NOTE(ravindra-cloudflare):
    * Purpose of this function is to ensure a way to reset tracks.
    * Our EdTech clients also call getUserMedia for their own proctoring systems,
    * which can cause our tracks to be blank despite having enabled true.
    *
    * To ensure that they can cleanup our tracks and re-request tracks,
    *  we need to remove the existing tracks.
    */
  }, { key: "removeVideoTrack", value: function() {
    l(this, ge)[ge].disableTrack(), l(this, ge)[ge].terminateMiddlewareWebWorker();
  } }, { key: "removeDocumentEventListeners", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              document.removeEventListener("visibilitychange", this.onVisibilityChange);
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(jo);
on([O.trace("MediaHandler.setupStreams")], $t.prototype, "setupStreams", 1);
on([O.trace("MediaHandler.enableAudio")], $t.prototype, "enableAudio", 1);
on([O.trace("MediaHandler.disableAudio")], $t.prototype, "disableAudio", 1);
on([O.trace("MediaHandler.setAudioDevice")], $t.prototype, "setAudioDevice", 1);
on([O.trace("MediaHandler.enableVideo")], $t.prototype, "enableVideo", 1);
on([O.trace("MediaHandler.disableVideo")], $t.prototype, "disableVideo", 1);
on([O.trace("MediaHandler.setVideoDevice")], $t.prototype, "setVideoDevice", 1);
on([O.trace("MediaHandler.updateVideoConstraints")], $t.prototype, "updateVideoConstraints", 1);
on([O.trace("MediaHandler.enableScreenShare")], $t.prototype, "enableScreenShare", 1);
on([O.trace("MediaHandler.disableScreenShare")], $t.prototype, "disableScreenShare", 1);
on([O.trace("MediaHandler.updateScreenshareConstraints")], $t.prototype, "updateScreenshareConstraints", 1);
on([O.trace("MediaHandler.destruct")], $t.prototype, "destruct", 1);
on([O.trace("MediaHandler.onDeviceChange")], $t.prototype, "onDeviceChange", 1);
function Al(o, t, e) {
  switch (!0) {
    case kr.isChromiumBased():
      switch (t) {
        case "NotAllowedError":
          return e.includes("by system") ? "SYSTEM_DENIED" : o === "screenshare" ? "CANCELED" : "DENIED";
        case "NotReadableError":
        default:
          return "COULD_NOT_START";
      }
    case kr.isSafari():
      switch (t) {
        case "NotAllowedError":
          return "DENIED";
        default:
          return "COULD_NOT_START";
      }
    case kr.isFirefox():
      switch (t) {
        case "NotFoundError":
        case "NotReadableError":
          return "SYSTEM_DENIED";
        case "NotAllowedError":
          return "DENIED";
        case "AbortError":
        default:
          return "COULD_NOT_START";
      }
    default:
      return "COULD_NOT_START";
  }
}
var dM = [
  "virtual",
  "emulator",
  "krisp",
  "solstice conference",
  "teams",
  "loom",
  "zoom",
  "manycam",
  "blackhole",
  "displayport",
  "xsplit",
  // XSplit virtual camera
  "wirecast",
  // Wirecast virtual camera
  "vMix",
  // vMix virtual camera
  "elgato",
  // Elgato virtual camera
  "epiphan",
  // Epiphan virtual camera
  "voice changer",
  // Some voice changer software
  "voicemod",
  // Voicemod virtual audio device
  "morphvoxx"
  // MorphVOXX virtual audio device
];
function jd(o) {
  var t, e, r = (t = o.label) === null || t === void 0 ? void 0 : t.toLowerCase();
  return ((e = kr._bowser) === null || e === void 0 ? void 0 : e.getOSName()) === "macOS" && r.includes("iphone") ? !0 : dM.some(function(n) {
    return r == null ? void 0 : r.includes(n);
  });
}
function pM(o, t, e) {
  return Fd.apply(this, arguments);
}
function Fd() {
  return Fd = m(/* @__PURE__ */ p().mark(function o(t, e, r) {
    var n, a, i, s, u, c, d;
    return p().wrap(function(v) {
      for (; ; )
        switch (v.prev = v.next) {
          case 0:
            if (e != null && e.length) {
              v.next = 2;
              break;
            }
            return v.abrupt("return", r);
          case 2:
            return n = t.getValue("logger"), a = new AudioContext(), v.next = 6, Promise.all(e == null ? void 0 : e.map(function(f) {
              return f(a);
            }));
          case 6:
            for (i = v.sent, s = a.createMediaStreamSource(new MediaStream([r])), u = a.createMediaStreamDestination(), v.prev = 9, c = s, d = 0; d < i.length; d += 1)
              c.connect(i[d]), c = i[d];
            c.connect(u), v.next = 19;
            break;
          case 15:
            return v.prev = 15, v.t0 = v.catch(9), n.error("getTransformedAudioTrack::middleware_execution_failed", { error: v.t0 }), v.abrupt("return", r);
          case 19:
            return v.abrupt("return", u.stream.getAudioTracks()[0]);
          case 20:
          case "end":
            return v.stop();
        }
    }, o, null, [[9, 15]]);
  })), Fd.apply(this, arguments);
}
var ma = /* @__PURE__ */ S("middlewareWebWorkerInterval"), nu = /* @__PURE__ */ S("context"), hM = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, ma, { writable: !0, value: void 0 }), Object.defineProperty(this, nu, { writable: !0, value: void 0 }), l(this, nu)[nu] = t;
  }
  return P(o, [{ key: "logger", get: function() {
    return l(this, nu)[nu].getValue("logger");
  } }, { key: "terminateMiddlewareWebWorker", value: function() {
    if (l(this, ma)[ma])
      try {
        Ml.clearInterval(l(this, ma)[ma]), l(this, ma)[ma] = void 0;
      } catch (e) {
        this.logger.debug("WorkerTimers::terminateMiddlewareWebWorker::failed");
      }
  } }, { key: "getTransformedVideoTrack", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s = this, u, c, d, h, v, f, g, k, y, b;
      return p().wrap(function(T) {
        for (; ; )
          switch (T.prev = T.next) {
            case 0:
              if (n != null && n.length) {
                T.next = 2;
                break;
              }
              return T.abrupt("return", a);
            case 2:
              return u = document.createElement("canvas"), T.next = 5, Promise.all(n == null ? void 0 : n.map(function(E) {
                return E({ canvas: u, WorkerTimers: Ml });
              }));
            case 5:
              if (c = T.sent, !i.disablePerFrameCanvasRendering) {
                T.next = 11;
                break;
              }
              return d = u.captureStream(), h = d.getVideoTracks()[0], Object.defineProperty(h, "originalSettings", { value: a.getSettings() }), T.abrupt("return", h);
            case 11:
              v = document.createElement("video"), f = new MediaStream(), f.addTrack(a), g = u.getContext("2d"), v.srcObject = f, v.autoplay = !0, this.terminateMiddlewareWebWorker(), k = /* @__PURE__ */ function() {
                var E = m(/* @__PURE__ */ p().mark(function D() {
                  var I;
                  return p().wrap(function(V) {
                    for (; ; )
                      switch (V.prev = V.next) {
                        case 0:
                          if (!(a.enabled === !1 || a.readyState === "ended")) {
                            V.next = 5;
                            break;
                          }
                          return s.terminateMiddlewareWebWorker(), v.remove(), u.remove(), V.abrupt("return");
                        case 5:
                          V.prev = 5, g.drawImage(v, 0, 0), I = 0;
                        case 8:
                          if (!(I < c.length)) {
                            V.next = 15;
                            break;
                          }
                          if (typeof c[I] != "function") {
                            V.next = 12;
                            break;
                          }
                          return V.next = 12, c[I](u, g);
                        case 12:
                          I += 1, V.next = 8;
                          break;
                        case 15:
                          V.next = 20;
                          break;
                        case 17:
                          V.prev = 17, V.t0 = V.catch(5), s.logger.error("getTransformedVideoTrack::middleware_execution_failed", { error: V.t0 });
                        case 20:
                        case "end":
                          return V.stop();
                      }
                  }, D, null, [[5, 17]]);
                }));
                return function() {
                  return E.apply(this, arguments);
                };
              }();
              try {
                v.play();
              } catch (E) {
              }
              return v.addEventListener("play", function() {
                u.width = v.width || a.getSettings().width, u.height = v.width || a.getSettings().height, l(s, ma)[ma] = Ml.setInterval(k, 50);
              }, !1), y = u.captureStream(), b = y.getVideoTracks()[0], Object.defineProperty(b, "originalSettings", { value: a.getSettings() }), T.abrupt("return", b);
            case 25:
            case "end":
              return T.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), vv = { gross: { width: { ideal: 192 }, height: { ideal: 144 } }, qvga: { width: { ideal: 384 }, height: { ideal: 288 } }, pvga: { width: { ideal: 480 }, height: { ideal: 360 } }, vga: { width: { ideal: 640 }, height: { ideal: 480 } }, hd: { width: { ideal: 1280 }, height: { ideal: 720 } }, hd_cropped: { width: { ideal: 900 }, height: { ideal: 720 } }, fhd: { width: { ideal: 1920 }, height: { ideal: 1080 } } }, vM = [[320, [{ rid: "q", maxBitrate: 25e4, maxFramerate: 24, scalabilityMode: "L1T1" }]], [640, [{ rid: "q", scaleResolutionDownBy: 2, maxBitrate: 25e4, maxFramerate: 24, scalabilityMode: "L1T1" }, { rid: "h", maxBitrate: 7e5, maxFramerate: 30, scalabilityMode: "L1T1" }]], [1280, [{ rid: "q", scaleResolutionDownBy: 2, maxBitrate: 5e5, maxFramerate: 24, scalabilityMode: "L1T1" }, { rid: "h", maxBitrate: 13e5, maxFramerate: 30, scalabilityMode: "L1T1" }]], [1920, [{ rid: "q", scaleResolutionDownBy: 2, maxBitrate: 9e5, maxFramerate: 24, scalabilityMode: "L1T1" }, { rid: "h", maxBitrate: 15e5, maxFramerate: 30, scalabilityMode: "L1T1" }]]], fM = function(t, e) {
  var r, n, a, i = t == null || (r = t.getValue("overrides")) === null || r === void 0 ? void 0 : r.simulcastConfig;
  if (i != null && (n = i.encodings) !== null && n !== void 0 && n.length)
    return i.encodings;
  var s = "getSettings" in e && e.getSettings().width || "getConstraints" in e && e.getConstraints().width || "originalSettings" in e && ((a = e.originalSettings) === null || a === void 0 ? void 0 : a.width), u = vM;
  t.getValue("flagsmith").hasFeature(me.OVERRIDE_SIMULCAST_DYNAMIC) && (u = JSON.parse(t.getValue("flagsmith").getValue(me.OVERRIDE_SIMULCAST_DYNAMIC)));
  var c = u.map(function(v) {
    var f = He(v, 1), g = f[0];
    return g;
  }).sort(function(v, f) {
    return v - f;
  }), d = Number.MAX_VALUE, h = 0;
  return c.forEach(function(v, f) {
    Math.abs(v - s) < d && (d = Math.abs(v - s), h = f);
  }), u[h][1];
}, cr = /* @__PURE__ */ function(o) {
  return o.WEBCAM = "webcam", o.WEBCAM_BACKUP = "webcam_backup", o.MIC = "mic", o.SCREENSHARE_VIDEO = "screenshare_video", o.SCREENSHARE_AUDIO = "screenshare_audio", o;
}(cr || {}), gM = ET(), yo = jn(gM.config.media);
function mM(o) {
  var t = {};
  if (o.audio) {
    var e, r;
    t.audio = { enableStereo: (e = o.audio.enableStereo) !== null && e !== void 0 ? e : !1, enableHighBitrate: (r = o.audio.enableHighBitrate) !== null && r !== void 0 ? r : !1 };
  }
  return t.video = o.video.quality, t;
}
var ya = /* @__PURE__ */ S("mediaConstraints"), yt = /* @__PURE__ */ S("context"), yM = /* @__PURE__ */ function() {
  function o(t, e) {
    var r = this;
    w(this, o), Object.defineProperty(this, ya, { writable: !0, value: void 0 }), Object.defineProperty(this, yt, { writable: !0, value: void 0 }), this.getScreenShareConstraints = function() {
      var n, a, i, s, u, c, d, h, v, f = (n = l(r, ya)[ya]) === null || n === void 0 ? void 0 : n.screenshare, g = (a = f == null || (i = f.width) === null || i === void 0 ? void 0 : i.max) !== null && a !== void 0 ? a : 1920, k = (s = f == null || (u = f.height) === null || u === void 0 ? void 0 : u.max) !== null && s !== void 0 ? s : 1080, y = (c = f == null || (d = f.frameRate) === null || d === void 0 ? void 0 : d.max) !== null && c !== void 0 ? c : 5, b = (h = f == null || (v = f.frameRate) === null || v === void 0 ? void 0 : v.ideal) !== null && h !== void 0 ? h : 5, C = f == null ? void 0 : f.displaySurface, T = f == null ? void 0 : f.selfBrowserSurface;
      if (l(r, yt)[yt].getValue("flagsmith").getValue(me.VAL_MIN_FRAMERATE)) {
        var E;
        b = parseInt((E = l(r, yt)[yt].getValue("flagsmith").getValue(me.VAL_MIN_FRAMERATE)) === null || E === void 0 ? void 0 : E.toString(), 10);
      }
      var D = { width: { max: g }, height: { max: k }, frameRate: { ideal: b, max: y } };
      if (l(r, yt)[yt].getValue("flagsmith").hasFeature(me.SCREENSHARE_CONSTRAINTS)) {
        var I, _ = (I = l(r, yt)[yt].getValue("flagsmith").getValue(me.SCREENSHARE_CONSTRAINTS)) === null || I === void 0 ? void 0 : I.toString();
        D = JSON.parse(_);
      }
      return C !== void 0 && ["monitor", "browser", "window"].includes(C) && (D = $($({}, D), {}, { displaySurface: C })), T !== void 0 && (D = $($({}, D), {}, { selfBrowserSurface: T })), { audio: !0, video: D };
    }, this.getAudioConstraints = function(n) {
      var a, i, s, u, c = {}, d = (a = l(r, ya)[ya]) === null || a === void 0 ? void 0 : a.audio, h = d != null && d.enableStereo ? 2 : 1;
      if (kr.isFirefox() || kr.isWebKitBased()) {
        var v, f, g;
        return c.audio = { deviceId: n, autoGainControl: (v = d == null ? void 0 : d.autoGainControl) !== null && v !== void 0 ? v : !0, echoCancellation: (f = d == null ? void 0 : d.echoCancellation) !== null && f !== void 0 ? f : !0, noiseSuppression: (g = d == null ? void 0 : d.noiseSupression) !== null && g !== void 0 ? g : !0, channelCount: h }, c;
      }
      return c.audio = { autoGainControl: (i = d == null ? void 0 : d.autoGainControl) !== null && i !== void 0 ? i : !0, echoCancellation: (s = d == null ? void 0 : d.echoCancellation) !== null && s !== void 0 ? s : !0, noiseSuppression: (u = d == null ? void 0 : d.noiseSupression) !== null && u !== void 0 ? u : !0, channelCount: h }, n && n !== "default" && (c.audio.deviceId = { exact: n }), c;
    }, this.getVideoConstraints = function(n) {
      var a, i, s, u = {}, c = (a = l(r, ya)[ya]) === null || a === void 0 ? void 0 : a.video, d = vv.vga;
      if (typeof c == "string" ? d = vv[c] : c !== void 0 && (d.height.ideal = c.height.ideal, d.width.ideal = c.width.ideal), d.frameRate = { ideal: (i = (s = d.frameRate) === null || s === void 0 ? void 0 : s.ideal) !== null && i !== void 0 ? i : 24 }, kr.isChromiumBased() && (d.frameRate.max = 30), l(r, yt)[yt].getValue("flagsmith").hasFeature(me.VIDEO_CONSTRAINTS)) {
        var h, v = (h = l(r, yt)[yt].getValue("flagsmith").getValue(me.VIDEO_CONSTRAINTS)) === null || h === void 0 ? void 0 : h.toString();
        d = JSON.parse(v);
      }
      return u.video = d, typeof u.video == "boolean" || (n ? u.video.deviceId = { exact: n } : u.video.facingMode = "user"), u;
    }, l(this, yt)[yt] = t, l(this, ya)[ya] = e;
  }
  return P(o, [{ key: "getUpdatedVideoConstraints", value: (
    // eslint-disable-next-line class-methods-use-this
    function(e) {
      var r = e;
      return r;
    }
  ) }]);
}(), Qc = /* @__PURE__ */ function(o) {
  function t(e, r, n) {
    var a;
    return w(this, t), a = R(this, t, [r]), a.constraints = void 0, a.name = void 0, a.name = e, a.constraints = n, a;
  }
  return A(t, o), P(t);
}(/* @__PURE__ */ Gs(Error)), kM = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this.permissions = void 0, this.permissions = { audio: "NOT_REQUESTED", video: "NOT_REQUESTED", screenshare: "NOT_REQUESTED" };
  }
  return P(o, [{ key: "getAudioInputDevices", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = n, n) {
                s.next = 5;
                break;
              }
              return s.next = 4, this.getAvailableDevices();
            case 4:
              a = s.sent;
            case 5:
              return s.abrupt("return", a.filter(function(u) {
                return u.kind === "audioinput";
              }));
            case 6:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getVideoInputDevices", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = n, n) {
                s.next = 5;
                break;
              }
              return s.next = 4, this.getAvailableDevices();
            case 4:
              a = s.sent;
            case 5:
              return s.abrupt("return", a.filter(function(u) {
                return u.kind === "videoinput";
              }));
            case 6:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getAudioOutputDevices", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = n, n) {
                s.next = 5;
                break;
              }
              return s.next = 4, this.getAvailableDevices();
            case 4:
              a = s.sent;
            case 5:
              return s.abrupt("return", a.filter(function(u) {
                return u.kind === "audiooutput";
              }));
            case 6:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), bM = Object.defineProperty, TM = Object.getOwnPropertyDescriptor, Wn = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? TM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && bM(e, r, a), a;
}, nn = (li = /* @__PURE__ */ S("deviceChangeAbortController"), Br = /* @__PURE__ */ S("constraintsBuilder"), Ie = /* @__PURE__ */ S("context"), /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    return w(this, t), n = R(this, t), n.availableDevices = void 0, Object.defineProperty(n, li, { writable: !0, value: void 0 }), Object.defineProperty(n, Br, { writable: !0, value: void 0 }), Object.defineProperty(n, Ie, { writable: !0, value: void 0 }), l(n, Ie)[Ie] = e, l(n, Br)[Br] = new yM(e, r), l(n, li)[li] = new AbortController(), n.availableDevices = [], n.getAvailableDevices(), n;
  }
  return A(t, o), P(t, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Ie)[Ie].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, Ie)[Ie].getValue("logger");
  } }, { key: "constraintsBuilder", get: function() {
    return l(this, Br)[Br];
  } }, { key: "destruct", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              (a = l(this, li)[li]) === null || a === void 0 || a.abort();
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "handlePermissionErrors", value: function(r, n) {
    var a = Al(r, n.name, n.message);
    return this.permissions[r] = a, l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_ERROR, { message: a, constraints: n.constraints, kind: r }), a;
  } }, { key: "getAudioAndVideoTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d, h, v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              return s = { audio: l(this, Br)[Br].getAudioConstraints(a).audio, video: l(this, Br)[Br].getVideoConstraints(i).video }, k.prev = 1, this.logger.info("getUserMediaWithoutTimeout::requesting_user_media", { constraints: JSON.stringify(s) }), k.next = 5, navigator.mediaDevices.getUserMedia(s);
            case 5:
              if (u = k.sent, this.logger.info("getUserMediaWithoutTimeout::received_user_media", { constraints: JSON.stringify(s) }), c = u.getAudioTracks()[0], d = u.getVideoTracks()[0], this.permissions.audio = "ACCEPTED", this.permissions.video = "ACCEPTED", h = l(this, Ie)[Ie].getValue("flagsmith").hasFeature(me.OBS_QUALITY), !(h && d.label.includes("OBS Virtual"))) {
                k.next = 20;
                break;
              }
              return k.next = 15, this.getVideoInputDevices();
            case 15:
              return v = k.sent, f = v.find(function(y) {
                return y.label.includes("OBS Virtual");
              }), k.next = 19, this.getVideoTrack(f.deviceId);
            case 19:
              d = k.sent;
            case 20:
              return l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.audio, kind: "audio" }), l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.video, kind: "video" }), k.abrupt("return", { audioTrack: c, videoTrack: d });
            case 25:
              throw k.prev = 25, k.t0 = k.catch(1), this.logger.error("WebMediaInterface.getAudioAndVideoTrack", { error: k.t0 }), new U("Couldnt fetch audio and video track", "1605");
            case 29:
            case "end":
              return k.stop();
          }
      }, n, this, [[1, 25]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getAudioTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s = this, u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return v.next = 2, this.getAudioInputDevices();
            case 2:
              if (u = v.sent, u.length !== 0) {
                v.next = 7;
                break;
              }
              throw this.permissions.audio = "NO_DEVICES_AVAILABLE", l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.audio, kind: "audio" }), new U("No audio devices available", "1606");
            case 7:
              return c = /* @__PURE__ */ function() {
                var f = m(/* @__PURE__ */ p().mark(function g(k) {
                  var y, b, C, T, E, D, I, _;
                  return p().wrap(function(F) {
                    for (; ; )
                      switch (F.prev = F.next) {
                        case 0:
                          return F.prev = 0, u = u.filter(function(N) {
                            return N.deviceId !== k;
                          }), y = l(s, Br)[Br].getAudioConstraints(k), s.logger.info("getUserMediaWithoutTimeout::requesting_user_media", { constraints: JSON.stringify(y) }), F.next = 6, navigator.mediaDevices.getUserMedia(y);
                        case 6:
                          return b = F.sent.getAudioTracks(), C = He(b, 1), T = C[0], s.logger.info("getUserMediaWithoutTimeout::received_user_media", { constraints: JSON.stringify(y) }), F.abrupt("return", T);
                        case 13:
                          if (F.prev = 13, F.t0 = F.catch(0), E = Al("audio", F.t0.name, F.t0.message), D = new Qc(F.t0.name, F.t0.message, y), E !== "COULD_NOT_START") {
                            F.next = 25;
                            break;
                          }
                          if (I = u.shift(), I) {
                            F.next = 21;
                            break;
                          }
                          throw D;
                        case 21:
                          return s.logger.info("getAudioTrack::gum_failed", { constraints: JSON.stringify(y), error: F.t0 }), _ = l(s, Br)[Br].getAudioConstraints(I.deviceId), s.logger.info("getAudioTrack::retrying_gum_for_next_device", { constraints: JSON.stringify(_) }), F.abrupt("return", c(I.deviceId));
                        case 25:
                          throw D;
                        case 26:
                        case "end":
                          return F.stop();
                      }
                  }, g, null, [[0, 13]]);
                }));
                return function(k) {
                  return f.apply(this, arguments);
                };
              }(), v.prev = 8, v.next = 11, c(i);
            case 11:
              return d = v.sent, d.enabled = !a, this.permissions.audio !== "ACCEPTED" && (this.permissions.audio = "ACCEPTED", l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.audio, kind: "audio" })), v.abrupt("return", d);
            case 17:
              throw v.prev = 17, v.t0 = v.catch(8), v.t0.constraints && this.handlePermissionErrors("audio", v.t0), new U(v.t0.message, "1601");
            case 21:
            case "end":
              return v.stop();
          }
      }, n, this, [[8, 17]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getVideoTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s = this, u, c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              return u = l(this, Ie)[Ie].getValue("flagsmith").hasFeature(me.OBS_QUALITY), y.next = 3, this.getCurrentDeviceLabel(a);
            case 3:
              if (y.t1 = i = y.sent, y.t0 = y.t1 === null, y.t0) {
                y.next = 7;
                break;
              }
              y.t0 = i === void 0;
            case 7:
              if (!y.t0) {
                y.next = 11;
                break;
              }
              y.t2 = void 0, y.next = 12;
              break;
            case 11:
              y.t2 = i.includes("OBS Virtual");
            case 12:
              return c = y.t2, d = u && c, y.next = 16, this.getVideoInputDevices();
            case 16:
              if (h = y.sent, h.length !== 0) {
                y.next = 21;
                break;
              }
              throw this.permissions.video = "NO_DEVICES_AVAILABLE", l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.video, kind: "video" }), new U("No video devices available", "1607");
            case 21:
              return v = /* @__PURE__ */ function() {
                var b = m(/* @__PURE__ */ p().mark(function C(T) {
                  var E, D, I, _, V, F, N, L, H, Q, B, G, x, Pe;
                  return p().wrap(function(le) {
                    for (; ; )
                      switch (le.prev = le.next) {
                        case 0:
                          return le.prev = 0, E = T, D = E, I = D.video, d && typeof I != "boolean" && (E = { video: { deviceId: I.deviceId } }), s.logger.info("getUserMediaWithoutTimeout::requesting_user_media", { constraints: JSON.stringify(E) }), le.next = 7, navigator.mediaDevices.getUserMedia(E);
                        case 7:
                          return _ = le.sent.getVideoTracks(), V = He(_, 1), F = V[0], d && typeof I != "boolean" && be(I.width) === "object" && (N = F.getSettings(), L = N.width, H = N.height, Q = I.width.ideal, F.applyConstraints({ width: { ideal: Q }, height: { ideal: Math.floor(H * Q / L) }, frameRate: I.frameRate })), s.logger.info("getUserMediaWithoutTimeout::received_user_media", { constraints: JSON.stringify(E) }), le.abrupt("return", F);
                        case 15:
                          if (le.prev = 15, le.t0 = le.catch(0), B = Al("video", le.t0.name, le.t0.message), G = new Qc(le.t0.name, le.t0.message, T), B !== "COULD_NOT_START") {
                            le.next = 27;
                            break;
                          }
                          if (x = h.shift(), x) {
                            le.next = 23;
                            break;
                          }
                          throw G;
                        case 23:
                          return s.logger.info("getVideoTrack::gum_failed", { constraints: JSON.stringify(T), error: le.t0 }), Pe = l(s, Br)[Br].getVideoConstraints(x.deviceId), s.logger.info("getVideoTrack::retrying_gum_for_next_device", { constraints: JSON.stringify(Pe) }), le.abrupt("return", v({ video: Pe.video }));
                        case 27:
                          throw G;
                        case 28:
                        case "end":
                          return le.stop();
                      }
                  }, C, null, [[0, 15]]);
                }));
                return function(T) {
                  return b.apply(this, arguments);
                };
              }(), y.prev = 22, f = l(this, Br)[Br].getVideoConstraints(a), y.next = 26, v(f);
            case 26:
              return g = y.sent, this.permissions.video !== "ACCEPTED" && (this.permissions.video = "ACCEPTED", l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.video, kind: "video" })), y.abrupt("return", g);
            case 31:
              throw y.prev = 31, y.t3 = y.catch(22), y.t3.constraints && this.handlePermissionErrors("video", y.t3), new U(y.t3.message, "1602");
            case 35:
            case "end":
              return y.stop();
          }
      }, n, this, [[22, 31]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getScreenShareTracks", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a = this, i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return i = /* @__PURE__ */ function() {
                var h = m(/* @__PURE__ */ p().mark(function v(f) {
                  var g, k, y, b;
                  return p().wrap(function(T) {
                    for (; ; )
                      switch (T.prev = T.next) {
                        case 0:
                          return T.prev = 0, a.logger.info("getDisplayMediaWithoutTimeout::requesting_display_media", { constraints: JSON.stringify(f) }), l(a, Ie)[Ie].getValue("callstats").screenShareRequested(), T.next = 5, navigator.mediaDevices.getDisplayMedia(f);
                        case 5:
                          return g = T.sent, a.logger.info("getDisplayMediaWithoutTimeout::received_display_media", { constraints: JSON.stringify(f) }), T.abrupt("return", g);
                        case 10:
                          if (T.prev = 10, T.t0 = T.catch(0), k = Al("video", T.t0.name, T.t0.message), y = new Qc(T.t0.name, T.t0.message, f), b = { video: !0 }, !(pP(f, b) || !l(a, Ie)[Ie].getValue("flagsmith").hasFeature(me.SCREEENSHARE_CONSTRAINTS_RETRY))) {
                            T.next = 17;
                            break;
                          }
                          throw y;
                        case 17:
                          if (k !== "COULD_NOT_START") {
                            T.next = 19;
                            break;
                          }
                          return T.abrupt("return", i(b));
                        case 19:
                          throw y;
                        case 20:
                        case "end":
                          return T.stop();
                      }
                  }, v, null, [[0, 10]]);
                }));
                return function(f) {
                  return h.apply(this, arguments);
                };
              }(), d.prev = 1, s = l(this, Br)[Br].getScreenShareConstraints(), d.next = 5, i(s);
            case 5:
              return u = d.sent, this.permissions.screenshare !== "ACCEPTED" && (this.permissions.screenshare = "ACCEPTED", l(this, Ie)[Ie].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.permissions.screenshare, kind: "screenshare" })), d.abrupt("return", { audioTrack: u.getAudioTracks()[0], videoTrack: u.getVideoTracks()[0] });
            case 10:
              throw d.prev = 10, d.t0 = d.catch(1), d.t0.constraints && this.handlePermissionErrors("screenshare", d.t0), new U(d.t0.message, "1612");
            case 14:
            case "end":
              return d.stop();
          }
      }, n, this, [[1, 10]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getCurrentDeviceLabel", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, this.getDevice(a || "default");
            case 2:
              return i = u.sent, u.abrupt("return", i == null ? void 0 : i.label);
            case 4:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getAvailableDevices", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.prev = 0, s.next = 3, navigator.mediaDevices.enumerateDevices();
            case 3:
              return a = s.sent, this.availableDevices = a, s.abrupt("return", a);
            case 8:
              throw s.prev = 8, s.t0 = s.catch(0), this.logger.error("enumerate_devices_failed", { error: s.t0 }), new U("Failed to get available devices", "1609");
            case 12:
            case "end":
              return s.stop();
          }
      }, n, this, [[0, 8]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getAvailableDevicesByKind", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.prev = 0, s.next = 3, navigator.mediaDevices.enumerateDevices();
            case 3:
              return s.abrupt("return", s.sent.filter(function(u) {
                var c = u.kind;
                return a === c;
              }));
            case 6:
              throw s.prev = 6, s.t0 = s.catch(0), this.logger.error("enumerate_devices_failed", { error: s.t0 }), new U("Failed to get available devices by kind", "1609");
            case 10:
            case "end":
              return s.stop();
          }
      }, n, this, [[0, 6]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.prev = 0, u.next = 3, navigator.mediaDevices.enumerateDevices();
            case 3:
              return i = u.sent, u.abrupt("return", i.filter(function(c) {
                return c.deviceId === a;
              })[0]);
            case 7:
              throw u.prev = 7, u.t0 = u.catch(0), this.logger.error("enumerate_devices_failed", { error: u.t0 }), new U("Failed to get device", "1609");
            case 11:
            case "end":
              return u.stop();
          }
      }, n, this, [[0, 7]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onDeviceChange", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              kr.supportsDeviceChangeEvent() && navigator.mediaDevices.addEventListener("devicechange", /* @__PURE__ */ function() {
                var c = m(/* @__PURE__ */ p().mark(function d(h) {
                  var v, f, g, k, y, b, C, T, E;
                  return p().wrap(function(I) {
                    for (; ; )
                      switch (I.prev = I.next) {
                        case 0:
                          return g = function(V) {
                            return "".concat(V.kind, "-").concat(V.deviceId, "-").concat(V.groupId);
                          }, k = i.availableDevices, y = new Set(k.map(function(_) {
                            return g(_);
                          })), I.next = 5, i.getAvailableDevices();
                        case 5:
                          b = I.sent, C = new Set(b.map(function(_) {
                            return g(_);
                          })), T = { added: b.filter(function(_) {
                            return !y.has(g(_));
                          }), removed: k.filter(function(_) {
                            return !C.has(g(_));
                          }), devices: b }, ((v = T.added) !== null && v !== void 0 && v.length || (f = T.removed) !== null && f !== void 0 && f.length) && (i.logger.info("repopulated_full_device_list", { devices: JSON.stringify(b) }), E = [].concat(Se(T.added), Se(T.removed)), E.some(function(_) {
                            return _.kind === "audioinput";
                          }) && l(i, Ie)[Ie].getValue("callstats").devices("AUDIO", b == null ? void 0 : b.filter(function(_) {
                            return _.kind === "audioinput";
                          })), E.some(function(_) {
                            return _.kind === "videoinput";
                          }) && l(i, Ie)[Ie].getValue("callstats").devices("VIDEO", b == null ? void 0 : b.filter(function(_) {
                            return _.kind === "videoinput";
                          })), E.some(function(_) {
                            return _.kind === "audiooutput";
                          }) && l(i, Ie)[Ie].getValue("callstats").devices("SPEAKER", b == null ? void 0 : b.filter(function(_) {
                            return _.kind === "audiooutput";
                          })), a(h, T, !1));
                        case 9:
                        case "end":
                          return I.stop();
                      }
                  }, d);
                }));
                return function(d) {
                  return c.apply(this, arguments);
                };
              }(), { signal: l(this, li)[li].signal });
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(kM));
Wn([O.trace("WebMediaInterface.destruct")], nn.prototype, "destruct", 1);
Wn([O.trace("WebMediaInterface.handlePermissionErrors")], nn.prototype, "handlePermissionErrors", 1);
Wn([O.trace("WebMediaInterface.getAudioAndVideoTrack")], nn.prototype, "getAudioAndVideoTrack", 1);
Wn([O.trace("WebMediaInterface.getAudioTrack")], nn.prototype, "getAudioTrack", 1);
Wn([O.trace("WebMediaInterface.getVideoTrack")], nn.prototype, "getVideoTrack", 1);
Wn([O.trace("WebMediaInterface.getScreenShareTracks")], nn.prototype, "getScreenShareTracks", 1);
Wn([O.trace("WebMediaInterface.getAvailableDevices")], nn.prototype, "getAvailableDevices", 1);
Wn([O.trace("WebMediaInterface.getAvailableDevicesByKind")], nn.prototype, "getAvailableDevicesByKind", 1);
Wn([O.trace("WebMediaInterface.getDevice")], nn.prototype, "getDevice", 1);
Wn([O.trace("WebMediaInterface.onDeviceChange")], nn.prototype, "onDeviceChange", 1);
nn = Wn([vt("1600")], nn);
var Tg = nn, Du = { setItem: function(t, e, r) {
  try {
    localStorage.setItem(t, e);
  } catch (n) {
    r == null || r.error("LocalStorage::setItem::crashed", { error: n, localStorage: { key: t, value: e } });
  }
}, getItem: function(t, e) {
  try {
    return localStorage.getItem(t);
  } catch (r) {
    e == null || e.error("LocalStorage::getItem::crashed", { error: r, localStorage: { key: t } });
  }
  return null;
} }, wM = function() {
  var t = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : 0;
  return new Promise(function(e) {
    return setTimeout(e, t);
  });
}, PM = function(t, e, r) {
  var n = typeof r == "number" ? r : 250, a = t.createMediaStreamSource(e), i = t.createAnalyser();
  i.fftSize = 2048, a.connect(i);
  var s = new Uint8Array(i.fftSize), u = !1;
  setTimeout(function() {
    u = !0;
  }, n);
  function c() {
    return u ? Promise.resolve(!0) : (i.getByteTimeDomainData(s), s.some(function(d) {
      return d !== 128 && d !== 0;
    }) ? Promise.resolve(!1) : wM().then(c));
  }
  return c().then(function(d) {
    return a.disconnect(), d;
  }, function(d) {
    throw a.disconnect(), d;
  });
}, SM = typeof AudioContext != "undefined" ? AudioContext : null, EM = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this._AudioContext = void 0, this.audioContext = void 0, this._audioContextRefContainers = void 0;
    var e = $({ AudioContext: SM }, t);
    Object.defineProperties(this, { _AudioContext: { value: e.AudioContext }, audioContext: { value: null, writable: !0 }, _audioContextRefContainers: { value: /* @__PURE__ */ new Set() }, AudioContextProvider: { enumerable: !0, value: o } });
  }
  return P(o, [{ key: "getOrCreate", value: function(e) {
    if (!this._audioContextRefContainers.has(e) && (this._audioContextRefContainers.add(e), this._AudioContext && !this.audioContext))
      try {
        this.audioContext = new this._AudioContext();
      } catch (r) {
      }
    return this.audioContext;
  } }, { key: "release", value: function(e) {
    this._audioContextRefContainers.has(e) && (this._audioContextRefContainers.delete(e), !this._audioContextRefContainers.size && this.audioContext && (this.audioContext.close(), this.audioContext = null));
  } }]);
}(), fv = new EM(), CM = 3, RM = 250;
function AM(o) {
  var t = {}, e = fv.getOrCreate(t), r = CM;
  function n() {
    return r -= 1, PM(e, o.srcObject, RM).then(function(a) {
      return a ? r > 0 ? n() : !0 : !1;
    }).catch(function() {
      return !0;
    });
  }
  return n().finally(function() {
    fv.release(t);
  });
}
function gv(o, t) {
  return Hd.apply(this, arguments);
}
function Hd() {
  return Hd = m(/* @__PURE__ */ p().mark(function o(t, e) {
    var r, n, a, i;
    return p().wrap(function(u) {
      for (; ; )
        switch (u.prev = u.next) {
          case 0:
            if (r = new Audio(), n = new MediaStream(), n.addTrack(e), r.srcObject = n, a = !1, u.prev = 5, i = r.play(), !i) {
              u.next = 10;
              break;
            }
            return u.next = 10, i;
          case 10:
            return u.next = 12, AM(r);
          case 12:
            a = u.sent, a && t.info("checkIfAudioTrackIsSilent::silence_detected"), u.next = 19;
            break;
          case 16:
            u.prev = 16, u.t0 = u.catch(5), t.error("checkIfAudioTrackIsSilent::failed_to_detect_silence", { error: u.t0 });
          case 19:
            return u.prev = 19, r.pause(), r.remove(), u.finish(19);
          case 23:
            return u.abrupt("return", a);
          case 24:
          case "end":
            return u.stop();
        }
    }, o, null, [[5, 16, 19, 23]]);
  })), Hd.apply(this, arguments);
}
var IM = Object.defineProperty, MM = Object.getOwnPropertyDescriptor, wg = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? MM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && IM(e, r, a), a;
}, tc = /* @__PURE__ */ function(o) {
  function t(e, r, n, a) {
    var i, s;
    w(this, t);
    var u = e.getValue("logger");
    return s = R(this, t, [u]), s.constructorName = s.constructor.name, s.userSelectedDevice = void 0, s.mediaInterface = void 0, s.isNonPreferredDevice = void 0, s._mediaTrack = void 0, s.transformedMediaTrack = void 0, s.middlewares = [], s.currentDevice = void 0, s.userPreferredDeviceKey = "Realtimekit::".concat(s.constructorName, "::UserDeviceID"), s.setUserPreferredDevice = function(c) {
      return Du.setItem(s.userPreferredDeviceKey, c, s.logger);
    }, s.getUserPreferredDevice = function() {
      return Du.getItem(s.userPreferredDeviceKey, s.logger);
    }, s.isCustomTrack = !1, s.context = void 0, s.context = e, s.mediaInterface = r, n && s.setMediaTrack(n), s.userSelectedDevice = (i = s.getUserPreferredDevice()) !== null && i !== void 0 ? i : void 0, s.isNonPreferredDevice = a, s.onTrackEnded = s.onTrackEnded.bind(s), s.onTrackMuted = s.onTrackMuted.bind(s), s;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return this.context.getValue("telemetry");
    }
  ) }, { key: "disableTrack", value: function() {
    var r;
    if (this.removeMediaTrackListeners(), !this.isCustomTrack) {
      var n;
      (n = this._mediaTrack) === null || n === void 0 || n.stop();
    }
    this._mediaTrack = void 0, (r = this.transformedMediaTrack) === null || r === void 0 || r.stop(), this.transformedMediaTrack = void 0;
  } }, { key: "mediaTrack", get: function() {
    return this._mediaTrack;
  } }, {
    key: "setMediaTrack",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i = this, s, u, c = arguments;
        return p().wrap(function(h) {
          for (; ; )
            switch (h.prev = h.next) {
              case 0:
                s = c.length > 1 && c[1] !== void 0 ? c[1] : !1, u = function(f) {
                  i.logger.error("".concat(i.constructorName, ".setMediaTrack.error"), { error: f });
                };
                try {
                  this.disableTrack();
                } catch (v) {
                  u(v);
                }
                return h.next = 5, this.conditionallyChangeTrack(a, s);
              case 5:
                return this._mediaTrack = h.sent, h.next = 8, this.setTransformedTrack();
              case 8:
                return h.prev = 8, this.addMediaTrackListeners(), h.next = 12, this.setCurrentDevice();
              case 12:
                h.next = 17;
                break;
              case 14:
                h.prev = 14, h.t0 = h.catch(8), u(h.t0);
              case 17:
              case "end":
                return h.stop();
            }
        }, n, this, [[8, 14]]);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Represents current audio/video state according to track status
    */
  }, {
    key: "trackEnabled",
    get: function() {
      return !!this.mediaTrack && this.mediaTrack.readyState === "live" && this.mediaTrack.enabled;
    }
    /**
    * Mutes track if it's present, DOES NOT STOP IT!
    * Only used for audio streams
    */
  }, { key: "muteTrack", value: function() {
    if (!this.mediaTrack) {
      this.logger.warn("BaseMediaHandler.muteTrack Tried muting with no track present");
      return;
    }
    this.transformedMediaTrack && (this.transformedMediaTrack.enabled = !1), this.mediaTrack.enabled = !1;
  } }, {
    key: "unmuteTrack",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                if (i.prev = 0, this.mediaTrack) {
                  i.next = 6;
                  break;
                }
                return i.next = 4, this.enableTrack(!1);
              case 4:
                i.next = 7;
                break;
              case 6:
                this.mediaTrack.enabled = !0;
              case 7:
                i.next = 14;
                break;
              case 9:
                throw i.prev = 9, i.t0 = i.catch(0), this.logger.error("".concat(this.constructorName, ".unmuteTrack.error"), { error: i.t0 }), this.disableTrack(), new U("Failed to unmute track", "1611");
              case 14:
              case "end":
                return i.stop();
            }
        }, n, this, [[0, 9]]);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // NOTE(ishita1805): Not to be used for screenshare or audiooutput
  }, {
    key: "getCurrentDeviceId",
    value: function() {
      var r = this.mediaTrack.kind;
      switch (r) {
        case "audio": {
          var n, a = this.mediaTrack.getSettings(), i = a.deviceId;
          if (i)
            return i;
          var s = this.mediaTrack.getConstraints();
          return this.userSelectedDevice ? (s && be(s.deviceId) === "object" && "exact" in s.deviceId ? s.deviceId.exact : s.deviceId) || (s == null || (n = s.advanced) === null || n === void 0 ? void 0 : n[0].deviceId) || "default" : this.mediaTrack.getSettings().deviceId;
        }
        default:
          return this.mediaTrack.getSettings().deviceId;
      }
    }
    /**
    * Called after every track switch, maintains local state of current
    * selected device for this particular stream.
    */
  }, { key: "setCurrentDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this.mediaTrack) {
                u.next = 3;
                break;
              }
              return this.currentDevice = void 0, u.abrupt("return");
            case 3:
              if (i = this.getCurrentDeviceId(), ((a = this.currentDevice) === null || a === void 0 ? void 0 : a.deviceId) !== i) {
                u.next = 6;
                break;
              }
              return u.abrupt("return");
            case 6:
              return u.next = 8, this.mediaInterface.getDevice(i);
            case 8:
              this.currentDevice = u.sent;
            case 9:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "setDevice",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (a) {
                  s.next = 3;
                  break;
                }
                throw this.logger.warn("".concat(this.constructorName, ".setDevice No device received")), new U("No device received!", "1603");
              case 3:
                return this.userSelectedDevice = a.deviceId, this.setUserPreferredDevice(a.deviceId), s.next = 7, this.onSetDevice(a);
              case 7:
              case "end":
                return s.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Middleware Utility
    */
  }, { key: "addMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!(kr.isWebKitBased() && !vT.hasFeature(me.ALLOW_SAFARI_MEDIA_MIDDLEWARES))) {
                s.next = 2;
                break;
              }
              return s.abrupt("return", { success: !1, message: "Middlewares are not supported in this WebKit engine based browser." });
            case 2:
              if (!this.middlewares.includes(a)) {
                s.next = 4;
                break;
              }
              return s.abrupt("return", { success: !1, message: "This middleware has been applied, already. Skipping." });
            case 4:
              if (s.prev = 4, this.middlewares.push(a), !this.trackEnabled) {
                s.next = 9;
                break;
              }
              return s.next = 9, this.setTransformedTrack();
            case 9:
              return s.abrupt("return", { success: !0, message: "Successfully added the middleware." });
            case 12:
              return s.prev = 12, s.t0 = s.catch(4), this.logger.error("While adding middleware", { error: s.t0 }), this.removeMiddleware(a), s.abrupt("return", { success: !1, message: s.t0 === null || s.t0 === void 0 ? void 0 : s.t0.message });
            case 17:
            case "end":
              return s.stop();
          }
      }, n, this, [[4, 12]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (i = this.middlewares.indexOf(a, 0), !(i > -1)) {
                u.next = 13;
                break;
              }
              return u.prev = 2, this.middlewares.splice(i, 1), u.next = 6, this.setTransformedTrack(!0);
            case 6:
              return u.abrupt("return", { success: !0, message: "Successfully removed the middleware." });
            case 9:
              return u.prev = 9, u.t0 = u.catch(2), this.logger.error("While removing middleware", { error: u.t0 }), u.abrupt("return", { success: !1, message: u.t0 === null || u.t0 === void 0 ? void 0 : u.t0.message });
            case 13:
              return u.abrupt("return", { success: !1, message: "No such middleware was found. Skipping." });
            case 14:
            case "end":
              return u.stop();
          }
      }, n, this, [[2, 9]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeAllMiddlewares", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!((a = this.middlewares) !== null && a !== void 0 && a.length)) {
                s.next = 12;
                break;
              }
              return s.prev = 1, this.middlewares = [], s.next = 5, this.setTransformedTrack(!0);
            case 5:
              return s.abrupt("return", { success: !0, message: "Successfully removed all the middlewares." });
            case 8:
              return s.prev = 8, s.t0 = s.catch(1), this.logger.error("While removing all the middlewares", { error: s.t0 }), s.abrupt("return", { success: !1, message: s.t0 === null || s.t0 === void 0 ? void 0 : s.t0.message });
            case 12:
              return s.abrupt("return", { success: !1, message: "No middlewares were found. Skipping." });
            case 13:
            case "end":
              return s.stop();
          }
      }, n, this, [[1, 8]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "addMediaTrackListeners", value: function() {
    var r, n;
    this.mediaTrack && (this.logger.info("".concat(this.constructorName, ".addMediaTrackListeners for deviceId ").concat((r = this.mediaTrack) === null || r === void 0 || (r = r.getSettings()) === null || r === void 0 ? void 0 : r.deviceId, " of type ").concat((n = this.mediaTrack) === null || n === void 0 ? void 0 : n.kind)), this.mediaTrack.addEventListener("ended", this.onTrackEnded), this.mediaTrack.addEventListener("mute", this.onTrackMuted));
  } }, { key: "removeMediaTrackListeners", value: function() {
    var r, n;
    this.mediaTrack && (this.logger.info("".concat(this.constructorName, ".removeMediaTrackListeners for deviceId ").concat((r = this.mediaTrack) === null || r === void 0 || (r = r.getSettings()) === null || r === void 0 ? void 0 : r.deviceId, " of type ").concat((n = this.mediaTrack) === null || n === void 0 ? void 0 : n.kind)), this.logger.info("".concat(this.constructorName, ".removeMediaTrackListeners")), this.mediaTrack.removeEventListener("ended", this.onTrackEnded), this.mediaTrack.removeEventListener("mute", this.onTrackMuted));
  } }]);
}(jo);
wg([O.trace("BaseMediaHandler.unmuteTrack")], tc.prototype, "unmuteTrack", 1);
tc = wg([vt("1600")], tc);
var Pg = tc, _M = Object.defineProperty, OM = Object.getOwnPropertyDescriptor, Wp = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? OM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && _M(e, r, a), a;
}, Xc = "[Realtimekit]nonSilentDeviceLabels", Ec = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t, [{ key: "onSetDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (a) {
                u.next = 3;
                break;
              }
              throw this.logger.warn("AudioMediaHandler.setDevice No device received"), new U("No device received!", "1603");
            case 3:
              if (a.kind === "audioinput") {
                u.next = 6;
                break;
              }
              throw this.logger.warn("AudioMediaHandler.setDevice Received non audio device"), new U("Non audio device received while setting device!", "1603");
            case 6:
              return u.prev = 6, i = this.trackEnabled, u.t0 = this, u.next = 11, this.mediaInterface.getAudioTrack(!i, this.userSelectedDevice);
            case 11:
              return u.t1 = u.sent, u.next = 14, u.t0.setMediaTrack.call(u.t0, u.t1);
            case 14:
              u.next = 21;
              break;
            case 16:
              throw u.prev = 16, u.t2 = u.catch(6), this.logger.error("AudioMediaHandler.setDevice.error", { error: u.t2 }), this.disableTrack(), new U(u.t2.message, "1604");
            case 21:
            case "end":
              return u.stop();
          }
      }, n, this, [[6, 16]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (!this.trackEnabled) {
                c.next = 3;
                break;
              }
              return this.logger.warn("AudioMediaHandler.enableTrack Track already enabled!"), c.abrupt("return");
            case 3:
              if (!i) {
                c.next = 8;
                break;
              }
              return this.isCustomTrack = !0, c.next = 7, this.setMediaTrack(i, !0);
            case 7:
              return c.abrupt("return");
            case 8:
              return this.isCustomTrack = !1, c.next = 11, this.mediaInterface.getAudioTrack(a, this.userSelectedDevice);
            case 11:
              return s = c.sent, c.next = 14, this.setMediaTrack(s);
            case 14:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setTransformedTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (!(!a && !((i = this.middlewares) !== null && i !== void 0 && i.length))) {
                u.next = 3;
                break;
              }
              return this.transformedMediaTrack = this.mediaTrack, u.abrupt("return");
            case 3:
              return u.prev = 3, u.next = 6, pM(this.context, this.middlewares, this.mediaTrack);
            case 6:
              this.transformedMediaTrack = u.sent, this.emit("trackChanged"), u.next = 14;
              break;
            case 10:
              u.prev = 10, u.t0 = u.catch(3), this.logger.error("AudioMediaHandler.setTransformedTrack", { error: u.t0 }), this.transformedMediaTrack = this.mediaTrack;
            case 14:
            case "end":
              return u.stop();
          }
      }, n, this, [[3, 10]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onTrackEnded", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.logger.info("AudioMediaHandler.TrackEnded"), this.emit("trackEnded"), a = this.mediaTrack.enabled, this.disableTrack(), s.next = 6, this.enableTrack(!a);
            case 6:
              return s.next = 8, this.setTransformedTrack();
            case 8:
              this.emit("trackChanged");
            case 9:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onTrackMuted", value: function() {
    this.logger.info("AudioMediaHandler.TrackMuted"), this.emit("trackMuted");
  } }, { key: "conditionallyChangeTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h, v, f, g, k = arguments;
      return p().wrap(function(b) {
        for (; ; )
          switch (b.prev = b.next) {
            case 0:
              if (s = k.length > 1 && k[1] !== void 0 ? k[1] : !1, a) {
                b.next = 3;
                break;
              }
              return b.abrupt("return", a);
            case 3:
              if (!(this.userSelectedDevice || s)) {
                b.next = 5;
                break;
              }
              return b.abrupt("return", a);
            case 5:
              return u = a, b.next = 8, this.mediaInterface.getAudioInputDevices();
            case 8:
              if (c = b.sent, d = this.isNonPreferredDevice ? c.filter(function(C) {
                return C && !i.isNonPreferredDevice(C);
              }) : c, d != null && d.length) {
                b.next = 12;
                break;
              }
              return b.abrupt("return", u);
            case 12:
              if (d.find(function(C) {
                return C.deviceId === a.getSettings().deviceId;
              })) {
                b.next = 18;
                break;
              }
              return u.stop(), this.logger.info("localmediahandler::setupstreams::found_audio_non_preferred"), b.next = 17, this.mediaInterface.getAudioTrack(!1, d[0].deviceId);
            case 17:
              u = b.sent;
            case 18:
              if (h = JSON.parse(Du.getItem(Xc, this.logger)), !(h != null && h.devices.some(function(C) {
                return C.label === u.label;
              }))) {
                b.next = 21;
                break;
              }
              return b.abrupt("return", u);
            case 21:
              return b.next = 23, gv(this.logger, u);
            case 23:
              if (b.sent) {
                b.next = 27;
                break;
              }
              return f = (v = h == null ? void 0 : h.devices.concat({ label: u.label })) !== null && v !== void 0 ? v : [{ label: u.label }], Du.setItem(Xc, JSON.stringify({ devices: f }), this.logger), b.abrupt("return", u);
            case 27:
              return this.logger.info("AudioMediaHandler.conditionallyChangeTrack.DetectedSilentTrack"), g = u.getSettings().deviceId, d.filter(function(C) {
                return C.deviceId !== g;
              }).some(/* @__PURE__ */ function() {
                var C = m(/* @__PURE__ */ p().mark(function T(E) {
                  var D, I;
                  return p().wrap(function(V) {
                    for (; ; )
                      switch (V.prev = V.next) {
                        case 0:
                          return V.next = 2, i.mediaInterface.getAudioTrack(!1, E.deviceId);
                        case 2:
                          return u = V.sent, V.next = 5, gv(i.logger, u);
                        case 5:
                          if (V.sent) {
                            V.next = 10;
                            break;
                          }
                          return I = (D = h == null ? void 0 : h.devices.concat({ label: u.label })) !== null && D !== void 0 ? D : [{ label: u.label }], Du.setItem(Xc, JSON.stringify({ devices: I }), i.logger), i.logger.info("AudioMediaHandler.conditionallyChangeTrack.SuccesfullyChangedTrack"), V.abrupt("return", !0);
                        case 10:
                          return i.logger.info("AudioMediaHandler.conditionallyChangeTrack.AnotherSilentTrackFound"), V.abrupt("return", !1);
                        case 12:
                        case "end":
                          return V.stop();
                      }
                  }, T);
                }));
                return function(T) {
                  return C.apply(this, arguments);
                };
              }()), b.abrupt("return", u);
            case 31:
            case "end":
              return b.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(Pg);
Wp([O.trace("AudioMediaHandler.setTransformedTrack")], Ec.prototype, "setTransformedTrack", 1);
Wp([O.trace("AudioMediaHandler.onTrackEnded")], Ec.prototype, "onTrackEnded", 1);
Wp([O.trace("AudioMediaHandler.conditionallyChangeTrack")], Ec.prototype, "conditionallyChangeTrack", 1);
var DM = Ec, cs = /* @__PURE__ */ S("mediaInterface"), LM = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, cs, { writable: !0, value: void 0 }), this.currentDevice = void 0, l(this, cs)[cs] = t;
  }
  return P(o, [{ key: "setupSpeaker", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s = this, u, c, d, h, v;
      return p().wrap(function(g) {
        for (; ; )
          switch (g.prev = g.next) {
            case 0:
              if (l(this, cs)[cs] instanceof Tg) {
                g.next = 2;
                break;
              }
              return g.abrupt("return");
            case 2:
              if (u = n, n) {
                g.next = 10;
                break;
              }
              return g.next = 6, l(this, cs)[cs].getAvailableDevicesByKind("audiooutput");
            case 6:
              c = g.sent, d = c.filter(function(k) {
                return !jd(k);
              }), h = He(d, 1), u = h[0];
            case 10:
              if (u) {
                g.next = 12;
                break;
              }
              throw new U("No speaker found", "1608");
            case 12:
              if (((a = this.currentDevice) === null || a === void 0 ? void 0 : a.deviceId) !== u.deviceId) {
                g.next = 14;
                break;
              }
              return g.abrupt("return");
            case 14:
              if (this.currentDevice = u, v = document.querySelectorAll("audio"), (i = v[0]) !== null && i !== void 0 && i.setSinkId) {
                g.next = 18;
                break;
              }
              return g.abrupt("return");
            case 18:
              v.forEach(/* @__PURE__ */ function() {
                var k = m(/* @__PURE__ */ p().mark(function y(b) {
                  return p().wrap(function(T) {
                    for (; ; )
                      switch (T.prev = T.next) {
                        case 0:
                          if (!(typeof b.sinkId != "undefined" && s.currentDevice.deviceId && b.sinkId !== s.currentDevice.deviceId)) {
                            T.next = 8;
                            break;
                          }
                          return T.prev = 1, T.next = 4, b.setSinkId(s.currentDevice.deviceId);
                        case 4:
                          T.next = 8;
                          break;
                        case 6:
                          T.prev = 6, T.t0 = T.catch(1);
                        case 8:
                        case "end":
                          return T.stop();
                      }
                  }, y, null, [[1, 6]]);
                }));
                return function(y) {
                  return k.apply(this, arguments);
                };
              }());
            case 19:
            case "end":
              return g.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), $M = LM, au = /* @__PURE__ */ S("context"), NM = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    w(this, t);
    var a = e.getValue("logger");
    return n = R(this, t, [a]), n.mediaInterface = void 0, n.audioMediaTrack = void 0, n.videoMediaTrack = void 0, Object.defineProperty(n, au, { writable: !0, value: void 0 }), l(n, au)[au] = e, n.mediaInterface = r, n;
  }
  return A(t, o), P(t, [{ key: "trackEnabled", get: function() {
    return !!this.videoMediaTrack;
  } }, { key: "enableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.prev = 0, d.next = 3, this.mediaInterface.getScreenShareTracks();
            case 3:
              if (i = d.sent, s = i.audioTrack, u = i.videoTrack, this.audioMediaTrack = s, this.videoMediaTrack = u, this.addMediaTrackListeners(), ((a = this.mediaInterface) === null || a === void 0 || (a = a.permissions) === null || a === void 0 ? void 0 : a.screenshare) !== "ACCEPTED") {
                d.next = 11;
                break;
              }
              return d.abrupt("return");
            case 11:
              this.mediaInterface.permissions && (this.mediaInterface.permissions.screenshare = "ACCEPTED", l(this, au)[au].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, { message: this.mediaInterface.permissions.screenshare, kind: "screenshare" })), d.next = 16;
              break;
            case 14:
              d.prev = 14, d.t0 = d.catch(0);
            case 16:
            case "end":
              return d.stop();
          }
      }, n, this, [[0, 14]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableScreenShare", value: function() {
    var r, n;
    this.removeMediaTrackListeners(), (r = this.audioMediaTrack) === null || r === void 0 || r.stop(), (n = this.videoMediaTrack) === null || n === void 0 || n.stop(), this.videoMediaTrack = void 0, this.audioMediaTrack = void 0;
  } }, { key: "updateConstraints", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this.videoMediaTrack) {
                u.next = 2;
                break;
              }
              throw new U("No media track enabled!", "1610");
            case 2:
              if (i = this.mediaInterface, i.constraintsBuilder) {
                u.next = 5;
                break;
              }
              throw new U("update constraints not supported for non web clients", "1100", this.logger);
            case 5:
              try {
                this.videoMediaTrack.applyConstraints(i.constraintsBuilder.getUpdatedVideoConstraints(a)), this.addMediaTrackListeners();
              } catch (c) {
                this.logger.error("ScreenShareHandler.updateConstraints.error", { error: c });
              }
            case 6:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "addMediaTrackListeners", value: function() {
    var r;
    if ((r = this.videoMediaTrack) === null || r === void 0 || r.addEventListener("ended", this.onTrackEnded.bind(this)), kr.isWebKitBased()) {
      var n;
      (n = this.videoMediaTrack) === null || n === void 0 || n.addEventListener("mute", this.onTrackEnded.bind(this));
    }
  } }, { key: "removeMediaTrackListeners", value: function() {
    var r, n;
    (r = this.videoMediaTrack) === null || r === void 0 || r.removeEventListener("ended", this.onTrackEnded), (n = this.videoMediaTrack) === null || n === void 0 || n.removeEventListener("mute", this.onTrackEnded);
  } }, { key: "onTrackEnded", value: function() {
    this.emit("trackEnded");
  } }]);
}(jo), VM = NM, UM = Object.defineProperty, jM = Object.getOwnPropertyDescriptor, Cc = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? jM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && UM(e, r, a), a;
}, ds = /* @__PURE__ */ S("videoMiddlewareUtils"), iu = /* @__PURE__ */ S("middlewareGlobalConfig"), ol = /* @__PURE__ */ function(o) {
  function t(e, r, n, a) {
    var i;
    return w(this, t), i = R(this, t, [e, r, n, a]), Object.defineProperty(i, ds, { writable: !0, value: void 0 }), Object.defineProperty(i, iu, { writable: !0, value: { disablePerFrameCanvasRendering: !1 } }), l(i, ds)[ds] = new hM(e), i;
  }
  return A(t, o), P(t, [{ key: "onSetDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a) {
                s.next = 3;
                break;
              }
              throw this.logger.warn("VideoMediaHandler.setDevice No device received"), new U("No device received!", "1603");
            case 3:
              if (a.kind === "videoinput") {
                s.next = 6;
                break;
              }
              throw this.logger.warn("VideoMediaHandler.setDevice Received non video device", { devices: [a] }), new U("Non video device received while setting video device!", "1603");
            case 6:
              if (this.mediaTrack && this.mediaTrack.enabled) {
                s.next = 10;
                break;
              }
              return this.logger.warn("VideoMediaHandler.setDevice Tried switching device with video disabled", { devices: [a] }), this.currentDevice = a, s.abrupt("return");
            case 10:
              return s.prev = 10, s.t0 = this, s.next = 14, this.mediaInterface.getVideoTrack(this.userSelectedDevice);
            case 14:
              return s.t1 = s.sent, s.next = 17, s.t0.setMediaTrack.call(s.t0, s.t1);
            case 17:
              s.next = 24;
              break;
            case 19:
              throw s.prev = 19, s.t2 = s.catch(10), this.logger.error("VideoMediaHandler.setDevice.error", { error: s.t2 }), this.disableTrack(), new U("Failed to change device", "1600", this.logger);
            case 24:
            case "end":
              return s.stop();
          }
      }, n, this, [[10, 19]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (!this.trackEnabled) {
                c.next = 3;
                break;
              }
              return this.logger.warn("VideoMediaHandler.enableTrack Track already enabled!"), c.abrupt("return");
            case 3:
              if (!i) {
                c.next = 8;
                break;
              }
              return this.isCustomTrack = !0, c.next = 7, this.setMediaTrack(i, !0);
            case 7:
              return c.abrupt("return");
            case 8:
              return this.isCustomTrack = !1, c.next = 11, this.mediaInterface.getVideoTrack(this.userSelectedDevice);
            case 11:
              return s = c.sent, c.next = 14, this.setMediaTrack(s);
            case 14:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setTransformedTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (!(!a && !((i = this.middlewares) !== null && i !== void 0 && i.length))) {
                u.next = 3;
                break;
              }
              return this.transformedMediaTrack = this.mediaTrack, u.abrupt("return");
            case 3:
              return u.prev = 3, u.next = 6, l(this, ds)[ds].getTransformedVideoTrack(this.middlewares, this.mediaTrack, l(this, iu)[iu]);
            case 6:
              this.transformedMediaTrack = u.sent, this.emit("trackChanged"), u.next = 14;
              break;
            case 10:
              u.prev = 10, u.t0 = u.catch(3), this.logger.error("VideoMediaHandler.setTransformedTrack", { error: u.t0 }), this.transformedMediaTrack = this.mediaTrack;
            case 14:
            case "end":
              return u.stop();
          }
      }, n, this, [[3, 10]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setVideoMiddlewareGlobalConfig", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              l(this, iu)[iu] = a;
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateConstraints", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this._mediaTrack) {
                u.next = 2;
                break;
              }
              throw new U("No media track enabled!", "1610");
            case 2:
              if (i = this.mediaInterface, i.constraintsBuilder) {
                u.next = 5;
                break;
              }
              throw new U("update constraints not supported for non web clients", "1100", this.logger);
            case 5:
              return u.prev = 5, this._mediaTrack.applyConstraints(i.constraintsBuilder.getUpdatedVideoConstraints(a)), u.next = 9, this.setTransformedTrack();
            case 9:
              return this.addMediaTrackListeners(), u.next = 12, this.setCurrentDevice();
            case 12:
              u.next = 17;
              break;
            case 14:
              u.prev = 14, u.t0 = u.catch(5), this.logger.error("VideoMediaHandler.updateConstraints.error", { error: u.t0 });
            case 17:
            case "end":
              return u.stop();
          }
      }, n, this, [[5, 14]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "terminateMiddlewareWebWorker", value: function() {
    l(this, ds)[ds].terminateMiddlewareWebWorker();
  } }, { key: "onTrackEnded", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              this.logger.info("VideoMediaHandler.TrackEnded"), this.disableTrack(), this.emit("trackEnded");
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "onTrackMuted", value: function() {
    this.logger.info("VideoMediaHandler.TrackMuted"), this.emit("trackMuted");
  } }, { key: "conditionallyChangeTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              if (s = h.length > 1 && h[1] !== void 0 ? h[1] : !1, a) {
                f.next = 3;
                break;
              }
              return f.abrupt("return", a);
            case 3:
              if (!(this.userSelectedDevice || s)) {
                f.next = 5;
                break;
              }
              return f.abrupt("return", a);
            case 5:
              return u = a, f.next = 8, this.mediaInterface.getVideoInputDevices();
            case 8:
              if (c = f.sent, d = this.isNonPreferredDevice ? c.filter(function(g) {
                return !i.isNonPreferredDevice(g);
              }) : c, d != null && d.length) {
                f.next = 12;
                break;
              }
              return f.abrupt("return", u);
            case 12:
              if (!window.FAST_RTK) {
                f.next = 14;
                break;
              }
              return f.abrupt("return", u);
            case 14:
              if (d.find(function(g) {
                return g.deviceId === a.getSettings().deviceId;
              })) {
                f.next = 20;
                break;
              }
              return u.stop(), this.logger.info("localmediahandler::setupstreams::found_video_non_preferred"), f.next = 19, this.mediaInterface.getVideoTrack(d[0].deviceId);
            case 19:
              u = f.sent;
            case 20:
              return f.abrupt("return", u);
            case 21:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(Pg);
Cc([O.trace("VideoMediaHandler.setTransformedTrack")], ol.prototype, "setTransformedTrack", 1);
Cc([O.trace("VideoMediaHandler.setVideoMiddlewareGlobalConfig")], ol.prototype, "setVideoMiddlewareGlobalConfig", 1);
Cc([O.trace("VideoMediaHandler.onTrackEnded")], ol.prototype, "onTrackEnded", 1);
Cc([O.trace("VideoMediaHandler.conditionallyChangeTrack")], ol.prototype, "conditionallyChangeTrack", 1);
var FM = ol, mv = jn(Np()), Er = /* @__PURE__ */ S("config"), ka = /* @__PURE__ */ S("theme"), su = /* @__PURE__ */ S("name"), ps = /* @__PURE__ */ S("pluginsConfig"), HM = /* @__PURE__ */ function() {
  function o(t) {
    if (w(this, o), Object.defineProperty(this, Er, { writable: !0, value: void 0 }), Object.defineProperty(this, ka, { writable: !0, value: void 0 }), Object.defineProperty(this, su, { writable: !0, value: void 0 }), Object.defineProperty(this, ps, { writable: !0, value: void 0 }), !t)
      throw new U("Could not load preset.", "0904");
    l(this, Er)[Er] = t.config, l(this, su)[su] = t.name, l(this, ka)[ka] = t.ui || jn(Np().ui), l(this, ps)[ps] = t.permissions.plugins.config;
  }
  return P(o, [{
    key: "setupScreen",
    get: (
      /**
      * @deprecated
      * The `setupScreen` represents the setup screen for the meeting.
      */
      function() {
        return { isEnabled: !0 };
      }
    )
    /**
    * @deprecated
    * The `waitingRoom` contains the properties to show a layout when
    * the participant is in waiting to join the meeting.
    */
  }, {
    key: "waitingRoom",
    get: function() {
      return { isEnabled: !0 };
    }
    /**
    * @deprecated
    * The `controlBar` contains the properties to show the meeting control bar with
    * various action buttons for the meeting.
    * The `elements` key contains the various action buttons.
    */
  }, {
    key: "controlBar",
    get: function() {
      return { isEnabled: !0, elements: { chat: !0, fullscreen: !0, invite: !1, layout: !1, participants: !0, plugins: !0, polls: !0, reactions: !1, screenshare: !0 } };
    }
    /**
    * @deprecated
    * The `header` contains the properties to show the meeting header with various elements.
    * The `elements` key contains the following properties
    * `logo` - string value representing the public URL for the logo
    * `timer` - boolean value suggesting if the timer should be shown
    * `title` - boolean value suggesting if the meeting title should be shown
    * `participantCount` - boolean value suggesting if the participant count shuld be shown
    * `changeLayout` - boolean value suggesting if the participant can change layout
    */
  }, {
    key: "header",
    get: function() {
      return { isEnabled: !0, elements: { logo: l(this, ka)[ka].designTokens.logo, timer: !0, title: !0, participantCount: !0, changeLayout: !1 } };
    }
    /**
    * @deprecated
    * The `pipMode` property returns a boolean value
    * If true, picture-in-picture mode is enabled for the participant.
    */
  }, {
    key: "pipMode",
    get: function() {
      return !0;
    }
    /**
    * The `viewType` tells the type of the meeting
    * possible values are: GROUP_CALL| LIVESTREAM | CHAT | AUDIO_ROOM
    */
  }, {
    key: "viewType",
    get: function() {
      return l(this, Er)[Er].viewType;
    }
    /**
    * The `livestreamViewerQualities` specifies the allowed qualities of a stream,
    * that can be viewed by a livestream viewer
    * */
  }, {
    key: "livestreamViewerQualities",
    get: function() {
      return l(this, Er)[Er].livestreamViewerQualities || [];
    }
    /**
    * The `maxVideoStreams` contains the maximum video
    * streams for mobile and desktop
    */
  }, {
    key: "maxVideoStreams",
    get: function() {
      return l(this, Er)[Er].maxVideoStreams;
    }
    /**
    * The `maxScreenShareCount` contains the maximum
    * possible concurrent screen shares
    */
  }, {
    key: "maxScreenShareCount",
    get: function() {
      return l(this, Er)[Er].maxScreenshareCount;
    }
    /**
    * @deprecated in favour of permissions.plugins.config
    */
  }, {
    key: "plugins",
    get: function() {
      return [];
    }
    /**
    * The `disabledPlugins` property returns id of all disabled plugins
    */
  }, { key: "disabledPlugins", get: function() {
    var e = this;
    return Object.keys(l(this, ps)[ps]).filter(function(r) {
      var n = l(e, ps)[ps][r];
      return n.disabled;
    });
  } }, { key: "designTokens", get: function() {
    return l(this, ka)[ka].designTokens;
  } }, { key: "configDiff", get: function() {
    return l(this, ka)[ka].configDiff;
  } }, { key: "mediaConstraints", get: function() {
    var e, r, n, a, i, s, u, c, d, h, v, f;
    return { audio: { enableStereo: (e = (r = l(this, Er)[Er]) === null || r === void 0 || (r = r.media) === null || r === void 0 || (r = r.audio) === null || r === void 0 ? void 0 : r.enableStereo) !== null && e !== void 0 ? e : yo.audio.enableStereo, enableHighBitrate: (n = (a = l(this, Er)[Er]) === null || a === void 0 || (a = a.media) === null || a === void 0 || (a = a.audio) === null || a === void 0 ? void 0 : a.enableHighBitrate) !== null && n !== void 0 ? n : yo.audio.enableHighBitrate }, video: { quality: (i = (s = l(this, Er)[Er]) === null || s === void 0 || (s = s.media) === null || s === void 0 || (s = s.video) === null || s === void 0 ? void 0 : s.quality) !== null && i !== void 0 ? i : yo.video.quality, frameRate: (u = (c = l(this, Er)[Er]) === null || c === void 0 || (c = c.media) === null || c === void 0 || (c = c.video) === null || c === void 0 ? void 0 : c.frameRate) !== null && u !== void 0 ? u : yo.video.frameRate }, screenshare: { quality: (d = (h = l(this, Er)[Er]) === null || h === void 0 || (h = h.media) === null || h === void 0 || (h = h.screenshare) === null || h === void 0 ? void 0 : h.quality) !== null && d !== void 0 ? d : yo.screenshare.quality, frameRate: (v = (f = l(this, Er)[Er]) === null || f === void 0 || (f = f.media) === null || f === void 0 || (f = f.screenshare) === null || f === void 0 ? void 0 : f.frameRate) !== null && v !== void 0 ? v : yo.screenshare.frameRate } };
  } }, { key: "name", get: function() {
    return l(this, su)[su];
  } }], [{
    key: "fromResponse",
    value: function(e) {
      return new o(e);
    }
    /** @deprecated. Use init() */
  }, { key: "default", value: function() {
    return new o(mv);
  } }, { key: "init", value: function(e) {
    var r = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    return !e || r ? new o(mv) : new o(e);
  } }]);
}(), BM = Object.defineProperty, qM = Object.getOwnPropertyDescriptor, Sg = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? qM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && BM(e, r, a), a;
}, hs = /* @__PURE__ */ S("self"), ou = /* @__PURE__ */ S("context"), Jp = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    w(this, t);
    var a = e.getValue("logger");
    return n = R(this, t, [a]), Object.defineProperty(n, hs, { writable: !0, value: void 0 }), n.state = "IDLE", n.playbackUrl = void 0, n.ingestionCredentials = void 0, n.viewerCount = void 0, Object.defineProperty(n, ou, { writable: !0, value: void 0 }), l(n, hs)[hs] = r, l(n, ou)[ou] = e, n.viewerCount = 0, n;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, ou)[ou].getValue("telemetry");
    }
  ) }, { key: "setLivestreamState", value: function(r) {
    var n = this.state;
    this.state = r, n !== r && this.emitCurrentLivestreamState();
  } }, { key: "emitCurrentLivestreamState", value: function() {
    this.emit("livestreamUpdate", this.state);
  } }, { key: "start", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i, s, u, c, d = arguments;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              if (a = d.length > 0 && d[0] !== void 0 ? d[0] : { manualIngestion: !1 }, l(this, hs)[hs].permissions.canLivestream) {
                v.next = 4;
                break;
              }
              throw this.logger.error("Livestream::start::permission_denied"), new U("User does not have permission to start livestreaming", "1901");
            case 4:
              return this.setLivestreamState("STARTING"), v.prev = 5, i = pt(), v.next = 9, i.startLivestreaming(a);
            case 9:
              s = v.sent, u = s.playbackUrl, c = s.ingestionCredentials, this.playbackUrl = u, this.ingestionCredentials = c, a != null && a.manualIngestion && this.setLivestreamState("WAITING_ON_MANUAL_INGESTION"), v.next = 22;
              break;
            case 17:
              throw v.prev = 17, v.t0 = v.catch(5), this.logger.error("Recording::stop::livestream_failed_to_start", { error: v.t0 }), this.setLivestreamState("IDLE"), new U("Error while starting livestream", "1900", this.logger);
            case 22:
            case "end":
              return v.stop();
          }
      }, n, this, [[5, 17]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "stop", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (l(this, hs)[hs].permissions.canLivestream) {
                s.next = 3;
                break;
              }
              throw this.logger.error("Livestream::stop::permission_denied"), new U("User does not have permission to stop livestreaming", "1901");
            case 3:
              if (!(this.state !== "LIVESTREAMING" && this.state !== "WAITING_ON_MANUAL_INGESTION")) {
                s.next = 6;
                break;
              }
              throw this.logger.error("Livestream::stop::inconsistent_state"), new U("Livestream not started yet", "1902");
            case 6:
              return s.prev = 6, this.setLivestreamState("STOPPING"), a = pt(), s.next = 11, a.stopLivestreaming();
            case 11:
              s.next = 18;
              break;
            case 13:
              throw s.prev = 13, s.t0 = s.catch(6), this.logger.error("Livestream::stop::livestream_failed_to_stop", { error: s.t0 }), this.setLivestreamState("STOPPING"), new U("Error while stopping livestream", "1900", this.logger);
            case 18:
            case "end":
              return s.stop();
          }
      }, n, this, [[6, 13]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an);
Sg([O.trace("livestream.start")], Jp.prototype, "start", 1);
Sg([O.trace("livestream.stop")], Jp.prototype, "stop", 1);
var GM = Object.defineProperty, WM = Object.getOwnPropertyDescriptor, JM = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? WM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && GM(e, r, a), a;
}, vs = /* @__PURE__ */ S("livestreamingPeerId"), fs = /* @__PURE__ */ S("self"), Wt = /* @__PURE__ */ S("livestreamSocketHandler"), kt = /* @__PURE__ */ S("context"), Eg = /* @__PURE__ */ function() {
  function o(t, e, r) {
    w(this, o), this.livestream = void 0, Object.defineProperty(this, vs, { writable: !0, value: void 0 }), Object.defineProperty(this, fs, { writable: !0, value: void 0 }), Object.defineProperty(this, Wt, { writable: !0, value: void 0 }), Object.defineProperty(this, kt, { writable: !0, value: void 0 }), l(this, kt)[kt] = t, l(this, fs)[fs] = e, this.livestream = new Jp(t, e), l(this, Wt)[Wt] = r, this.setupEvents();
  }
  return P(o, [{
    key: "logger",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, kt)[kt].getValue("logger");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "telemetry", get: function() {
    return l(this, kt)[kt].getValue("telemetry");
  } }, { key: "fetchInitialLivestreamingState", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return n = pt(), h.next = 3, n.getActiveLivestream();
            case 3:
              a = h.sent, i = a.status, s = a.playbackUrl, u = a.manualIngest, c = a.ingestionCredentials, this.livestream.playbackUrl = s, this.livestream.ingestionCredentials = c, i === "LIVE" && this.livestream.setLivestreamState("LIVESTREAMING"), i === "INVOKED" && u && this.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION");
            case 12:
            case "end":
              return h.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, Wt)[Wt].on(Y.startedLivestream, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (e.livestream.playbackUrl = a.playbackUrl, e.livestream.setLivestreamState("LIVESTREAMING"), s.prev = 2, !l(e, fs)[fs].permissions.canLivestream) {
                  s.next = 6;
                  break;
                }
                return s.next = 6, e.fetchInitialLivestreamingState();
              case 6:
                s.next = 11;
                break;
              case 8:
                s.prev = 8, s.t0 = s.catch(2), e.logger.error("Error: LivestreamController.fetchLivestream during startedLivestream re-fetch");
              case 11:
              case "end":
                return s.stop();
            }
        }, n, null, [[2, 8]]);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), l(this, Wt)[Wt].on(Y.livestreamingInvoked, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (a.manualIngest) {
                  s.next = 2;
                  break;
                }
                return s.abrupt("return");
              case 2:
                if (e.livestream.setLivestreamState("WAITING_ON_MANUAL_INGESTION"), s.prev = 3, !l(e, fs)[fs].permissions.canLivestream) {
                  s.next = 7;
                  break;
                }
                return s.next = 7, e.fetchInitialLivestreamingState();
              case 7:
                s.next = 12;
                break;
              case 9:
                s.prev = 9, s.t0 = s.catch(3), e.logger.error("Error: LivestreamController.fetchLivestream during livestreamingInvoked re-fetch");
              case 12:
              case "end":
                return s.stop();
            }
        }, n, null, [[3, 9]]);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), l(this, Wt)[Wt].on(Y.stoppedLivestream, function() {
      e.livestream.setLivestreamState("IDLE"), e.livestream.playbackUrl = void 0, e.livestream.ingestionCredentials = void 0;
    }), l(this, Wt)[Wt].on(Y.erroredLivestream, function() {
      e.livestream.setLivestreamState("IDLE"), e.livestream.playbackUrl = void 0;
    }), l(this, Wt)[Wt].on(Y.roomPeerCount, function(r) {
      e.livestream.viewerCount = r.count, e.livestream.emit("viewerCountUpdate", r.count);
    }), l(this, kt)[kt].getValue("peerSessionStore").on(j.PEER_JOINED_INTERNAL, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                ((i = a.flags) === null || i === void 0 ? void 0 : i.hiddenParticipant) === !0 && a.recorderType === "LIVESTREAMER" && (l(e, vs)[vs] = a.id, e.livestream.setLivestreamState("LIVESTREAMING"));
              case 1:
              case "end":
                return u.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), l(this, kt)[kt].getValue("peerSessionStore").on(j.PEER_CLOSED, function(r) {
      r.id === l(e, vs)[vs] && (l(e, vs)[vs] = void 0, e.livestream.setLivestreamState("IDLE"));
    }), l(this, kt)[kt].getValue("peerSessionStore").onAsync(j.LEAVE_MEDIA_ROOM, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              if (!e.livestream.playbackUrl) {
                a.next = 2;
                break;
              }
              return a.abrupt("return");
            case 2:
              return e.logger.info("Fetching livestreaming state on leave stage"), a.prev = 3, a.next = 6, e.fetchInitialLivestreamingState();
            case 6:
              a.next = 11;
              break;
            case 8:
              a.prev = 8, a.t0 = a.catch(3), e.logger.error("Failed to fetch livestreaming state on leave stage", { error: a.t0 });
            case 11:
            case "end":
              return a.stop();
          }
      }, r, null, [[3, 8]]);
    }))), l(this, kt)[kt].getValue("peerSessionStore").on(j.SOCKET_SERVICE_ROOM_JOINED, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              return a.prev = 0, a.next = 3, e.fetchInitialLivestreamingState();
            case 3:
              a.next = 8;
              break;
            case 5:
              a.prev = 5, a.t0 = a.catch(0), e.logger.error("Error: LivestreamController.fetchLivestream");
            case 8:
            case "end":
              return a.stop();
          }
      }, r, null, [[0, 5]]);
    })));
  } }]);
}();
JM([O.trace("LivestreamController.setupEvents")], Eg.prototype, "setupEvents", 1);
var KM = Object.defineProperty, zM = Object.getOwnPropertyDescriptor, ul = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? zM(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && KM(e, r, a), a;
}, ar = /* @__PURE__ */ S("data"), Cn = /* @__PURE__ */ S("meetingId"), Rn = /* @__PURE__ */ S("socketHandler"), Zc = /* @__PURE__ */ S("update"), Bo = /* @__PURE__ */ function() {
  function o(t) {
    var e = t.name, r = t.socketHandler, n = t.meetingId;
    w(this, o), Object.defineProperty(this, Zc, { value: YM }), this.name = "", Object.defineProperty(this, ar, { writable: !0, value: {} }), Object.defineProperty(this, Cn, { writable: !0, value: "" }), Object.defineProperty(this, Rn, { writable: !0, value: void 0 }), this.rateLimitConfig = { maxInvocations: 5, period: 1 }, this.bulkRateLimitConfig = { maxInvocations: 5, period: 1 }, this.listeners = {}, this.name = e, l(this, Rn)[Rn] = r, l(this, Cn)[Cn] = n;
  }
  return P(o, [{ key: "set", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i = this, s, u, c = arguments;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              s = c.length > 2 && c[2] !== void 0 ? c[2] : !0, u = c.length > 3 && c[3] !== void 0 ? c[3] : !1, l(this, ar)[ar][n] = a, s && this.remoteSet(n, a), u && (this.listeners[n] && this.listeners[n].forEach(function(v) {
                return v({ [n]: l(i, ar)[ar][n] });
              }), this.listeners["*"] && this.listeners["*"].forEach(function(v) {
                return v({ [n]: l(i, ar)[ar][n] });
              }));
            case 5:
            case "end":
              return h.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "remoteSet", value: function(e, r) {
    l(this, Rn)[Rn].storeInsertKeys(l(this, Cn)[Cn], this.name, [{ key: e, payload: r }]);
  } }, { key: "bulkSet", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              n.forEach(function(u) {
                var c = u.key, d = u.payload;
                l(a, ar)[ar][c] = d;
              }), l(this, Rn)[Rn].storeInsertKeys(l(this, Cn)[Cn], this.name, n);
            case 2:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "update",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
        var i, s = arguments;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                i = s.length > 2 && s[2] !== void 0 ? s[2] : !0, l(this, Zc)[Zc](n, a, i);
              case 2:
              case "end":
                return c.stop();
            }
        }, r, this);
      }));
      function e(r, n) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    // eslint-disable-next-line consistent-return
  }, { key: "delete", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s = arguments;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (a = s.length > 1 && s[1] !== void 0 ? s[1] : !0, i = s.length > 2 && s[2] !== void 0 ? s[2] : !1, l(this, ar)[ar][n] && delete l(this, ar)[ar][n], !a) {
                c.next = 5;
                break;
              }
              return c.abrupt("return", l(this, Rn)[Rn].storeDeleteKeys(l(this, Cn)[Cn], this.name, [{ key: n }]));
            case 5:
              i && (this.listeners[n] && (this.listeners[n].forEach(function(d) {
                return d({ [n]: void 0 });
              }), delete this.listeners[n]), this.listeners["*"] && this.listeners["*"].forEach(function(d) {
                return d({ [n]: void 0 });
              }));
            case 6:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "bulkDelete",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a = this;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return n.forEach(function(u) {
                  var c = u.key;
                  l(a, ar)[ar][c] && delete l(a, ar)[ar][c];
                }), s.abrupt("return", l(this, Rn)[Rn].storeDeleteKeys(l(this, Cn)[Cn], this.name, n));
              case 2:
              case "end":
                return s.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * @description Returns value for the given key.
    * @param {string} key - Unique identifier used to store value.
    * @returns {any} Value for the given key.
    */
  }, {
    key: "get",
    value: function(e) {
      if (l(this, ar)[ar][e])
        return l(this, ar)[ar][e];
    }
    /**
    * @description Returns the entire store.
    * @returns {StoreData} An instance of StoreData.
    */
  }, { key: "getAll", value: function() {
    return l(this, ar)[ar];
  } }, { key: "rateLimits", get: function() {
    return this.rateLimitConfig;
  } }, { key: "updateRateLimits", value: function(e, r) {
    this.rateLimitConfig.maxInvocations = e, this.rateLimitConfig.period = r;
  } }, {
    key: "bulkRateLimits",
    get: function() {
      return this.bulkRateLimitConfig;
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "updateBulkRateLimits",
    value: function(e, r) {
      this.bulkRateLimitConfig.maxInvocations = e, this.bulkRateLimitConfig.period = r;
    }
    /**
    * @description Listens for data change on a store key.
    * @param {string} key - Unique identifier used to store value.
    * @param {Function} cb - The callback function that gets executed
    * when data is modified.
    * @returns {void} void
    */
  }, {
    key: "subscribe",
    value: function(e, r) {
      if (this.listeners[e]) {
        this.listeners[e].push(r);
        return;
      }
      this.listeners[e] = [r];
    }
    /**
       * @description Removes all listeners for a key on the store.
       * @param {string} key - Unique identifier used to store value.
    * * @param {Function} cb - Callback to be removed.
       * @returns {void} void
       */
  }, { key: "unsubscribe", value: function(e, r) {
    if (r) {
      var n;
      this.listeners[e] = ((n = this.listeners[e]) === null || n === void 0 ? void 0 : n.filter(function(a) {
        return a !== r;
      })) || [];
      return;
    }
    this.listeners[e] && delete this.listeners[e];
  } }, { key: "populate", value: function(e) {
    l(this, ar)[ar] = e;
  } }]);
}();
function YM(o, t) {
  var e = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !0, r, n = l(this, ar)[ar][o], a = Object.prototype.toString.call(t), i = Object.prototype.toString.call(n);
  if (a !== i) {
    this.set(o, t);
    return;
  }
  switch (i) {
    case "[object Array]":
      r = [].concat(Se(n), Se(t));
      break;
    case "[object Object]":
      r = $($({}, n), t);
      break;
    case "[object Map]":
      r = new Map([].concat(Se(n), Se(t)));
      break;
    case "[object Set]":
      r = /* @__PURE__ */ new Set([].concat(Se(n), Se(t)));
      break;
    default:
      r = t;
      break;
  }
  this.set(o, r, e);
}
ul([Lt(Ho, "rateLimitConfig")], Bo.prototype, "remoteSet", 1);
ul([Lt(Ho, "bulkRateLimitConfig")], Bo.prototype, "bulkSet", 1);
ul([Lt(Ho, "rateLimitConfig")], Bo.prototype, "update", 1);
ul([Lt(Ho, "rateLimitConfig")], Bo.prototype, "delete", 1);
ul([Lt(Ho, "bulkRateLimitConfig")], Bo.prototype, "bulkDelete", 1);
var _a = /* @__PURE__ */ S("pluginSocketHandler"), Oa = /* @__PURE__ */ S("meetingId"), Au = /* @__PURE__ */ S("peerId"), Lu = /* @__PURE__ */ S("context"), Ln = /* @__PURE__ */ S("pendingInit"), xc = /* @__PURE__ */ S("setup"), QM = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, xc, { value: ZM }), Object.defineProperty(this, Au, { get: XM, set: void 0 }), this.stores = /* @__PURE__ */ new Map(), Object.defineProperty(this, _a, { writable: !0, value: void 0 }), Object.defineProperty(this, Oa, { writable: !0, value: "" }), Object.defineProperty(this, Lu, { writable: !0, value: void 0 }), Object.defineProperty(this, Ln, { writable: !0, value: /* @__PURE__ */ new Map() }), l(this, _a)[_a] = e, l(this, Oa)[Oa] = t.getValue("meetingId"), l(this, Lu)[Lu] = t, l(this, xc)[xc]();
  }
  return P(o, [{ key: "create", value: function(e) {
    var r = this, n = new Bo({ name: e, socketHandler: l(this, _a)[_a], meetingId: l(this, Oa)[Oa] });
    l(this, _a)[_a].storeGetKeys(l(this, Oa)[Oa], e, []);
    var a = new Promise(function(i, s) {
      var u = setTimeout(function() {
        return s(Error("Failed"));
      }, 3e3);
      l(r, Ln)[Ln].set(e, { rejectTimeout: u, resolve: i, store: n });
    });
    return a;
  } }]);
}();
function XM() {
  return l(this, Lu)[Lu].getValue("peerId");
}
function ZM() {
  var o = this;
  [se.storeInsertKeys, se.storeGetKeys, se.storeDeleteKeys].forEach(function(t) {
    l(o, _a)[_a].on(t, /* @__PURE__ */ function() {
      var e = m(/* @__PURE__ */ p().mark(function r(n) {
        var a, i, s, u, c, d;
        return p().wrap(function(v) {
          for (; ; )
            switch (v.prev = v.next) {
              case 0:
                if (n.pluginId === l(o, Oa)[Oa]) {
                  v.next = 2;
                  break;
                }
                return v.abrupt("return");
              case 2:
                if (s = (a = n.storeItems) === null || a === void 0 ? void 0 : a.map(function(f) {
                  var g;
                  return { timestamp: f.timestamp, peerId: f.peerId, payload: JSON.parse((g = f.payload) !== null && g !== void 0 && g.length ? new TextDecoder().decode(f.payload) : "{}"), key: f.storeKey };
                }), t !== se.storeGetKeys) {
                  v.next = 9;
                  break;
                }
                return u = l(o, Ln)[Ln].get(n.storeName), c = o.stores.get(n.storeName) || (u == null ? void 0 : u.store), l(o, Ln)[Ln].get(n.storeName) && (o.stores.set(n.storeName, u.store), u.resolve(c), clearTimeout(u.rejectTimeout), l(o, Ln)[Ln].delete(n.storeName)), s.forEach(function(f) {
                  c.set(f.key, f.payload, !1, !1);
                }), v.abrupt("return");
              case 9:
                if (d = o.stores.get(n.storeName) || ((i = l(o, Ln)[Ln].get(n.storeName)) === null || i === void 0 ? void 0 : i.store), d !== void 0) {
                  v.next = 12;
                  break;
                }
                return v.abrupt("return");
              case 12:
                t === se.storeInsertKeys && s.forEach(function(f) {
                  var g = f.key, k = f.peerId, y = f.payload;
                  k !== l(o, Au)[Au] && d.set(g, y, !1, !0);
                }), t === se.storeDeleteKeys && s.forEach(function(f) {
                  var g = f.key, k = f.peerId;
                  k !== l(o, Au)[Au] && d.delete(g, !1, !0);
                });
              case 14:
              case "end":
                return v.stop();
            }
        }, r);
      }));
      return function(r) {
        return e.apply(this, arguments);
      };
    }());
  });
}
function Is(o) {
  var t, e, r, n, a, i, s, u, c;
  return o ? { media: { audio: { enabled: o.audioEnabled, trackId: (t = o.audioTrack) === null || t === void 0 ? void 0 : t.id, permission: "mediaPermissions" in o ? (e = o.mediaPermissions) === null || e === void 0 ? void 0 : e.audio : null }, video: { enabled: o.videoEnabled, trackId: (r = o.videoTrack) === null || r === void 0 ? void 0 : r.id, permission: "mediaPermissions" in o ? (n = o.mediaPermissions) === null || n === void 0 ? void 0 : n.video : null }, screenshare: { enabled: o.screenShareEnabled, permission: "mediaPermissions" in o ? (a = o.mediaPermissions) === null || a === void 0 ? void 0 : a.screenshare : null, audio: { enabled: (i = o.screenShareTracks) === null || i === void 0 || (i = i.audio) === null || i === void 0 ? void 0 : i.enabled, trackId: (s = o.screenShareTracks) === null || s === void 0 || (s = s.audio) === null || s === void 0 ? void 0 : s.id }, video: { enabled: (u = o.screenShareTracks) === null || u === void 0 || (u = u.video) === null || u === void 0 ? void 0 : u.enabled, trackId: (c = o.screenShareTracks) === null || c === void 0 || (c = c.video) === null || c === void 0 ? void 0 : c.id } } } } : {};
}
var xM = Object.defineProperty, e_ = Object.getOwnPropertyDescriptor, qo = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? e_(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && xM(e, r, a), a;
}, r_ = 0.8, t_ = 1.2, Ga = (ci = /* @__PURE__ */ S("isPinned"), di = /* @__PURE__ */ S("stageStatus"), Dr = /* @__PURE__ */ S("context"), Qn = /* @__PURE__ */ S("roomNodeClient"), bn = /* @__PURE__ */ S("audioPlayback"), Xn = /* @__PURE__ */ S("mediaJoined"), hl = /* @__PURE__ */ S("socketJoined"), It = /* @__PURE__ */ S("self"), lo = /* @__PURE__ */ S("roomSocketHandler"), mn = /* @__PURE__ */ S("videoElements"), Zn = /* @__PURE__ */ S("pip"), Mt = /* @__PURE__ */ S("maxSpatialLayer"), vl = /* @__PURE__ */ S("videoDimensionsUpdated"), co = /* @__PURE__ */ S("updateVideos"), fl = /* @__PURE__ */ S("updateAudio"), gl = /* @__PURE__ */ S("updateScreenShare"), /* @__PURE__ */ function(o) {
  function t(e, r, n, a) {
    var i;
    w(this, t);
    var s = e.getValue("logger");
    i = R(this, t, [s]), Object.defineProperty(i, gl, { value: c_ }), Object.defineProperty(i, fl, { value: l_ }), Object.defineProperty(i, co, { value: u_ }), Object.defineProperty(i, Zn, { get: o_, set: void 0 }), Object.defineProperty(i, hl, { get: s_, set: void 0 }), Object.defineProperty(i, Xn, { get: i_, set: void 0 }), Object.defineProperty(i, bn, { get: a_, set: void 0 }), Object.defineProperty(i, Qn, { get: n_, set: void 0 }), i.id = void 0, i.userId = void 0, i.name = void 0, i.picture = void 0, i.isHost = void 0, i.customParticipantId = void 0, i.flags = void 0, i.device = void 0, i.videoTrack = void 0, i.audioTrack = void 0, i.screenShareTracks = void 0, i.videoEnabled = void 0, i.audioEnabled = void 0, i.screenShareEnabled = void 0, i.producers = void 0, i.manualProducerConfig = void 0, Object.defineProperty(i, ci, { writable: !0, value: void 0 }), i.supportsRemoteControl = !1, Object.defineProperty(i, di, { writable: !0, value: void 0 }), i.presetName = void 0, Object.defineProperty(i, Dr, { writable: !0, value: void 0 }), Object.defineProperty(i, It, { writable: !0, value: void 0 }), Object.defineProperty(i, lo, { writable: !0, value: void 0 }), Object.defineProperty(i, mn, { writable: !0, value: /* @__PURE__ */ new Map() }), Object.defineProperty(i, Mt, { writable: !0, value: 1 }), Object.defineProperty(i, vl, { writable: !0, value: jp(function(F) {
      if (i.videoTrack) {
        var N = F.clientWidth, L = F.clientHeight, H = i.videoTrack.getSettings(), Q = H.width, B = H.height;
        if (!(!Q || !B)) {
          var G = B / L, x = Q / N, Pe = Math.max(G, x);
          Pe > t_ && l(i, Mt)[Mt] === 1 ? (l(i, Mt)[Mt] = 0, l(i, Dr)[Dr].getValue("peerSessionStore").emit(j.MAX_SPATIAL_LAYER_CHANGE, { peerId: i.id, maxSpatialLayer: l(i, Mt)[Mt] })) : Pe < r_ && l(i, Mt)[Mt] === 0 && (l(i, Mt)[Mt] = 1, l(i, Dr)[Dr].getValue("peerSessionStore").emit(j.MAX_SPATIAL_LAYER_CHANGE, { peerId: i.id, maxSpatialLayer: l(i, Mt)[Mt] }));
        }
      }
    }, 2e3) }), l(i, Dr)[Dr] = e;
    var u = r.id, c = r.userId, d = r.displayName, h = r.device, v = r.picture, f = r.isHost, g = r.flags, k = r.clientSpecificId, y = r.stageStatus, b = r.customParticipantId, C = r.audioMuted, T = r.audioTrack, E = r.videoEnabled, D = E === void 0 ? !1 : E, I = r.videoTrack, _ = r.producers, V = r.metadata;
    return i.id = u, i.userId = c, i.name = d, i.device = h, i.picture = v, i.isHost = f, i.flags = g, i.manualProducerConfig = bP, l(i, di)[di] = y != null ? y : "ON_STAGE", i.customParticipantId = b != null ? b : k, i.audioEnabled = !C, i.audioTrack = T, i.videoEnabled = D, i.videoTrack = I, i.screenShareTracks = { audio: void 0, video: void 0 }, i.producers = _ != null ? _ : [], i.presetName = V == null ? void 0 : V.preset_name, l(i, ci)[ci] = !1, l(i, It)[It] = n, l(i, lo)[lo] = a, i.setupEvents(), i.updateVideo = i.updateVideo.bind(i), l(i, co)[co](), i;
  }
  return A(t, o), P(t, [{ key: "clientSpecificId", get: (
    /**
    * @deprecated
    * Use `customParticipantId`
    */
    function() {
      return this.customParticipantId;
    }
  ) }, { key: "stageStatus", get: (
    /** Denotes the participants's current stage status. */
    function() {
      return l(this, di)[di];
    }
  ) }, { key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, Dr)[Dr].getValue("telemetry");
    }
  ) }, { key: "setVideoEnabled", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    this.videoEnabled = r, n && (this.logger.info("Participant::setVideoEnabled::videoUpdate", $({}, Is(this))), this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack }));
  } }, { key: "setAudioEnabled", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    this.audioEnabled = r, n && (this.logger.info("Participant::setAudioEnabled::audioUpdate", $({}, Is(this))), this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack }));
  } }, { key: "setScreenShareEnabled", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    this.screenShareEnabled = r, n && this.emit("screenShareUpdate", { screenShareEnabled: this.screenShareEnabled, screenShareTracks: this.screenShareTracks });
  } }, {
    key: "setupEvents",
    value: function() {
      this.on("videoUpdate", l(this, co)[co]), l(this, bn)[bn] && (this.on("audioUpdate", l(this, fl)[fl]), this.on("screenShareUpdate", l(this, gl)[gl]));
    }
    /**
    * Returns `participant.id` if user has permission
    * to pin participants.
    */
  }, { key: "pin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Xn)[Xn]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t pin participant without joining room", "1205");
            case 2:
              if (l(this, It)[It].permissions.pinParticipant) {
                i.next = 4;
                break;
              }
              throw new U("You do not have permission to pin participants.", "1201");
            case 4:
              return i.abrupt("return", l(this, Qn)[Qn].pinPeer(this.id));
            case 5:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "unpin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Xn)[Xn]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t unpin participant without joining room", "1205");
            case 2:
              if (l(this, It)[It].permissions.pinParticipant) {
                i.next = 4;
                break;
              }
              throw new U("You do not have permission to unpin participants.", "1201");
            case 4:
              return i.abrupt("return", l(this, Qn)[Qn].pinPeer(null));
            case 5:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setIsPinned", value: function(r) {
    var n, a = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    l(this, ci)[ci] = r;
    var i = r ? "pinned" : "unpinned";
    (n = l(this, Zn)[Zn]) === null || n === void 0 || n.updateSource(this.id, { pinned: r }), a && this.emit(i, this);
  } }, { key: "disableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = this.id, this.logger.info("Participant::disable_audio", { participant: { id: a } }), l(this, Xn)[Xn]) {
                s.next = 4;
                break;
              }
              throw new U("Can`t disable participant audio without joining room", "1205");
            case 4:
              if (!l(this, It)[It].permissions.canDisableParticipantAudio) {
                s.next = 6;
                break;
              }
              return s.abrupt("return", l(this, Qn)[Qn].disableAudio(a));
            case 6:
              throw this.logger.error("Participant::unauthorized_disable_audio", { participant: { id: a } }), new U("Unauthorized: User does not have permission to disable participant audio.", "1201");
            case 8:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "kick", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = this.id, this.logger.info("Participant::kick", { participant: { id: a } }), l(this, hl)[hl]) {
                s.next = 4;
                break;
              }
              throw new U("Can`t kick participant without joining room", "1205");
            case 4:
              if (!l(this, It)[It].permissions.kickParticipant) {
                s.next = 8;
                break;
              }
              return s.next = 7, l(this, Dr)[Dr].getValue("peerSessionStore").emitAsync(j.KICK_PEER, { peerId: a });
            case 7:
              return s.abrupt("return");
            case 8:
              throw this.logger.error("Participant::unauthorized_kick", { participant: { id: a } }), new U("Unauthorized: User does not have permission to kick participants.", "1201");
            case 10:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = this.id, this.logger.info("Participant::disable_video", { participant: { id: a } }), l(this, Xn)[Xn]) {
                s.next = 4;
                break;
              }
              throw new U("Can`t disable participant video without joining room", "1205");
            case 4:
              if (!l(this, It)[It].permissions.canDisableParticipantVideo) {
                s.next = 6;
                break;
              }
              return s.abrupt("return", l(this, Qn)[Qn].disableVideo(a));
            case 6:
              throw this.logger.error("Participant::unauthorized_disable_video", { participant: { id: a } }), new U("Unauthorized: User does not have permission to disable participant video.", "1201");
            case 8:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPermissions", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", l(this, lo)[lo].getUserPermissions(this.userId));
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "setStageStatus",
    value: function(r) {
      l(this, di)[di] = r, this.emit("stageStatusUpdate", this);
    }
    /**
    * Returns true if the participant is pinned.
    */
  }, { key: "isPinned", get: function() {
    return l(this, ci)[ci];
  } }, { key: "registerVideoElement", value: function(r) {
    var n, a = this, i, s;
    if (r) {
      var u;
      (n = l(this, mn)[mn].get(r)) === null || n === void 0 || (n = n.observer) === null || n === void 0 || n.disconnect(), "ResizeObserver" in window && (u = new ResizeObserver(function() {
        return l(a, vl)[vl](r);
      }), u.observe(r)), l(this, mn)[mn].set(r, { observer: u }), this.updateVideo(r), (i = l(this, Zn)[Zn]) === null || i === void 0 || i.addSource(this.id, r, this.videoEnabled, this.isPinned, this.name, this.picture, (s = this.raised) !== null && s !== void 0 ? s : !1);
    }
  } }, { key: "deregisterVideoElement", value: function(r) {
    var n, a;
    if (!r) {
      var i;
      (i = l(this, Zn)[Zn]) === null || i === void 0 || i.removeSource(this.id);
      return;
    }
    r.srcObject = void 0, (n = l(this, mn)[mn].get(r)) === null || n === void 0 || (n = n.observer) === null || n === void 0 || n.disconnect(), l(this, mn)[mn].delete(r), (a = l(this, Zn)[Zn]) === null || a === void 0 || a.removeSource(this.id);
  } }, { key: "updateVideo", value: (
    /**
    * Internal method, do not use
    */
    function(r) {
      if (this.videoEnabled) {
        var n;
        if (this.videoTrack == null)
          return;
        var a = (n = r.srcObject) === null || n === void 0 ? void 0 : n.getTracks()[0];
        if ((a == null ? void 0 : a.id) === this.videoTrack.id)
          return;
        var i = new MediaStream();
        i.addTrack(this.videoTrack), r.srcObject = i;
      } else
        r.srcObject = void 0;
      r.style.display = this.videoEnabled ? "block" : "none";
    }
  ) }]);
}(an));
function n_() {
  return l(this, Dr)[Dr].getValue("roomNodeClient");
}
function a_() {
  return l(this, Dr)[Dr].getValue("audioPlayback");
}
function i_() {
  return l(this, Dr)[Dr].getValue("connectionHandler").mediaJoined;
}
function s_() {
  return l(this, Dr)[Dr].getValue("connectionHandler").socketJoined;
}
function o_() {
  return l(this, Dr)[Dr].getValue("pip");
}
function u_() {
  Array.from(l(this, mn)[mn].keys()).forEach(this.updateVideo);
}
function l_() {
  if (this.audioEnabled && this.audioTrack) {
    var o;
    (o = l(this, bn)[bn]) === null || o === void 0 || o.addParticipantTrack(this.id, this.audioTrack);
  } else {
    var t;
    (t = l(this, bn)[bn]) === null || t === void 0 || t.removeParticipantTrack(this.id);
  }
}
function c_() {
  if (this.screenShareEnabled && this.screenShareTracks.audio) {
    var o;
    (o = l(this, bn)[bn]) === null || o === void 0 || o.addParticipantTrack("screenshare-".concat(this.id), this.screenShareTracks.audio);
  } else {
    var t;
    (t = l(this, bn)[bn]) === null || t === void 0 || t.removeParticipantTrack("screenshare-".concat(this.id));
  }
}
qo([O.trace("Participant.disableAudio")], Ga.prototype, "disableAudio", 1);
qo([O.trace("Participant.kick")], Ga.prototype, "kick", 1);
qo([O.trace("Participant.disableVideo")], Ga.prototype, "disableVideo", 1);
qo([O.trace("Participant.getPermissions")], Ga.prototype, "getPermissions", 1);
qo([O.trace("Participant.setStageStatus")], Ga.prototype, "setStageStatus", 1);
Ga = qo([vt("1200")], Ga);
var uu = /* @__PURE__ */ function(o) {
  function t(e, r) {
    w(this, t);
    var n = r != null ? r : {}, a = n.onAddEvent, i = a === void 0 ? "participantJoined" : a, s = n.onDeleteEvent, u = s === void 0 ? "participantLeft" : s, c = n.onClearEvent, d = c === void 0 ? "participantsCleared" : c;
    return R(this, t, [{ onAddEvent: i, onDeleteEvent: u, onClearEvent: d }, e]);
  }
  return A(t, o), P(t, [{ key: "add", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
    return this.has(r.id) && Object.is(this.get(r.id), r) === !1 && this.delete(r.id), Re(t, "add", this, 3)([r, n]);
  } }, { key: "clear", value: function() {
    var r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !0, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    return Re(t, "clear", this, 3)([r, n]);
  } }, { key: "delete", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1;
    return Re(t, "delete", this, 3)([r, n, a]);
  } }]);
}(yg), An = /* @__PURE__ */ S("map"), d_ = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e]), Object.defineProperty(r, An, { writable: !0, value: void 0 }), l(r, An)[An] = /* @__PURE__ */ new Map(), r;
  }
  return A(t, o), P(t, [{
    key: "__set",
    value: function(r, n) {
      return l(this, An)[An].set(r, n);
    }
    /**
    * @private
    */
  }, { key: "__clear", value: function() {
    return l(this, An)[An].clear();
  } }, { key: "get", value: function(r) {
    return l(this, An)[An].get(r);
  } }, { key: "toArray", value: function() {
    return Array.from(l(this, An)[An].values());
  } }]);
}(jo), p_ = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this._orderedArray = void 0, this._map = void 0, this._map = /* @__PURE__ */ new Map(), this._orderedArray = [];
  }
  return P(o, [{ key: "add", value: function(e, r) {
    if (!this._map.has(e)) {
      this._map.set(e, { peerId: e, priority: r }), this._orderedArray.splice(Math.max(r - 1, 0), 0, e);
      var n = this.index(e);
      return n;
    }
    var a = this.index(e);
    this.delete(e);
    var i = this.add(e, r);
    return a !== i ? i : -1;
  } }, { key: "delete", value: function(e) {
    if (this._map.has(e)) {
      var r = this.index(e);
      this._map.delete(e), this._orderedArray.splice(r, 1);
    }
  } }, { key: "index", value: function(e) {
    return this._map.has(e) ? this._orderedArray.indexOf(e) : -1;
  } }, { key: Symbol.iterator, value: function() {
    return this._orderedArray[Symbol.iterator]();
  } }]);
}(), h_ = /* @__PURE__ */ function() {
  function o() {
    w(this, o), this._activeSpeakerPeers = void 0, this._compulsoryPeers = void 0, this._activeSpeakerPeers = new p_(), this._compulsoryPeers = /* @__PURE__ */ new Set();
  }
  return P(o, [{ key: "add", value: function(e, r, n) {
    if (!e)
      return -1;
    if (r < 0)
      return this._compulsoryPeers.add(e), 0;
    var a = n.getValue("logger");
    if (this.compulsoryPeers.includes(e) && (r > 0 || r === 246267631)) {
      if (a.info("SelectedPeer::removing_compulsory_peer", { selectedPeer: { peerId: e } }), this._removeFromCompulsoryPeer(e), r === 246267631)
        return -1;
    } else if (r === 229490415)
      return this.delete(e, n), -1;
    return this._activeSpeakerPeers.add(e, r);
  } }, { key: "delete", value: function(e, r) {
    var n = r == null ? void 0 : r.getValue("logger");
    n == null || n.info("SelectedPeer::deleting_peer_from_selectedPeer", { selectedPeer: { peerId: e } }), this._removeFromCompulsoryPeer(e), this._activeSpeakerPeers.delete(e);
  } }, { key: "index", value: function(e) {
    return this._activeSpeakerPeers.index(e);
  } }, { key: "peers", get: function() {
    return Array.from(new Set(this.compulsoryPeers.concat(this.activeSpeakerPeers)));
  } }, { key: "compulsoryPeers", get: function() {
    return Array.from(this._compulsoryPeers.values());
  } }, { key: "activeSpeakerPeers", get: function() {
    return Array.from(this._activeSpeakerPeers);
  } }, { key: "_removeFromCompulsoryPeer", value: function(e) {
    this._compulsoryPeers.delete(e);
  } }]);
}(), Cg = new h_(), v_ = Object.defineProperty, f_ = Object.getOwnPropertyDescriptor, un = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? f_(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && v_(e, r, a), a;
}, g_ = ["ACTIVE_GRID", "PAGINATED", "MANUAL"], Ct = (ke = /* @__PURE__ */ S("context"), po = /* @__PURE__ */ S("roomNodeClient"), xn = /* @__PURE__ */ S("socketJoined"), pi = /* @__PURE__ */ S("mediaJoined"), ea = /* @__PURE__ */ S("self"), br = /* @__PURE__ */ S("roomSocketHandler"), /* @__PURE__ */ function(o) {
  function t(e, r, n) {
    var a;
    w(this, t);
    var i = e.getValue("logger");
    return a = R(this, t, [i]), Object.defineProperty(a, pi, { get: k_, set: void 0 }), Object.defineProperty(a, xn, { get: y_, set: void 0 }), Object.defineProperty(a, po, { get: m_, set: void 0 }), a.waitlisted = void 0, a.joined = void 0, a.active = void 0, a.videoSubscribed = void 0, a.audioSubscribed = void 0, a.pinned = void 0, a.all = void 0, Object.defineProperty(a, ke, { writable: !0, value: void 0 }), Object.defineProperty(a, ea, { writable: !0, value: void 0 }), Object.defineProperty(a, br, { writable: !0, value: void 0 }), a.rateLimitConfig = { maxInvocations: 5, period: 1 }, a.viewMode = void 0, a.currentPage = void 0, a.lastActiveSpeaker = void 0, a.selectedPeers = Cg, l(a, ke)[ke] = e, l(a, ea)[ea] = r, l(a, br)[br] = n, a.waitlisted = new uu(i), a.joined = new uu(i), a.videoSubscribed = new uu(i), a.audioSubscribed = new uu(i), a.active = a.videoSubscribed, a.pinned = new uu(i), a.all = new d_(i), a.viewMode = "ACTIVE_GRID", a.currentPage = 0, a.setupEvents(), a;
  }
  return A(t, o), P(t, [{ key: "pip", get: (
    /**
    * Return the controls for Picture-in-Picture
    */
    function() {
      return l(this, ke)[ke].getValue("pip");
    }
  ) }, { key: "rateLimits", get: function() {
    return this.rateLimitConfig;
  } }, {
    key: "updateRateLimits",
    value: function(r, n) {
      this.rateLimitConfig.maxInvocations = r, this.rateLimitConfig.period = n;
    }
    /**
    * @access private
    * Not for external use
    */
  }, { key: "telemetry", get: function() {
    return l(this, ke)[ke].getValue("telemetry");
  } }, {
    key: "setupEvents",
    value: function() {
      var r = this;
      l(this, ke)[ke].getValue("peerSessionStore").on(j.E2EE_ACTIVE_CONSUMER, function(a) {
        var i, s = a.peerId;
        ((i = l(r, ke)[ke].getValue("modules").e2ee) === null || i === void 0 ? void 0 : i.enabled) !== !0 && r.emit("media_decode_error", { reason: "Got encrypted media for participantId ".concat(s, ", but encryption wasn't enabled in init.defaults"), code: "1702" });
      });
      var n = l(this, ke)[ke].getValue("audioPlayback");
      n && this.audioSubscribed.on("participantLeft", function(a) {
        n.removeParticipantTrack(a.id);
      });
    }
    /**
    * Returns the number of participants who are joined in the meeting.
    */
  }, {
    key: "count",
    get: function() {
      return this.joined.size;
    }
    /**
    * Returns the maximum number of participants that can be present in
    * the active map.
    */
  }, {
    key: "maxActiveParticipantsCount",
    get: function() {
      var r;
      return (r = l(this, ke)[ke]) === null || r === void 0 ? void 0 : r.getValue("maxPreferredStreams");
    }
    /**
    * Updates the maximum number of participants that are populated in
    * the active map.
    *
    * @param limit: Updated max limit
    */
  }, {
    key: "setMaxActiveParticipantsCount",
    value: function(r) {
      if (r < 0 || r > 24)
        throw new U("0 <= Max active participants count limit <= 24", "1203");
      l(this, ke)[ke].setValue("maxPreferredStreams", r), l(this, pi)[pi] && l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.viewMode, page: this.currentPage });
    }
    /**
    * Returns the number of pages that are available in the meeting in PAGINATED mode.
    * If the meeting is in ACTIVE_GRID mode, this value will be 0.
    */
  }, {
    key: "pageCount",
    get: function() {
      if (this.viewMode === "PAGINATED") {
        var r = this.selectedPeers.compulsoryPeers.length, n = this.joined.toArray().filter(function(a) {
          return a.stageStatus === "ON_STAGE";
        });
        return Math.ceil((n.length - r) / Math.max(this.maxActiveParticipantsCount - r, 1));
      }
      return 0;
    }
    /**
    * Accepts requests from waitlisted participants if user
    * has appropriate permissions.
    * @param id peerId or userId of the waitlisted participant.
    */
  }, {
    key: "acceptWaitingRoomRequest",
    value: function(r) {
      var n, a;
      if (!l(this, xn)[xn])
        throw new U("Can`t accept waiting room request without joining room", "1205");
      var i = (n = (a = this.waitlisted.get(r)) === null || a === void 0 ? void 0 : a.userId) !== null && n !== void 0 ? n : r;
      return l(this, br)[br].acceptWaitingRoomRequest([i]);
    }
    /**
    * We need a new event for socket service events
    * since if we send them all together, sequence of events
    * can be unreliable
    */
  }, { key: "acceptAllWaitingRoomRequest", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return s = a.map(function(d) {
                var h, v;
                return (h = (v = i.waitlisted.get(d)) === null || v === void 0 ? void 0 : v.userId) !== null && h !== void 0 ? h : d;
              }), c.abrupt("return", l(this, br)[br].acceptWaitingRoomRequest(s));
            case 2:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "rejectWaitingRoomRequest", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (l(this, xn)[xn]) {
                d.next = 2;
                break;
              }
              throw new U("Can`t reject waiting room request without joining room", "1205");
            case 2:
              u = (i = (s = this.waitlisted.get(a)) === null || s === void 0 ? void 0 : s.userId) !== null && i !== void 0 ? i : a, l(this, br)[br].rejectWaitingRoomRequest([u]);
            case 4:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setViewMode", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this.logger.info("Participants::set_view_mode", { pageNavigation: { viewMode: a, currentPage: this.currentPage, pageCount: this.pageCount, maxActiveParticipantsCount: this.maxActiveParticipantsCount } }), i = function(d) {
                return g_.includes(d);
              }, i(a)) {
                u.next = 5;
                break;
              }
              throw this.logger.error("Participants::setViewMode::invalid_view_mode", { pageNavigation: { viewMode: a, currentPage: this.currentPage, pageCount: this.pageCount, maxActiveParticipantsCount: this.maxActiveParticipantsCount } }), new U("Invalid view mode: ".concat(a, ". Try ACTIVE_GRID, PAGINATED or MANUAL."), "1207");
            case 5:
              if (this.viewMode !== a) {
                u.next = 8;
                break;
              }
              return this.logger.info("Participants::setViewMode::view_mode_same_as_previous"), u.abrupt("return");
            case 8:
              this.viewMode = a, a === "PAGINATED" ? (this.currentPage = 1, l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: a, page: this.currentPage })) : a === "ACTIVE_GRID" ? (this.currentPage = 0, l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: a, page: this.currentPage })) : a === "MANUAL" && (this.currentPage = 0, l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: a, page: this.currentPage })), this.emit("viewModeChanged", { viewMode: a, currentPage: this.currentPage, pageCount: this.pageCount });
            case 11:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "subscribe", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = u.length > 1 && u[1] !== void 0 ? u[1] : ["audio", "video", "screenshareAudio", "screenshareVideo"], this.viewMode === "MANUAL") {
                d.next = 3;
                break;
              }
              throw new U("MANUAL subscription mode was not activated.", "1206");
            case 3:
              a.forEach(function(h) {
                var v = i.joined.get(h);
                v && (s.includes("audio") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { audio: !0 }), i.audioSubscribed.has(v.id) || i.audioSubscribed.add(v)), s.includes("video") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { video: !0 }), i.videoSubscribed.has(v.id) || i.videoSubscribed.add(v)), s.includes("screenshareAudio") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { screenshareAudio: !0 }), i.audioSubscribed.has(v.id) || i.audioSubscribed.add(v)), s.includes("screenshareVideo") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { screenshareVideo: !0 }), i.videoSubscribed.has(v.id) || i.videoSubscribed.add(v)));
              }), l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.viewMode, page: this.currentPage });
            case 5:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "unsubscribe", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = u.length > 1 && u[1] !== void 0 ? u[1] : ["audio", "video", "screenshareAudio", "screenshareVideo"], this.viewMode === "MANUAL") {
                d.next = 3;
                break;
              }
              throw new U("MANUAL subscription mode was not activated.", "1206");
            case 3:
              a.forEach(function(h) {
                var v = i.joined.get(h);
                v && (s.includes("audio") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { audio: !1 }), v.manualProducerConfig.screenshareAudio || i.audioSubscribed.delete(v.id)), s.includes("video") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { video: !1 }), v.manualProducerConfig.screenshareVideo || i.videoSubscribed.delete(v.id)), s.includes("screenshareAudio") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { screenshareAudio: !1 }), v.manualProducerConfig.audio || i.audioSubscribed.delete(v.id)), s.includes("screenshareVideo") && (v.manualProducerConfig = $($({}, v.manualProducerConfig), {}, { screenshareVideo: !1 }), v.manualProducerConfig.video || i.videoSubscribed.delete(v.id)));
              }), l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.viewMode, page: this.currentPage });
            case 5:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getPeerIdsForCurrentPage", value: function() {
    var r = this;
    this.logger.info("Participants::getPeerIdsForCurrentPage()", { pageNavigation: { viewMode: this.viewMode, currentPage: this.currentPage, pageCount: this.pageCount, maxActiveParticipantsCount: this.maxActiveParticipantsCount } });
    var n = this.selectedPeers.compulsoryPeers, a = n.filter(function(d) {
      return r.joined.has(d);
    }), i = Array.from(this.pinned.keys()).filter(function(d) {
      return !a.includes(d);
    }), s = Array.from(this.joined.toArray().filter(function(d) {
      return d.stageStatus === "ON_STAGE";
    }).map(function(d) {
      return d.id;
    })), u = Math.max((this.currentPage - 1) * (this.maxActiveParticipantsCount - a.length - i.length)), c = this.currentPage * (this.maxActiveParticipantsCount - a.length - i.length);
    return a.concat(i, s.slice(u, c));
  } }, { key: "setPage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.logger.info("Participants::set_page", { pageNavigation: { settingPage: a, viewMode: this.viewMode, currentPage: this.currentPage, pageCount: this.pageCount, maxActiveParticipantsCount: this.maxActiveParticipantsCount } }), this.viewMode === "PAGINATED") {
                s.next = 3;
                break;
              }
              return s.abrupt("return");
            case 3:
              if (Number.isInteger(a)) {
                s.next = 6;
                break;
              }
              throw this.logger.error("Participants::invalid_page_number"), new U("Invalid page: ".concat(a, ". Page must be an integer and greater than 0 and less than or equal to .pageCount"), "1202");
            case 6:
              this.currentPage = a, l(this, ke)[ke].getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.viewMode, page: a }), this.emit("pageChanged", { viewMode: this.viewMode, currentPage: this.currentPage, pageCount: this.pageCount });
            case 9:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAllAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.logger.info("Participants::disable_all_audio", { actions: { disableAllAudio: { allowUnmute: a } } }), l(this, pi)[pi]) {
                s.next = 3;
                break;
              }
              throw new U("Can`t disable all audio without joining room", "1205");
            case 3:
              if (!l(this, ea)[ea].permissions.canAllowParticipantAudio) {
                s.next = 5;
                break;
              }
              return s.abrupt("return", l(this, po)[po].muteAll(a));
            case 5:
              throw this.logger.error("Participants::unauthorized_disable_all_audio", { actions: { disableAllAudio: { allowUnmute: a } } }), new U("Unauthorized: User does not have permission to disable peer audio.", "1201");
            case 7:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAllVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (this.logger.info("Participants::disable_all_video"), l(this, pi)[pi]) {
                i.next = 3;
                break;
              }
              throw new U("Can`t disable all video without joining room", "1205");
            case 3:
              if (!l(this, ea)[ea].permissions.canAllowParticipantVideo) {
                i.next = 5;
                break;
              }
              return i.abrupt("return", l(this, po)[po].muteAllVideo());
            case 5:
              throw this.logger.error("Participants::unauthorized_disable_all_video"), new U("Unauthorized: User does not have permission to disable peer video.", "1201");
            case 7:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              this.joined.get(a).disableAudio();
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              this.joined.get(a).disableVideo();
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "kick", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, ke)[ke].getValue("peerSessionStore").emitAsync(j.KICK_PEER, { peerId: a });
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "kickAll", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this.logger.info("Participants::kick_all"), a = l(this, ke)[ke].getValue("viewType"), !(a !== "LIVESTREAM" && !l(this, xn)[xn])) {
                u.next = 4;
                break;
              }
              throw new U("Can`t kick all without joining room", "1205");
            case 4:
              if (l(this, ea)[ea].permissions.kickParticipant) {
                u.next = 7;
                break;
              }
              throw this.logger.error("Participants::unauthorized_kick_all"), new U("Unauthorized: User does not have permission to kick peers.", "1201");
            case 7:
              i = l(this, ke)[ke].getValue("flagsmith").hasFeature(me.PROPAGATE_KICK_ALL), l(this, br)[br].kickAll(i);
            case 9:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "broadcastMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (this.logger.info("Participants::broadcastMessage"), l(this, xn)[xn]) {
                d.next = 3;
                break;
              }
              throw new U("Can`t broadcast message without joining room", "1205");
            case 3:
              if (a != null && a.trim()) {
                d.next = 5;
                break;
              }
              throw new U("`type` must be a non-empty string.", "1209");
            case 5:
              if (!s) {
                d.next = 17;
                break;
              }
              if (!("meetingIds" in s)) {
                d.next = 11;
                break;
              }
              return d.next = 9, l(this, br)[br].broadcastToMeetings(a, s.meetingIds, i);
            case 9:
              d.next = 15;
              break;
            case 11:
              return u = [], "participantIds" in s ? u = s.participantIds : u = this.joined.toArray().filter(function(h) {
                var v;
                return (v = s.presetNames) === null || v === void 0 ? void 0 : v.includes(h.presetName);
              }).map(function(h) {
                return h.id;
              }), d.next = 15, l(this, br)[br].broadcastToPeers(a, u, i);
            case 15:
              d.next = 19;
              break;
            case 17:
              return d.next = 19, l(this, br)[br].broadcastMessage(a, i);
            case 19:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getAllJoinedPeers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.next = 2, l(this, br)[br].getRoomPeers(a, i, s);
            case 2:
              return u = d.sent, d.abrupt("return", u.peers.map(za.formatSocketPeerMessage));
            case 4:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updatePermissions", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = this.joined.toArray().filter(function(h) {
                return a.includes(h.id);
              }).map(function(h) {
                return h.userId;
              }), u = Se(new Set(s)), u.length) {
                d.next = 4;
                break;
              }
              throw new U("Cannot update permissions, no valid userIDs found", "1204");
            case 4:
              l(this, br)[br].updatePermissions(u, i);
            case 5:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getParticipantsInMeetingPreJoin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", l(this, br)[br].getRoomPeersNonPaginated());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an));
function m_() {
  return l(this, ke)[ke].getValue("roomNodeClient");
}
function y_() {
  var o;
  return ((o = l(this, ke)[ke].getValue("connectionHandler")) === null || o === void 0 ? void 0 : o.socketJoined) === !0;
}
function k_() {
  var o;
  return ((o = l(this, ke)[ke].getValue("connectionHandler")) === null || o === void 0 ? void 0 : o.mediaJoined) === !0;
}
un([O.trace("Participants.setViewMode")], Ct.prototype, "setViewMode", 1);
un([O.trace("Participants.setPage")], Ct.prototype, "setPage", 1);
un([O.trace("Participants.disableAllAudio")], Ct.prototype, "disableAllAudio", 1);
un([O.trace("Participants.disableAllVideo")], Ct.prototype, "disableAllVideo", 1);
un([O.trace("Participants.disablePeerAudio")], Ct.prototype, "disableAudio", 1);
un([O.trace("Participants.disablePeerVideo")], Ct.prototype, "disableVideo", 1);
un([O.trace("Participants.kickPeer")], Ct.prototype, "kick", 1);
un([O.trace("Participants.kickAll")], Ct.prototype, "kickAll", 1);
un([O.trace("Participants.broadcastMessage"), Lt(Ho, "rateLimitConfig")], Ct.prototype, "broadcastMessage", 1);
un([O.trace("Participants.getAllJoinedPeers"), Lt({ maxInvocations: 10, period: 60 })], Ct.prototype, "getAllJoinedPeers", 1);
un([O.trace("Participant.updatePermissions"), Lt({ maxInvocations: 1e3, period: 60 })], Ct.prototype, "updatePermissions", 1);
un([O.trace("Participants.getParticipantsInMeetingPreJoin")], Ct.prototype, "getParticipantsInMeetingPreJoin", 1);
Ct = un([vt("1200")], Ct);
var b_ = Object.defineProperty, T_ = Object.getOwnPropertyDescriptor, to = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? T_(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && b_(e, r, a), a;
}, Rg = (qr = /* @__PURE__ */ S("currentView"), xr = /* @__PURE__ */ S("consumersSyncing"), hi = /* @__PURE__ */ S("resyncRequired"), /* @__PURE__ */ function() {
  function o(t, e, r) {
    var n = this;
    w(this, o), this.participants = void 0, this.self = void 0, this.selectedPeers = Cg, this.maxSpatialLayerUpdates = /* @__PURE__ */ new Map(), this.consumerPeerMap = void 0, this.events = void 0, this.roomSocketHandler = void 0, this.context = void 0, this.videoPeerConsumerMap = /* @__PURE__ */ new Map(), Object.defineProperty(this, qr, { writable: !0, value: { mode: "ACTIVE_GRID", page: 0 } }), Object.defineProperty(this, xr, { writable: !0, value: !1 }), Object.defineProperty(this, hi, { writable: !0, value: !1 }), this.updateConsumerSpatialLayers = jp(function() {
      var a = {}, i = new Map(n.maxSpatialLayerUpdates);
      n.maxSpatialLayerUpdates.clear(), Array.from(i.entries()).forEach(function(s) {
        var u = He(s, 2), c = u[0], d = u[1];
        a[d] === void 0 && (a[d] = { layer: d, consumerIds: [] }), a[d].consumerIds.push(c);
      }), Object.keys(a).forEach(function(s) {
        var u = a[s];
        n.logger.log("Switching max spatial layer to ".concat(u.layer), { consumerIds: u.consumerIds }), n.roomNodeClient.switchConsumersToLayer(u.consumerIds, u.layer);
      });
    }, 2e3), this.updateConsumers = /* @__PURE__ */ function() {
      var a = m(/* @__PURE__ */ p().mark(function i(s, u) {
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                if (n.logger.info("updateConsumers: Starting consumer updates - AddProducers: ".concat(s.length, ", RemoveProducers: ").concat(u.length, ", ConsumersSyncing: ").concat(l(n, xr)[xr])), d.prev = 1, s.length === 0) {
                  d.next = 7;
                  break;
                }
                return n.logger.info("updateConsumers: Creating consumers for ".concat(s.length, " producers: [").concat(s.map(function(h) {
                  return h.producerId;
                }).join(", "), "]")), d.next = 6, n.roomNodeClient.createConsumers(s);
              case 6:
                n.logger.info("updateConsumers: Successfully created consumers.");
              case 7:
                d.next = 12;
                break;
              case 9:
                d.prev = 9, d.t0 = d.catch(1), n.logger.error("updateConsumers: Error creating consumers", { error: d.t0 });
              case 12:
                if (d.prev = 12, u.length === 0) {
                  d.next = 18;
                  break;
                }
                return n.logger.info("updateConsumers: Closing consumers for ".concat(u.length, " producers: [").concat(u.map(function(h) {
                  return h.producerId;
                }).join(", "), "]")), d.next = 17, n.roomNodeClient.closeConsumers(u);
              case 17:
                n.logger.info("updateConsumers: Successfully closed consumers.");
              case 18:
                d.next = 23;
                break;
              case 20:
                d.prev = 20, d.t1 = d.catch(12), n.logger.error("updateConsumers: Error closing consumers", { error: d.t1 });
              case 23:
                n.logger.info("updateConsumers: Completed consumer updates.");
              case 24:
              case "end":
                return d.stop();
            }
        }, i, null, [[1, 9], [12, 20]]);
      }));
      return function(i, s) {
        return a.apply(this, arguments);
      };
    }(), this.context = t, this.roomSocketHandler = r, this.participants = new Ct(t, e, this.roomSocketHandler), this.self = e, this.consumerPeerMap = /* @__PURE__ */ new Map(), this.events = Vn, e.config.viewType !== "CHAT" && this.setupEventsGlobal(), this.setupEvents();
  }
  return P(o, [{ key: "roomNodeClient", get: function() {
    return this.context.getValue("roomNodeClient");
  } }, { key: "mediaJoined", get: function() {
    var e;
    return ((e = this.roomNodeClient) === null || e === void 0 ? void 0 : e.mediaJoined) === !0;
  } }, { key: "pip", get: function() {
    return this.context.getValue("pip");
  } }, {
    key: "telemetry",
    get: function() {
      return this.context.getValue("telemetry");
    }
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return this.context.getValue("logger");
  } }, {
    key: "setupEvents",
    value: function() {
      var e = this;
      this.roomSocketHandler.on(Y.getWaitingRoomRequests, this.waitingRoomRequestHandler.bind(this)), this.context.getValue("peerSessionStore").on(j.SOCKET_PEERS, /* @__PURE__ */ function() {
        var r = m(/* @__PURE__ */ p().mark(function n(a) {
          var i, s;
          return p().wrap(function(c) {
            for (; ; )
              switch (c.prev = c.next) {
                case 0:
                  i = e.context.getValue("flagsmith").hasFeature(me.DEBUG_SOCKET_JOIN), i && (s = a && (a == null ? void 0 : a.length) < 20 ? { peers: JSON.stringify(a.map(function(d) {
                    return d.peerId;
                  })) } : void 0, e.logger.info("Processing socket peers", s)), a == null || a.forEach(function(d) {
                    d.waitlisted || e.onParticipantSocketJoined(e.createParticipantObjFromSocketPeer(d));
                  }), i && e.logger.info("Processed socket peers");
                case 4:
                case "end":
                  return c.stop();
              }
          }, n);
        }));
        return function(n) {
          return r.apply(this, arguments);
        };
      }()), this.roomSocketHandler.on(this.events.peerJoinedBroadcast, function(r) {
        var n = r.participant;
        e.logger.info("PEER_INFO:::MEDIA_JOIN", { participant: { id: n.peerId, maskedName: Se((n == null ? void 0 : n.displayName) || "").map(function(a, i) {
          return i % 2 ? "*" : a;
        }).join("") } }), e.logger.info("events.peerJoinedBroadcast", { peers: n.peerId }), e.onParticipantMediaJoined(n.peerId, n.producerStates, n.capabilities);
      }), this.roomSocketHandler.on(this.events.selfJoinComplete, function(r) {
        var n = r.participants, a = r.selectedPeers, i = r.roomState;
        if (e.context.getValue("flagsmith").hasFeature(me.DEBUG_SOCKET_JOIN)) {
          var s = n && (n == null ? void 0 : n.length) < 20 ? { peers: JSON.stringify(n.map(function(h) {
            return h.peerId;
          })) } : void 0;
          e.logger.info("events.selfJoinComplete", s);
        }
        n.forEach(function(h) {
          var v = h.peerId, f = h.producerStates, g = h.capabilities;
          return e.onParticipantMediaJoined(v, f, g);
        });
        var u = a != null ? a : {}, c = u.audioPeers, d = u.compulsoryPeers;
        i.pinnedPeerIds.length !== 0 && e.onParticipantPinned(i.pinnedPeerIds[0]), e.computeActivateParticipants(c != null ? c : [], d), e.logger.info("selfJoinComplete: Emitting UPDATE_ACTIVE with createAllConsumers=true"), e.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { createAllConsumers: !0 });
      }), this.context.getValue("peerSessionStore").on(j.MAX_SPATIAL_LAYER_CHANGE, function(r) {
        var n = r.peerId, a = r.maxSpatialLayer, i = e.videoPeerConsumerMap.get(n);
        i && (e.context.getValue("flagsmith").hasFeature(me.DISABLE_LAYER_SWITCH) || (e.maxSpatialLayerUpdates.set(i, a), e.updateConsumerSpatialLayers()));
      }), this.context.getValue("peerSessionStore").on(j.NEW_PRODUCER, function(r) {
        var n = r.peerId, a = r.producer, i = e.participants.joined.get(n);
        if (!i) {
          e.logger.warn("ParticipantController::NEW_PRODUCER::participant not found", { producer: { id: a == null ? void 0 : a.producerId, kind: a == null ? void 0 : a.kind, status: "not_initialized", appData: { screenShare: a == null ? void 0 : a.screenShare } }, participant: { id: n } });
          return;
        }
        i.producers.push(a), e.logger.info("ParticipantController::NEW_PRODUCER::producer_added_to_participant", { producer: { id: a == null ? void 0 : a.producerId, peerId: n, kind: a == null ? void 0 : a.kind, status: "not_initialized", appData: { screenShare: a == null ? void 0 : a.screenShare } } }), (a == null ? void 0 : a.kind) === "audio" && e.participants.audioSubscribed.get(n) || (a == null ? void 0 : a.kind) === "video" && e.participants.videoSubscribed.get(n) || a != null && a.screenShare ? (e.logger.info("NEW_PRODUCER: scheduling syncConsumer (AUTO mode) - Producer: ".concat(a.producerId, ", Peer: ").concat(n, ", Kind: ").concat(a.kind, ", ScreenShare: ").concat(a.screenShare, ", ConsumersSyncing: ").concat(l(e, xr)[xr], ", VideoSub: ").concat(a.kind === "video" ? e.participants.videoSubscribed.has(n) : "N/A", ", AudioSub: ").concat(a.kind === "audio" ? e.participants.audioSubscribed.has(n) : "N/A")), e.scheduleSyncConsumers({ source: "NEW_PRODUCER_AUTO" })) : e.logger.info("ParticipantController::NEW_PRODUCER::not_consuming_producer_auto", { producer: { id: a == null ? void 0 : a.producerId, peerId: n, kind: a == null ? void 0 : a.kind, status: "UNKNOWN", appData: { screenShare: a == null ? void 0 : a.screenShare } } });
      }), this.context.getValue("peerSessionStore").on(j.PRODUCER_CLOSED, function(r) {
        var n = r.peerId, a = r.producerId, i = e.participants.joined.get(n);
        if (!i) {
          e.logger.warn("ParticipantController::NEW_PRODUCER::participant not found", { participant: { id: n } });
          return;
        }
        i.producers = i.producers.filter(function(s) {
          return s.producerId !== a;
        });
      }), this.context.getValue("peerSessionStore").on(j.PRODUCER_TOGGLE, function(r) {
        var n = r.peerId, a = r.producerId, i = r.paused, s = r.kind, u = e.participants.joined.get(n);
        if (u) {
          s === "audio" && u.setAudioEnabled(!i);
          var c = u.producers.find(function(d) {
            return d.producerId === a;
          });
          c && (c.pause = i), s === "video" && e.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: e.participants.viewMode, page: e.participants.currentPage });
        }
      }), this.roomSocketHandler.on(this.events.globalPeerPinBroadcast, function(r) {
        var n;
        if (r && (n = r.participantId), !!e.mediaJoined) {
          var a = n;
          e.onParticipantPinned(a);
          var i = e.participants.joined.get(a);
          i && (e.logger.info("globalPeerPinBroadcast: Scheduling audio/video consumer sync for pinned participant ".concat(a, " - ProducerCount: ").concat(i.producers.length, ", ConsumersSyncing: ").concat(l(e, xr)[xr], ", ProducerIds: [").concat(i.producers.map(function(s) {
            return s.producerId;
          }).join(", "), "]")), e.scheduleSyncConsumers({ source: "GLOBAL_PEER_PIN" }));
        }
      }), this.roomSocketHandler.on(this.events.selectedPeer, function(r) {
        var n = r.audioPeers, a = r.compulsoryPeers;
        e.mediaJoined && e.onSelectedPeers(a.concat(n));
      }), this.roomSocketHandler.on(this.events.selectedPeerDiff, function(r) {
        var n = r.entries;
        if (e.mediaJoined) {
          var a = n.map(function(i) {
            return { peerId: i.peerId, priority: i.priority };
          });
          e.updateActiveParticipantsWithPriorities(a, !0);
        }
      });
    }
    /**
    * Socket Service only
    */
  }, { key: "waitingRoomRequestHandler", value: function(e) {
    var r = this, n = e.requests.filter(function(i) {
      return !r.participants.waitlisted.toArray().find(function(s) {
        return s.userId === i.userId;
      });
    }), a = this.participants.waitlisted.toArray().filter(function(i) {
      return !e.requests.find(function(s) {
        return s.userId === i.userId;
      });
    });
    n.forEach(function(i) {
      return r.participants.waitlisted.add(new Ga(r.context, { id: i.peerId, displayName: i.displayName, audioMuted: !0, videoEnabled: !1, audioTrack: void 0, videoTrack: void 0, stageStatus: "OFF_STAGE", userId: i.userId, flags: {}, isHost: !1, customParticipantId: i.customParticipantId, picture: i.picture, metadata: { preset_name: i.presetName } }, r.self, r.roomSocketHandler));
    }), a.forEach(function(i) {
      return r.participants.waitlisted.delete(i.id);
    });
  } }, { key: "maxPreferredStreams", get: function() {
    return this.participants.maxActiveParticipantsCount;
  } }, { key: "selectPagePeers", value: function(e) {
    var r = this, n = this.selectedPeers.compulsoryPeers, a = n.filter(function(h) {
      return r.participants.joined.has(h);
    }), i = Array.from(this.participants.pinned.keys()).filter(function(h) {
      return !a.includes(h);
    }), s = Array.from(this.participants.joined.toArray().filter(function(h) {
      return h.stageStatus === "ON_STAGE";
    }).map(function(h) {
      return h.id;
    })), u = Math.max((e - 1) * (this.maxPreferredStreams - a.length - i.length)), c = e * (this.maxPreferredStreams - a.length - i.length), d = a.concat(i, s.slice(u, c));
    return d;
  } }, {
    key: "selectActivePeers",
    value: function(e) {
      var r = this, n = /* @__PURE__ */ new Map(), a = Array.from(this.participants.joined.toArray().filter(function(g) {
        return g.stageStatus === "ON_STAGE";
      }).map(function(g) {
        return n.set(g.id, !0), g.id;
      })), i = this.selectedPeers.peers, s = this.participants.pinned.toArray().reduce(function(g, k) {
        return k.stageStatus !== "ON_STAGE" ? r.participants.pinned.delete(k.id) : g.push(k.id), g;
      }, []), u = this.self.stageStatus === "ON_STAGE" ? 1 : 0, c = e - u, d = new Set(i.concat(s).filter(function(g) {
        return g !== r.self.id && n.has(g);
      })), h = Array.from(d), v = c - d.size;
      if (v >= 0) {
        var f = a.filter(function(g) {
          return !d.has(g) && g !== r.self.id;
        }).slice(0, v);
        h = Array.from(d).concat(f);
      } else
        h = h.slice(0, c);
      return h;
    }
    /**
    * NOTE(ravindra-cloudflare):
    * This method retrieves the active peers for the given page and mode,
    * and updates the participants.audioSubscribed & participants.videoSubscribed maps,
    * which are basically active maps to consume.
    *
    * This is why there are no participants.audioSubscribed.add,
    * and participants.videoSubscribed.add method calls.
    *
    * Actual subscription configs, eg: whether consumption is allowed or not of a peer producer
    * is stored in participants.manualProducerConfig.
    *
    * Do not call this method directly, use UPDATE_ACTIVE event instead, for Sanity.
    * Emitting UPDATE_ACTIVE will help figure out races faster, if any.
    * */
  }, { key: "updateMediaSubscribedMaps", value: function(e, r) {
    var n = r != null ? r : {}, a = n.page;
    e && l(this, qr)[qr].mode !== e && (l(this, qr)[qr].mode = e), a && l(this, qr)[qr].page !== a && (l(this, qr)[qr].page = a);
    var i = l(this, qr)[qr], s = i.mode, u = i.page;
    switch (s) {
      case "PAGINATED": {
        if (!u)
          return;
        var c = this.selectPagePeers(u), d = this.selectActivePeers(this.participants.maxActiveParticipantsCount + 4);
        this.updateParticipantsMap(this.participants.videoSubscribed, c), this.updateParticipantsMap(this.participants.audioSubscribed, d), this.logger.debug("ParticipantController::updateActive::updating_current_page_peers", { peerIds: c });
        break;
      }
      case "ACTIVE_GRID": {
        var h = this.selectActivePeers(this.participants.maxActiveParticipantsCount), v = this.selectActivePeers(this.participants.maxActiveParticipantsCount + 4);
        this.updateParticipantsMapMinReplacement(this.participants.videoSubscribed, h), this.updateParticipantsMap(this.participants.audioSubscribed, v);
        break;
      }
      case "MANUAL":
        break;
      default:
        throw new Error("View mode ".concat(e, " not supported"));
    }
  } }, {
    key: "scheduleSyncConsumers",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a, i, s, u = this, c, d;
        return p().wrap(function(v) {
          for (; ; )
            switch (v.prev = v.next) {
              case 0:
                c = n.source, d = ((a = l(this, qr)[qr]) === null || a === void 0 ? void 0 : a.mode) === "PAGINATED" && !l(this, xr)[xr] ? 200 : 0, this.logger.info("scheduleSyncConsumers():: Source: ".concat(c, ", ViewMode: ").concat((i = l(this, qr)[qr]) === null || i === void 0 ? void 0 : i.mode, ", ConsumersSyncing: ").concat(l(this, xr)[xr], ", Delay: ").concat(d, ", Page: ").concat((s = l(this, qr)[qr]) === null || s === void 0 ? void 0 : s.page)), setTimeout(function() {
                  return u.syncConsumers();
                }, d);
              case 4:
              case "end":
                return v.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * try to avoid calling this method concurrently.
    *
    * To ensure that only once request succeeds and rest get queued,
    * we have a flag `#consumersSyncing` to track the state.
    *
    * If `#consumersSyncing` is true, it means a sync operation is in progress.
    * In this case, we set `#resyncRequired` to true and exit.
    *
    * If `#consumersSyncing` is false, it means no sync operation is in progress.
    * In this case, we set `#consumersSyncing` to true and proceed with the sync operation.
    *
    * Logic:
    * 1. We will get all the producers that should have consumers to show in the current page/mode,
    *    based on audioSubscribed & videoSubscribed, which are active participant maps.
    * 2. We will get all the consumers of producers that we are currently consuming.
    * 3. We will get the difference between the two sets.
    * 4. We will add the consumers of producers that we should ideally have but are not consuming.
    * 5. We will remove the consumers of producers that we are consuming but should not.
    */
  }, { key: "syncConsumers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a = this, i, s, u, c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              if (((n = this.context.getValue("connectionHandler")) === null || n === void 0 || (n = n.mediaState) === null || n === void 0 || (n = n.recv) === null || n === void 0 ? void 0 : n.state) === "connected") {
                y.next = 3;
                break;
              }
              return this.logger.info("syncConsumers: Connection not ready, exiting."), y.abrupt("return");
            case 3:
              if (!l(this, xr)[xr]) {
                y.next = 7;
                break;
              }
              return l(this, hi)[hi] = !0, this.logger.info("syncConsumers: Sync in progress, marking resyncRequired=true and exiting."), y.abrupt("return");
            case 7:
              if (this.logger.info("syncConsumers: Starting sync operation."), l(this, xr)[xr] = !0, l(this, hi)[hi] = !1, c = [], this.participants.videoSubscribed.forEach(function(b) {
                var C, T, E = a.participants.joined.get(b.id), D = (C = (T = b.producers) === null || T === void 0 ? void 0 : T.filter(function(I) {
                  return I.kind === "video";
                })) !== null && C !== void 0 ? C : [];
                E && D !== null && D !== void 0 && D.length && D.forEach(function(I) {
                  var _, V, F, N, L = ((_ = (V = E.manualProducerConfig) === null || V === void 0 ? void 0 : V.video) !== null && _ !== void 0 ? _ : !0) && I.kind === "video" && !I.screenShare, H = ((F = (N = E.manualProducerConfig) === null || N === void 0 ? void 0 : N.screenshareVideo) !== null && F !== void 0 ? F : !0) && I.kind === "video" && I.screenShare;
                  (L || H) && (I.pause || c.push(I));
                });
              }), this.participants.audioSubscribed.forEach(function(b) {
                var C, T, E = a.participants.joined.get(b.id), D = (C = (T = b.producers) === null || T === void 0 ? void 0 : T.filter(function(I) {
                  return I.kind === "audio";
                })) !== null && C !== void 0 ? C : [];
                E && D !== null && D !== void 0 && D.length && D.forEach(function(I) {
                  var _, V, F, N, L = ((_ = (V = E.manualProducerConfig) === null || V === void 0 ? void 0 : V.audio) !== null && _ !== void 0 ? _ : !0) && I.kind === "audio" && !I.screenShare, H = ((F = (N = E.manualProducerConfig) === null || N === void 0 ? void 0 : N.screenshareAudio) !== null && F !== void 0 ? F : !0) && I.kind === "audio" && I.screenShare;
                  (L || H) && c.push(I);
                });
              }), c = kP(c, function(b) {
                return b.producerId;
              }), d = /* @__PURE__ */ new Map(), c.forEach(function(b) {
                d.set(b.producerId, b);
              }), h = (i = this.roomNodeClient) === null || i === void 0 ? void 0 : i.getConsumers(), v = c.filter(function(b) {
                return !(h != null && h.has(b.producerId));
              }), f = [], g = Array.from((s = h == null ? void 0 : h.values()) !== null && s !== void 0 ? s : []).map(function(b) {
                return b.peerId;
              }), g = yP(g), (u = g) === null || u === void 0 || u.forEach(function(b) {
                var C, T = a.participants.joined.get(b);
                if (!T) {
                  a.logger.warn("Peer with ".concat(b, " doesn't exist in joined list but producers of it are being consumed."));
                  return;
                }
                (C = T.producers) !== null && C !== void 0 && C.length && T.producers.forEach(function(E) {
                  var D = E.consumer && h.has(E.consumer.id);
                  !d.has(E.producerId) && (h.has(E.producerId) || D) && f.push(E);
                });
              }), this.logger.info("syncConsumers: Computed changes - AddProducers: ".concat(v.length, " [").concat(v.map(function(b) {
                return b.producerId;
              }).join(", "), "], RemoveProducers: ").concat(f.length, " [").concat(f.map(function(b) {
                return b.producerId;
              }).join(", "), "]").substring(0, 5e3)), y.prev = 23, !(v.length > 0 || f.length > 0)) {
                y.next = 31;
                break;
              }
              return this.logger.info("syncConsumers: Calling updateConsumers with changes. Adding ".concat(v.length, " and removing ").concat(f.length, ".")), y.next = 28, this.updateConsumers(v, f);
            case 28:
              this.logger.info("syncConsumers: updateConsumers completed successfully."), y.next = 32;
              break;
            case 31:
              this.logger.info("syncConsumers: No changes needed, skipping updateConsumers.");
            case 32:
              y.next = 37;
              break;
            case 34:
              y.prev = 34, y.t0 = y.catch(23), this.logger.error("syncConsumers: updateConsumers failed with error.", { error: y.t0 });
            case 37:
              return y.prev = 37, this.logger.info("syncConsumers: Setting consumersSyncing=false and completing sync."), l(this, xr)[xr] = !1, y.finish(37);
            case 41:
              l(this, hi)[hi] && (this.logger.info("syncConsumers: Resync required, calling syncConsumers again."), this.syncConsumers());
            case 42:
            case "end":
              return y.stop();
          }
      }, r, this, [[23, 34, 37, 41]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "computeActivateParticipants", value: function(e, r) {
    var n = e.map(function(i, s) {
      return { peerId: i, priority: s + 1 };
    }), a = r == null ? void 0 : r.map(function(i, s) {
      return { peerId: i, priority: -(s + 1) };
    });
    n.push.apply(n, Se(a != null ? a : [])), n.length > 0 && this.updateActiveParticipantsWithPriorities(n);
  } }, { key: "createParticipantObjFromSocketPeer", value: function(e) {
    var r = Rg.formatSocketPeerMessage(e);
    return new Ga(this.context, $($({}, r), {}, { isHost: !1, videoEnabled: !1, audioMuted: !0, videoTrack: void 0, audioTrack: void 0 }), this.self, this.roomSocketHandler);
  } }, {
    key: "updatePipSource",
    value: function(e, r) {
      var n, a;
      r ? (n = this.pip) === null || n === void 0 || n.enableSource(e) : (a = this.pip) === null || a === void 0 || a.disableSource(e);
    }
    /** *
    * NOTE(ravindra-cloudflare):
    * This method is meant to be called for participants that have joined the media room
    * They can now hear/see others.
    *
    * By this time, they have called meeting.join().
    */
  }, {
    key: "onParticipantMediaJoined",
    value: function(e, r, n) {
      var a = this;
      if (this.mediaJoined && e !== this.self.id) {
        var i = this.participants.joined.get(e);
        if (!i) {
          this.logger.warn("Received media.peerJoinedBroadcast for non-existent peer ".concat(e));
          return;
        }
        this.logger.info("PEER_INFO:::SOCKET_ON_MEDIA_JOIN", { participant: { id: i.id, maskedName: Se((i == null ? void 0 : i.name) || "").map(function(s, u) {
          return u % 2 ? "*" : s;
        }).join("") } }), this.logger.info("onParticipantMediaJoined: peer ".concat(e, " has joined media room. Processing.")), r.forEach(function(s) {
          s.kind === ca.AUDIO && !s.screenShare ? i.setAudioEnabled(!s.pause) : s.kind === ca.VIDEO && !s.screenShare && (i.setVideoEnabled(!s.pause), a.updatePipSource(i.id, !s.pause)), i.producers.push($($({}, s), {}, { producingTransportId: s.producingTransportId, kind: s.kind === ca.AUDIO ? "audio" : "video", producingPeerId: e, mimeType: s.mimeType }));
        }), this.roomNodeClient.handlePeerCapabilities(e, n), this.context.getValue("flagsmith").hasFeature(me.FORCE_VIDEO_CODEC) || this.roomNodeClient.shareWebcam(this.self.videoTrack), this.logger.info("onParticipantMediaJoined: Emitting UPDATE_ACTIVE for peer ".concat(e)), this.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.participants.viewMode, page: this.participants.currentPage });
      }
    }
    /**
    	* NOTE(roerohan): The following piece of code updates .active and ensures that the positions
    	* in the peer map are not affected by the order of the peerIds
    	* sent in the input. If a participant is present in the 3rd position in the
    	* map, and room node sends the peerId in the 2nd position, the participant
    	* should remain in the 3rd position.
    */
  }, { key: "updateParticipantsMapMinReplacement", value: function(e, r) {
    var n = this, a = Array.from(e.keys()), i = new Map(e), s = new Set(r), u = [];
    a.forEach(function(c, d) {
      (!s.has(c) || !n.participants.joined.get(c)) && u.push(d);
    }), r.forEach(function(c) {
      if (!e.get(c)) {
        if (a.length < r.length) {
          a.push(c);
          return;
        }
        var d = u.shift();
        a[d] = c;
      }
    }), u.forEach(function(c) {
      a.splice(c, 1);
    }), Array.from(e.keys()).forEach(function(c) {
      e.delete(c, !s.has(c));
    }), a.forEach(function(c) {
      if (!n.participants.joined.get(c)) {
        n.logger.warn("updateActiveParticipants::participant_not_in_joined_list", { participant: { id: c } });
        return;
      }
      e.add(n.participants.joined.get(c), !i.get(c));
    }), e.emit("participantsUpdate");
  } }, { key: "updateParticipantsMap", value: function(e, r) {
    var n = this, a = Array.from(e.keys());
    a.forEach(function(i) {
      r.includes(i) || e.delete(i, !0);
    }), r.forEach(function(i) {
      e.get(i) || e.add(n.participants.joined.get(i), !0);
    }), e.emit("participantsUpdate");
  } }, { key: "updatePinnedParticipants", value: function() {
    var e = this;
    this.participants.pinned.forEach(function(r) {
      r.setIsPinned(!1), e.participants.pinned.delete(r.id);
    });
  } }, { key: "setupEventsGlobal", value: function() {
    var e = this;
    this.roomSocketHandler.on(Y.joinRoom, function(r) {
      var n = r.peer;
      if (!n.waitlisted) {
        var a = e.context.getValue("flagsmith").hasFeature(me.DEBUG_SOCKET_JOIN);
        a && e.logger.info("Processing socket join", { peers: n.peerId }), e.onParticipantSocketJoined(e.createParticipantObjFromSocketPeer(n)), a && e.logger.info("Processed socket join", { peers: n.peerId });
      }
    }), this.roomSocketHandler.on(Y.leaveRoom, function(r) {
      var n = r.peer.peerId;
      e.selectedPeers.delete(n, e.context), e.onParticipantLeave(n);
    }), this.context.getValue("peerSessionStore").on(j.SOCKET_SERVICE_ROOM_JOINED, function() {
      e.self.permissions.acceptWaitingRequests && e.roomSocketHandler.getWaitingRoomRequests();
    }), this.self.permissions.on("permissionsUpdate", function(r) {
      var n = r.acceptWaitingRequests;
      n !== void 0 && (n ? e.roomSocketHandler.getWaitingRoomRequests() : e.participants.waitlisted.clear());
    }), this.context.getValue("peerSessionStore").on(j.SOCKET_SERVICE_DISCONNECTED, function() {
      e.participants.joined.clear(), e.participants.videoSubscribed.clear(), e.participants.audioSubscribed.clear(), e.participants.pinned.clear(), e.participants.currentPage = 0, e.participants.viewMode = "ACTIVE_GRID", e.participants.emit("viewModeChanged", { viewMode: "ACTIVE_GRID", currentPage: e.participants.currentPage, pageCount: e.participants.pageCount });
    }), this.context.getValue("peerSessionStore").on(j.CONSUMER_PAUSED, function(r) {
      var n = r.id;
      e.processConsumerPaused(n);
    }), this.context.getValue("peerSessionStore").on(j.CONSUMER_RESUMED, function(r) {
      var n = r.id;
      e.processConsumerResumed(n);
    }), this.context.getValue("peerSessionStore").on(j.NEW_CONSUMER, function(r) {
      var n = r.id;
      e.processNewConsumer(n);
    }), this.context.getValue("peerSessionStore").on(j.CONSUMER_CLOSED, function(r) {
      var n = r.id;
      e.processConsumerClosed(n);
    }), this.context.getValue("peerSessionStore").on(j.ROOM_MESSAGE, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s, u;
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                i = a.payload, s = a.type, u = a.timestamp, e.participants.emit("broadcastedMessage", { type: s, payload: i, timestamp: u });
              case 2:
              case "end":
                return d.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), this.context.getValue("peerSessionStore").on(j.MESSAGE, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s, u;
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                if (i = a.payload, s = a.type, u = a.timestamp, s !== "spotlight") {
                  d.next = 3;
                  break;
                }
                return d.abrupt("return");
              case 3:
                e.participants.emit("broadcastedMessage", { type: s, payload: i, timestamp: u });
              case 4:
              case "end":
                return d.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), this.context.getValue("peerSessionStore").on(j.LOW_CONSUMER_SCORE, function(r) {
      var n = r.peerId, a = r.score, i = r.kind, s = e.participants.joined.get(n);
      s && (s.emit("poorConnection", { score: a, kind: i }), e.participants.emit("poorConnection", { participantId: n, score: a, kind: i }));
    }), this.context.getValue("peerSessionStore").on(j.CONSUMER_SCORE_UPDATE, function(r) {
      var n, a = r.score, i = r.kind, s = r.appData, u = r.peerId, c = r.scoreStats, d = i === "video" && ((n = s == null ? void 0 : s.screenShare) !== null && n !== void 0 ? n : !1), h = e.participants.joined.get(u);
      h && (h.emit("mediaScoreUpdate", { kind: i, isScreenshare: d, score: a, participantId: u, scoreStats: c }), e.participants.emit("mediaScoreUpdate", { kind: i, isScreenshare: d, score: a, participantId: u, scoreStats: c }));
    }), this.context.getValue("peerSessionStore").onAsync(j.KICK_PEER, /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                return i = a.peerId, s = e.participants.joined.get(i), e.roomNodeClient.kick(i), c.next = 5, e.roomSocketHandler.kick(i);
              case 5:
                s ? s.emit("kicked") : e.participants.joined.emit("kicked", { id: i });
              case 6:
              case "end":
                return c.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), this.context.getValue("peerSessionStore").on(j.UPDATE_ACTIVE, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              n = u.length > 0 && u[0] !== void 0 ? u[0] : { viewMode: "ACTIVE_GRID", page: 0, createAllConsumers: !1 }, a = n.viewMode, i = n.page, s = n.createAllConsumers, e.logger.info("UPDATE_ACTIVE event received - viewMode: ".concat(l(e, qr)[qr].mode, ", page: ").concat(i, ", CreateAllConsumers: ").concat(s)), s && (e.logger.info("UPDATE_ACTIVE viewMode: ".concat(a, ", Page: ").concat(i, ", Removing existing subscriptions.")), e.participants.videoSubscribed.clear(), e.participants.audioSubscribed.clear()), e.updateMediaSubscribedMaps(a, { page: i }), e.scheduleSyncConsumers({ source: "UPDATE_ACTIVE" });
            case 5:
            case "end":
              return d.stop();
          }
      }, r);
    })));
  } }, {
    key: "onParticipantPinned",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (n) {
                  s.next = 4;
                  break;
                }
                return this.self.isPinned && this.self.setIsPinned(!1), this.participants.pinned.size !== 0 && this.updatePinnedParticipants(), s.abrupt("return");
              case 4:
                if (n !== this.self.id) {
                  s.next = 8;
                  break;
                }
                return this.participants.pinned.size !== 0 && this.updatePinnedParticipants(), this.self.setIsPinned(!0), s.abrupt("return");
              case 8:
                a = this.participants.joined.get(n), this.self.isPinned && this.self.setIsPinned(!1), this.updatePinnedParticipants(), a.setIsPinned(!0), this.participants.pinned.add(a);
              case 13:
              case "end":
                return s.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /** *
    * NOTE(ravindra-cloudflare):
    * This method is meant to be called for participants that are on setup screen,
    * therefore connected to the socket edge.
    *
    * However they haven't called meeting.join() yet.
    */
  }, { key: "onParticipantSocketJoined", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              this.logger.info("onParticipantSocketJoined: peer ".concat(n.id, " has joined socket edge. Processing.")), this.self.id !== n.id && !((a = n.flags) !== null && a !== void 0 && a.recorder) && !((i = n.flags) !== null && i !== void 0 && i.hidden_participant) && !((s = n.flags) !== null && s !== void 0 && s.hiddenParticipant) && (this.participants.videoSubscribed.delete(n.id), this.participants.audioSubscribed.delete(n.id), this.participants.joined.add(n), this.participants.waitlisted.delete(n.id), n.stageStatus === "REQUESTED_TO_JOIN_STAGE" && this.context.getValue("peerSessionStore").emit(j.UPDATE_STAGE_REQUESTS, { request: { displayName: n.name, userId: n.userId, peerId: n.id }, add: !0 })), this.context.getValue("peerSessionStore").emit(j.PEER_JOINED_INTERNAL, n);
            case 3:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "onParticipantLeave", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              a = this.participants.joined.get(n), this.participants.joined.delete(n, !0, !0), this.participants.pinned.delete(n, !0, !0), this.participants.waitlisted.delete(n, !0, !0), this.roomNodeClient && (this.roomNodeClient.handlePeerLeaving(n), this.roomNodeClient.closeConsumers(a == null ? void 0 : a.producers)), a && a.stageStatus === "REQUESTED_TO_JOIN_STAGE" && this.context.getValue("peerSessionStore").emit(j.UPDATE_STAGE_REQUESTS, { request: { displayName: a.name, userId: a.userId, peerId: a.id }, add: !1 }), i = this.participants.currentPage, s = this.maxPreferredStreams * (i - 1), u = this.participants.videoSubscribed.get(n), this.participants.viewMode === "MANUAL" ? this.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.participants.viewMode, page: i }) : s === 0 ? this.participants.setViewMode("ACTIVE_GRID") : this.participants.joined.size <= s ? i === 2 ? this.participants.setViewMode("ACTIVE_GRID") : this.participants.setPage(i - 1) : u && this.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.participants.viewMode, page: i });
            case 10:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "processMedia", value: function(e) {
    var r, n = this.roomNodeClient.getConsumers(), a = (r = n.get(e)) !== null && r !== void 0 ? r : {}, i = a.peerId, s = a.kind, u = a.appData, c = a.track, d = a.producerId, h = a.rtpReceiver, v = a.paused, f = a.localId;
    if (!i)
      return this.logger.warn("processMedia::Peer ID is undefined", { consumer: { id: e, kind: s, peerId: i, appData: { supportsRemoteControl: !!(u != null && u.supportsRemoteControl), screenShare: !!(u != null && u.screenShare) }, remotelyPaused: v, producerId: d } }), {};
    var g = u;
    return s === "video" && g.screenShare !== !0 && this.videoPeerConsumerMap.set(i, e), this.logger.info("ParticipantController::processMedia", { consumer: { id: e, peerId: i, kind: s, appData: g, remotelyPaused: v, producerId: d } }), this.consumerPeerMap.set(e, { type: s, peerId: i, appData: g, remotelyPaused: v, producerId: d }), { peerId: i, kind: s, appData: g, remotelyPaused: v, track: c, producerId: d, rtpReceiver: h, localId: f };
  } }, { key: "processConsumerClosed", value: function(e) {
    var r = this, n = this.consumerPeerMap.get(e) || {}, a = n.peerId, i = n.type, s = n.appData, u = n.remotelyPaused, c = n.producerId, d = this.participants.joined.get(a);
    if (this.logger.info("ParticipantController::processConsumerClosed", { consumer: { id: e, peerId: a, appData: s, kind: i, remotelyPaused: u, producerId: c } }), this.consumerPeerMap.delete(e), i === "video" && s.screenShare !== !0 && this.videoPeerConsumerMap.delete(a), !!d) {
      var h = d.producers.find(function(f) {
        return f.producerId === c;
      });
      h && (h.consumer = { id: e, peerId: a, kind: void 0, appData: s, paused: u, producerId: c, rtpReceiver: void 0, localId: void 0 });
      var v = [];
      s && s.screenShare ? (d.setScreenShareEnabled(!1), this.context.getValue("callstats").consumerSharedMediaState(e, { screen: !1 }), d.screenShareTracks.video && v.push(d.screenShareTracks.video.id), d.screenShareTracks.audio && v.push(d.screenShareTracks.audio.id), d.screenShareTracks = { audio: void 0, video: void 0 }) : i === "audio" ? (d.setAudioEnabled(!1), d.audioTrack && v.push(d.audioTrack.id), this.context.getValue("callstats").consumerSharedMediaState(e, { audio: !1 }), d.audioTrack = void 0) : i === "video" && (d.setVideoEnabled(!1), this.updatePipSource(d.id, !1), d.videoTrack && v.push(d.videoTrack.id), this.context.getValue("callstats").consumerSharedMediaState(e, { video: !1 }), d.videoTrack = void 0), s.e2ee && v.forEach(function(f) {
        r.context.getValue("peerSessionStore").emit(j.E2EE_INACTIVE_CONSUMER, { peerId: a, trackId: f });
      });
    }
  } }, { key: "processConsumerResumed", value: function(e) {
    var r = this.processMedia(e), n = r.peerId, a = r.kind, i = r.appData, s = r.track, u = r.remotelyPaused, c = r.producerId, d = r.rtpReceiver, h = r.localId;
    if (n) {
      this.logger.info("ParticipantController::processConsumerResumed", { consumer: { id: e, peerId: n, kind: a, appData: i, remotelyPaused: u, producerId: c } });
      var v = this.participants.joined.get(n);
      if (v) {
        var f = v.producers.find(function(k) {
          return k.producerId === c;
        });
        if (f && (f.consumer = { id: e, peerId: n, kind: a, appData: i, paused: u, producerId: c, rtpReceiver: d, localId: h }), i.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_ACTIVE_CONSUMER, { peerId: n, rtpReceiver: d, track: s }), i.screenShare) {
          var g;
          a === "video" ? v.screenShareTracks.video = s : a === "audio" && (v.screenShareTracks.audio = s), v.setScreenShareEnabled(!0), (g = this.context) === null || g === void 0 || g.getValue("callstats").consumerSharedMediaState(e, { screen: !0 });
          return;
        }
        a === "video" ? (v.videoTrack = s, v.setVideoEnabled(!0), this.updatePipSource(v.id, !0), this.context.getValue("callstats").consumerSharedMediaState(e, { video: !0 })) : a === "audio" && (v.audioTrack = s, v.setAudioEnabled(v.audioEnabled), this.context.getValue("callstats").consumerSharedMediaState(e, { audio: v.audioEnabled }));
      }
    }
  } }, { key: "processConsumerPaused", value: function(e) {
    this.logger.info("ParticipantController::processConsumerPaused called for consumerId: ".concat(e));
    var r = this.processMedia(e), n = r.peerId, a = r.kind, i = r.track, s = r.appData, u = r.remotelyPaused, c = r.producerId, d = r.rtpReceiver, h = r.localId;
    if (n) {
      this.logger.info("ParticipantController::processConsumerPaused", { consumer: { id: e, peerId: n, kind: a, appData: s, remotelyPaused: u, producerId: c } });
      var v = this.participants.joined.get(n);
      if (v) {
        var f = v.producers.find(function(g) {
          return g.producerId === c;
        });
        f && (f.consumer = { id: e, peerId: n, kind: a, appData: s, paused: u, producerId: c, rtpReceiver: d, localId: h }), i && s.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_INACTIVE_CONSUMER, { peerId: n, trackId: i.id }), a === "video" ? (v.videoTrack = i, v.setVideoEnabled(!1), this.updatePipSource(v.id, !1), this.context.getValue("callstats").consumerSharedMediaState(e, { video: !1 })) : a === "audio" && (v.audioTrack = i, v.setAudioEnabled(v.audioEnabled), this.context.getValue("callstats").consumerSharedMediaState(e, { audio: v.audioEnabled }));
      }
    }
  } }, { key: "processNewConsumer", value: function(e) {
    var r = this.processMedia(e), n = r.peerId, a = r.kind, i = r.remotelyPaused, s = r.track, u = r.appData, c = r.producerId, d = r.rtpReceiver, h = r.localId;
    if (n) {
      this.logger.info("ParticipantController::processNewConsumer", { consumer: { id: e, peerId: n, kind: a, remotelyPaused: i, appData: u, producerId: c } });
      var v = this.participants.joined.get(n);
      if (v) {
        var f = v.producers.find(function(g) {
          return g.producerId === c;
        });
        if (f && (f.consumer = { id: e, peerId: n, kind: a, appData: u, paused: i, producerId: c, rtpReceiver: d, localId: h }), u.screenShare) {
          a === "video" ? v.screenShareTracks.video = s : a === "audio" && (v.screenShareTracks.audio = s), (!i || this.self.permissions.isRecorder || this.context.getValue("flagsmith").hasFeature(me.SCREEENSHARE_ERR_HACK)) && v.setScreenShareEnabled(!0), u.supportsRemoteControl && (v.supportsRemoteControl = !0), this.participants.broadcastMessage("screenshareConsumerCreated", { producerId: c, peerId: n, screenShare: !0, consumerId: e, consumerPeerId: this.self.id }), this.logger.info("ParticipantController::newScreenshareConsumer::screenshareConsumerCreated", { consumer: { id: e, peerId: n, kind: a, remotelyPaused: i, appData: u, producerId: c } });
          return;
        }
        a === "video" ? (v.videoTrack = s, i || (v.setVideoEnabled(!0), this.updatePipSource(v.id, !0)), this.context.getValue("callstats").consumerSharedMediaState(e, { video: !i })) : a === "audio" && (v.audioTrack = s, i || v.setAudioEnabled(!0), this.context.getValue("callstats").consumerSharedMediaState(e, { audio: !i })), !i && u.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_ACTIVE_CONSUMER, { peerId: n, rtpReceiver: d, track: s });
      }
    }
  } }, { key: "onSelectedPeers", value: (
    // XXX dead code, this event is not fired
    function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (this.participants.viewMode === "ACTIVE_GRID") {
                  s.next = 2;
                  break;
                }
                return s.abrupt("return");
              case 2:
                this.computeActivateParticipants(n, a);
              case 3:
              case "end":
                return s.stop();
            }
        }, r, this);
      }));
      function e(r, n) {
        return t.apply(this, arguments);
      }
      return e;
    }()
  ) }, { key: "updateActiveParticipantsWithPriorities", value: function(e) {
    var r = this, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    if (this.participants.viewMode !== "MANUAL") {
      if (!this.mediaJoined) {
        this.logger.warn("Skipped::ParticipantController::updateActiveParticipantsWithPriorities", { roomJoined: this.mediaJoined });
        return;
      }
      e.forEach(function(i) {
        r.selectedPeers.add(i.peerId, i.priority, r.context);
      });
      var a = this.selectedPeers.activeSpeakerPeers.at(0);
      a !== void 0 && a !== this.participants.lastActiveSpeaker && (this.participants.lastActiveSpeaker = a, this.participants.emit("activeSpeaker", {
        peerId: a,
        volume: 1
        // priority
      })), n && this.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { viewMode: this.participants.viewMode, page: this.participants.currentPage });
    }
  } }], [{ key: "formatSocketPeerMessage", value: function(e) {
    var r, n, a, i, s, u;
    if (e) {
      var c = Gp(e.stageType);
      return { id: e.peerId, userId: e.userId, name: e.displayName, displayName: e.displayName, stageType: c, customParticipantId: e.customParticipantId, presetId: e.presetId, picture: e.displayPictureUrl, waitlisted: e.waitlisted, stageStatus: c, metadata: { preset_name: (r = e.flags) === null || r === void 0 ? void 0 : r.presetName }, recorderType: (n = e.flags) === null || n === void 0 ? void 0 : n.recorderType, flags: { hiddenParticipant: (a = e.flags) === null || a === void 0 ? void 0 : a.hiddenParticipant, hidden_participant: (i = e.flags) === null || i === void 0 ? void 0 : i.hiddenParticipant, recorder: ((s = e.flags) === null || s === void 0 ? void 0 : s.recorderType) !== void 0 && ((u = e.flags) === null || u === void 0 ? void 0 : u.recorderType) !== "NONE" } };
    }
  } }]);
}()), za = Rg;
to([O.trace("ParticipantController.setupEvents")], za.prototype, "setupEvents", 1);
to([O.trace("ParticipantController.setupEvents")], za.prototype, "setupEventsGlobal", 1);
to([O.trace("ParticipantController.processMedia")], za.prototype, "processMedia", 1);
to([O.trace("ParticipantController.processConsumerClosed")], za.prototype, "processConsumerClosed", 1);
to([O.trace("ParticipantController.processConsumerResumed")], za.prototype, "processConsumerResumed", 1);
to([O.trace("ParticipantController.processConsumerPaused")], za.prototype, "processConsumerPaused", 1);
to([O.trace("ParticipantController.processNewConsumer")], za.prototype, "processNewConsumer", 1);
var nr = jn(Np().permissions), q = /* @__PURE__ */ S("permissions"), gs = /* @__PURE__ */ S("viewType"), Ms = /* @__PURE__ */ S("context"), ed = /* @__PURE__ */ S("updatePermission"), gr = /* @__PURE__ */ S("stageStatus"), w_ = /* @__PURE__ */ function(o) {
  function t(e, r, n) {
    var a, i = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !1;
    w(this, t);
    var s = e.getValue("logger");
    if (a = R(this, t, [s]), Object.defineProperty(a, gr, { get: P_, set: void 0 }), Object.defineProperty(a, q, { writable: !0, value: void 0 }), Object.defineProperty(a, gs, { writable: !0, value: void 0 }), Object.defineProperty(a, Ms, { writable: !0, value: void 0 }), Object.defineProperty(a, ed, { writable: !0, value: function(c) {
      var d = c.chat, h = c.connectedMeetings, v = c.plugins, f = c.polls, g = c.media, k = lc(c, xg);
      if (d && (d.private && yi(l(a, q)[q].chat.private, d.private), d.public && yi(l(a, q)[q].chat.public, d.public), a.emit("chatUpdate")), h && yi(l(a, q)[q].connectedMeetings, h), g) {
        var y, b, C, T = function(I) {
          switch (I) {
            case Ri.NONE:
              return te.Allowed;
            case Ri.ALLOWED:
              return te.Allowed;
            case Ri.NOT_ALLOWED:
              return te.NotAllowed;
            case Ri.CAN_REQUEST:
              return te.CanRequest;
            default:
              return;
          }
        }, E = { audio: void 0, video: void 0, screenshare: void 0 };
        (y = g.audio) !== null && y !== void 0 && y.canProduce && (E.audio = { canProduce: T(g.audio.canProduce) }), (b = g.video) !== null && b !== void 0 && b.canProduce && (E.video = { canProduce: T(g.video.canProduce) }), (C = g.screenshare) !== null && C !== void 0 && C.canProduce && (E.screenshare = { canProduce: T(g.screenshare.canProduce) }), yi(l(a, q)[q].media, E);
      }
      v && (yi(l(a, q)[q].plugins, v), a.emit("pluginsUpdate")), f && (yi(l(a, q)[q].polls, f), a.emit("pollsUpdate")), Object.keys(k).length !== 0 && yi(l(a, q)[q], k), a.emit("permissionsUpdate", c);
    } }), !r)
      throw a.logger.error("PermissionPreset::load_preset_permissions_failed"), new U("Could not load preset permissions.", "0904");
    return l(a, Ms)[Ms] = e, l(a, gs)[gs] = n, l(a, q)[q] = r, i && a.setupEvents(), a;
  }
  return A(t, o), P(t, [{
    key: "setupEvents",
    value: function() {
      l(this, Ms)[Ms].getValue("peerSessionStore").on(j.UPDATE_PERMISSIONS, l(this, ed)[ed]);
    }
    /** @deprecated. Use init() */
  }, {
    key: "mediaRoomType",
    get: (
      // eslint-disable-next-line class-methods-use-this
      function() {
        return "CF";
      }
    )
    /**
    * The `stageEnabled` property returns a boolean value.
    * If `true`, stage management is available for the participant.
    */
  }, { key: "stageEnabled", get: function() {
    var r;
    return ((r = l(this, q)[q]) === null || r === void 0 ? void 0 : r.stageEnabled) || l(this, gs)[gs] === Dt.Webinar || l(this, gs)[gs] === Dt.Livestream;
  } }, {
    key: "acceptStageRequests",
    get: function() {
      var r, n;
      return this.stageEnabled ? ((r = l(this, q)[q]) === null || r === void 0 ? void 0 : r.acceptStageRequests) || ((n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.canAcceptProductionRequests) : !1;
    }
    /**
    * The `stageAccess` property dictactes how a user interacts with the stage.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`;
    */
  }, {
    key: "stageAccess",
    get: function() {
      var r, n, a;
      return ((r = l(this, q)[q]) === null || r === void 0 ? void 0 : r.stageAccess) === te.NotAllowed ? te.NotAllowed : ((n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.stageAccess) === te.CanRequest ? te.CanRequest : ((a = l(this, q)[q]) === null || a === void 0 ? void 0 : a.stageAccess) === te.Allowed || l(this, q)[q].media.audio.canProduce === te.Allowed || l(this, q)[q].media.video.canProduce === te.Allowed || l(this, q)[q].media.screenshare.canProduce === te.Allowed ? te.Allowed : l(this, q)[q].media.audio.canProduce === te.CanRequest || l(this, q)[q].media.video.canProduce === te.CanRequest || l(this, q)[q].media.screenshare.canProduce === te.CanRequest ? te.CanRequest : te.NotAllowed;
    }
    /**
    * The `acceptWaitingRequests` returns boolean value.
    * If `true`, participant can accept the request of waiting participant.
    */
  }, {
    key: "acceptWaitingRequests",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.acceptWaitingRequests) !== null && r !== void 0 ? r : nr.acceptWaitingRequests;
    }
    /**
    * The `requestProduceVideo` returns boolean value.
    * If `true`, participant can send request to participants
    * about producing video.
    */
  }, {
    key: "requestProduceVideo",
    get: function() {
      var r;
      return ((r = l(this, q)[q]) === null || r === void 0 || (r = r.media) === null || r === void 0 || (r = r.video) === null || r === void 0 ? void 0 : r.canProduce) === te.CanRequest;
    }
    /**
    * The `requestProduceAudio` returns boolean value.
    * If `true`, participant can send request to participants
    * about producing audio.
    */
  }, {
    key: "requestProduceAudio",
    get: function() {
      var r;
      return ((r = l(this, q)[q]) === null || r === void 0 || (r = r.media) === null || r === void 0 || (r = r.audio) === null || r === void 0 ? void 0 : r.canProduce) === te.CanRequest;
    }
    /**
    * The `requestProduceScreenshare` returns boolean value.
    * If `true`, participant can send request to participants
    * about sharing screen.
    */
  }, {
    key: "requestProduceScreenshare",
    get: function() {
      var r;
      return ((r = l(this, q)[q]) === null || r === void 0 || (r = r.media) === null || r === void 0 || (r = r.screenshare) === null || r === void 0 ? void 0 : r.canProduce) === te.CanRequest;
    }
    /**
    * The `canAllowParticipantAudio` returns boolean value.
    * If `true`, participant can enable other participants` audio.
    */
  }, {
    key: "canAllowParticipantAudio",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.disableParticipantAudio) !== null && r !== void 0 ? r : nr.disableParticipantAudio;
    }
    /**
    * The `canAllowParticipantScreensharing` returns boolean value.
    * If `true`, participant can enable other participants` screen share.
    */
  }, {
    key: "canAllowParticipantScreensharing",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.canAcceptProductionRequests) !== null && r !== void 0 ? r : nr.canAcceptProductionRequests;
    }
    /**
    * The `canAllowParticipantVideo` returns boolean value.
    * If `true`, participant can enable other participants` video.
    */
  }, {
    key: "canAllowParticipantVideo",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.disableParticipantVideo) !== null && r !== void 0 ? r : nr.disableParticipantVideo;
    }
    /**
    * If `true`, a participant can disable other participants` audio.
    */
  }, {
    key: "canDisableParticipantAudio",
    get: function() {
      return this.canAllowParticipantAudio;
    }
    /**
    * If `true`, a participant can disable other participants` video.
    */
  }, {
    key: "canDisableParticipantVideo",
    get: function() {
      return this.canAllowParticipantVideo;
    }
    /**
    * The `kickParticipant` returns boolean value.
    * If `true`, participant can remove other participants from the meeting.
    */
  }, {
    key: "kickParticipant",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.kickParticipant) !== null && r !== void 0 ? r : nr.kickParticipant;
    }
    /**
    * The `pinParticipant` returns boolean value.
    * If `true`, participant can pin a participant in the meeting.
    */
  }, {
    key: "pinParticipant",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.pinParticipant) !== null && r !== void 0 ? r : nr.pinParticipant;
    }
    /**
    * The `canRecord` returns boolean value.
    * If `true`, participant can record the meeting.
    */
  }, {
    key: "canRecord",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.canRecord) !== null && r !== void 0 ? r : nr.canRecord;
    }
    /**
    * @deprecated in favour of `waitingRoomBehaviour`.
    * The `waitingRoomType` returns string value.
    * type of waiting room behavior
    * possible values are `SKIP`, `ON_PRIVILEGED_USER_ENTRY`, `SKIP_ON_ACCEPT`
    */
  }, {
    key: "waitingRoomType",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.waitingRoomType) !== null && r !== void 0 ? r : nr.waitingRoomType;
    }
    /**
    * The `waitingRoomType` returns string value.
    * type of waiting room behavior
    * possible values are `SKIP`, `ON_PRIVILEGED_USER_ENTRY`, `SKIP_ON_ACCEPT`
    */
  }, {
    key: "waitingRoomBehaviour",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.waitingRoomType) !== null && r !== void 0 ? r : nr.waitingRoomType;
    }
    /**
    * The `plugins` tells if the participant can act on plugins
    * there are 2 permissions with boolean values, `canStart` and `canClose`.
    */
  }, {
    key: "plugins",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.plugins) !== null && r !== void 0 ? r : nr.plugins;
    }
    /**
    * The `polls` tells if the participant can use polls.
    * There are 3 permissions with boolean values, `canCreate`, `canVote`, `canViewResults`
    */
  }, {
    key: "polls",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.polls) !== null && r !== void 0 ? r : nr.polls;
    }
    /**
    * @deprecated in favour of `canProduceVideo`
    * The `produceVideo` shows permissions for enabling video.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "produceVideo",
    get: function() {
      return this.canProduceVideo;
    }
    /**
    * @deprecated
    * The `requestProduce` returns boolean value.
    * If `true`, participant can send request to participants
    * about producing audio, video or screenshare.
    */
  }, {
    key: "requestProduce",
    get: function() {
      return l(this, q)[q].media.audio.canProduce === te.CanRequest || l(this, q)[q].media.video.canProduce === te.CanRequest || l(this, q)[q].media.screenshare.canProduce === te.CanRequest;
    }
    /**
    * The `canProduceVideo` shows permissions for enabling video.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "canProduceVideo",
    get: function() {
      var r, n = (r = l(this, q)[q].media.video.canProduce) !== null && r !== void 0 ? r : nr.media.video.canProduce;
      return this.stageEnabled && (l(this, gr)[gr] === "ACCEPTED_TO_JOIN_STAGE" || l(this, gr)[gr] === "ON_STAGE") && n === te.CanRequest ? te.Allowed : this.stageEnabled && (l(this, gr)[gr] === "OFF_STAGE" || l(this, gr)[gr] === "REQUESTED_TO_JOIN_STAGE") && n === te.Allowed ? te.NotAllowed : n;
    }
    /**
    * @deprecated in favour of `canProduceScreenshare`
    * The `produceVideo` shows permissions for sharing screen.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "produceScreenshare",
    get: function() {
      return this.canProduceScreenshare;
    }
    /**
    * The `canProduceScreenshare` shows permissions for sharing screen.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "canProduceScreenshare",
    get: function() {
      var r, n = (r = l(this, q)[q].media.screenshare.canProduce) !== null && r !== void 0 ? r : nr.media.screenshare.canProduce;
      return this.stageEnabled && (l(this, gr)[gr] === "ACCEPTED_TO_JOIN_STAGE" || l(this, gr)[gr] === "ON_STAGE") && n === te.CanRequest ? te.Allowed : this.stageEnabled && (l(this, gr)[gr] === "OFF_STAGE" || l(this, gr)[gr] === "REQUESTED_TO_JOIN_STAGE") && n === te.Allowed ? te.NotAllowed : n;
    }
    /**
    * @deprecated in favour of `canProduceAudio`
    * The `produceAudio` shows permissions for enabling audio.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "produceAudio",
    get: function() {
      return this.canProduceAudio;
    }
    /**
    * The `canProduceAudio` shows permissions for enabling audio.
    * There possible values are `ALLOWED`, `NOT_ALLOWED`, `CAN_REQUEST`
    */
  }, {
    key: "canProduceAudio",
    get: function() {
      var r, n = (r = l(this, q)[q].media.audio.canProduce) !== null && r !== void 0 ? r : nr.media.audio.canProduce;
      return this.stageEnabled && (l(this, gr)[gr] === "ACCEPTED_TO_JOIN_STAGE" || l(this, gr)[gr] === "ON_STAGE") && n === te.CanRequest ? te.Allowed : this.stageEnabled && (l(this, gr)[gr] === "OFF_STAGE" || l(this, gr)[gr] === "REQUESTED_TO_JOIN_STAGE") && n === te.Allowed ? te.NotAllowed : n;
    }
    /**
    * The `chatPublic` shows permissions for public chat
    * there are 4 permissions
    * `canSend` - if true, the participant can send chat
    * `text` - if true, the participant can send text
    * `files` - if true, the participant can send files
    */
  }, {
    key: "chatPublic",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 || (n = n.chat) === null || n === void 0 ? void 0 : n.public) !== null && r !== void 0 ? r : nr.chat.public;
    }
    /**
    * The `chatPrivate` shows permissions for public chat
    * there are 4 permissions
    * `canSend` - if true, the participant can send private chat
    * `text` - if true, the participant can send text as private chat
    * `files` - if true, the participant can send files as private chat
    * `canReceive` - (optional) if true, the participant can receive private chat
    */
  }, { key: "chatPrivate", get: function() {
    var r, n;
    return (r = (n = l(this, q)[q]) === null || n === void 0 || (n = n.chat) === null || n === void 0 ? void 0 : n.private) !== null && r !== void 0 ? r : nr.chat.private;
  } }, { key: "chatChannel", get: function() {
    var r, n;
    return (r = (n = l(this, q)[q]) === null || n === void 0 || (n = n.chat) === null || n === void 0 ? void 0 : n.channel) !== null && r !== void 0 ? r : nr.chat.channel;
  } }, { key: "chatMessage", get: function() {
    var r, n;
    return (r = (n = l(this, q)[q]) === null || n === void 0 || (n = n.chat) === null || n === void 0 ? void 0 : n.message) !== null && r !== void 0 ? r : nr.chat.message;
  } }, {
    key: "connectedMeetings",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.connectedMeetings) !== null && r !== void 0 ? r : nr == null ? void 0 : nr.connectedMeetings;
    }
    /**
    * The `hiddenParticipant` returns boolean value.
    * If `true`, participant is hidden.
    */
  }, {
    key: "hiddenParticipant",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.hiddenParticipant) !== null && r !== void 0 ? r : nr.hiddenParticipant;
    }
    /**
    * The `showParticipantList` returns boolean value.
    * If `true`, participant list can be shown to the participant.
    */
  }, {
    key: "showParticipantList",
    get: function() {
      var r;
      return (r = l(this, q)[q].showParticipantList) !== null && r !== void 0 ? r : nr.showParticipantList;
    }
    /**
    * @deprecated in favour of `canChangeParticipantPermissions`
    * The `canChangeParticipantRole` returns boolean value.
    * If `true`, allow changing the participants' role.
    */
  }, {
    key: "canChangeParticipantRole",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.canChangeParticipantPermissions) !== null && r !== void 0 ? r : nr.canChangeParticipantPermissions;
    }
    /**
    * The `canChangeParticipantPermissions` returns boolean value.
    * If `true`, allow changing the participants' permissions.
    */
  }, {
    key: "canChangeParticipantPermissions",
    get: function() {
      var r, n;
      return (r = (n = l(this, q)[q]) === null || n === void 0 ? void 0 : n.canChangeParticipantPermissions) !== null && r !== void 0 ? r : nr.canChangeParticipantPermissions;
    }
    /**
    * @deprecated
    * The `canChangeTheme` returns boolean value.
    * If `true`, the participant can change the meeting theme.
    */
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "canChangeTheme",
    get: function() {
      return !1;
    }
    /**
    * @deprecated in favour of individual production settings
    * The `canPresent` returns boolean value.
    * If `true`, the participant can become a presentor.
    */
  }, {
    key: "canPresent",
    get: function() {
      return l(this, q)[q].media.audio.canProduce === te.Allowed || l(this, q)[q].media.video.canProduce === te.Allowed || l(this, q)[q].media.screenshare.canProduce === te.Allowed;
    }
    /**
    * @deprecated Use `acceptStageRequests` instead.
    */
  }, { key: "acceptPresentRequests", get: function() {
    return this.acceptStageRequests;
  } }, {
    key: "canEditDisplayName",
    get: function() {
      var r;
      return (r = l(this, q)[q].canEditDisplayName) !== null && r !== void 0 ? r : !1;
    }
    /**
    * @deprecated Self.config.maxScreenShareCount
    */
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "maxScreenShareCount",
    get: function() {
      return 1;
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "isRecorder", get: function() {
    return l(this, q)[q].isRecorder;
  } }, {
    key: "canSpotlight",
    get: function() {
      return l(this, q)[q].canSpotlight;
    }
    /** Livestream */
  }, { key: "canLivestream", get: function() {
    return l(this, q)[q].canLivestream;
  } }, { key: "transcriptionEnabled", get: function() {
    return l(this, q)[q].transcriptionEnabled;
  } }], [{
    key: "fromResponse",
    value: function(r, n, a) {
      return new t(a, r, n, !0);
    }
    /** @deprecated. Use init() */
  }, { key: "default", value: function(r, n) {
    return new t(r, nr, n);
  } }, { key: "init", value: function(r, n, a) {
    var i;
    return a ? i = new t(r, a, n, !0) : i = new t(r, nr, n), i;
  } }]);
}(an);
function P_() {
  return l(this, Ms)[Ms].getValue("stageStatus");
}
var st = /* @__PURE__ */ S("context"), Ag = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    w(this, t);
    for (var r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    return e = R(this, t, [].concat(n)), e.localMediaHandler = void 0, Object.defineProperty(e, st, { writable: !0, value: void 0 }), e;
  }
  return A(t, o), P(t, [{
    key: "updatePermission",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        var a = this, i, s, u, c, d, h, v, f;
        return p().wrap(function(k) {
          for (; ; )
            switch (k.prev = k.next) {
              case 0:
                if (u = function(b, C) {
                  a.mediaPermissions[b] = C;
                  var T = { message: a.mediaPermissions[b], kind: b };
                  C === "DENIED" ? l(a, st)[st].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_ERROR, T) : l(a, st)[st].getValue("peerSessionStore").emit(j.MEDIA_PERMISSION_UPDATE, T);
                }, kr.getName() !== "firefox") {
                  k.next = 3;
                  break;
                }
                return k.abrupt("return");
              case 3:
                return c = "microphone", d = "camera", k.next = 7, (i = navigator) === null || i === void 0 || (i = i.permissions) === null || i === void 0 ? void 0 : i.query({ name: c });
              case 7:
                return h = k.sent, k.next = 10, (s = navigator) === null || s === void 0 || (s = s.permissions) === null || s === void 0 ? void 0 : s.query({ name: d });
              case 10:
                v = k.sent, f = function(b, C) {
                  switch (C) {
                    case "granted":
                      u(b, "ACCEPTED");
                      break;
                    case "denied":
                      u(b, "DENIED");
                      break;
                    case "prompt":
                      u(b, "NOT_REQUESTED");
                      break;
                  }
                  a.localMediaHandler.repopulateAvailableDevices();
                }, h && (h.onchange = function() {
                  return f("audio", h.state);
                }), v && (v.onchange = function() {
                  return f("video", v.state);
                });
              case 14:
              case "end":
                return k.stop();
            }
        }, n);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    // eslint-disable-next-line class-methods-use-this
  }, { key: "populateMediaPermissionsInCallstats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              i = a.message, s = a.kind, f.t0 = s, f.next = f.t0 === "audio" ? 4 : f.t0 === "video" ? 7 : f.t0 === "screenshare" ? 9 : 11;
              break;
            case 4:
              return (u = l(this, st)[st]) === null || u === void 0 || u.getValue("callstats").mediaPermission("AUDIO", i), (c = l(this, st)[st]) === null || c === void 0 || c.getValue("callstats").mediaPermission("SPEAKER", i), f.abrupt("break", 11);
            case 7:
              return (d = l(this, st)[st]) === null || d === void 0 || d.getValue("callstats").mediaPermission("VIDEO", i), f.abrupt("break", 11);
            case 9:
              return (h = l(this, st)[st]) === null || h === void 0 || h.getValue("callstats").mediaPermission("SCREENSHARE", i), f.abrupt("break", 11);
            case 11:
            case "end":
              return f.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "peerId", get: function() {
    var r;
    return (r = l(this, st)[st]) === null || r === void 0 ? void 0 : r.getValue("peerId");
  } }, { key: "init", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a = this, i, s, u, c, d, h, v, f, g, k, y, b, C, T, E = arguments;
      return p().wrap(function(I) {
        for (; ; )
          switch (I.prev = I.next) {
            case 0:
              if (i = E.length > 0 && E[0] !== void 0 ? E[0] : {}, s = E.length > 1 && E[1] !== void 0 ? E[1] : !1, u = E.length > 2 && E[2] !== void 0 ? E[2] : null, kr.init(), !this.localMediaHandler) {
                I.next = 6;
                break;
              }
              return I.abrupt("return");
            case 6:
              if (I.prev = 6, d = !0, !(u != null && (c = u.getValue("defaults")) !== null && c !== void 0 && c.mediaHandler)) {
                I.next = 13;
                break;
              }
              d = !1, this.localMediaHandler = u.getValue("defaults").mediaHandler.localMediaHandler, I.next = 21;
              break;
            case 13:
              if (!navigator.RNLocalMediaHandlerImpl) {
                I.next = 20;
                break;
              }
              return h = navigator, v = h.RNLocalMediaHandlerImpl, I.next = 17, v.init(i);
            case 17:
              this.localMediaHandler = I.sent, I.next = 21;
              break;
            case 20:
              this.localMediaHandler = new $t(u, i.constraints, u == null || (f = u.getValue("defaults")) === null || f === void 0 ? void 0 : f.isNonPreferredDevice, u == null || (g = u.getValue("defaults")) === null || g === void 0 ? void 0 : g.autoSwitchAudioDevice);
            case 21:
              if (u == null || u.getValue("peerSessionStore").on(j.MEDIA_PERMISSION_UPDATE, /* @__PURE__ */ function() {
                var _ = m(/* @__PURE__ */ p().mark(function V(F) {
                  return p().wrap(function(L) {
                    for (; ; )
                      switch (L.prev = L.next) {
                        case 0:
                          if (a.populateMediaPermissionsInCallstats({ message: F.message, kind: F.kind }), F.message !== "NOT_REQUESTED") {
                            L.next = 10;
                            break;
                          }
                          L.t0 = F == null ? void 0 : F.kind, L.next = L.t0 === "audio" ? 5 : L.t0 === "video" ? 7 : 9;
                          break;
                        case 5:
                          return a.rawAudioTrack && (a.logger.info("Disabling audio due to media permission update"), a.disableAudio()), L.abrupt("break", 10);
                        case 7:
                          return a.rawVideoTrack && (a.logger.info("Disabling video due to media permission update"), a.disableVideo()), L.abrupt("break", 10);
                        case 9:
                          return L.abrupt("break", 10);
                        case 10:
                          a.emit("mediaPermissionUpdate", F);
                        case 11:
                        case "end":
                          return L.stop();
                      }
                  }, V);
                }));
                return function(V) {
                  return _.apply(this, arguments);
                };
              }()), u == null || u.getValue("peerSessionStore").on(j.MEDIA_PERMISSION_ERROR, /* @__PURE__ */ function() {
                var _ = m(/* @__PURE__ */ p().mark(function V(F) {
                  var N, L, H;
                  return p().wrap(function(B) {
                    for (; ; )
                      switch (B.prev = B.next) {
                        case 0:
                          N = F.kind, L = F.message, H = F.constraints, a.populateMediaPermissionsInCallstats({ message: L, kind: N }), N === "audio" ? (a.logger.info("Disabling audio due to media permission error  skipping: ".concat(a.localMediaHandler.audioUpdateInProgress)), a.localMediaHandler.audioUpdateInProgress === !1 && a.disableAudio()) : N === "video" && (a.logger.info("Disabling video due to media permission error skipping: ".concat(a.localMediaHandler.videoUpdateInProgress)), a.localMediaHandler.videoUpdateInProgress === !1 && a.disableVideo()), a.logger.error("SelfController::mediaPermissionError", { error: { message: L }, constraints: H, mediaPermissionsErrors: { kind: N, message: L } }), a.emit("mediaPermissionError", F), a.emit("mediaPermissionUpdate", { message: L, kind: N });
                        case 6:
                        case "end":
                          return B.stop();
                      }
                  }, V);
                }));
                return function(V) {
                  return _.apply(this, arguments);
                };
              }()), !d) {
                I.next = 29;
                break;
              }
              if (this.logger.info("Setting up SelfMedia streams using media handler. audio:".concat((k = i == null ? void 0 : i.audio) !== null && k !== void 0 ? k : !0, " video:").concat((y = i == null ? void 0 : i.video) !== null && y !== void 0 ? y : !0)), T = this.localMediaHandler.setupStreams({ video: (b = i == null ? void 0 : i.video) !== null && b !== void 0 ? b : !0, audio: (C = i == null ? void 0 : i.audio) !== null && C !== void 0 ? C : !0 }), s) {
                I.next = 29;
                break;
              }
              return I.next = 29, T;
            case 29:
              I.next = 34;
              break;
            case 31:
              I.prev = 31, I.t0 = I.catch(6), this.logger.error("Self::init::Failed To Setup Streams", { error: { name: I.t0.name, message: I.t0.message } });
            case 34:
            case "end":
              return I.stop();
          }
      }, n, this, [[6, 31]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "context",
    set: function(r) {
      l(this, st)[st] = r, this.localMediaHandler.context = r;
    }
    /**
    * Returns the `audioTrack`.
    */
  }, {
    key: "audioTrack",
    get: function() {
      return this.localMediaHandler.audioTrack;
    }
    /**
    * Returns the `rawAudioTrack` having no middleware executed on it.
    */
  }, {
    key: "rawAudioTrack",
    get: function() {
      return this.localMediaHandler.rawAudioTrack;
    }
    /**
    * Returns the current audio and video permissions given by the user.
    * 'ACCEPTED' if the user has given permission to use the media.
    * 'CANCELED' if the user has canceled the screenshare.
    * 'DENIED' if the user has denied permission to use the media.
    * 'SYS_DENIED' if the user's system has denied permission to use the media.
    * 'UNAVAILABLE' if the media is not available (or being used by a different application).
    */
  }, {
    key: "mediaPermissions",
    get: function() {
      return this.localMediaHandler.permissions;
    }
    /**
    * Adds the audio middleware to be executed on the raw audio stream.
    * If there are more than 1 audio middlewares,
    * they will be executed in the sequence they were added in.
    * If you want the sequence to be altered, please remove all previous middlewares and re-add.
    */
  }, { key: "addAudioMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", this.localMediaHandler.addAudioMiddleware(a));
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeAudioMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", this.localMediaHandler.removeAudioMiddleware(a));
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeAllAudioMiddlewares", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.localMediaHandler.removeAllAudioMiddlewares());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "videoTrack",
    get: function() {
      return this.localMediaHandler.videoTrack;
    }
    /**
    * Returns the `videoTrack` having no middleware executed on it.
    */
  }, {
    key: "rawVideoTrack",
    get: function() {
      return this.localMediaHandler.rawVideoTrack;
    }
    /**
    * Adds the video middleware to be executed on the raw video stream.
    * If there are more than 1 video middlewares,
    * they will be executed in the sequence they were added in.
    * If you want the sequence to be altered, please remove all previous middlewares and re-add.
    */
  }, { key: "addVideoMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", this.localMediaHandler.addVideoMiddleware(a));
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setVideoMiddlewareGlobalConfig", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i = arguments;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return a = i.length > 0 && i[0] !== void 0 ? i[0] : { disablePerFrameCanvasRendering: !1 }, u.abrupt("return", this.localMediaHandler.setVideoMiddlewareGlobalConfig(a));
            case 2:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeVideoMiddleware", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.abrupt("return", this.localMediaHandler.removeVideoMiddleware(a));
            case 1:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeAllVideoMiddlewares", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.localMediaHandler.removeAllVideoMiddlewares());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "screenShareTracks",
    get: function() {
      return this.localMediaHandler.screenShareTracks;
    }
    /**
    * Returns true if audio is enabled.
    */
  }, {
    key: "audioEnabled",
    get: function() {
      return this.localMediaHandler.audioEnabled;
    }
    /**
    * Returns true if video is enabled.
    */
  }, {
    key: "videoEnabled",
    get: function() {
      return this.localMediaHandler.videoEnabled;
    }
    /**
    * Returns true if screen share is enabled.
    */
  }, { key: "screenShareEnabled", get: function() {
    return this.localMediaHandler.screenShareEnabled;
  } }, { key: "enableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, this.localMediaHandler.enableAudio();
            case 2:
              this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack });
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, this.localMediaHandler.enableVideo();
            case 2:
              this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack });
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              this.localMediaHandler.disableAudio(), this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack });
            case 2:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, this.localMediaHandler.enableScreenShare();
            case 2:
              this.emit("screenShareUpdate", { screenShareEnabled: this.screenShareEnabled, screenShareTracks: this.screenShareTracks });
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, this.localMediaHandler.disableScreenShare();
            case 2:
              this.emit("screenShareUpdate", { screenShareEnabled: this.screenShareEnabled, screenShareTracks: this.screenShareTracks });
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "disableVideo",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                return i.next = 2, this.localMediaHandler.disableVideo();
              case 2:
                this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack });
              case 3:
              case "end":
                return i.stop();
            }
        }, n, this);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Returns the media devices currently being used.
    */
  }, {
    key: "getCurrentDevices",
    value: function() {
      return this.localMediaHandler.getCurrentDevices();
    }
    /**
    * Returns the local participant's audio devices.
    */
  }, { key: "getAudioDevices", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.localMediaHandler.getAudioDevices();
            case 2:
              return a = s.sent, s.abrupt("return", a);
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getVideoDevices", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.localMediaHandler.getVideoDevices();
            case 2:
              return a = s.sent, s.abrupt("return", a);
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getSpeakerDevices", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.localMediaHandler.getSpeakerDevices();
            case 2:
              return a = s.sent, s.abrupt("return", a);
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "getDeviceById",
    value: function(r, n) {
      var a;
      return n === "audio" ? a = "audioinput" : n === "video" ? a = "videoinput" : n === "speaker" && (a = "audiooutput"), this.localMediaHandler.getDeviceById(r, a);
    }
    /**
    * Change the current media device that is being used by the local participant.
    * @param device The device that is to be used. A device of the same `kind` will be replaced.
    * the primary stream.
    */
  }, { key: "setDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              s.t0 = a.kind, s.next = s.t0 === "audioinput" ? 3 : s.t0 === "audiooutput" ? 14 : s.t0 === "videoinput" ? 17 : 28;
              break;
            case 3:
              return s.prev = 3, s.next = 6, this.localMediaHandler.setAudioDevice(a);
            case 6:
              s.next = 10;
              break;
            case 8:
              s.prev = 8, s.t1 = s.catch(3);
            case 10:
              return s.prev = 10, this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack }), s.finish(10);
            case 13:
              return s.abrupt("break", 28);
            case 14:
              return s.next = 16, this.localMediaHandler.setSpeakerDevice(a);
            case 16:
              return s.abrupt("break", 28);
            case 17:
              return s.prev = 17, s.next = 20, this.localMediaHandler.setVideoDevice(a);
            case 20:
              s.next = 24;
              break;
            case 22:
              s.prev = 22, s.t2 = s.catch(17);
            case 24:
              return s.prev = 24, this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack }), s.finish(24);
            case 27:
              return s.abrupt("break", 28);
            case 28:
              this.emit("deviceUpdate", { device: a });
            case 29:
            case "end":
              return s.stop();
          }
      }, n, this, [[3, 8, 10, 13], [17, 22, 24, 27]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(an), S_ = Object.defineProperty, E_ = Object.getOwnPropertyDescriptor, Rt = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? E_(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && S_(e, r, a), a;
}, nt = (vi = /* @__PURE__ */ S("config"), or = /* @__PURE__ */ S("permissions"), fi = /* @__PURE__ */ S("isPinned"), Ne = /* @__PURE__ */ S("context"), _t = /* @__PURE__ */ S("pip"), Ve = /* @__PURE__ */ S("roomNodeClient"), gi = /* @__PURE__ */ S("audioPlayback"), Me = /* @__PURE__ */ S("mediaJoined"), Pi = /* @__PURE__ */ S("previewVideoElements"), Si = /* @__PURE__ */ S("videoElements"), ho = /* @__PURE__ */ S("updateVideos"), /* @__PURE__ */ function(o) {
  function t(e, r, n, a, i) {
    var s, u;
    w(this, t);
    var c = e.getValue("logger");
    return u = R(this, t, [c]), Object.defineProperty(u, ho, { value: M_ }), Object.defineProperty(u, Me, { get: I_, set: void 0 }), Object.defineProperty(u, gi, { get: A_, set: void 0 }), Object.defineProperty(u, Ve, { get: R_, set: void 0 }), Object.defineProperty(u, _t, { get: C_, set: void 0 }), u.name = void 0, u.picture = void 0, u.customParticipantId = void 0, u.waitlistStatus = void 0, Object.defineProperty(u, vi, { writable: !0, value: void 0 }), Object.defineProperty(u, or, { writable: !0, value: void 0 }), Object.defineProperty(u, fi, { writable: !0, value: void 0 }), u.role = void 0, u.userId = void 0, u.organizationId = void 0, u.supportsRemoteControl = !1, u.device = void 0, Object.defineProperty(u, Ne, { writable: !0, value: void 0 }), u.hidden = !1, u.presetName = void 0, u.roomState = "init", Object.defineProperty(u, Pi, { writable: !0, value: /* @__PURE__ */ new Set() }), Object.defineProperty(u, Si, { writable: !0, value: /* @__PURE__ */ new Set() }), l(u, Ne)[Ne] = e, u.userId = r.id, u.name = r.name, u.picture = r.picture, u.customParticipantId = (s = r.customParticipantId) !== null && s !== void 0 ? s : r.clientSpecificId, u.waitlistStatus = "none", l(u, or)[or] = n, l(u, vi)[vi] = a, u.hidden = !1, l(u, fi)[fi] = !1, u.organizationId = r.organizationId, u.supportsRemoteControl = kr.isElectron(), u.device = kr.getDeviceInfo(), u.presetName = i, a.viewType !== Dt.Chat && u.updatePermission(), u.updateVideo = u.updateVideo.bind(u), l(u, ho)[ho](), u;
  }
  return A(t, o), P(t, [{ key: "telemetry", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, Ne)[Ne].getValue("telemetry");
    }
  ) }, { key: "stageStatus", get: function() {
    return l(this, Ne)[Ne].getValue("stageStatus");
  } }, { key: "producers", get: function() {
    var r, n;
    return Array.from((r = (n = l(this, Ve)[Ve].getProducers()) === null || n === void 0 ? void 0 : n.values()) !== null && r !== void 0 ? r : []);
  } }, {
    key: "id",
    get: function() {
      return this.peerId;
    }
    /** NOTE(ishita1805): Discussed with Ravindra, added a duplicate for consistency
    * when using identifiers in Locker.
    * We might want to look at deprecating the `id` sometime later. */
  }, { key: "peerId", get: function() {
    return l(this, Ne)[Ne].getValue("peerId");
  } }, { key: "cleanupEvents", value: function() {
    this.removeAllListeners("videoUpdate"), this.localMediaHandler.removeAllListeners("AUDIO_TRACK_CHANGE"), this.localMediaHandler.removeAllListeners("VIDEO_TRACK_CHANGE"), this.localMediaHandler.removeAllListeners("DEVICE_CHANGE"), this.localMediaHandler.removeAllListeners("DEVICE_LIST_UPDATED"), this.localMediaHandler.removeAllListeners("SCREENSHARE_TRACK_CHANGE"), this.localMediaHandler.removeAllListeners("SCREENSHARE_ENDED"), this.localMediaHandler.removeAllListeners("AUDIO_TRACK_SILENT"), this.localMediaHandler.removeAllListeners("FORCE_MUTE_AUDIO"), this.localMediaHandler.removeAllListeners("FORCE_MUTE_VIDEO"), l(this, or)[or].removeAllListeners("permissionsUpdate");
  } }, {
    key: "setupEvents",
    value: function() {
      var r = this;
      this.on("videoUpdate", l(this, ho)[ho]);
      var n = l(this, gi)[gi];
      n && n.onError(function(a) {
        r.emit("autoplayError", a);
      }), this.localMediaHandler.on("AUDIO_TRACK_CHANGE", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (r.logger.info("Self::setupEvents::AUDIO_TRACK_CHANGE", $({}, Is(r))), !(l(r, Me)[Me] && r.audioEnabled)) {
                  s.next = 11;
                  break;
                }
                return s.prev = 2, s.next = 5, l(r, Ve)[Ve].shareMic(r.audioTrack);
              case 5:
                s.next = 11;
                break;
              case 7:
                s.prev = 7, s.t0 = s.catch(2), r.logger.error("Self::setupEvents::Error while sharing mic", { error: s.t0 }), r.localMediaHandler.disableAudio();
              case 11:
                r.emit("audioUpdate", { audioEnabled: r.audioEnabled, audioTrack: r.audioTrack });
              case 12:
              case "end":
                return s.stop();
            }
        }, a, null, [[2, 7]]);
      }))), this.localMediaHandler.on("VIDEO_TRACK_CHANGE", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
        var i;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                if (r.logger.info("Self::setupEvents::VIDEO_TRACK_CHANGE", $({}, Is(r))), !(l(r, Me)[Me] && r.rawVideoTrack === void 0)) {
                  u.next = 6;
                  break;
                }
                r.logger.info("Self::VIDEO_TRACK_CHANGE::Forcing_disable_video"), r.disableVideo(), u.next = 22;
                break;
              case 6:
                if (!(r.videoEnabled && l(r, Me)[Me])) {
                  u.next = 22;
                  break;
                }
                return u.prev = 7, u.next = 10, l(r, Ve)[Ve].shareWebcam(r.videoTrack);
              case 10:
                if (i = u.sent, !(i && i.id !== r.videoTrack.id && l(r, Ne)[Ne].getValue("flagsmith").hasFeature(me.EXP_RESHARE))) {
                  u.next = 14;
                  break;
                }
                return u.next = 14, l(r, Ve)[Ve].shareWebcam(r.videoTrack);
              case 14:
                u.next = 22;
                break;
              case 16:
                if (u.prev = 16, u.t0 = u.catch(7), r.logger.error("Self::setupEvents::failed shareWebcam", { error: u.t0 }), !r.videoEnabled) {
                  u.next = 22;
                  break;
                }
                return u.next = 22, r.localMediaHandler.disableVideo();
              case 22:
                r.emit("videoUpdate", { videoEnabled: r.videoEnabled, videoTrack: r.videoTrack });
              case 23:
              case "end":
                return u.stop();
            }
        }, a, null, [[7, 16]]);
      }))), this.localMediaHandler.on("DEVICE_CHANGE", /* @__PURE__ */ function() {
        var a = m(/* @__PURE__ */ p().mark(function i(s) {
          var u, c;
          return p().wrap(function(h) {
            for (; ; )
              switch (h.prev = h.next) {
                case 0:
                  u = s.device, r.emit("deviceUpdate", { device: u }), u.kind === "audiooutput" && typeof HTMLAudioElement.prototype.setSinkId == "function" && ((c = l(r, gi)[gi]) === null || c === void 0 || c.setSpeakerDevice(u.deviceId));
                case 3:
                case "end":
                  return h.stop();
              }
          }, i);
        }));
        return function(i) {
          return a.apply(this, arguments);
        };
      }()), this.localMediaHandler.on("DEVICE_LIST_UPDATED", function(a) {
        r.emit("deviceListUpdate", a);
      }), this.localMediaHandler.on("SCREENSHARE_TRACK_CHANGE", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                if (l(r, Me)[Me]) {
                  s.next = 3;
                  break;
                }
                return r.logger.error("Self.SCREENSHARE_TRACK_CHANGE.LocalMediaInitialized_WithoutRoomNode"), s.abrupt("return");
              case 3:
                if (!r.screenShareEnabled) {
                  s.next = 15;
                  break;
                }
                return s.prev = 4, s.next = 7, l(r, Ve)[Ve].shareScreen(r.screenShareTracks);
              case 7:
                s.next = 15;
                break;
              case 9:
                if (s.prev = 9, s.t0 = s.catch(4), r.logger.error("Self::setupEvents::Error while sharing screen", { error: s.t0 }), !r.screenShareEnabled) {
                  s.next = 15;
                  break;
                }
                return s.next = 15, r.localMediaHandler.disableScreenShare();
              case 15:
                r.logger.info("Self::setupEvents::SCREENSHARE_TRACK_CHANGE", $({}, Is(r))), r.emit("screenShareUpdate", { screenShareEnabled: r.screenShareEnabled, screenShareTracks: r.screenShareTracks });
              case 17:
              case "end":
                return s.stop();
            }
        }, a, null, [[4, 9]]);
      }))), this.localMediaHandler.on("SCREENSHARE_ENDED", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return r.logger.log("Disabling screenshare due to SCREENSHARE_ENDED"), s.next = 3, r.disableScreenShare();
              case 3:
                r.logger.info("Self::setupEvents::SCREENSHARE_ENDED", $({}, Is(r)));
              case 4:
              case "end":
                return s.stop();
            }
        }, a);
      }))), this.localMediaHandler.on("AUDIO_TRACK_SILENT", function() {
        var a;
        (a = l(r, Ne)[Ne]) === null || a === void 0 || a.getValue("callstats").mediaTrackMuted("AUDIO");
      }), this.localMediaHandler.on("FORCE_MUTE_AUDIO", function() {
        r.disableAudio();
      }), this.localMediaHandler.on("FORCE_MUTE_VIDEO", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
        var i;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                if (!l(r, Me)[Me]) {
                  u.next = 3;
                  break;
                }
                return u.next = 3, l(r, Ve)[Ve].pauseWebcam();
              case 3:
                r.emit("videoUpdate", { videoEnabled: r.videoEnabled, videoTrack: r.videoTrack }), (i = l(r, Ne)[Ne]) === null || i === void 0 || i.getValue("callstats").videoOff();
              case 5:
              case "end":
                return u.stop();
            }
        }, a);
      }))), l(this, or)[or].on("permissionsUpdate", function(a) {
        var i, s, u;
        a != null && (i = a.media) !== null && i !== void 0 && i.audio && l(r, or)[or].canProduceAudio !== te.Allowed && (r.disableAudio(), r.logger.info("Disabled audio due to dynamic preset change: canProduceAudio: ".concat(r.permissions.canProduceAudio))), a != null && (s = a.media) !== null && s !== void 0 && s.video && l(r, or)[or].canProduceVideo !== te.Allowed && (r.disableVideo(), r.logger.info("Disabled video due to dynamic preset change: canProduceVideo: ".concat(r.permissions.canProduceVideo))), a != null && (u = a.media) !== null && u !== void 0 && u.screenshare && l(r, or)[or].canProduceScreenshare !== te.Allowed && (r.disableScreenShare(), r.logger.info("Disabled screenshare due to dynamic preset change: canProduceScreenshare: ".concat(r.permissions.canProduceScreenshare)));
      });
    }
    /**
    * Returns the current permission given to the user for the meeting.
    */
  }, {
    key: "permissions",
    get: function() {
      return l(this, or)[or];
    }
    /**
    * Returns configuration for the meeting.
    */
  }, { key: "config", get: function() {
    return l(this, vi)[vi];
  } }, { key: "roomJoined", get: (
    /**
    * Returns true if the local participant has joined the meeting.
    */
    function() {
      if (l(this, vi)[vi].viewType === Dt.Livestream && this.stageStatus !== "ON_STAGE") {
        var r;
        return ((r = l(this, Ne)[Ne].getValue("connectionHandler")) === null || r === void 0 ? void 0 : r.socketJoined) === !0;
      }
      return l(this, Me)[Me];
    }
  ) }, { key: "setName", value: (
    /**
    * The name of the user can be set by calling this method.
    * This will get reflected to other participants ONLY if
    * this method is called before the room is joined.
    * @param name Name of the user.
    */
    function(r) {
      if (!r)
        throw new U("Name cannot be empty.", "1103");
      this.name = r;
    }
  ) }, { key: "setupTracks", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a, i = arguments;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return a = i.length > 0 && i[0] !== void 0 ? i[0] : {}, a.forceReset, u.next = 4, this.disableAudio();
            case 4:
              return u.next = 6, this.disableVideo();
            case 6:
              if (this.localMediaHandler.removeAudioTrack(), this.localMediaHandler.removeVideoTrack(), !a.audio) {
                u.next = 11;
                break;
              }
              return u.next = 11, this.enableAudio();
            case 11:
              if (!a.video) {
                u.next = 14;
                break;
              }
              return u.next = 14, this.enableVideo();
            case 14:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "destructMediaHandler", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.localMediaHandler.destruct());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "removeDocumentEventListeners", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.localMediaHandler.removeDocumentEventListeners());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this.permissions.canProduceAudio !== te.NotAllowed) {
                u.next = 2;
                break;
              }
              return u.abrupt("return");
            case 2:
              if (!(l(this, or)[or].canProduceAudio === te.CanRequest && (this.stageStatus === "OFF_STAGE" || this.stageStatus === "REQUESTED_TO_JOIN_STAGE"))) {
                u.next = 4;
                break;
              }
              return u.abrupt("return");
            case 4:
              if (!this.audioEnabled) {
                u.next = 6;
                break;
              }
              return u.abrupt("return");
            case 6:
              return (i = l(this, Ne)[Ne]) === null || i === void 0 || i.getValue("callstats").audioOn(), u.next = 9, this.localMediaHandler.enableAudio(a);
            case 9:
              if (!(l(this, Me)[Me] && this.stageStatus === "ON_STAGE")) {
                u.next = 22;
                break;
              }
              if (!this.audioTrack) {
                u.next = 20;
                break;
              }
              return u.prev = 11, u.next = 14, l(this, Ve)[Ve].shareMic(this.audioTrack);
            case 14:
              u.next = 20;
              break;
            case 16:
              u.prev = 16, u.t0 = u.catch(11), this.logger.error("Self::enableAudio::Error while sharing mic", { error: u.t0 }), this.localMediaHandler.disableAudio();
            case 20:
              if (this.audioEnabled) {
                u.next = 22;
                break;
              }
              return u.abrupt("return");
            case 22:
              this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack });
            case 23:
            case "end":
              return u.stop();
          }
      }, n, this, [[11, 16]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (l(this, or)[or].canProduceVideo !== te.NotAllowed) {
                u.next = 2;
                break;
              }
              return u.abrupt("return");
            case 2:
              if (!(l(this, or)[or].canProduceVideo === te.CanRequest && (this.stageStatus === "OFF_STAGE" || this.stageStatus === "REQUESTED_TO_JOIN_STAGE"))) {
                u.next = 4;
                break;
              }
              return u.abrupt("return");
            case 4:
              if (!this.videoEnabled) {
                u.next = 6;
                break;
              }
              return u.abrupt("return");
            case 6:
              return (i = l(this, Ne)[Ne]) === null || i === void 0 || i.getValue("callstats").videoOn(), u.next = 9, this.localMediaHandler.enableVideo(a);
            case 9:
              if (!(l(this, Me)[Me] && this.stageStatus === "ON_STAGE")) {
                u.next = 19;
                break;
              }
              return u.prev = 10, u.next = 13, l(this, Ve)[Ve].shareWebcam(this.videoTrack);
            case 13:
              u.next = 19;
              break;
            case 15:
              u.prev = 15, u.t0 = u.catch(10), this.logger.error("Self::enableVideo::Error while sharing video", { error: u.t0 }), this.videoEnabled && this.localMediaHandler.disableVideo();
            case 19:
              this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack }), this.logger.info("Self.enableVideo", $({}, Is(this)));
            case 21:
            case "end":
              return u.stop();
          }
      }, n, this, [[10, 15]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateVideoConstraints", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.localMediaHandler.updateVideoConstraints) {
                s.next = 2;
                break;
              }
              throw new U("Unsupported", "1102");
            case 2:
              return s.next = 4, this.localMediaHandler.updateVideoConstraints(a);
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "enableScreenShare", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Me)[Me]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t enable screenshare without joining room", "1105");
            case 2:
              if (l(this, or)[or].canProduceScreenshare !== te.NotAllowed) {
                i.next = 4;
                break;
              }
              return i.abrupt("return");
            case 4:
              if (!(l(this, or)[or].canProduceScreenshare === te.CanRequest && (this.stageStatus === "OFF_STAGE" || this.stageStatus === "REQUESTED_TO_JOIN_STAGE"))) {
                i.next = 6;
                break;
              }
              return i.abrupt("return");
            case 6:
              if (!this.screenShareEnabled) {
                i.next = 8;
                break;
              }
              return i.abrupt("return");
            case 8:
              return i.next = 10, this.localMediaHandler.enableScreenShare();
            case 10:
              if (!(this.screenShareTracks.audio || this.screenShareTracks.video)) {
                i.next = 23;
                break;
              }
              return i.prev = 11, i.next = 14, l(this, Ve)[Ve].shareScreen(this.screenShareTracks);
            case 14:
              i.next = 22;
              break;
            case 16:
              if (i.prev = 16, i.t0 = i.catch(11), this.logger.error("Self::enableScreenShare::Error while sharing screen", { error: i.t0 }), !this.screenShareEnabled) {
                i.next = 22;
                break;
              }
              return i.next = 22, this.localMediaHandler.disableScreenShare();
            case 22:
              this.emit("screenShareUpdate", { screenShareEnabled: this.screenShareEnabled, screenShareTracks: this.screenShareTracks });
            case 23:
            case "end":
              return i.stop();
          }
      }, n, this, [[11, 16]]);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateScreenshareConstraints", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.localMediaHandler.updateScreenshareConstraints) {
                s.next = 2;
                break;
              }
              throw new U("Unsupported", "1102");
            case 2:
              return s.next = 4, this.localMediaHandler.updateScreenshareConstraints(a);
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableAudio", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.audioEnabled) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              this.localMediaHandler.disableAudio(), l(this, Me)[Me] && l(this, Ve)[Ve].muteSelf(), this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack }), (a = l(this, Ne)[Ne]) === null || a === void 0 || a.getValue("callstats").audioOff();
            case 6:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "disableVideo", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (this.videoEnabled) {
                s.next = 2;
                break;
              }
              return s.abrupt("return");
            case 2:
              return s.next = 4, this.localMediaHandler.disableVideo();
            case 4:
              if (!l(this, Me)[Me]) {
                s.next = 7;
                break;
              }
              return s.next = 7, l(this, Ve)[Ve].pauseWebcam();
            case 7:
              this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack }), (a = l(this, Ne)[Ne]) === null || a === void 0 || a.getValue("callstats").videoOff();
            case 9:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "disableScreenShare",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        return p().wrap(function(i) {
          for (; ; )
            switch (i.prev = i.next) {
              case 0:
                if (this.screenShareEnabled) {
                  i.next = 2;
                  break;
                }
                return i.abrupt("return");
              case 2:
                return i.next = 4, this.localMediaHandler.disableScreenShare();
              case 4:
                if (!l(this, Me)[Me]) {
                  i.next = 7;
                  break;
                }
                return i.next = 7, l(this, Ve)[Ve].disableScreenShare();
              case 7:
                this.emit("screenShareUpdate", { screenShareEnabled: this.screenShareEnabled, screenShareTracks: this.screenShareTracks });
              case 8:
              case "end":
                return i.stop();
            }
        }, n, this);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Returns all media devices accessible by the local participant.
    */
  }, {
    key: "getAllDevices",
    value: function() {
      return this.localMediaHandler.getAllDevices();
    }
    /**
    * @access private
    * Not for external use.
    */
  }, {
    key: "setIsPinned",
    value: function(r) {
      var n, a = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !0;
      l(this, fi)[fi] = r;
      var i = r ? "pinned" : "unpinned";
      (n = l(this, _t)[_t]) === null || n === void 0 || n.updateSource(this.id, { pinned: r }), a && this.emit(i, this);
    }
    /**
    * Returns true if the current user is pinned.
    */
  }, {
    key: "isPinned",
    get: function() {
      return l(this, fi)[fi];
    }
    /**
    * Returns `self.id` if user has permission
    * to pin participants.
    */
  }, { key: "pin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Me)[Me]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t pin participants without joining room", "1105");
            case 2:
              return this.show(), i.abrupt("return", l(this, Ve)[Ve].pinPeer(this.id));
            case 4:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "unpin", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Me)[Me]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t unpin participants without joining room", "1105");
            case 2:
              return i.abrupt("return", l(this, Ve)[Ve].pinPeer(null));
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "hide", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, Me)[Me]) {
                i.next = 2;
                break;
              }
              throw new U("Can`t toggle participant tile without joining room", "1105");
            case 2:
              this.hidden = !0, this.emit("toggleTile", { hidden: this.hidden });
            case 4:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "show", value: function() {
    if (!l(this, Me)[Me])
      throw new U("Can`t toggle participant tile without joining room", "1105");
    this.hidden = !1, this.emit("toggleTile", { hidden: this.hidden });
  } }, { key: "setDevice", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (a) {
                h.next = 2;
                break;
              }
              throw new U("No device selected", "1104");
            case 2:
              if (c = this.getCurrentDevices(), !(a.deviceId && ((c == null || (i = c.audio) === null || i === void 0 ? void 0 : i.deviceId) === a.deviceId || (c == null || (s = c.video) === null || s === void 0 ? void 0 : s.deviceId) === a.deviceId || (c == null || (u = c.speaker) === null || u === void 0 ? void 0 : u.deviceId) === a.deviceId))) {
                h.next = 7;
                break;
              }
              if (this.logger.warn("Self.setDevice.setting_to_in_use_device", { devices: [a] }), !l(this, Ne)[Ne].getValue("flagsmith").hasFeature(me.SKIP_SETTING_IN_USE_DEVICE)) {
                h.next = 7;
                break;
              }
              throw new U("Cannot set device currently in use", "1106");
            case 7:
              h.t0 = a.kind, h.next = h.t0 === "audioinput" ? 10 : h.t0 === "audiooutput" ? 22 : h.t0 === "videoinput" ? 25 : 37;
              break;
            case 10:
              return h.prev = 10, h.next = 13, this.localMediaHandler.setAudioDevice(a);
            case 13:
              h.next = 21;
              break;
            case 15:
              if (h.prev = 15, h.t1 = h.catch(10), !l(this, Me)[Me]) {
                h.next = 20;
                break;
              }
              return h.next = 20, l(this, Ve)[Ve].muteSelf();
            case 20:
              this.emit("audioUpdate", { audioEnabled: this.audioEnabled, audioTrack: this.audioTrack });
            case 21:
              return h.abrupt("break", 37);
            case 22:
              return h.next = 24, this.localMediaHandler.setSpeakerDevice(a);
            case 24:
              return h.abrupt("break", 37);
            case 25:
              return h.prev = 25, h.next = 28, this.localMediaHandler.setVideoDevice(a);
            case 28:
              h.next = 36;
              break;
            case 30:
              if (h.prev = 30, h.t2 = h.catch(25), !l(this, Me)[Me]) {
                h.next = 35;
                break;
              }
              return h.next = 35, l(this, Ve)[Ve].pauseWebcam();
            case 35:
              this.emit("videoUpdate", { videoEnabled: this.videoEnabled, videoTrack: this.videoTrack });
            case 36:
              return h.abrupt("break", 37);
            case 37:
            case "end":
              return h.stop();
          }
      }, n, this, [[10, 15], [25, 30]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "cleanUpTracks", value: function() {
    var r, n, a, i;
    (r = this.audioTrack) === null || r === void 0 || r.stop(), (n = this.rawAudioTrack) === null || n === void 0 || n.stop(), (a = this.videoTrack) === null || a === void 0 || a.stop(), (i = this.rawVideoTrack) === null || i === void 0 || i.stop();
  } }, { key: "playAudio", value: function() {
    var r;
    return (r = l(this, gi)[gi]) === null || r === void 0 ? void 0 : r.play();
  } }, { key: "registerVideoElement", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    if (r && (n ? l(this, Pi)[Pi].add(r) : l(this, Si)[Si].add(r), this.updateVideo(r), !n)) {
      var a, i;
      (a = l(this, _t)[_t]) === null || a === void 0 || a.addSource(this.id, r, this.videoEnabled, this.isPinned, this.name, this.picture, (i = this.raised) !== null && i !== void 0 ? i : !1);
    }
  } }, {
    key: "deregisterVideoElement",
    value: function(r) {
      var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
      if (!r) {
        l(this, _t)[_t].removeSource(this.id);
        return;
      }
      r.srcObject = void 0, n ? l(this, Pi)[Pi].delete(r) : (l(this, Si)[Si].delete(r), l(this, _t)[_t].removeSource(this.id));
    }
    /**
    * Internal method, do not use
    */
  }, { key: "updateVideo", value: function(r) {
    var n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    if (this.videoEnabled) {
      var a;
      if (this.videoTrack == null)
        return;
      var i = (a = r.srcObject) === null || a === void 0 ? void 0 : a.getTracks()[0];
      if ((i == null ? void 0 : i.id) === this.videoTrack.id)
        return;
      var s = new MediaStream();
      if (s.addTrack(this.videoTrack), r.srcObject = s, !n) {
        var u;
        (u = l(this, _t)[_t]) === null || u === void 0 || u.enableSource(this.id);
      }
    } else if (r.srcObject = void 0, !n) {
      var c;
      (c = l(this, _t)[_t]) === null || c === void 0 || c.disableSource(this.id);
    }
    r.style.display = this.videoEnabled ? "block" : "none";
  } }], [{ key: "__init__", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s, u, c) {
      var d, h, v, f, g, k, y, b, C, T, E, D, I = arguments;
      return p().wrap(function(V) {
        for (; ; )
          switch (V.prev = V.next) {
            case 0:
              if (y = I.length > 5 && I[5] !== void 0 ? I[5] : !1, b = (d = (h = a.getValue("defaults")) === null || h === void 0 ? void 0 : h.audio) !== null && d !== void 0 ? d : !0, C = (v = (f = a.getValue("defaults")) === null || f === void 0 ? void 0 : f.video) !== null && v !== void 0 ? v : !0, s.canProduceAudio !== "ALLOWED" && (b = !1), s.canProduceVideo !== "ALLOWED" && (C = !1), T = new nt(a, i, s, u, c), u.viewType !== Dt.Chat) {
                V.next = 8;
                break;
              }
              return V.abrupt("return", T);
            case 8:
              return E = mM(u.mediaConstraints), yi(E, (g = a.getValue("defaults")) === null || g === void 0 ? void 0 : g.mediaConfiguration), D = (k = a.getValue("defaults")) === null || k === void 0 ? void 0 : k.mediaHandler, D && (D.context = a), V.next = 14, T.init({ audio: b, video: C, constraints: E }, y, a);
            case 14:
              return T.setupEvents(), V.abrupt("return", T);
            case 16:
            case "end":
              return V.stop();
          }
      }, n);
    }));
    function r(n, a, i, s, u) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(Ag));
function C_() {
  return l(this, Ne)[Ne].getValue("pip");
}
function R_() {
  return l(this, Ne)[Ne].getValue("roomNodeClient");
}
function A_() {
  return l(this, Ne)[Ne].getValue("audioPlayback");
}
function I_() {
  var o;
  return ((o = l(this, Ne)[Ne].getValue("connectionHandler")) === null || o === void 0 ? void 0 : o.mediaJoined) === !0;
}
function M_() {
  var o = this;
  Array.from(l(this, Si)[Si]).forEach(function(t) {
    return o.updateVideo(t, !1);
  }), Array.from(l(this, Pi)[Pi]).forEach(function(t) {
    return o.updateVideo(t, !0);
  });
}
Rt([O.trace("Self.cleanupEvents")], nt.prototype, "cleanupEvents", 1);
Rt([O.trace("Self.setupEvents")], nt.prototype, "setupEvents", 1);
Rt([O.trace("Self.setupTracks")], nt.prototype, "setupTracks", 1);
Rt([O.trace("Self.destructMediaHandler")], nt.prototype, "destructMediaHandler", 1);
Rt([O.trace("Self.removeDocumentEventListeners")], nt.prototype, "removeDocumentEventListeners", 1);
Rt([Ka.executeWithLock({ methodName: "meeting.self.enableAudio", lockName: "Self.toggleAudio", timeout: 3e3 }), O.trace("Self.enableAudio")], nt.prototype, "enableAudio", 1);
Rt([Ka.executeWithLock({ methodName: "meeting.self.enableVideo", lockName: "Self.toggleVideo", timeout: 3e3 }), O.trace("Self.enableVideo")], nt.prototype, "enableVideo", 1);
Rt([O.trace("Self.updateVideoConstraints")], nt.prototype, "updateVideoConstraints", 1);
Rt([O.trace("Self.enableScreenShare"), Ka.executeWithLock({ methodName: "meeting.self.enableScreenShare", lockName: "Self.toggleScreenShare", timeout: 3e3 })], nt.prototype, "enableScreenShare", 1);
Rt([O.trace("Self.updateScreenshareConstraints")], nt.prototype, "updateScreenshareConstraints", 1);
Rt([Ka.executeWithLock({ methodName: "meeting.self.disableAudio", lockName: "Self.toggleAudio", timeout: 3e3 }), O.trace("Self.disableAudio")], nt.prototype, "disableAudio", 1);
Rt([Ka.executeWithLock({ methodName: "meeting.self.disableVideo", lockName: "Self.toggleVideo", timeout: 3e3 }), O.trace("Self.disableVideo")], nt.prototype, "disableVideo", 1);
Rt([Ka.executeWithLock({ methodName: "meeting.self.disableScreenShare", lockName: "Self.toggleScreenShare", timeout: 3e3 }), O.trace("Self.disableScreenShare")], nt.prototype, "disableScreenShare", 1);
Rt([O.trace("Self.setDevice")], nt.prototype, "setDevice", 1);
nt = Rt([vt("1100")], nt);
var __ = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e != null ? e : "AwaitQueue stopped"]), r.name = "AwaitQueueStoppedError", typeof Error.captureStackTrace == "function" && Error.captureStackTrace(r, t), r;
  }
  return A(t, o), P(t);
}(/* @__PURE__ */ Gs(Error)), O_ = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e != null ? e : "AwaitQueue task removed"]), r.name = "AwaitQueueRemovedTaskError", typeof Error.captureStackTrace == "function" && Error.captureStackTrace(r, t), r;
  }
  return A(t, o), P(t);
}(/* @__PURE__ */ Gs(Error)), lu = /* @__PURE__ */ S("logger"), Bd = /* @__PURE__ */ function() {
  function o(t) {
    var e = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1;
    w(this, o), this.pendingTasks = /* @__PURE__ */ new Map(), this.nextTaskId = 0, this.stopping = !1, Object.defineProperty(this, lu, { writable: !0, value: void 0 }), this.log = e, l(this, lu)[lu] = { info: e && t ? t.info : function() {
    } };
  }
  return P(o, [{ key: "size", get: function() {
    return this.pendingTasks.size;
  } }, { key: "push", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s = this;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (a = a != null ? a : n.name, typeof n == "function") {
                c.next = 3;
                break;
              }
              throw new TypeError("given task is not a function");
            case 3:
              if (a)
                try {
                  Object.defineProperty(n, "name", { value: a });
                } catch (d) {
                }
              return c.abrupt("return", new Promise(function(d, h) {
                var v = { id: s.nextTaskId++, task: n, metadata: i, name: a, enqueuedAt: Date.now(), executedAt: void 0, completed: !1, resolve: function(g) {
                  if (!v.completed) {
                    v.completed = !0, s.pendingTasks.delete(v.id), d(g);
                    var k = s.pendingTasks.values(), y = He(k, 1), b = y[0];
                    b && !b.executedAt && s.execute(b);
                  }
                }, reject: function(g) {
                  if (!v.completed && (v.completed = !0, s.pendingTasks.delete(v.id), h(g), !s.stopping)) {
                    var k = s.pendingTasks.values(), y = He(k, 1), b = y[0];
                    b && !b.executedAt && s.execute(b);
                  }
                } };
                s.pendingTasks.set(v.id, v), s.pendingTasks.size === 1 && s.execute(v);
              }));
            case 5:
            case "end":
              return c.stop();
          }
      }, r);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "stop", value: function() {
    this.stopping = !0;
    var e = Fn(this.pendingTasks.values()), r;
    try {
      for (e.s(); !(r = e.n()).done; ) {
        var n = r.value;
        n.reject(new __());
      }
    } catch (a) {
      e.e(a);
    } finally {
      e.f();
    }
    this.stopping = !1;
  } }, { key: "remove", value: function(e) {
    var r = Array.from(this.pendingTasks.values())[e];
    r && r.reject(new O_());
  } }, { key: "get", value: function(e) {
    return Array.from(this.pendingTasks.values())[e];
  } }, { key: "dump", value: function() {
    var e = Date.now(), r = 0;
    return Array.from(this.pendingTasks.values()).map(function(n) {
      return { idx: r++, task: n.task, name: n.name, enqueuedTime: n.executedAt ? n.executedAt - n.enqueuedAt : e - n.enqueuedAt, executionTime: n.executedAt ? e - n.executedAt : 0 };
    });
  } }, { key: "execute", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (!n.executedAt) {
                c.next = 2;
                break;
              }
              throw new Error("task already being executed");
            case 2:
              return n.executedAt = Date.now(), c.prev = 3, a = this.pendingTasks.size, c.next = 7, n.task();
            case 7:
              i = c.sent, s = Date.now(), l(this, lu)[lu].info("AwaitQueue.push(".concat(n.name, ")_timings"), { awaitQueueTask: { id: n.id, metadata: n.metadata, queueSizeAtStart: a, execTime: (s - n.executedAt) / 1e3, taskStartTime: (n.executedAt - n.enqueuedAt) / 1e3 } }), n.resolve(i), c.next = 16;
              break;
            case 13:
              c.prev = 13, c.t0 = c.catch(3), n.reject(c.t0);
            case 16:
            case "end":
              return c.stop();
          }
      }, r, this, [[3, 13]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}();
function D_(o, t) {
  var e = new Error(t);
  return e.name = o, e;
}
var qd = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e]), r.name = "UnsupportedError", Error.hasOwnProperty("captureStackTrace") ? Error.captureStackTrace(r, t) : r.stack = new Error(e).stack, r;
  }
  return A(t, o), P(t);
}(U), kn = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e]), r.name = "InvalidStateError", Error.hasOwnProperty("captureStackTrace") ? Error.captureStackTrace(r, t) : r.stack = new Error(e).stack, r;
  }
  return A(t, o), P(t);
}(U), Bs = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t, [e]), r.name = "TransportConnectionError", Error.hasOwnProperty("captureStackTrace") ? Error.captureStackTrace(r, kn) : r.stack = new Error(e).stack, r;
  }
  return A(t, o), P(t);
}(U), yv = function(t) {
  return new Promise(function(e) {
    return setTimeout(e, t);
  });
};
function Ig(o, t) {
  return Gd.apply(this, arguments);
}
function Gd() {
  return Gd = m(/* @__PURE__ */ p().mark(function o(t, e) {
    return p().wrap(function(n) {
      for (; ; )
        switch (n.prev = n.next) {
          case 0:
            return n.abrupt("return", new Promise(/* @__PURE__ */ function() {
              var a = m(/* @__PURE__ */ p().mark(function i(s, u) {
                var c, d, h, v, f, g, k, y, b;
                return p().wrap(function(T) {
                  for (; ; )
                    switch (T.prev = T.next) {
                      case 0:
                        c = $({ strategy: "linear", maxRetryCount: 3, delayTime: 10 }, e), d = c.strategy, h = c.maxRetryCount, v = c.delayTime, f = 0, k = !1, y = function(D) {
                          k = !0, u(D);
                        };
                      case 4:
                        if (!(f < h)) {
                          T.next = 32;
                          break;
                        }
                        return T.prev = 5, T.next = 8, t(f, y);
                      case 8:
                        return b = T.sent, T.abrupt("return", s(b));
                      case 12:
                        if (T.prev = 12, T.t0 = T.catch(5), g = T.t0, !k) {
                          T.next = 17;
                          break;
                        }
                        return T.abrupt("break", 32);
                      case 17:
                        if (!(f < h)) {
                          T.next = 28;
                          break;
                        }
                        if (d !== "linear") {
                          T.next = 23;
                          break;
                        }
                        return T.next = 21, yv(v * (f + 1));
                      case 21:
                        T.next = 26;
                        break;
                      case 23:
                        if (d !== "exponential") {
                          T.next = 26;
                          break;
                        }
                        return T.next = 26, yv(v * (f + Math.max(0, f - 1)));
                      case 26:
                        T.next = 29;
                        break;
                      case 28:
                        return T.abrupt("break", 32);
                      case 29:
                        f += 1, T.next = 4;
                        break;
                      case 32:
                        return T.abrupt("return", u(g));
                      case 33:
                      case "end":
                        return T.stop();
                    }
                }, i, null, [[5, 12]]);
              }));
              return function(i, s) {
                return a.apply(this, arguments);
              };
            }()));
          case 1:
          case "end":
            return n.stop();
        }
    }, o);
  })), Gd.apply(this, arguments);
}
function L_(o) {
  return o.map(function(t) {
    var e = { channels: t.channels, clockRate: t.clockRate, mimeType: t.mimeType, sdpFmtpLine: t.sdpFmtpLine };
    return e;
  });
}
function $_(o) {
  return o.map(function(t) {
    var e = { uri: t.uri };
    return e;
  });
}
function Il(o) {
  var t = { codecs: L_(o.codecs), headerExtensions: $_(o.headerExtensions ? o.headerExtensions : []) };
  return t;
}
function N_(o) {
  var t = RTCRtpReceiver.getCapabilities("audio"), e = RTCRtpReceiver.getCapabilities("video"), r = RTCRtpSender.getCapabilities("audio"), n = RTCRtpSender.getCapabilities("video");
  o && (e.codecs = e.codecs.filter(function(u) {
    var c = u.mimeType;
    return o === c;
  }), n.codecs = n.codecs.filter(function(u) {
    var c = u.mimeType;
    return o === c;
  }));
  var a = { audio: Il(t), video: Il(e) }, i = { audio: Il(r), video: Il(n) }, s = { sender: i, receiver: a };
  return s;
}
var Be = /* @__PURE__ */ S("socket"), V_ = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, Be, { writable: !0, value: void 0 }), this.events = void 0, l(this, Be)[Be] = t, this.events = Vn;
  }
  return P(o, [{ key: "joinRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s, u, c, d = arguments;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return s = d.length > 3 && d[3] !== void 0 ? d[3] : !1, u = d.length > 4 && d[4] !== void 0 ? d[4] : null, c = { roomUuid: n, displayName: a, prejoined: s, capabilities: i }, u && (c.location = u), v.next = 6, l(this, Be)[Be].sendMessagePromiseWithTimeout({ event: this.events.joinRoom, protobuf: gS.toBinary(c), timeout: 5e3 });
            case 6:
              return v.abrupt("return", v.sent.payload);
            case 7:
            case "end":
              return v.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "connectTransport", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              return v.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.createWebRTCTransport, GP.toBinary(n));
            case 2:
              return a = v.sent.payload, i = Qf.fromBinary(a), s = i.transportId, u = i.description, c = i.producerIds, d = { sdp: u == null ? void 0 : u.sdp, type: u.type }, v.abrupt("return", { transportId: s, answer: d, producerIds: c });
            case 6:
            case "end":
              return v.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "produce", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return h.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.produce, _S.toBinary(n));
            case 2:
              return s = h.sent.payload, u = hE.fromBinary(s), c = { sdp: u == null || (a = u.description) === null || a === void 0 ? void 0 : a.sdp, type: u == null || (i = u.description) === null || i === void 0 ? void 0 : i.type }, h.abrupt("return", { answer: c, producerId: u.producerId });
            case 6:
            case "end":
              return h.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "consume", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.consume, ES.toBinary(n));
            case 2:
              return a = d.sent.payload, i = dE.fromBinary(a), s = i.consumerIdsMap.map, u = i.description, d.abrupt("return", { consumerStateMap: s, sessionDescription: u });
            case 5:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "closeProducer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.closeProducer, US.toBinary(n));
            case 2:
              return a = c.sent.payload, i = bE.fromBinary(a), s = i.description, c.abrupt("return", s);
            case 5:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "closeConsumer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.closeConsumer, FS.toBinary(n));
            case 2:
              return i.abrupt("return", i.sent.payload);
            case 3:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "updateConsumersSimulcastConfig", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.updateConsumersSimulcastConfig, IS.toBinary(n));
            case 2:
              return i.abrupt("return", i.sent.payload);
            case 3:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "hostControlForPeer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return i = { audio: a === "audio", screeShare: !1, video: a === "video", participantId: n }, h.next = 3, l(this, Be)[Be].sendMessagePromise(this.events.hostControlPeer, JS.toBinary(i));
            case 3:
              if (s = h.sent.payload, s) {
                h.next = 6;
                break;
              }
              return h.abrupt("return", !1);
            case 6:
              return u = RE.fromBinary(s), c = u.status, h.abrupt("return", c === "success");
            case 8:
            case "end":
              return h.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "hostControlForAll",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a, i, s, u;
        return p().wrap(function(d) {
          for (; ; )
            switch (d.prev = d.next) {
              case 0:
                return a = { audio: n === "audio", screenShare: !1, video: n === "video" }, d.next = 3, l(this, Be)[Be].sendMessagePromise(this.events.hostControlAllPeers, zS.toBinary(a));
              case 3:
                if (i = d.sent.payload, i) {
                  d.next = 6;
                  break;
                }
                return d.abrupt("return", !1);
              case 6:
                return s = IE.fromBinary(i), u = s.status, d.abrupt("return", u === "success");
              case 8:
              case "end":
                return d.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * Ideally should have been async with a response but
    * this is basically a fire and forget since socket does not
    * send a response at the moment
    */
  }, { key: "kickAll", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              n = { propagateKickAcrossRooms: !1 }, l(this, Be)[Be].sendMessagePromise(
                /**
                * Does not use mediaEventSlugs is the same irrespective of the SFU
                */
                Y.kickAll,
                eg.toBinary(n)
              );
            case 2:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "kickPeer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              l(this, Be)[Be].sendMessagePromise(
                /**
                * Does not use mediaEventSlugs is the same irrespective of the SFU
                */
                Y.kick,
                ig.toBinary(n)
              );
            case 1:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "changeDisplayName", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, l(this, Be)[Be].sendMessagePromise(this.events.changeDisplayName, GS.toBinary(n));
            case 2:
              if (a = c.sent.payload, a) {
                c.next = 5;
                break;
              }
              return c.abrupt("return", !1);
            case 5:
              return i = _E.fromBinary(a), s = i.status, c.abrupt("return", s === "success");
            case 7:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "notifySelfJoinComplete", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return n = {}, s.next = 3, l(this, Be)[Be].sendMessagePromise(this.events.selfJoinComplete, yS.toBinary(n));
            case 3:
              return a = s.sent.payload, s.abrupt("return", Ed.fromBinary(a));
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "audioActivity", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              l(this, Be)[Be].sendMessage(this.events.audioActivity, JP.toBinary(n));
            case 1:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), Vo = /* @__PURE__ */ function(o) {
  return o.NEW = "new", o.CONNECTING = "connecting", o.RECONNECTING = "reconnecting", o.DISCONNECTED = "disconnected", o.CONNECTED = "connected", o.FAILED = "failed", o.CLOSED = "closed", o;
}(Vo || {}), cu = /* @__PURE__ */ S("context"), Rc = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    return w(this, t), r = R(this, t), Object.defineProperty(r, cu, { writable: !0, value: void 0 }), l(r, cu)[cu] = e, r.setMaxListeners(1 / 0), r;
  }
  return A(t, o), P(t, [{ key: "logger", get: function() {
    return l(this, cu)[cu].getValue("logger");
  } }, { key: "safeEmit", value: function(r) {
    var n = this.listenerCount(r);
    try {
      for (var a = arguments.length, i = new Array(a > 1 ? a - 1 : 0), s = 1; s < a; s++)
        i[s - 1] = arguments[s];
      return this.emit.apply(this, [r].concat(i));
    } catch (u) {
      return this.logger.error("EnhancedEventEmitter:: safeEmit() | event listener ".concat(r, " threw an error"), { error: u }), Boolean(n);
    }
  } }, { key: "safeEmitAsPromise", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s, u, c, d = arguments;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              for (i = {}.EVENT_PROMISE_TIMEOUT ? parseInt({}.EVENT_PROMISE_TIMEOUT, 10) : 1e4, s = d.length, u = new Array(s > 1 ? s - 1 : 0), c = 1; c < s; c++)
                u[c - 1] = d[c];
              return v.abrupt("return", this.safeEmitAsPromiseWithTimeout.apply(this, [a, i].concat(u)));
            case 3:
            case "end":
              return v.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "safeEmitAsPromiseWithTimeout", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s = this, u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              for (u = h.length, c = new Array(u > 2 ? u - 2 : 0), d = 2; d < u; d++)
                c[d - 2] = h[d];
              return f.abrupt("return", new Promise(function(g, k) {
                setTimeout(k, i, "event request timeout");
                try {
                  s.emit.apply(s, [a.toString()].concat(c, [g, k]));
                } catch (y) {
                  s.logger.error("EnhancedEventEmitter:: safeEmitAsPromise() | event listener for event ".concat(a.toString(), " threw an error [event:%s]:%o"), { error: y }), k(y);
                }
              }));
            case 2:
            case "end":
              return f.stop();
          }
      }, n);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(ht.EventEmitter), Kp = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    w(this, t);
    for (var r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    return e = R(this, t, [].concat(n)), e._sendWebStream = new MediaStream(), e._sendScreenShareStream = new MediaStream(), e._direction = void 0, e.pc = void 0, e._transportReady = !1, e._mapMidTransceiver = /* @__PURE__ */ new Map(), e.enableHighBitrate = !1, e.enableStereo = !1, e.enableDtx = !0, e;
  }
  return A(t, o), P(t, [{ key: "midTransceiverMap", get: function() {
    return this._mapMidTransceiver;
  } }, { key: "close", value: function() {
    if (this.logger.debug("".concat(this.name, "::close()")), this.pc)
      try {
        this.pc.close();
      } catch (r) {
        this.logger.error("".concat(this.name, "::pc.close()"), { error: r });
      }
  } }, { key: "restartIce", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a = this, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return this.logger.debug("".concat(this.name, "::restartIce()")), c.next = 3, this.pc.createOffer({ iceRestart: !0 });
            case 3:
              return i = c.sent, this.logger.debug("".concat(this.name, "::restartIce() | calling pc.setLocalDescription() [offer:").concat(JSON.stringify(i), "]")), s = /* @__PURE__ */ function() {
                var d = m(/* @__PURE__ */ p().mark(function h(v) {
                  return p().wrap(function(g) {
                    for (; ; )
                      switch (g.prev = g.next) {
                        case 0:
                          return a.logger.info("".concat(a.name, "::restartIce() | calling pc.setRemoteDescription() [answer:").concat(JSON.stringify(v), "]")), g.next = 3, a.pc.setRemoteDescription(v);
                        case 3:
                        case "end":
                          return g.stop();
                      }
                  }, h);
                }));
                return function(v) {
                  return d.apply(this, arguments);
                };
              }(), c.abrupt("return", { offerSdp: i, callback: s });
            case 7:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "init", value: function(r) {
    var n = r.direction, a = r.iceServers, i = r.iceTransportPolicy, s = r.additionalSettings, u = r.proprietaryConstraints, c = r.onTrackHandler;
    this.logger.debug("HandlerInterface::init()"), this._direction = n, this.pc = new RTCPeerConnection($({ iceServers: a || [], iceTransportPolicy: i || "all", bundlePolicy: "max-bundle", rtcpMuxPolicy: "require" }, s), u), c && this.pc.addEventListener("track", function(d) {
      c(d);
    }), this._addEventListeners();
  } }, { key: "connect", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      var a = this, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return this.pc.addTransceiver("video", { direction: "sendonly" }), c.next = 3, this.pc.createOffer();
            case 3:
              return i = c.sent, c.next = 6, this.pc.setLocalDescription(i);
            case 6:
              return this.logger.info("connect offer: ".concat(JSON.stringify(i))), s = /* @__PURE__ */ function() {
                var d = m(/* @__PURE__ */ p().mark(function h(v) {
                  return p().wrap(function(g) {
                    for (; ; )
                      switch (g.prev = g.next) {
                        case 0:
                          return a.logger.debug("".concat(a.name, "::connect() | calling pc.setRemoteDescription() [answer:").concat(JSON.stringify(v), "]")), g.next = 3, a.pc.setRemoteDescription(v);
                        case 3:
                        case "end":
                          return g.stop();
                      }
                  }, h);
                }));
                return function(v) {
                  return d.apply(this, arguments);
                };
              }(), c.abrupt("return", { offerSdp: i, callback: s });
            case 9:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getTransportStats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.pc.getStats());
            case 1:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "_assertSendDirection", value: function() {
    if (this._direction !== "send")
      throw new Error('method can just be called for handlers with "send" direction');
  } }, { key: "_assertRecvDirection", value: function() {
    if (this._direction !== "recv")
      throw new Error('method can just be called for handlers with "recv" direction');
  } }, { key: "getReceiverStats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (this._assertRecvDirection(), i = this.midTransceiverMap.get(a), i) {
                u.next = 4;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 4:
              return u.abrupt("return", i.receiver.getStats());
            case 5:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "stopSending", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (this._assertSendDirection(), this.logger.debug("stopSending() [localId:".concat(a, "]")), s = this.midTransceiverMap.get(a), s) {
                h.next = 5;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 5:
              return s.sender.replaceTrack(null), this.pc.removeTrack(s.sender), s.direction = "inactive", h.next = 10, this.pc.createOffer();
            case 10:
              return u = h.sent, this.logger.debug("stopSending() | calling pc.setLocalDescription() [offer:".concat(JSON.stringify(u), "]")), h.next = 14, this.pc.setLocalDescription(u);
            case 14:
              return c = /* @__PURE__ */ function() {
                var v = m(/* @__PURE__ */ p().mark(function f(g) {
                  return p().wrap(function(y) {
                    for (; ; )
                      switch (y.prev = y.next) {
                        case 0:
                          return i.logger.debug("stopSending() | calling pc.setRemoteDescription() [answer:".concat(JSON.stringify(g), "]")), y.next = 3, i.pc.setRemoteDescription(g);
                        case 3:
                          i.midTransceiverMap.delete(a);
                        case 4:
                        case "end":
                          return y.stop();
                      }
                  }, f);
                }));
                return function(g) {
                  return v.apply(this, arguments);
                };
              }(), h.abrupt("return", { offerSdp: u, callback: c });
            case 16:
            case "end":
              return h.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "replaceTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (this._assertSendDirection(), i ? this.logger.debug("replaceTrack() [localId:".concat(a, ", track.id:").concat(i.id, "]")) : this.logger.debug("replaceTrack() [localId:".concat(a, ", no track]")), s = this.midTransceiverMap.get(a), s) {
                c.next = 5;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 5:
              return c.next = 7, s.sender.replaceTrack(i);
            case 7:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setMaxSpatialLayer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (this._assertSendDirection(), this.logger.debug("setMaxSpatialLayer() [localId:".concat(a, ", spatialLayer:").concat(i, "]")), s = this.midTransceiverMap.get(a), s) {
                d.next = 5;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 5:
              return u = s.sender.getParameters(), u.encodings.forEach(function(h, v) {
                v <= i ? h.active = !0 : h.active = !1;
              }), d.next = 9, s.sender.setParameters(u);
            case 9:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setRtpEncodingParameters", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (this._assertSendDirection(), this.logger.debug("setRtpEncodingParameters() [localId:".concat(a, ", params:").concat(JSON.stringify(i), "]")), s = this.midTransceiverMap.get(a), s) {
                d.next = 5;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 5:
              return u = s.sender.getParameters(), u.encodings.forEach(function(h, v) {
                u.encodings[v] = $($({}, h), i);
              }), d.next = 9, s.sender.setParameters(u);
            case 9:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "getSenderStats", value: function(r) {
    this._assertSendDirection();
    var n = this.midTransceiverMap.get(r);
    if (!n)
      throw new Error("associated RTCRtpTransceiver not found");
    return n.sender.getStats();
  } }, {
    key: "_addEventListeners",
    value: function() {
      var r = this;
      this.pc.addEventListener("icecandidate", function(n) {
        n.candidate && r.emit("@icecandidate", { candidate: n.candidate });
      }), this.pc.addEventListener("iceconnectionstatechange", function() {
        switch (r.pc.iceConnectionState) {
          case "checking":
            r.emit("@connectionstatechange", "connecting");
            break;
          case "connected":
          case "completed":
            r.emit("@connectionstatechange", "connected"), r._transportReady = !0;
            break;
          case "failed":
            r.emit("@connectionstatechange", "failed");
            break;
          case "disconnected":
            r.emit("@connectionstatechange", "disconnected");
            break;
          case "closed":
            r.emit("@connectionstatechange", "closed");
            break;
          default:
            r.logger.warn("unknown state");
            break;
        }
      }), this.pc.addEventListener("negotiationneeded", function() {
        r.emit("@negotiationneeded", {}), r.logger.debug("negotiationneeded");
      }), this.pc.addEventListener("icegatheringstatechange", function() {
        switch (r.pc.iceGatheringState) {
          case "gathering":
            r.logger.debug("icegatheringstatechange | gathering"), r.emit("@icegatheringstatechange", "gathering");
            break;
          case "complete":
            r.logger.debug("icegatheringstatechange | complete"), r.emit("@icegatheringstatechange", "complete");
            break;
          default:
            r.logger.warn("unknown state");
            break;
        }
      }), this.pc.addEventListener("icecandidateerror", function(n) {
        r.logger.warn("icecandidateerror", { error: { code: n.errorCode, message: n.errorText } });
      }), this.pc.addEventListener("datachannel", function(n) {
        r.logger.info("data channel created: ", { rtcChannel: { label: n.channel.label } });
        var a = n.channel;
        a.onopen = function() {
          r.logger.info("data channel open: ", { rtcChannel: { label: n.channel.label } }), r.safeEmit("dc_open", n.channel);
        }, a.onclose = function() {
          r.logger.warn("data channel closed: ", { rtcChannel: { label: n.channel.label } });
        }, a.onerror = function() {
          r.logger.error("data channel error: ", {
            rtcChannel: { label: n.channel.label }
            // error: error as unknown as LogData, // Need to fix this, where to get message, reason
          });
        };
      }), this.addCustomEventListeners();
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "addCustomEventListeners", value: function() {
  } }]);
}(Rc), U_ = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t, [{ key: "name", get: (
    // eslint-disable-next-line class-methods-use-this
    function() {
      return "Chrome74";
    }
  ) }, { key: "init", value: function(r) {
    var n = r.direction, a = r.iceServers, i = r.iceTransportPolicy, s = r.additionalSettings, u = r.proprietaryConstraints, c = r.onTrackHandler;
    this._direction = n, this.pc = new RTCPeerConnection($({ iceServers: a || [], iceTransportPolicy: i || "all", bundlePolicy: "max-bundle", rtcpMuxPolicy: "require", sdpSemantics: "unified-plan" }, s), u), c && this.pc.addEventListener("track", function(d) {
      c(d);
    }), this._addEventListeners();
  } }, { key: "send", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h, v, f, g, k, y, b, C;
      return p().wrap(function(E) {
        for (; ; )
          switch (E.prev = E.next) {
            case 0:
              return s = a.track, u = a.encodings, c = a.codecOptions, d = a.screenShare, this._assertSendDirection(), h = this.pc.addTransceiver(s, { direction: "sendonly", streams: [d ? this._sendScreenShareStream : this._sendWebStream], sendEncodings: u }), navigator.isReactNative || (this.logger.debug("creating new transceiver"), v = RTCRtpSender.getCapabilities(typeof s == "string" ? s : s.kind), this.logger.info("senders available params: ".concat(JSON.stringify(v))), f = [], c && c.length && c.forEach(function(D) {
                var I = v.codecs.find(function(N) {
                  return N.mimeType.includes(D.name);
                });
                if (D.parameters) {
                  var _;
                  i.logger.debug("codecOption.parameters:".concat(JSON.stringify(D.parameters)));
                  var V = ((_ = I.sdpFmtpLine) === null || _ === void 0 ? void 0 : _.split(";")) || [];
                  V.push.apply(V, Se(D.parameters));
                  var F = Array.from(new Set(V).values());
                  I.sdpFmtpLine = F.join(";");
                }
                f.push(I);
              }), this.logger.info("selected codecs: ".concat(JSON.stringify(f))), h.setCodecPreferences(f)), E.next = 6, this.pc.createOffer();
            case 6:
              return g = E.sent, E.next = 9, this.pc.setLocalDescription(g);
            case 9:
              return c && c.findIndex(function(D) {
                var I = D.name;
                return I === "opus";
              }) >= 0 && (k = this.enableDtx, y = this.enableStereo, b = this.enableHighBitrate ? y ? 128e3 : 64e3 : y ? 64e3 : 32e3, g.sdp = g.sdp.replace("minptime=10;useinbandfec=1", "minptime=10;useinbandfec=1;".concat(k ? "usedtx=1;" : "").concat(y ? "stereo=1;sprop-stereo=1;" : "", "maxaveragebitrate=").concat(b)), g.sdp += `a=rtcp-fb:111 nack\r
`), this.midTransceiverMap.set(h.mid, h), C = /* @__PURE__ */ function() {
                var D = m(/* @__PURE__ */ p().mark(function I(_) {
                  return p().wrap(function(F) {
                    for (; ; )
                      switch (F.prev = F.next) {
                        case 0:
                          return i.logger.debug("send() | calling pc.setRemoteDescription() [answer:".concat(JSON.stringify(_), "]")), F.next = 3, i.pc.setRemoteDescription(_);
                        case 3:
                          return F.abrupt("return", h.mid);
                        case 4:
                        case "end":
                          return F.stop();
                      }
                  }, I);
                }));
                return function(_) {
                  return D.apply(this, arguments);
                };
              }(), this.logger.debug("send() | calling pc.setLocalDescription() [offer: ".concat(JSON.stringify(g, void 0, 2), "]")), E.abrupt("return", { offerSdp: g, callback: C, sender: h.sender, mid: h.mid });
            case 14:
            case "end":
              return E.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "addCustomEventListeners", value: function() {
    var r = this;
    this.pc.addEventListener("datachannel", function(n) {
      var a = n.channel;
      a.onmessage = function(i) {
        r.safeEmit("datachannel", n.channel, String.fromCharCode.apply(String, Se(new Uint8Array(i.data))));
      };
    });
  } }], [{ key: "createFactory", value: (
    /**
    * Creates a factory function.
    */
    function(r) {
      return function() {
        return new t(r);
      };
    }
  ) }]);
}(Kp), kv = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    return w(this, t), n = R(this, t, [e]), n.supportsSendEncodings = !1, n.supportsSendEncodings = r.supportsSendEncodings, n;
  }
  return A(t, o), P(t, [{ key: "name", get: function() {
    return "Firefox60";
  } }, { key: "send", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h, v, f, g, k, y, b, C, T;
      return p().wrap(function(D) {
        for (; ; )
          switch (D.prev = D.next) {
            case 0:
              if (s = a.track, u = a.encodings, c = a.codecOptions, d = a.screenShare, this._assertSendDirection(), h = this.supportsSendEncodings && u !== void 0 ? { sendEncodings: u } : {}, v = this.pc.addTransceiver(s, $({ direction: "sendonly", streams: [d ? this._sendScreenShareStream : this._sendWebStream] }, h)), !(!this.supportsSendEncodings && u)) {
                D.next = 10;
                break;
              }
              return u.reverse(), f = v.sender.getParameters(), f.encodings = u, D.next = 10, v.sender.setParameters(f);
            case 10:
              return g = function(_, V) {
                var F, N = Dn.parse(_), L = N.media[N.media.length - 1], H = L.rtp.filter(function(x) {
                  return V.some(function(Pe) {
                    return Pe.name === x.codec;
                  });
                }), Q = L.fmtp.filter(function(x) {
                  return H.some(function(Pe) {
                    return Pe.payload === x.payload;
                  });
                }), B = (F = L.rtcpFb) === null || F === void 0 ? void 0 : F.filter(function(x) {
                  return H.some(function(Pe) {
                    return Pe.payload === x.payload;
                  });
                }), G = H.map(function(x) {
                  return x.payload;
                });
                return N.media[N.media.length - 1].rtp = H, N.media[N.media.length - 1].fmtp = Q, N.media[N.media.length - 1].rtcpFb = B, N.media[N.media.length - 1].payloads = G.join(" "), Dn.write(N);
              }, D.next = 13, this.pc.createOffer();
            case 13:
              return k = D.sent, k.sdp = g(k.sdp, c), this.logger.debug("send() | calling pc.setLocalDescription() [offer:".concat(JSON.stringify(k), "]")), D.next = 18, this.pc.setLocalDescription(k);
            case 18:
              return (s === "audio" || s.kind === "audio") && (y = this.enableDtx, b = this.enableStereo, C = this.enableHighBitrate ? b ? 128e3 : 64e3 : b ? 64e3 : 32e3, k.sdp = k.sdp.replace("minptime=10;useinbandfec=1", "minptime=10;useinbandfec=1;".concat(y ? "usedtx=1;" : "").concat(b ? "stereo=1;sprop-stereo=1;" : "", "maxaveragebitrate=").concat(C))), this.midTransceiverMap.set(v.mid, v), T = /* @__PURE__ */ function() {
                var I = m(/* @__PURE__ */ p().mark(function _(V) {
                  return p().wrap(function(N) {
                    for (; ; )
                      switch (N.prev = N.next) {
                        case 0:
                          return i.logger.debug("send() | calling pc.setRemoteDescription() [answer:".concat(JSON.stringify(V), "]")), N.next = 3, i.pc.setRemoteDescription(V);
                        case 3:
                          return N.abrupt("return", v.mid);
                        case 4:
                        case "end":
                          return N.stop();
                      }
                  }, _);
                }));
                return function(V) {
                  return I.apply(this, arguments);
                };
              }(), D.abrupt("return", { offerSdp: k, callback: T, sender: v.sender, mid: v.mid });
            case 22:
            case "end":
              return D.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setMaxSpatialLayer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (this._assertSendDirection(), this.logger.debug("setMaxSpatialLayer() [localId:".concat(a, ", spatialLayer:").concat(i, "]")), s = this.midTransceiverMap.get(a), s) {
                h.next = 5;
                break;
              }
              throw new Error("associated RTCRtpTransceiver not found");
            case 5:
              return u = s.sender.getParameters(), c = u.encodings.length - 1 - i, u.encodings.forEach(function(v, f) {
                f >= c ? v.active = !0 : v.active = !1;
              }), h.next = 10, s.sender.setParameters(u);
            case 10:
            case "end":
              return h.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "addCustomEventListeners", value: function() {
    var r = this;
    this.pc.addEventListener("datachannel", function(n) {
      var a = n.channel;
      a.onmessage = /* @__PURE__ */ function() {
        var i = m(/* @__PURE__ */ p().mark(function s(u) {
          var c;
          return p().wrap(function(h) {
            for (; ; )
              switch (h.prev = h.next) {
                case 0:
                  return h.next = 2, u.data.arrayBuffer();
                case 2:
                  c = h.sent, r.safeEmit("datachannel", n.channel, String.fromCharCode.apply(String, Se(new Uint8Array(c))));
                case 4:
                case "end":
                  return h.stop();
              }
          }, s);
        }));
        return function(s) {
          return i.apply(this, arguments);
        };
      }();
    });
  } }], [{ key: "createFactory", value: (
    /**
    * Creates a factory function.
    */
    function(r, n) {
      return function() {
        return new t(r, n);
      };
    }
  ) }]);
}(Kp), j_ = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, arguments);
  }
  return A(t, o), P(t, [{ key: "name", get: (
    // eslint-disable-next-line class-methods-use-this
    function() {
      return "Safari12";
    }
  ) }, { key: "send", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h, v, f, g, k, y, b, C;
      return p().wrap(function(E) {
        for (; ; )
          switch (E.prev = E.next) {
            case 0:
              return s = a.track, u = a.encodings, c = a.codecOptions, d = a.screenShare, this._assertSendDirection(), this.logger.debug("Safari12::creating new transceiver"), h = this.pc.addTransceiver(s, { direction: "sendonly", streams: [d ? this._sendScreenShareStream : this._sendWebStream], sendEncodings: u }), v = RTCRtpSender.getCapabilities(typeof s == "string" ? s : s.kind), this.logger.info("Safari12::senders available params: ".concat(JSON.stringify(v))), f = [], c && c.length > 0 && c.forEach(function(D) {
                var I = v.codecs.find(function(N) {
                  return N.mimeType.includes(D.name);
                });
                if (D.parameters) {
                  var _;
                  i.logger.info("Safari12::codecOption.parameters:, ".concat(JSON.stringify(D.parameters)));
                  var V = ((_ = I.sdpFmtpLine) === null || _ === void 0 ? void 0 : _.split(";")) || [];
                  V.push.apply(V, Se(D.parameters));
                  var F = Se(new Set(V).values());
                  I.sdpFmtpLine = F.join(";");
                }
                f.push(I);
              }), this.logger.info("Safari12::selected codecs: ".concat(JSON.stringify(f))), h.setCodecPreferences(f), E.next = 12, this.pc.createOffer();
            case 12:
              return g = E.sent, E.next = 15, this.pc.setLocalDescription(g);
            case 15:
              return (s === "audio" || s.kind === "audio") && (k = this.enableStereo, y = this.enableDtx, b = this.enableHighBitrate ? k ? 128e3 : 64e3 : k ? 64e3 : 32e3, g.sdp = g.sdp.replace("minptime=10;useinbandfec=1", "minptime=10;useinbandfec=1;".concat(y ? "usedtx=1;" : "").concat(k ? "stereo=1;sprop-stereo=1;" : "", "maxaveragebitrate=").concat(b))), this.midTransceiverMap.set(h.mid, h), C = /* @__PURE__ */ function() {
                var D = m(/* @__PURE__ */ p().mark(function I(_) {
                  return p().wrap(function(F) {
                    for (; ; )
                      switch (F.prev = F.next) {
                        case 0:
                          return i.logger.debug("Safari12::send() | calling pc.setRemoteDescription() [answer:".concat(JSON.stringify(_), "]")), F.next = 3, i.pc.setRemoteDescription(_);
                        case 3:
                          return F.abrupt("return", h.mid);
                        case 4:
                        case "end":
                          return F.stop();
                      }
                  }, I);
                }));
                return function(_) {
                  return D.apply(this, arguments);
                };
              }(), E.abrupt("return", { offerSdp: g, callback: C, sender: h.sender, mid: h.mid });
            case 19:
            case "end":
              return E.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "addCustomEventListeners", value: function() {
    var r = this;
    this.pc.ondatachannel = function(n) {
      var a = n.channel;
      a.onmessage = /* @__PURE__ */ function() {
        var i = m(/* @__PURE__ */ p().mark(function s(u) {
          var c;
          return p().wrap(function(h) {
            for (; ; )
              switch (h.prev = h.next) {
                case 0:
                  c = String.fromCharCode.apply(String, Se(new Uint8Array(u.data))), r.safeEmit("datachannel", n.channel, c);
                case 2:
                case "end":
                  return h.stop();
              }
          }, s);
        }));
        return function(s) {
          return i.apply(this, arguments);
        };
      }();
    };
  } }], [{ key: "createFactory", value: (
    /**
    * Creates a factory function.
    */
    function(r) {
      return function() {
        return new t(r);
      };
    }
  ) }]);
}(Kp);
function F_(o, t) {
  return typeof o == "undefined" ? t : typeof window != "undefined" && Object.getOwnPropertyDescriptor(window, "structuredClone") ? structuredClone(o) : JSON.parse(JSON.stringify(o));
}
var du = /* @__PURE__ */ S("handler"), ba = /* @__PURE__ */ S("paused"), bt = /* @__PURE__ */ S("closed"), rd = /* @__PURE__ */ S("context"), wt = /* @__PURE__ */ S("metadata"), Xu = /* @__PURE__ */ S("onTrackEnded"), td = /* @__PURE__ */ S("handleTrack"), nd = /* @__PURE__ */ S("destroyTrack"), H_ = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n, a;
    return w(this, t), a = R(this, t, [e]), Object.defineProperty(a, nd, { value: W_ }), Object.defineProperty(a, td, { value: G_ }), Object.defineProperty(a, Xu, { value: q_ }), Object.defineProperty(a, wt, { get: B_, set: void 0 }), a.rtpReceiver = void 0, a.id = void 0, a.localId = void 0, a.producerId = void 0, a.producingTransportId = void 0, a.mimeType = void 0, a.track = void 0, a.peerId = void 0, a.appData = void 0, a.transceiver = void 0, Object.defineProperty(a, du, { writable: !0, value: void 0 }), Object.defineProperty(a, ba, { writable: !0, value: void 0 }), Object.defineProperty(a, bt, { writable: !0, value: void 0 }), Object.defineProperty(a, rd, { writable: !0, value: void 0 }), a.id = r.id, a.localId = r.localId, l(a, du)[du] = r.handler, a.appData = r.appData, a.peerId = r.producingPeerId, a.producingTransportId = r.producingTransportId, l(a, bt)[bt] = !1, a.producerId = r.producerId, a.track = r.track, l(a, ba)[ba] = (n = r.paused) !== null && n !== void 0 ? n : !1, a.mimeType = r.mimeType, a.transceiver = r.transceiver, a.rtpReceiver = r.rtpReceiver, l(a, td)[td](), l(a, rd)[rd] = e, a;
  }
  return A(t, o), P(t, [{
    key: "closed",
    get: function() {
      return l(this, bt)[bt];
    }
    /**
    * Kind of media on to this consumer
    */
  }, {
    key: "kind",
    get: function() {
      return this.track.kind;
    }
    /**
    * Indicates whether the consumer is paused
    */
  }, { key: "paused", get: function() {
    return l(this, ba)[ba];
  } }, {
    key: "close",
    value: (
      /**
      * Closes the Consumer.
      */
      function(r, n) {
        l(this, bt)[bt] || (this.logger.debug("Consumer::close() ".concat(r ? "with reason ".concat(r) : ""), l(this, wt)[wt]), l(this, bt)[bt] = !0, n && (l(this, nd)[nd](), this.transceiver.stop()), this.safeEmit("close", r));
      }
    )
    /**
    * Get associated RTCRtpReceiver stats.
    */
  }, { key: "getStats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (!l(this, bt)[bt]) {
                i.next = 2;
                break;
              }
              throw new kn("closed");
            case 2:
              return i.abrupt("return", l(this, du)[du].getReceiverStats(this.localId));
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "pause",
    value: function() {
      if (this.logger.debug("consumer::pause()", l(this, wt)[wt]), l(this, bt)[bt]) {
        this.logger.error("consumer::pause() | Consumer closed", l(this, wt)[wt]);
        return;
      }
      l(this, ba)[ba] = !0, this.track.enabled = !1, this.safeEmit("pause");
    }
    /**
    * Resumes receiving media.
    */
  }, { key: "resume", value: function() {
    if (this.logger.debug("consumer::resume()", l(this, wt)[wt]), l(this, bt)[bt]) {
      this.logger.error("Consumer::resume() | Consumer closed", l(this, wt)[wt]);
      return;
    }
    l(this, ba)[ba] = !1, this.track.enabled = !0, this.safeEmit("resume");
  } }]);
}(Rc);
function B_() {
  return { consumer: { id: this.id, appData: this.appData, peerId: this.peerId, kind: this.kind } };
}
function q_() {
  this.logger.debug('Consumer::track "ended" event', l(this, wt)[wt]), this.safeEmit("trackended");
}
function G_() {
  this.track.addEventListener("ended", l(this, Xu)[Xu].bind(this));
}
function W_() {
  try {
    this.track.removeEventListener("ended", l(this, Xu)[Xu]), this.track.stop();
  } catch (o) {
    this.logger.error("Consumer::destroyTrack()", $($({}, l(this, wt)[wt]), {}, { error: o }));
  }
}
var ot = /* @__PURE__ */ S("handler"), ms = /* @__PURE__ */ S("stopTracks"), ys = /* @__PURE__ */ S("disableTrackOnPause"), Ta = /* @__PURE__ */ S("zeroRtpOnPause"), Qr = /* @__PURE__ */ S("closed"), Je = /* @__PURE__ */ S("track"), In = /* @__PURE__ */ S("paused"), ks = /* @__PURE__ */ S("maxSpatialLayer"), ad = /* @__PURE__ */ S("context"), Vr = /* @__PURE__ */ S("metadata"), J_ = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n, a, i;
    return w(this, t), i = R(this, t, [e]), Object.defineProperty(i, Vr, { get: K_, set: void 0 }), i.id = void 0, i.localId = void 0, Object.defineProperty(i, ot, { writable: !0, value: void 0 }), i.kind = void 0, i.appData = void 0, i.rtpSender = void 0, Object.defineProperty(i, ms, { writable: !0, value: void 0 }), Object.defineProperty(i, ys, { writable: !0, value: void 0 }), Object.defineProperty(i, Ta, { writable: !0, value: void 0 }), Object.defineProperty(i, Qr, { writable: !0, value: !1 }), Object.defineProperty(i, Je, { writable: !0, value: void 0 }), Object.defineProperty(i, In, { writable: !0, value: void 0 }), Object.defineProperty(i, ks, { writable: !0, value: void 0 }), Object.defineProperty(i, ad, { writable: !0, value: void 0 }), i.id = r.id, i.localId = r.localId, l(i, Je)[Je] = r.track, i.kind = (n = r.track) === null || n === void 0 ? void 0 : n.kind, l(i, In)[In] = r.disableTrackOnPause ? !((a = r.track) !== null && a !== void 0 && a.enabled) : !1, l(i, ks)[ks] = void 0, l(i, ms)[ms] = r.stopTracks, l(i, ys)[ys] = r.disableTrackOnPause, l(i, Ta)[Ta] = r.zeroRtpOnPause, i.appData = r.appData || {}, i._onTrackEnded = i._onTrackEnded.bind(i), l(i, ot)[ot] = r.handler, i.rtpSender = r.rtpSender, i._handleTrack(), l(i, ad)[ad] = e, i;
  }
  return A(t, o), P(t, [{
    key: "closed",
    get: function() {
      return l(this, Qr)[Qr];
    }
    /**
    * The associated track.
    */
  }, {
    key: "track",
    get: function() {
      return l(this, Je)[Je];
    }
    /**
    * Whether the Producer is paused.
    */
  }, {
    key: "paused",
    get: function() {
      return l(this, In)[In];
    }
    /**
    * Max spatial layer.
    *
    * @type {Number | undefined}
    */
  }, { key: "maxSpatialLayer", get: function() {
    return l(this, ks)[ks];
  } }, { key: "close", value: (
    /**
    * Closes the Producer.
    */
    function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i, s, u, c, d;
        return p().wrap(function(v) {
          for (; ; )
            switch (v.prev = v.next) {
              case 0:
                if (!l(this, Qr)[Qr]) {
                  v.next = 2;
                  break;
                }
                return v.abrupt("return");
              case 2:
                if (this.logger.debug("Producer::close() ".concat(a ? "with reason ".concat(a) : ""), l(this, Vr)[Vr]), l(this, Qr)[Qr] = !0, this._destroyTrack(), a !== nc) {
                  v.next = 8;
                  break;
                }
                return this.safeEmit("close", { reason: a }), v.abrupt("return");
              case 8:
                return v.next = 10, l(this, ot)[ot].stopSending(this.localId);
              case 10:
                return i = v.sent, s = i.offerSdp, u = i.callback, v.next = 15, this.safeEmitAsPromise("close", { offer: s, reason: a });
              case 15:
                c = v.sent, d = c.answer, u(d);
              case 18:
              case "end":
                return v.stop();
            }
        }, n, this);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
  ) }, { key: "getStats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (!l(this, Qr)[Qr]) {
                i.next = 2;
                break;
              }
              throw new kn("closed");
            case 2:
              return i.abrupt("return", l(this, ot)[ot].getSenderStats(this.localId));
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "pause",
    value: function() {
      this.logger.debug("Producer::pause()", l(this, Vr)[Vr]), l(this, Qr)[Qr] && this.logger.error("Producer::pause() | Producer closed", l(this, Vr)[Vr]), l(this, In)[In] = !0, l(this, Je)[Je] && l(this, ys)[ys] && (l(this, Je)[Je].enabled = !1), l(this, Ta)[Ta] && l(this, ot)[ot].replaceTrack(this.localId, null), this.emit("pause");
    }
    /**
    * Resumes sending media.
    */
  }, {
    key: "resume",
    value: function() {
      if (this.logger.debug("Producer::resume()", l(this, Vr)[Vr]), l(this, Qr)[Qr]) {
        this.logger.error("Producer::resume() | Producer closed", l(this, Vr)[Vr]);
        return;
      }
      l(this, In)[In] = !1, l(this, Je)[Je] && l(this, ys)[ys] && (l(this, Je)[Je].enabled = !0), l(this, Ta)[Ta] && l(this, ot)[ot].replaceTrack(this.localId, l(this, Je)[Je]), this.emit("resume");
    }
    /**
    * Replaces the current track with a new one or null.
    */
  }, { key: "replaceTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (i = a.track, this.logger.debug("Producer::replaceTrack() trackId: ".concat(i == null ? void 0 : i.id), l(this, Vr)[Vr]), !l(this, Qr)[Qr]) {
                u.next = 7;
                break;
              }
              if (i && l(this, ms)[ms])
                try {
                  i.stop();
                } catch (c) {
                  this.logger.error("Producer::replaceTrack", $($({}, l(this, Vr)[Vr]), {}, { error: c }));
                }
              throw new kn("closed");
            case 7:
              if (!(i && i.readyState === "ended")) {
                u.next = 9;
                break;
              }
              throw new kn("track ended");
            case 9:
              if (i !== l(this, Je)[Je]) {
                u.next = 12;
                break;
              }
              return this.logger.debug("replaceTrack() | same track, ignored trackId: ".concat(i.id), l(this, Vr)[Vr]), u.abrupt("return");
            case 12:
              if (!(!l(this, Ta)[Ta] || !l(this, In)[In])) {
                u.next = 15;
                break;
              }
              return u.next = 15, l(this, ot)[ot].replaceTrack(this.localId, i);
            case 15:
              this._destroyTrack(), l(this, Je)[Je] = i, this._handleTrack();
            case 18:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setMaxSpatialLayer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!l(this, Qr)[Qr]) {
                s.next = 4;
                break;
              }
              throw new kn("closed");
            case 4:
              if (this.kind === "video") {
                s.next = 8;
                break;
              }
              throw new qd("not a video Producer");
            case 8:
              if (typeof a == "number") {
                s.next = 10;
                break;
              }
              throw new TypeError("invalid spatialLayer");
            case 10:
              return s.next = 12, l(this, ot)[ot].setMaxSpatialLayer(this.localId, a);
            case 12:
              l(this, ks)[ks] = a;
            case 13:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setRtpEncodingParameters", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (!l(this, Qr)[Qr]) {
                s.next = 4;
                break;
              }
              throw new kn("closed");
            case 4:
              if (be(a) === "object") {
                s.next = 6;
                break;
              }
              throw new TypeError("invalid params");
            case 6:
              return s.next = 8, l(this, ot)[ot].setRtpEncodingParameters(this.localId, a);
            case 8:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "_onTrackEnded", value: function() {
    this.logger.debug('Producer::track "ended" event trackId: '.concat(this.track.id), l(this, Vr)[Vr]), this.safeEmit("trackended", this.track.id);
  } }, { key: "_handleTrack", value: function() {
    l(this, Je)[Je] && l(this, Je)[Je].addEventListener("ended", this._onTrackEnded);
  } }, { key: "_destroyTrack", value: function() {
    if (l(this, Je)[Je])
      try {
        l(this, Je)[Je].removeEventListener("ended", this._onTrackEnded), l(this, ms)[ms] && l(this, Je)[Je].stop();
      } catch (n) {
        var r;
        this.logger.error("Producer::_destroyTrack trackId: ".concat((r = this.track) === null || r === void 0 ? void 0 : r.id), $($({}, l(this, Vr)[Vr]), {}, { error: n }));
      }
  } }]);
}(Rc);
function K_() {
  return { producer: { id: this.id, appData: this.appData, kind: this.kind } };
}
function Mg(o) {
  return be(o) === "object" && !Array.isArray(o) && o !== null;
}
function zp(o) {
  return Math.random().toString(36).substring(2, 2 + o);
}
var Ac = 1;
function bv(o) {
  var t = o;
  return delete t.payload._bolt, t;
}
function z_(o) {
  return o.payload && Mg(o.payload);
}
function Y_(o) {
  var t, e;
  return z_(o) && (t = (e = o.payload._bolt) === null || e === void 0 ? void 0 : e.id) !== null && t !== void 0 ? t : "";
}
var Mn = /* @__PURE__ */ S("datachannelCache"), id = /* @__PURE__ */ S("context"), wa = /* @__PURE__ */ S("logger"), ll = /* @__PURE__ */ function(o) {
  function t(e, r, n, a) {
    var i;
    return w(this, t), i = R(this, t), i.channel = void 0, i.queue = void 0, i.serverProtocolVersion = void 0, Object.defineProperty(i, Mn, { writable: !0, value: /* @__PURE__ */ new Map() }), Object.defineProperty(i, id, { writable: !0, value: void 0 }), Object.defineProperty(i, wa, { writable: !0, value: void 0 }), i.respond = function(s, u) {
      var c = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1, d;
      c ? d = t.createErrorResponse(s, u) : d = t.createResponse(s, u), i.channel.send(JSON.stringify(d));
    }, i.notify = function(s) {
      var u = t.createNotification(s);
      i.channel.send(JSON.stringify(u));
    }, i.request = /* @__PURE__ */ function() {
      var s = m(/* @__PURE__ */ p().mark(function u(c) {
        var d, h;
        return p().wrap(function(f) {
          for (; ; )
            switch (f.prev = f.next) {
              case 0:
                return d = t.createRequest(c), h = new Promise(function(g, k) {
                  var y = 2e4, b = d.payload._bolt.id, C = { id: b, method: d.type, resolve: function(E) {
                    i.queue.delete(b) && (clearTimeout(C.timer), g(E));
                  }, timer: setTimeout(function() {
                    i.queue.delete(b) && k(new Error("request timeout for message id: ".concat(b)));
                  }, y), cancel: function(E) {
                    i.queue.delete(b) && (clearTimeout(C.timer), k(E));
                  } };
                  i.queue.set(b, C);
                }), i.channel.send(JSON.stringify(d)), f.abrupt("return", h);
              case 4:
              case "end":
                return f.stop();
            }
        }, u);
      }));
      return function(u) {
        return s.apply(this, arguments);
      };
    }(), i.send = function(s) {
      var u = JSON.stringify(s), c = 16384;
      if (u.length > c) {
        for (var d = c - 200, h = Math.ceil(u.length / d), v = [], f = 0; f < h; f += 1) {
          var g = f * d, k = (f + 1) * d;
          v.push(u.slice(g, k));
        }
        for (var y = Js(), b = 0; b < h; b += 1) {
          var C = v[b], T = { id: y, count: h, chunkIndex: b, chunk: C }, E = JSON.stringify(T);
          l(i, wa)[wa].debug("Sending message chunk over dc: ".concat(E)), i.channel.send(E);
        }
      } else
        l(i, wa)[wa].debug("Sending message over dc: ".concat(u)), i.channel.send(u);
    }, i.processMessage = function(s) {
      l(i, Mn)[Mn].has(s.id) || l(i, Mn)[Mn].set(s.id, []);
      var u = l(i, Mn)[Mn].get(s.id);
      if (u[s.chunkIndex] = s, (u == null ? void 0 : u.length) === s.count && !u.some(function(f) {
        return f === void 0;
      })) {
        var c, d = l(i, Mn)[Mn].get(s.id), h = d == null ? void 0 : d.reduce(function(f, g) {
          return f + g.chunk;
        }, "");
        l(i, Mn)[Mn].delete(s.id);
        var v = JSON.parse(h);
        if (!v.payload || !Mg(v.payload))
          throw new Error("corrupted incoming message over dc", { cause: { code: "CORRUPT_DC_MESSAGE", values: v } });
        if (i.processBoltHandshake(v))
          return;
        if (i.serverProtocolVersion = (c = v.payload._bolt) === null || c === void 0 ? void 0 : c.version, !i.processResponseMsg(v))
          return v;
      }
    }, i.processResponseMsg = function(s) {
      var u = s.payload._bolt.id, c = i.queue.get(u);
      return c ? (l(i, wa)[wa].debug("resolving pending request with id: ".concat(u, ", complete response: ").concat(JSON.stringify(s))), s.type === "error" ? c.cancel(bv(s)) : c.resolve(bv(s)), !0) : !1;
    }, i.processBoltHandshake = function(s) {
      if (s.type === "_bolt" || s.type === "handshake") {
        var u, c;
        return i.respond((u = (c = s.payload._bolt) === null || c === void 0 ? void 0 : c.id) !== null && u !== void 0 ? u : zp(8), { type: "_bolt", payload: { message: "pong" } }), !0;
      }
      return !1;
    }, i.label = n, i.transportId = a, l(i, id)[id] = e, l(i, wa)[wa] = e.getValue("logger"), i.channel = r, i.queue = /* @__PURE__ */ new Map(), i;
  }
  return A(t, o), P(t);
}(ht.EventEmitter);
ll.createRequest = function(o) {
  var t;
  if ((t = o.payload) !== null && t !== void 0 && t._bolt)
    throw new Error("rpc fields are internal values");
  return { type: o.type, payload: $($({}, o.payload), {}, { _bolt: { id: zp(8), type: "REQUEST", version: Ac } }) };
};
ll.createResponse = function(o, t) {
  var e;
  if ((e = t.payload) !== null && e !== void 0 && e._bolt)
    throw new Error("rpc fields are internal values");
  return { type: t.type, payload: $($({}, t.payload), {}, { _bolt: { id: o, type: "RESPONSE", version: Ac } }) };
};
ll.createNotification = function(o) {
  var t;
  if ((t = o.payload) !== null && t !== void 0 && t._bolt)
    throw new Error("rpc fields are internal values");
  return { type: o.type, payload: $($({}, o.payload), {}, { bolt: { id: zp(8), type: "NOTIFY", version: Ac } }) };
};
ll.createErrorResponse = function(o, t) {
  return { type: "error", payload: { error: t.message, _bolt: { id: o, type: "RESPONSE", version: Ac } } };
};
var nc = "transport closed", Pa = /* @__PURE__ */ S("context"), Q_ = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n, a, i, s, u = r.id, c = r.direction, d = r.handlerFactory, h = r.iceServers, v = r.iceTransportPolicy, f = r.proprietaryConstraints, g = r.additionalSettings, k = r.appData, y = r.config;
    w(this, t), s = R(this, t, [e]), s.awaitQueue = void 0, s.observer = void 0, s.id = void 0, s.serverId = void 0, s.direction = void 0, s.maxSctpMessageSize = void 0, s.handler = void 0, s.connectionState = "new", s.producers = void 0, s.consumers = void 0, s.datachannels = void 0, s.connected = !1, s.eventsDCReadyPromise = void 0, s.eventsDCReadyPromiseResolver = void 0, s.eventsDCFailureTimer = void 0, s.transportConnectionPromise = void 0, s.consumerTrackEvents = void 0, s.unknownTracksMap = void 0, s.appData = void 0, Object.defineProperty(s, Pa, { writable: !0, value: void 0 }), l(s, Pa)[Pa] = e;
    var b = e.getValue("logger");
    b.debug("constructor() [id: ".concat(u, ", direction: ").concat(c, "]")), s.id = u, s.direction = c;
    var C = F_(g, {});
    return delete C.iceServers, delete C.iceTransportPolicy, delete C.bundlePolicy, delete C.rtcpMuxPolicy, delete C.sdpSemantics, s.producers = /* @__PURE__ */ new Map(), s.consumers = /* @__PURE__ */ new Map(), s.datachannels = /* @__PURE__ */ new Map(), s.consumerTrackEvents = /* @__PURE__ */ new Map(), s.unknownTracksMap = /* @__PURE__ */ new Map(), s.awaitQueue = new Bd(b, !0), s.handler = d(), s.handler.enableHighBitrate = (n = y == null ? void 0 : y.enableHighBitrate) !== null && n !== void 0 ? n : !1, s.handler.enableStereo = (a = y == null ? void 0 : y.enableStereo) !== null && a !== void 0 ? a : !1, s.handler.enableDtx = (i = y == null ? void 0 : y.enableDtx) !== null && i !== void 0 ? i : !0, s.handler.init({ onTrackHandler: s._ontrack.bind(s), direction: c, iceServers: h, iceTransportPolicy: v, additionalSettings: g, proprietaryConstraints: f }), s.appData = k || {}, s.transportConnectionPromise = new Promise(function(T) {
      s.once("connected", function() {
        T(!0);
      }), s.once("disconnect", function() {
        T(!1);
      }), s.once("close", function() {
        T(!1);
      });
    }), s.eventsDCReadyPromise = new Promise(function(T) {
      s.eventsDCReadyPromiseResolver = T;
    }), s.handler.on("@connectionstatechange", function(T) {
      T !== s.connectionState && (s.logger.debug("connection state changed to ".concat(T)), s.connectionState = T, T === "connected" && (s.connected = !0, s.emit("connected")), T === "disconnected" && (s.connected = !1, s.emit("disconnect")), (T === "failed" || T === "closed") && (s.connected = !1, s.emit("close")), s.closed || s.safeEmit("connectionstatechange", T));
    }), s.handler.on("@icecandidate", function(T) {
      var E = T.candidate;
      s.closed || s.safeEmit("icecandidate", E);
    }), s.handler.on("dc_open", function(T) {
      var E = s.datachannels.get(T.label);
      E || (E || (E = new ll(l(s, Pa)[Pa], T, T.label, s.serverId), s.datachannels.set(T.label, E)), s.eventsDCFailureTimer = setTimeout(function() {
        T.label === "events" && (s.eventsDCReadyPromiseResolver(!1), s.safeEmit("dc_error", T.label));
      }, 5e3));
    }), s.handler.on("datachannel", function(T, E) {
      T.label === "events" && (s.eventsDCReadyPromiseResolver(!0), s.eventsDCFailureTimer && clearTimeout(s.eventsDCFailureTimer));
      var D = s.datachannels.get(T.label);
      if (!D) {
        s.logger.error("unregistered datachannel for message", { rtcChannel: { label: T.label, message: E } });
        return;
      }
      try {
        var I = JSON.parse(E);
        s.logger.debug("datachannel message chunk recieved", { dataChannelMessageChunk: { id: I.id, count: I.count, chunkIndex: I.chunkIndex, chunk: I.chunk, transprtId: s.serverId } });
        var _ = D.processMessage(I);
        if (!_)
          return;
        s.logger.debug("datachannel message with id:".concat(I.id, " on transport:").concat(s.serverId, "complete - ").concat(JSON.stringify(_))), s.emit("datachannel:".concat(T.label), D.label, _);
      } catch (V) {
        s.logger.error("error parsing message", { error: V });
      }
    }), s;
  }
  return A(t, o), P(t, [{ key: "closed", get: function() {
    return this.connectionState === "closed";
  } }, { key: "setServerId", value: function(r) {
    this.serverId = r;
  } }, { key: "getDatachannel", value: function(r) {
    return this.datachannels.get(r);
  } }, {
    key: "isEventsDCReady",
    get: function() {
      return this.eventsDCReadyPromise;
    }
    /**
    * Close the Transport.
    */
  }, {
    key: "close",
    value: function() {
      this.closed || (this.logger.debug("Transport close called"), this.connectionState = "closed", this.awaitQueue.stop(), this.awaitQueue = void 0, this.connected = !1, this.handler.close(), Array.from(this.producers.values()).forEach(function(r) {
        r.close(nc).catch(function() {
        });
      }), this.producers.clear(), Array.from(this.consumers.values()).forEach(function(r) {
        r.close(nc);
      }), this.consumers.clear(), this.consumerTrackEvents.clear(), this.emit("close"));
    }
    /**
    * Get associated Transport (RTCPeerConnection) stats.
    *
    * @returns {RTCStatsReport}
    */
  }, { key: "getStats", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (!this.closed) {
                i.next = 2;
                break;
              }
              throw new kn("closed");
            case 2:
              return i.abrupt("return", this.handler.getTransportStats());
            case 3:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, {
    key: "connect",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n(a) {
        var i = this;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                return u.prev = 0, u.next = 3, this.awaitQueue.push(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function c() {
                  var d, h, v, f, g, k;
                  return p().wrap(function(b) {
                    for (; ; )
                      switch (b.prev = b.next) {
                        case 0:
                          return b.next = 2, i.handler.connect();
                        case 2:
                          return d = b.sent, h = d.offerSdp, v = d.callback, b.next = 7, a(h);
                        case 7:
                          return f = b.sent, g = f.transportId, k = f.answer, i.setServerId(g), b.next = 13, v(k);
                        case 13:
                        case "end":
                          return b.stop();
                      }
                  }, c);
                })));
              case 3:
                return u.next = 5, this.transportConnectionPromise;
              case 5:
                if (u.sent) {
                  u.next = 7;
                  break;
                }
                throw new Error("ice connection failed");
              case 7:
                u.next = 13;
                break;
              case 9:
                throw u.prev = 9, u.t0 = u.catch(0), this.logger.error("transport failed to connect:", { error: u.t0 }), u.t0;
              case 13:
              case "end":
                return u.stop();
            }
        }, n, this, [[0, 9]]);
      }));
      function r(n) {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * Restart ICE connection.
    */
  }, { key: "restartIce", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (this.logger.debug("restartIce()"), !this.closed) {
                i.next = 3;
                break;
              }
              throw new kn("closed");
            case 3:
              return i.abrupt("return", this.handler.restartIce());
            case 4:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "canProduce", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (i = a.track, s = a.appData, i) {
                c.next = 5;
                break;
              }
              throw new TypeError("missing track");
            case 5:
              if (this.direction === "send") {
                c.next = 9;
                break;
              }
              throw new qd("not a sending Transport");
            case 9:
              if (i.readyState !== "ended") {
                c.next = 13;
                break;
              }
              throw new kn("track ended");
            case 13:
              if (!(s && be(s) !== "object")) {
                c.next = 15;
                break;
              }
              throw new TypeError("if given, appData must be an object");
            case 15:
              return c.next = 17, this.transportConnectionPromise;
            case 17:
              if (c.sent) {
                c.next = 19;
                break;
              }
              throw new Bs("transport not connected");
            case 19:
              return c.abrupt("return", !0);
            case 20:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "produce", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s = this, u, c, d, h, v, f, g, k, y, b, C, T, E, D, I, _;
      return p().wrap(function(F) {
        for (; ; )
          switch (F.prev = F.next) {
            case 0:
              return F.next = 2, this.canProduce(a);
            case 2:
              if (u = F.sent, u) {
                F.next = 5;
                break;
              }
              throw new Error("Cannot produce");
            case 5:
              return c = a.track, d = a.encodings, h = a.codecOptions, v = a.stopTracks, f = v === void 0 ? !0 : v, g = a.disableTrackOnPause, k = g === void 0 ? !0 : g, y = a.zeroRtpOnPause, b = y === void 0 ? !1 : y, C = a.appData, T = C === void 0 ? {} : C, this.logger.debug("produce() [track:".concat(c.id, "]")), F.next = 9, this.awaitQueue.push(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function N() {
                var L, H, Q, B, G, x, Pe, ie, le;
                return p().wrap(function(Z) {
                  for (; ; )
                    switch (Z.prev = Z.next) {
                      case 0:
                        return Z.next = 2, s.handler.send({ track: c, encodings: d, codecOptions: h, screenShare: T == null ? void 0 : T.screenShare });
                      case 2:
                        return L = Z.sent, H = L.offerSdp, Q = L.callback, B = L.sender, G = L.mid, Z.next = 9, i({ offer: H, kind: c.kind, paused: k ? !c.enabled || Object.hasOwn(c, "fakeTracks") : !1, appData: $($({}, T || {}), {}, { mid: G }), codecOptions: h, producingTransportId: s.serverId });
                      case 9:
                        return x = Z.sent, Pe = x.answer, ie = x.producerId, Z.next = 14, Q(Pe);
                      case 14:
                        return le = Z.sent, Z.abrupt("return", { producerId: ie, localId: le, rtpSender: B });
                      case 16:
                      case "end":
                        return Z.stop();
                    }
                }, N);
              })), "Transport.produce");
            case 9:
              return E = F.sent, D = E.producerId, I = E.localId, _ = E.rtpSender, F.abrupt("return", this.createProducerObject({ id: D, localId: I, track: c, stopTracks: f, disableTrackOnPause: k, zeroRtpOnPause: b, appData: T, handler: this.handler, rtpSender: _ }));
            case 14:
            case "end":
              return F.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "createProducerObject", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return s = new J_(l(this, Pa)[Pa], a), this.producers.set(s.id, s), s.once("close", function() {
                i.producers.delete(s.id);
              }), this.emit("newproducer", s), c.abrupt("return", s);
            case 5:
            case "end":
              return c.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeProducer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.awaitQueue.push(a.close.bind(a), "Transport.closeProducer");
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "canConsume", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n() {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (!this.closed) {
                i.next = 4;
                break;
              }
              throw new kn("closed");
            case 4:
              if (this.direction === "recv") {
                i.next = 6;
                break;
              }
              throw new qd("not a receiving transport");
            case 6:
              return i.next = 8, this.transportConnectionPromise;
            case 8:
              if (i.sent) {
                i.next = 10;
                break;
              }
              throw new Bs("transport not connected");
            case 10:
              return i.abrupt("return", !0);
            case 11:
            case "end":
              return i.stop();
          }
      }, n, this);
    }));
    function r() {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "consume", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u = this;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.abrupt("return", this.awaitQueue.push(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function h() {
                var v, f, g, k, y, b;
                return p().wrap(function(T) {
                  for (; ; )
                    switch (T.prev = T.next) {
                      case 0:
                        return v = {}, T.next = 3, i(a);
                      case 3:
                        if (f = T.sent, g = f.consumerStates, k = f.sessionDescription, y = f.failedProducers, g.forEach(function(E, D) {
                          v[D] = u.createConsumerObjectAndWaitForTrack($($({}, E), {}, { producerId: D }));
                        }), !k) {
                          T.next = 12;
                          break;
                        }
                        return u.logger.info("Session description found, sending negotiation request"), T.next = 12, s(k);
                      case 12:
                        return b = [], T.next = 15, Promise.all(Object.entries(v).map(function(E) {
                          var D = He(E, 2), I = D[0], _ = D[1];
                          return _.then(function(V) {
                            return b.push(V);
                          }).catch(function() {
                            u.logger.error("Failed to create consumer object, producer: ".concat(I), { error: { message: "This should not happen" }, transport: { serverId: u.serverId } });
                          });
                        }));
                      case 15:
                        return T.abrupt("return", { consumers: b, failedProducers: y });
                      case 16:
                      case "end":
                        return T.stop();
                    }
                }, h);
              })), "Transport.consume", { producersLength: a.length }));
            case 1:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeConsumers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              return f.prev = 0, s = a.map(function(g) {
                return g.transceiver.mid;
              }), u = t.parseCodecAndFmtpMappings(this.handler.pc.remoteDescription, s), c = t.parseHeaderExtensionMappings(this.handler.pc.remoteDescription), this.logger.info("Stopping transceivers", { consumerIds: a.map(function(g) {
                var k = g.id;
                return k;
              }) }), a.forEach(function(g) {
                return g.close(void 0, !0);
              }), f.next = 8, this.handler.pc.createOffer();
            case 8:
              return d = f.sent, this.logger.info("Created offer for closing consumers", { sdp: d.sdp }), d = t.setCodecAndFmtpMappings(d, s, u), d = t.setHeaderExtensionMappings(d, c), this.logger.info("Updated codec and fmtp mappings in close consumer offer", { sdp: d.sdp }), f.next = 15, this.setLocalDescription(d);
            case 15:
              return this.logger.info("Successfully set local description in close consumers"), f.next = 18, i(a, d);
            case 18:
              return h = f.sent, this.logger.info("Received answer in close consumers", { sdp: h.sdp }), f.next = 22, this.setRemoteDescription(h);
            case 22:
              this.logger.info("Remote description was set successfully in close consumers", { sdp: h.sdp }), f.next = 28;
              break;
            case 25:
              f.prev = 25, f.t0 = f.catch(0), this.logger.error("Failed to close consumers", { error: f.t0 });
            case 28:
            case "end":
              return f.stop();
          }
      }, n, this, [[0, 25]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setRemoteOffer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.prev = 0, this.logger.info("Received offer from SFU", { sdp: a.sdp }), c.next = 4, this.setRemoteDescription(a);
            case 4:
              return c.next = 6, this.handler.pc.createAnswer();
            case 6:
              return i = c.sent, this.logger.info("Created answer corresponding to received offer", { sdp: i.sdp }), s = Dn.parse(i.sdp), s.media = s.media.map(function(d) {
                if (d.type === "audio") {
                  var h = $({}, d), v = h.fmtp.find(function(g) {
                    return g.payload === 111;
                  });
                  v && (v.config += ";stereo=1;sprop-stereo=1"), h.rtcpFb || (h.rtcpFb = []);
                  var f = h.rtcpFb.some(function(g) {
                    return g.type === "nack";
                  });
                  return f || h.rtcpFb.push({ payload: parseInt(h.payloads, 10), type: "nack" }), h;
                }
                return d;
              }), i.sdp = Dn.write(s), this.logger.info("Setting munged SDP", { sdp: i.sdp }), c.next = 14, this.setLocalDescription(i);
            case 14:
              return this.logger.info("Successfully set local description", { sdp: i.sdp }), c.abrupt("return", i);
            case 18:
              throw c.prev = 18, c.t0 = c.catch(0), this.logger.error("Set remote offer failed", { error: c.t0 }), c.t0;
            case 22:
            case "end":
              return c.stop();
          }
      }, n, this, [[0, 18]]);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "_ontrack", value: function(r) {
    var n = this, a = r.track, i = r.transceiver;
    this.logger.info("track event received [trackId: ".concat(a.id, "] [mid: ").concat(i.mid, "]"));
    var s = "".concat(i.mid, ":").concat(a.kind);
    a.addEventListener("ended", function() {
      n.logger.info("rtc consumer track ended [trackId: ".concat(a.id, "]")), n.unknownTracksMap.delete(s);
    });
    var u = this.consumerTrackEvents.get(s);
    u ? (u(a, i), this.consumerTrackEvents.delete(s)) : (this.logger.warn("track event handler not found ".concat(s)), this.unknownTracksMap.set(s, r));
  } }, { key: "sendErrorOverDC", value: function(r, n, a) {
    var i = this.getDatachannel(r);
    if (!i)
      throw new Error("datachannel not found", { cause: { code: "DC_NOT_FOUND", values: { label: r } } });
    i.respond(n, a, !0);
  } }, { key: "sendResponseOverDC", value: function(r, n, a) {
    var i = this.getDatachannel(r);
    if (!i)
      throw new Error("datachannel not found", { cause: { code: "DC_NOT_FOUND", values: { label: r } } });
    i.respond(n, a);
  } }, { key: "createConsumerObjectAndWaitForTrack", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c, d, h, v, f, g, k, y, b, C;
      return p().wrap(function(E) {
        for (; ; )
          switch (E.prev = E.next) {
            case 0:
              return s = a.consumerId, u = a.producerId, c = a.producingPeerId, d = a.producingTransportId, h = a.streamId, v = a.paused, f = a.screenShare, g = a.appData, k = a.kind, y = a.mimeType, b = "".concat(h, ":").concat(k), C = $($({}, a), {}, { name: "consumer creation task error", message: "consumer creation failed" }), E.abrupt("return", new Promise(/* @__PURE__ */ function() {
                var D = m(/* @__PURE__ */ p().mark(function I(_, V) {
                  var F, N, L;
                  return p().wrap(function(Q) {
                    for (; ; )
                      switch (Q.prev = Q.next) {
                        case 0:
                          F = setTimeout(function() {
                            i.logger.warn("Timed out waiting for track event ".concat(b, " producingPeerId: ").concat(c)), i.consumerTrackEvents.delete(b), C.isTimedout = !0, V(C);
                          }, 5e3), N = function(G, x) {
                            try {
                              if (G.readyState === "ended")
                                clearTimeout(F), V(C);
                              else {
                                var Pe = G;
                                Pe.enabled = !0, i.handler.midTransceiverMap.set(x.mid, x);
                                var ie = new H_(l(i, Pa)[Pa], { id: s, localId: x.mid, transceiver: x, track: Pe, paused: v, producerId: u, producingPeerId: c, producingTransportId: d, handler: i.handler, appData: $($({}, g), {}, { screenShare: f, peerId: c }), rtpReceiver: x.receiver, mimeType: y });
                                i.consumers.set(s, ie), ie.once("close", function() {
                                  i.consumers.delete(ie.id), i.handler.midTransceiverMap.delete(x.mid);
                                }), i.logger.info("consumer created for ", { consumer: { id: s, kind: k, appData: { screenShare: f }, peerId: c, producerId: u } }), i.emit("newconsumer", ie), clearTimeout(F), _(ie);
                              }
                            } catch (le) {
                              i.logger.warn("error while creating consumer:", le), clearTimeout(F), V(C);
                            }
                          }, L = i.unknownTracksMap.get(b), L ? (i.logger.info("track event already received [trackId: ".concat(L.track.id, "] [mid: ").concat(L.transceiver.mid, "]")), i.unknownTracksMap.delete(b), N(L.track, L.transceiver)) : (i.logger.info("Registering onTrack handler for key ".concat(b, " [producingPeerId: ").concat(c, "]")), i.consumerTrackEvents.set(b, N));
                        case 4:
                        case "end":
                          return Q.stop();
                      }
                  }, I);
                }));
                return function(I, _) {
                  return D.apply(this, arguments);
                };
              }()));
            case 4:
            case "end":
              return E.stop();
          }
      }, n);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setRemoteDescription", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, this.handler.pc.setRemoteDescription(a);
            case 2:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "setLocalDescription", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.logger.debug("".concat(this.direction, "() {transportId: ").concat(this.serverId, "} | calling pc.setLocalDescription() [offer:").concat(JSON.stringify(a), "]")), s.next = 3, this.handler.pc.setLocalDescription(a);
            case 3:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "sendDataChannelMessage", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = this.getDatachannel(a), s) {
                d.next = 3;
                break;
              }
              throw D_("DC_NOT_READY", "".concat(a, " datachannel not ready"));
            case 3:
              return d.next = 5, s.request(i);
            case 5:
              return u = d.sent.payload, this.logger.info("sendDataChannelMessage::response ".concat(JSON.stringify(u))), d.abrupt("return", u);
            case 8:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }], [{ key: "parseCodecAndFmtpMappings", value: function(r, n) {
    var a = Dn.parse(r.sdp), i = {};
    return a.media.forEach(function(s) {
      n.includes(s.mid.toString()) && (i[s.mid.toString()] = { rtp: s.rtp, fmtp: s.fmtp, payloads: s.payloads, rtcpFb: s.rtcpFb });
    }), i;
  } }, { key: "setCodecAndFmtpMappings", value: function(r, n, a) {
    var i = Dn.parse(r.sdp);
    i.media = i.media.map(function(u) {
      if (n.includes(u.mid.toString())) {
        var c = $({}, u);
        return c.rtp = a[u.mid.toString()].rtp, c.fmtp = a[u.mid.toString()].fmtp, c.payloads = a[u.mid.toString()].payloads, c.rtcpFb = a[u.mid.toString()].rtcpFb, c;
      }
      return u;
    });
    var s = $($({}, r), {}, { sdp: Dn.write(i) });
    return s;
  } }, { key: "parseHeaderExtensionMappings", value: function(r) {
    var n = Dn.parse(r.sdp), a = {};
    return n.media.forEach(function(i) {
      a[i.mid] = i.ext;
    }), a;
  } }, { key: "setHeaderExtensionMappings", value: function(r, n) {
    var a = Dn.parse(r.sdp);
    a.media = a.media.map(function(s) {
      var u = $({}, s);
      return u.ext = n[s.mid], u;
    });
    var i = $($({}, r), {}, { sdp: Dn.write(a) });
    return i;
  } }]);
}(Rc);
function X_(o) {
  if ((typeof navigator == "undefined" ? "undefined" : be(navigator)) === "object" && navigator.product === "ReactNative") {
    if (typeof RTCPeerConnection == "undefined") {
      o.warn("Device::this._detectDevice() | unsupported ReactNative without RTCPeerConnection");
      return;
    }
    return o.debug("Device::this._detectDevice() | ReactNative handler chosen"), "Chrome74";
  }
  if ((typeof navigator == "undefined" ? "undefined" : be(navigator)) === "object" && typeof navigator.userAgent == "string") {
    var t = navigator.userAgent, e = _v.getParser(t), r = e.getEngine();
    if (e.satisfies({ chrome: ">=74", chromium: ">=74", "microsoft edge": ">=88" }))
      return "Chrome74";
    if (e.satisfies({ chrome: ">=55", chromium: ">=55" }))
      return;
    if (e.satisfies({ firefox: ">=110" }))
      return "Firefox110";
    if (e.satisfies({ firefox: ">=60" }))
      return "Firefox60";
    if (e.satisfies({ ios: { OS: ">=14.3", firefox: ">=30.0" } }) || e.satisfies({ safari: ">=12.0" }) && typeof RTCRtpTransceiver != "undefined" && RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))
      return "Safari12";
    if (e.satisfies({ safari: ">=11" }) || e.satisfies({ "microsoft edge": ">=11" }) && e.satisfies({ "microsoft edge": "<=18" }))
      return;
    if (r.name && r.name.toLowerCase() === "blink") {
      var n = t.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);
      if (n) {
        var a = Number(n[1]);
        return a >= 74 ? "Chrome74" : void 0;
      }
      return "Chrome74";
    }
    if (r.name.toLowerCase() === "webkit" && e.getOS().name.toLowerCase() === "ios")
      return typeof RTCRtpTransceiver != "undefined" && RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection") ? "Safari12" : void 0;
    o.warn("Device::this._detectDevice() | browser not supported");
    return;
  }
  o.warn("Device::this._detectDevice() | unknown device");
}
var Jt = /* @__PURE__ */ S("context"), Sa = /* @__PURE__ */ S("logger"), Z_ = /* @__PURE__ */ function() {
  function o(t) {
    var e = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : {}, r = e.handlerName, n = e.handlerFactory;
    w(this, o), this.handlerFactory = void 0, Object.defineProperty(this, Jt, { writable: !0, value: void 0 }), Object.defineProperty(this, Sa, { writable: !0, value: void 0 });
    var a = t.getValue("logger");
    if (a.debug("constructor()"), l(this, Jt)[Jt] = t, l(this, Sa)[Sa] = a, r && n)
      throw new TypeError("just one of handlerName or handlerInterface can be given");
    if (n)
      this.handlerFactory = n;
    else {
      if (r)
        l(this, Sa)[Sa].debug("Device::constructor() | handler given: ".concat(r));
      else if (r = X_(l(this, Sa)[Sa]), r)
        l(this, Sa)[Sa].debug("Device::constructor() | detected handler: ".concat(r));
      else
        throw new Error("device not supported");
      switch (r) {
        case "Chrome74":
          this.handlerFactory = U_.createFactory(l(this, Jt)[Jt]);
          break;
        case "Safari12":
          this.handlerFactory = j_.createFactory(l(this, Jt)[Jt]);
          break;
        case "Firefox60":
          this.handlerFactory = kv.createFactory(l(this, Jt)[Jt], { supportsSendEncodings: !1 });
          break;
        case "Firefox110":
          this.handlerFactory = kv.createFactory(l(this, Jt)[Jt], { supportsSendEncodings: !0 });
          break;
        default:
          throw new TypeError('unknown handlerName "'.concat(r, '"'));
      }
    }
  }
  return P(o, [{ key: "createTransport", value: function(e) {
    var r = Js(), n = new Q_(l(this, Jt)[Jt], $($({ id: r }, e), {}, { handlerFactory: this.handlerFactory }));
    return n;
  } }]);
}(), x_ = 2e3, qs = /* @__PURE__ */ S("device"), ir = /* @__PURE__ */ S("sendTransport"), sr = /* @__PURE__ */ S("recvTransport"), pu = /* @__PURE__ */ S("sendTransportConnectedCallback"), hu = /* @__PURE__ */ S("recvTransportConnectedCallback"), Ua = /* @__PURE__ */ S("socket"), _s = /* @__PURE__ */ S("socketHandler"), vu = /* @__PURE__ */ S("events"), Qs = /* @__PURE__ */ S("metrics"), Na = /* @__PURE__ */ S("transportDisconnectedTimer"), Et = /* @__PURE__ */ S("iceTransportPolicy"), Ns = /* @__PURE__ */ S("connectionHandler"), fu = /* @__PURE__ */ S("reset"), sd = /* @__PURE__ */ S("createTransports"), gu = /* @__PURE__ */ S("connectTransportWithRetry"), Wd = /* @__PURE__ */ S("connectTransport"), Jd = /* @__PURE__ */ S("createSendTransport"), Kd = /* @__PURE__ */ S("createRecvTransport"), zd = /* @__PURE__ */ S("setTransportEventHandlers"), Yd = /* @__PURE__ */ S("transportConnectionRequest"), Iu = /* @__PURE__ */ S("reconnectTransport"), Zu = /* @__PURE__ */ S("updateTransportState"), eO = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    w(this, t), n = R(this, t), Object.defineProperty(n, Zu, { value: dO }), Object.defineProperty(n, Iu, { value: cO }), Object.defineProperty(n, Yd, { value: lO }), Object.defineProperty(n, zd, { value: uO }), Object.defineProperty(n, Kd, { value: oO }), Object.defineProperty(n, Jd, { value: sO }), Object.defineProperty(n, Wd, { value: iO }), Object.defineProperty(n, gu, { value: aO }), Object.defineProperty(n, sd, { value: nO }), Object.defineProperty(n, fu, { value: tO }), Object.defineProperty(n, Ns, { get: rO, set: void 0 }), n.context = void 0, Object.defineProperty(n, qs, { writable: !0, value: void 0 }), Object.defineProperty(n, ir, { writable: !0, value: void 0 }), Object.defineProperty(n, sr, { writable: !0, value: void 0 }), Object.defineProperty(n, pu, { writable: !0, value: void 0 }), Object.defineProperty(n, hu, { writable: !0, value: void 0 }), Object.defineProperty(n, Ua, { writable: !0, value: void 0 }), Object.defineProperty(n, _s, { writable: !0, value: void 0 }), Object.defineProperty(n, vu, { writable: !0, value: void 0 }), Object.defineProperty(n, Qs, { writable: !0, value: { transportFailureCount: { send: 0, recv: 0 }, lastConnectionTime: 0 } }), Object.defineProperty(n, Na, { writable: !0, value: void 0 }), Object.defineProperty(n, Et, { writable: !0, value: "all" }), n.context = e, l(n, Ua)[Ua] = r, l(n, qs)[qs] = new Z_(e), l(n, _s)[_s] = new V_(r), l(n, vu)[vu] = Vn, l(n, Ns)[Ns].mediaState = { send: { state: Vo.NEW }, recv: { state: Vo.NEW } };
    var a = $o(n.context, "forceRelay");
    return (a || n.context.getValue("flagsmith").hasFeature(me.FORCE_RELAY)) && (l(n, Et)[Et] = "relay"), n.logger.info("ICE Transport Policy initially set to ".concat(l(n, Et)[Et])), l(n, fu)[fu](), n;
  }
  return A(t, o), P(t, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return this.context.getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return this.context.getValue("logger");
  } }, { key: "socket", get: function() {
    return l(this, Ua)[Ua];
  } }, { key: "socketHandler", get: function() {
    return l(this, _s)[_s];
  } }, { key: "sendTransport", get: function() {
    return l(this, ir)[ir];
  } }, { key: "recvTransport", get: function() {
    return l(this, sr)[sr];
  } }, { key: "events", get: function() {
    return l(this, vu)[vu];
  } }, { key: "sendTransportConnectedCallback", set: function(r) {
    l(this, pu)[pu] = r;
  } }, { key: "recvTransportConnectedCallback", set: function(r) {
    l(this, hu)[hu] = r;
  } }, { key: "setupTransports", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return d.next = 2, l(this, sd)[sd](a);
            case 2:
              return a.send && (s = l(this, gu)[gu](l(this, ir)[ir]).then(function(h) {
                try {
                  l(i, pu)[pu](h);
                } catch (v) {
                  i.logger.error("Failed to run send transport callback");
                }
              })), a.recv && (u = l(this, gu)[gu](l(this, sr)[sr]).then(function(h) {
                try {
                  l(i, hu)[hu](h);
                } catch (v) {
                  i.logger.error("Failed to run recv transport callback");
                }
              })), d.next = 6, Promise.all([s, u]);
            case 6:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "stopTransports", value: function(r) {
    if (r.send && this.sendTransport !== void 0) {
      var n = l(this, ir)[ir], a = n.id, i = n.serverId, s = n.direction;
      this.logger.info("Closing send transport", { transport: { id: a, serverId: i, type: s } }), l(this, ir)[ir].close(), l(this, ir)[ir].removeAllListeners(), l(this, ir)[ir] = void 0;
    }
    if (r.recv && this.recvTransport !== void 0) {
      var u, c, d = l(this, sr)[sr], h = d.id, v = d.serverId, f = d.direction;
      this.logger.info("Closing recv transport", { transport: { id: h, serverId: v, type: f } }), (u = l(this, sr)[sr]) === null || u === void 0 || u.close(), (c = l(this, sr)[sr]) === null || c === void 0 || c.removeAllListeners(), l(this, sr)[sr] = void 0;
    }
    l(this, fu)[fu]();
  } }, { key: "stopAllTransports", value: function() {
    this.logger.info("Closing all transports"), this.stopTransports({ send: !0, recv: !0 });
  } }, { key: "handleErrors", value: (
    // eslint-disable-next-line class-methods-use-this, @typescript-eslint/no-unused-vars
    function(r) {
      throw new Error("Method not implemented.");
    }
  ) }]);
}(ht.EventEmitter);
function rO() {
  return this.context.getValue("connectionHandler");
}
function tO() {
  l(this, Na)[Na] = { send: void 0, recv: void 0 };
}
function nO(o) {
  return Qd.apply(this, arguments);
}
function Qd() {
  return Qd = m(/* @__PURE__ */ p().mark(function o(t) {
    var e = this, r, n, a, i, s, u, c, d, h, v;
    return p().wrap(function(g) {
      for (; ; )
        switch (g.prev = g.next) {
          case 0:
            return r = $o(this.context, "forceRelay"), (r || this.context.getValue("flagsmith").hasFeature(me.FORCE_RELAY)) && (l(this, Et)[Et] = "relay"), this.logger.info("ICE Transport Policy set to ".concat(l(this, Et)[Et])), n = pt(), g.next = 6, n.getICEServers().catch(function(k) {
              return e.logger.warn("failed to get iceservers from server: ".concat(k.message)), [];
            });
          case 6:
            a = g.sent, t.send && (h = this.context.getValue("flagsmith").hasFeature(me.DISABLE_OPUS_DTX_CF), l(this, Jd)[Jd]({ iceServers: a, additionalSettings: { encodedInsertableStreams: (i = this.context.getValue("modules").e2ee) === null || i === void 0 ? void 0 : i.enabled }, config: { enableHighBitrate: (s = (u = this.context.getValue("defaults").mediaConfiguration) === null || u === void 0 || (u = u.audio) === null || u === void 0 ? void 0 : u.enableHighBitrate) !== null && s !== void 0 ? s : !1, enableStereo: (c = (d = this.context.getValue("defaults").mediaConfiguration) === null || d === void 0 || (d = d.audio) === null || d === void 0 ? void 0 : d.enableStereo) !== null && c !== void 0 ? c : !1, enableDtx: !!h }, iceTransportPolicy: l(this, Et)[Et] })), t.recv && l(this, Kd)[Kd]({ iceServers: a, additionalSettings: { encodedInsertableStreams: (v = this.context.getValue("modules").e2ee) === null || v === void 0 ? void 0 : v.enabled }, iceTransportPolicy: l(this, Et)[Et] });
          case 9:
          case "end":
            return g.stop();
        }
    }, o, this);
  })), Qd.apply(this, arguments);
}
function aO(o) {
  return Xd.apply(this, arguments);
}
function Xd() {
  return Xd = m(/* @__PURE__ */ p().mark(function o(t) {
    var e = this, r, n, a, i;
    return p().wrap(function(u) {
      for (; ; )
        switch (u.prev = u.next) {
          case 0:
            return r = t.id, n = t.serverId, a = t.direction, l(this, zd)[zd](t), u.prev = 2, i = 1 / 0, u.next = 6, Ig(/* @__PURE__ */ function() {
              var c = m(/* @__PURE__ */ p().mark(function d(h, v) {
                return p().wrap(function(g) {
                  for (; ; )
                    switch (g.prev = g.next) {
                      case 0:
                        if (h > 0 && e.logger.debug("Retrying transport connect, count: ".concat(h), { transport: { id: r, serverId: n, type: a } }), g.prev = 1, !t.closed) {
                          g.next = 4;
                          break;
                        }
                        throw new Bs("Cannot reconnect closed transport");
                      case 4:
                        return g.next = 6, l(e, Wd)[Wd](t);
                      case 6:
                        g.next = 15;
                        break;
                      case 8:
                        if (g.prev = 8, g.t0 = g.catch(1), !(g.t0 instanceof Bs)) {
                          g.next = 13;
                          break;
                        }
                        return v(g.t0), g.abrupt("return");
                      case 13:
                        throw e.logger.error("Failed to connect transport, retrying", { transport: t, error: g.t0 }), g.t0;
                      case 15:
                      case "end":
                        return g.stop();
                    }
                }, d, null, [[1, 8]]);
              }));
              return function(d, h) {
                return c.apply(this, arguments);
              };
            }(), { delayTime: 100, strategy: "exponential", maxRetryCount: i });
          case 6:
            return u.abrupt("return", t);
          case 9:
            throw u.prev = 9, u.t0 = u.catch(2), this.logger.error("Failed to connect send transport after retry: ".concat(t.id), { error: u.t0, transport: { id: r, serverId: n, type: a } }), t.close(), t.removeAllListeners(), u.t0;
          case 15:
          case "end":
            return u.stop();
        }
    }, o, this, [[2, 9]]);
  })), Xd.apply(this, arguments);
}
function iO(o) {
  return Zd.apply(this, arguments);
}
function Zd() {
  return Zd = m(/* @__PURE__ */ p().mark(function o(t) {
    var e = this, r, n;
    return p().wrap(function(i) {
      for (; ; )
        switch (i.prev = i.next) {
          case 0:
            if (r = t.id, n = t.direction, this.logger.info("Connecting ".concat(n, " transport"), { transport: { id: r, type: n } }), l(this, Ua)[Ua].isConnected) {
              i.next = 4;
              break;
            }
            throw new Bs("Socket is not connected");
          case 4:
            if (t.connectionState !== "closed") {
              i.next = 6;
              break;
            }
            throw new Bs("Transport is closed");
          case 6:
            return i.prev = 6, i.next = 9, t.connect(function(s) {
              return l(e, Yd)[Yd](n, s);
            });
          case 9:
            this.logger.info("Connected ".concat(n, " transport"), { transport: { id: r, serverId: t.serverId, type: n } }), i.next = 18;
            break;
          case 12:
            if (i.prev = 12, i.t0 = i.catch(6), l(this, Qs)[Qs].transportFailureCount[n] += 1, i.t0.message !== "ice connection failed") {
              i.next = 17;
              break;
            }
            throw new Bs(i.t0.message);
          case 17:
            throw i.t0;
          case 18:
          case "end":
            return i.stop();
        }
    }, o, this, [[6, 12]]);
  })), Zd.apply(this, arguments);
}
function sO(o) {
  if (l(this, ir)[ir] && l(this, ir)[ir].connected) {
    var t, e;
    this.logger.info("Transport send is already connected", { transport: { id: (t = l(this, ir)[ir]) === null || t === void 0 ? void 0 : t.id, serverId: (e = l(this, ir)[ir]) === null || e === void 0 ? void 0 : e.serverId, type: "send" } });
    return;
  }
  l(this, ir)[ir] = l(this, qs)[qs].createTransport($($({}, o), {}, { direction: "send" })), this.context.getValue("callstats").configureSendTransport(l(this, ir)[ir]);
}
function oO(o) {
  if (l(this, sr)[sr] && l(this, sr)[sr].connected) {
    var t, e;
    this.logger.info("Transport recv is already connected", { transport: { id: (t = l(this, sr)[sr]) === null || t === void 0 ? void 0 : t.id, serverId: (e = l(this, sr)[sr]) === null || e === void 0 ? void 0 : e.serverId, type: "recv" } });
    return;
  }
  l(this, sr)[sr] = l(this, qs)[qs].createTransport($($({}, o), {}, { direction: "recv" })), this.context.getValue("callstats").configureRecvTransport(l(this, sr)[sr]);
}
function uO(o) {
  var t = this, e = o.direction, r = o.id;
  o.on("connectionstatechange", /* @__PURE__ */ function() {
    var n = m(/* @__PURE__ */ p().mark(function a(i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              l(t, Zu)[Zu]({ state: i, direction: e }), t.logger.info("Transport connection state changed for ".concat(e, " transport"), { transport: { id: r, serverId: o.serverId, type: e, status: i } }), s = function() {
                var h = l(t, Na)[Na][e];
                h !== void 0 && (clearTimeout(h), l(t, Na)[Na][e] = void 0);
              }, c.t0 = i, c.next = c.t0 === "connected" ? 6 : c.t0 === "disconnected" ? 9 : c.t0 === "failed" ? 11 : 18;
              break;
            case 6:
              return s(), l(t, Qs)[Qs].lastConnectionTime = performance.now(), c.abrupt("break", 18);
            case 9:
              return l(t, Na)[Na][e] = setTimeout(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function d() {
                return p().wrap(function(v) {
                  for (; ; )
                    switch (v.prev = v.next) {
                      case 0:
                        return t.logger.warn("".concat(e, " transport is in disconnected state, reconnecting transport"), { transport: { id: r, serverId: o.serverId, type: e } }), v.next = 3, l(t, Iu)[Iu](o.direction);
                      case 3:
                      case "end":
                        return v.stop();
                    }
                }, d);
              })), x_), c.abrupt("break", 18);
            case 11:
              if (!o.closed) {
                c.next = 13;
                break;
              }
              return c.abrupt("return");
            case 13:
              return s(), t.logger.warn("".concat(e, " transport is in failed state, reconnecting transport"), { transport: { id: r, serverId: o.serverId, type: e } }), c.next = 17, l(t, Iu)[Iu](o.direction);
            case 17:
              return c.abrupt("break", 18);
            case 18:
            case "end":
              return c.stop();
          }
      }, a);
    }));
    return function(a) {
      return n.apply(this, arguments);
    };
  }()), o.on("icecandidate", /* @__PURE__ */ function() {
    var n = m(/* @__PURE__ */ p().mark(function a(i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              t.logger.debug("Sending iceCandidate:", { iceCandidate: i });
            case 1:
            case "end":
              return u.stop();
          }
      }, a);
    }));
    return function(a) {
      return n.apply(this, arguments);
    };
  }()), o.on("datachannel:events", /* @__PURE__ */ function() {
    var n = m(/* @__PURE__ */ p().mark(function a(i, s) {
      var u, c, d;
      return p().wrap(function(v) {
        for (; ; )
          switch (v.prev = v.next) {
            case 0:
              t.logger.debug("Got data channel message on event:", { rtcChannel: { label: i, message: s } }), v.prev = 1, v.t0 = s.type, v.next = v.t0 === "handshake" ? 5 : v.t0 === "hub-disconnect" ? 8 : v.t0 === "error" ? 11 : 12;
              break;
            case 5:
              return u = { type: "handshake", payload: { message: "pong" } }, o.sendResponseOverDC(i, Y_(s), u), v.abrupt("break", 13);
            case 8:
              return t.logger.debug("media hub disconnected, full_reconnect: ".concat((c = s.payload) === null || c === void 0 ? void 0 : c.full_reconnect)), ((d = s.payload) === null || d === void 0 ? void 0 : d.full_reconnect) === !0 && t.handleErrors("rejoin"), v.abrupt("break", 13);
            case 11:
              return v.abrupt("break", 13);
            case 12:
              return v.abrupt("break", 13);
            case 13:
              v.next = 18;
              break;
            case 15:
              v.prev = 15, v.t1 = v.catch(1), t.logger.error("Unable to handle the incoming datachannel message on channel ".concat(i));
            case 18:
            case "end":
              return v.stop();
          }
      }, a, null, [[1, 15]]);
    }));
    return function(a, i) {
      return n.apply(this, arguments);
    };
  }()), o.on("dc_error", function() {
    o.direction === "recv" && (t.logger.warn("Events datachannel did not open in 5s", { country: O.location.country }), t.handleErrors("reconnectRecvTransport"));
  });
}
function lO(o, t) {
  return xd.apply(this, arguments);
}
function xd() {
  return xd = m(/* @__PURE__ */ p().mark(function o(t, e) {
    var r, n, a, i;
    return p().wrap(function(u) {
      for (; ; )
        switch (u.prev = u.next) {
          case 0:
            return r = t === "recv", u.prev = 1, n = e.sdp, a = e.type, i = { consuming: r, description: { sdp: n, type: a, target: r ? qa.SUBSCRIBER : qa.PUBLISHER }, producers: [] }, u.abrupt("return", l(this, _s)[_s].connectTransport(i));
          case 7:
            throw u.prev = 7, u.t0 = u.catch(1), this.logger.error("Error in ".concat(t, " transport connection:"), { error: u.t0, country: O.location.country }), u.t0;
          case 11:
          case "end":
            return u.stop();
        }
    }, o, this, [[1, 7]]);
  })), xd.apply(this, arguments);
}
function cO(o) {
  return ep.apply(this, arguments);
}
function ep() {
  return ep = m(/* @__PURE__ */ p().mark(function o(t) {
    var e;
    return p().wrap(function(n) {
      for (; ; )
        switch (n.prev = n.next) {
          case 0:
            return this.logger.info("Called reconnect transport", { transport: { type: t } }), this.stopTransports({ [t]: !0 }), e = this.context.getValue("flagsmith").hasFeature(me.CF_TRANSPORT_FORCE_RELAY_ON_ICE_FAILED), e && l(this, Ua)[Ua].isConnected && l(this, Qs)[Qs].transportFailureCount[t] > 2 && (this.logger.warn("Multiple disconnections in ".concat(t, " transport, forcing relay")), l(this, Et)[Et] = "relay"), n.next = 6, this.setupTransports({ [t]: !0 });
          case 6:
            n.t0 = t, n.next = n.t0 === "send" ? 9 : n.t0 === "recv" ? 12 : 15;
            break;
          case 9:
            return this.logger.info("Transport reconnected", { transport: l(this, ir)[ir] }), this.context.getValue("peerSessionStore").emit(j.RESET_PRODUCER_STATE), n.abrupt("break", 16);
          case 12:
            return this.logger.info("Transport reconnected", { transport: l(this, sr)[sr] }), this.context.getValue("peerSessionStore").emit(j.UPDATE_ACTIVE, { createAllConsumers: !0 }), n.abrupt("break", 16);
          case 15:
            this.logger.warn("Unknown transport direction", { transport: { type: t } });
          case 16:
            l(this, Zu)[Zu]({ state: Vo.CONNECTED, direction: t });
          case 17:
          case "end":
            return n.stop();
        }
    }, o, this);
  })), ep.apply(this, arguments);
}
function dO(o) {
  var t = o.state, e = o.direction;
  l(this, Ns)[Ns].mediaState[e] = { state: t }, this.context.getValue("peerSessionStore").emit(j.TRANSPORT_STATE_UPDATE, $({ transport: e }, l(this, Ns)[Ns].mediaState[e]));
}
var mu = /* @__PURE__ */ S("context"), Xr = /* @__PURE__ */ S("logger"), pO = /* @__PURE__ */ function() {
  function o(t, e, r, n, a) {
    w(this, o), Object.defineProperty(this, mu, { writable: !0, value: void 0 }), Object.defineProperty(this, Xr, { writable: !0, value: void 0 }), this.events = e, this.recvTransport = r, this.socket = n, this.socketHandler = a, l(this, mu)[mu] = t, l(this, Xr)[Xr] = t.getValue("logger");
  }
  return P(o, [{ key: "create", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i, s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              if (!(!n || n && n.length === 0)) {
                f.next = 2;
                break;
              }
              throw new Error("List of producers is required");
            case 2:
              return i = /* @__PURE__ */ new Map(), s = [], n.forEach(function(g) {
                var k = g.producingPeerId, y = g.producerId, b = g.producingTransportId, C = l(a, mu)[mu].getValue("flagsmith").hasFeature(me.ENABLE_CF_SIMULCAST) ? { simulcast: { preferredRid: "h", priorityOrdering: "asciibetical", ridNotAvailable: "asciibetical" } } : {};
                i.set(y, k), s.push($({ producingPeerId: k, producerId: y, producingTransportId: b }, C));
              }), f.next = 7, this.socketHandler.consume({ requests: s, consumingTransportId: this.recvTransport.serverId });
            case 7:
              return u = f.sent, c = /* @__PURE__ */ new Map(), n.forEach(function(g) {
                return c.set(g.producerId, g);
              }), d = /* @__PURE__ */ new Map(), h = [], Object.entries(u.consumerStateMap).forEach(function(g) {
                var k = He(g, 2), y = k[0], b = k[1], C = c.get(y);
                if (C) {
                  if (b.errorCode) {
                    l(a, Xr)[Xr].warn("Consumer request failed for producer ".concat(y), { error: { message: b.errorCode } }), h.push($($({}, C), {}, { errorCode: b.errorCode }));
                    return;
                  }
                  var T = {};
                  try {
                    T = JSON.parse(b.producerState.appData);
                  } catch (E) {
                  }
                  d.set(y, { consumerId: b.consumerId, producingTransportId: C.producingTransportId, producingPeerId: C.producingPeerId, kind: C.kind, paused: C.pause, streamId: b.producerTrack.streamId, trackId: b.producerTrack.trackId, screenShare: C.screenShare, mimeType: C.mimeType, appData: T });
                }
              }), f.abrupt("return", { consumerStates: d, sessionDescription: u.sessionDescription, failedProducers: h });
            case 14:
            case "end":
              return f.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "negotiate", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.prev = 0, l(this, Xr)[Xr].info("Negotiating socket consumer", { transport: this.recvTransport }), l(this, Xr)[Xr].debug("setting remote offer: ".concat(JSON.stringify(n), " on recvTransport"), { transport: this.recvTransport }), u.next = 5, this.recvTransport.setRemoteOffer(n);
            case 5:
              return a = u.sent, i = { transportId: this.recvTransport.serverId, description: { sdp: a.sdp, type: a.type, target: qa.SUBSCRIBER } }, l(this, Xr)[Xr].debug("sending renegotiate request: ".concat(JSON.stringify(i), " on recvTransport"), { transport: this.recvTransport }), u.next = 10, this.socket.sendMessagePromise(this.events.renegotiateSessionDescription, YP.toBinary(i));
            case 10:
              return l(this, Xr)[Xr].info("Renegotiation done", { transport: this.recvTransport }), u.abrupt("return", a);
            case 14:
              return u.prev = 14, u.t0 = u.catch(0), l(this, Xr)[Xr].error("Failed to renegotiate", { error: u.t0 }), u.abrupt("return", void 0);
            case 18:
            case "end":
              return u.stop();
          }
      }, r, this, [[0, 14]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "close", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (n.length) {
                u.next = 2;
                break;
              }
              return u.abrupt("return", {});
            case 2:
              return i = /* @__PURE__ */ function() {
                var c = m(/* @__PURE__ */ p().mark(function d(h, v) {
                  var f, g, k, y;
                  return p().wrap(function(C) {
                    for (; ; )
                      switch (C.prev = C.next) {
                        case 0:
                          return f = h.map(function(T) {
                            return T.localId;
                          }), l(a, Xr)[Xr].info("Closing consumers: ".concat(JSON.stringify(f))), g = { description: { sdp: v.sdp, type: v.type, target: qa.SUBSCRIBER }, consumerIds: f, consumingTransportId: a.recvTransport.serverId }, C.next = 5, a.socketHandler.closeConsumer(g);
                        case 5:
                          return k = C.sent, y = wE.fromBinary(k).description, C.abrupt("return", { sdp: y.sdp, type: y.type });
                        case 8:
                        case "end":
                          return C.stop();
                      }
                  }, d);
                }));
                return function(h, v) {
                  return c.apply(this, arguments);
                };
              }(), u.next = 5, this.recvTransport.awaitQueue.push(function() {
                return a.recvTransport.closeConsumers(n, i);
              }, "ConsumerStrategy.close", { consumersLength: n.length });
            case 5:
              return u.abrupt("return", {});
            case 6:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "switchConsumersToLayer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = { requests: [], consumingTransportId: this.recvTransport.serverId }, s = n.filter(function(d) {
                return d && d.id;
              }), s.forEach(function(d) {
                var h = d.id, v = d.producingTransportId, f = d.localId;
                i.requests.push({ producerId: h, producingTransportId: v, mid: f, simulcast: { preferredRid: a === 0 ? "q" : "h", priorityOrdering: "asciibetical", ridNotAvailable: "asciibetical" } });
              }), c.next = 5, this.socketHandler.updateConsumersSimulcastConfig(i);
            case 5:
              l(this, Xr)[Xr].info("Consumers switched layers to ".concat(a), { consumerIds: s == null ? void 0 : s.map(function(d) {
                var h = d.id;
                return h;
              }) });
            case 6:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), hO = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.socketHandler = t;
  }
  return P(o, [{ key: "create", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k, y, b;
      return p().wrap(function(T) {
        for (; ; )
          switch (T.prev = T.next) {
            case 0:
              return s = n.offer, u = n.kind, c = n.paused, d = n.appData, h = n.codecOptions, v = n.producingTransportId, f = o.getMSIDFromSDP(s.sdp, u), g = { description: { sdp: s.sdp, type: s.type, target: qa.PUBLISHER }, paused: c, kind: u, msid: f, appData: JSON.stringify(d), screenShare: (a = d.screenShare) !== null && a !== void 0 ? a : !1, mimeType: "".concat(u, "/").concat((i = h[0]) === null || i === void 0 ? void 0 : i.name), producingTransportId: v }, T.next = 5, this.socketHandler.produce(g);
            case 5:
              return k = T.sent, y = k.answer, b = k.producerId, T.abrupt("return", { answer: y, producerId: b });
            case 9:
            case "end":
              return T.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }], [{ key: "getMSIDFromSDP", value: function(e, r) {
    var n = Dn.parse(e), a = n.media.filter(function(i) {
      return r === "video" ? i.type === "video" : i.type === "audio";
    }).at(-1).msid;
    return a;
  } }]);
}(), Da = /* @__PURE__ */ S("producers"), $n = /* @__PURE__ */ S("consumers"), bs = /* @__PURE__ */ S("producerIdToConsumerIdMap"), $u = /* @__PURE__ */ S("producerStrategy"), St = /* @__PURE__ */ S("consumerStrategy"), od = /* @__PURE__ */ S("metrics"), rn = /* @__PURE__ */ S("producersToConsume"), Os = /* @__PURE__ */ S("processConsumerTimeout"), Nu = /* @__PURE__ */ S("processConsumers"), ud = /* @__PURE__ */ S("producerCreationRequest"), ld = /* @__PURE__ */ S("handleProducer"), rp = /* @__PURE__ */ S("consumerCreationRequest"), tp = /* @__PURE__ */ S("handleConsumer"), vO = /* @__PURE__ */ function(o) {
  function t(e, r) {
    var n;
    return w(this, t), n = R(this, t, [e, r]), Object.defineProperty(n, tp, { value: kO }), Object.defineProperty(n, rp, { value: yO }), Object.defineProperty(n, ld, { value: mO }), Object.defineProperty(n, ud, { value: gO }), Object.defineProperty(n, Nu, { value: fO }), Object.defineProperty(n, Da, { writable: !0, value: void 0 }), Object.defineProperty(n, $n, { writable: !0, value: void 0 }), Object.defineProperty(n, bs, { writable: !0, value: void 0 }), Object.defineProperty(n, $u, { writable: !0, value: void 0 }), Object.defineProperty(n, St, { writable: !0, value: void 0 }), Object.defineProperty(n, od, { writable: !0, value: { producerCreationFailureCount: 0, consumerCreationFailureCount: 0, producerNotReadyFailureCount: 0 } }), Object.defineProperty(n, rn, { writable: !0, value: [] }), Object.defineProperty(n, Os, { writable: !0, value: void 0 }), n.context = e, n.sendTransportConnectedCallback = /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function a() {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              l(n, $u)[$u] = new hO(n.socketHandler);
            case 1:
            case "end":
              return s.stop();
          }
      }, a);
    })), n.recvTransportConnectedCallback = /* @__PURE__ */ function() {
      var a = m(/* @__PURE__ */ p().mark(function i(s) {
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                l(n, bs)[bs].clear(), l(n, St)[St] = new pO(n.context, n.events, s, n.socket, n.socketHandler);
              case 2:
              case "end":
                return c.stop();
            }
        }, i);
      }));
      return function(i) {
        return a.apply(this, arguments);
      };
    }(), n.reset(), n;
  }
  return A(t, o), P(t, [{ key: "socketHandler", get: function() {
    return Re(t, "socketHandler", this, 1);
  } }, { key: "producers", get: function() {
    return l(this, Da)[Da];
  } }, { key: "consumers", get: function() {
    return l(this, $n)[$n];
  } }, {
    key: "producerIdToConsumerIdMap",
    get: function() {
      return l(this, bs)[bs];
    }
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return this.context.getValue("logger");
  } }, { key: "reset", value: function() {
    l(this, Da)[Da] = /* @__PURE__ */ new Map(), l(this, $n)[$n] = /* @__PURE__ */ new Map(), l(this, bs)[bs] = /* @__PURE__ */ new Map();
  } }, { key: "createProducer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (!(!this.sendTransport || this.sendTransport.closed)) {
                d.next = 2;
                break;
              }
              throw new Error("Send transport is closed");
            case 2:
              return d.prev = 2, d.next = 5, this.sendTransport.produce(a, l(this, ud)[ud].bind(this));
            case 5:
              return u = d.sent, (s = a.appData) !== null && s !== void 0 && s.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_ACTIVE_PRODUCER, u), l(this, ld)[ld](u, i), d.abrupt("return", u);
            case 11:
              throw d.prev = 11, d.t0 = d.catch(2), this.logger.error("Failed to create producer", { error: d.t0 }), l(this, od)[od].producerCreationFailureCount += 1, d.t0;
            case 16:
            case "end":
              return d.stop();
          }
      }, n, this, [[2, 11]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeProducer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (s = this.producers.get(a), s) {
                d.next = 4;
                break;
              }
              return this.logger.warn("Producer with ID ".concat(a, " was not found")), d.abrupt("return");
            case 4:
              return i != null && i.stopTrack && s.track.stop(), d.prev = 5, d.next = 8, this.sendTransport.closeProducer(s);
            case 8:
              (u = this.context.getValue("modules").e2ee) !== null && u !== void 0 && u.enabled && this.context.getValue("peerSessionStore").emit(j.E2EE_INACTIVE_PRODUCER, s), d.next = 14;
              break;
            case 11:
              d.prev = 11, d.t0 = d.catch(5), this.logger.error("Failed to close producer on server", { error: d.t0, producer: s });
            case 14:
            case "end":
              return d.stop();
          }
      }, n, this, [[5, 11]]);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeAllProducers", value: function() {
    return Promise.all(Array.from(l(this, Da)[Da].entries()).map(function(r) {
      var n = He(r, 2), a = n[1];
      return a.close();
    }));
  } }, { key: "createConsumer", value: function(r) {
    return this.createConsumers([r]);
  } }, { key: "createConsumers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return l(this, Os)[Os] || clearTimeout(l(this, Os)[Os]), l(this, rn)[rn] = l(this, rn)[rn].concat(a), s.next = 4, l(this, Nu)[Nu]();
            case 4:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeConsumer", value: function(r) {
    return this.closeConsumers([r]);
  } }, { key: "closeConsumers", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (l(this, St)[St]) {
                h.next = 2;
                break;
              }
              return h.abrupt("return");
            case 2:
              if (s = a.map(function(v) {
                return i.consumers.get(v);
              }).filter(function(v) {
                return v !== void 0;
              }), s.length !== 0) {
                h.next = 5;
                break;
              }
              return h.abrupt("return");
            case 5:
              return h.next = 7, l(this, St)[St].close(s);
            case 7:
              u = h.sent, c = u.failedConsumers, c != null && c.length && this.logger.warn("Failed to close some consumers", { consumerIds: c });
            case 10:
            case "end":
              return h.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "closeAllConsumers", value: function() {
    return this.closeConsumers(Array.from(l(this, $n)[$n].keys()));
  } }, { key: "switchConsumersToLayer", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i) {
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              l(this, St)[St].switchConsumersToLayer(a, i);
            case 1:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n, a) {
      return e.apply(this, arguments);
    }
    return r;
  }() }]);
}(eO);
function fO() {
  return np.apply(this, arguments);
}
function np() {
  return np = m(/* @__PURE__ */ p().mark(function o() {
    var t = this, e, r, n, a, i, s, u, c;
    return p().wrap(function(h) {
      for (; ; )
        switch (h.prev = h.next) {
          case 0:
            if (!(!this.recvTransport || this.recvTransport.closed)) {
              h.next = 2;
              break;
            }
            throw new Error("Recv transport is closed");
          case 2:
            if (e = 500, r = l(this, rn)[rn].splice(0, l(this, rn)[rn].length), h.prev = 4, n = new Set(Array.from(this.consumers.values()).map(function(v) {
              var f = v.producerId;
              return f;
            })), a = r.filter(function(v) {
              var f = v.producerId;
              return !t.producers.get(f) && !n.has(f);
            }), a.length !== 0) {
              h.next = 9;
              break;
            }
            return h.abrupt("return");
          case 9:
            return h.next = 11, this.recvTransport.consume(a, l(this, rp)[rp].bind(this), l(this, St)[St].negotiate.bind(l(this, St)[St]));
          case 11:
            i = h.sent, s = i.consumers, u = i.failedProducers, s.forEach(l(this, tp)[tp].bind(this)), u != null && u.length && (this.logger.error("Failed to create consumers for producers", { producers: u }), c = u.filter(function(v) {
              var f = v.errorCode, g = v.producerId;
              return f === "not_found_track_error" ? (t.logger.error("Track not found for producer: ".concat(g, ". This will not be retried.")), !1) : f === "backend_error" ? (t.logger.error("Unrecoverable error: backend error"), !1) : !0;
            }), l(this, rn)[rn] = l(this, rn)[rn].concat(c), l(this, Os)[Os] = setTimeout(l(this, Nu)[Nu].bind(this), e)), h.next = 26;
            break;
          case 18:
            if (h.prev = 18, h.t0 = h.catch(4), this.logger.error("failed to consume on transport", { error: h.t0 }), !(h.t0.errorCode === "internal_error" && h.t0.errorDescription === "Backend error" || h.t0.errorCode === "invalid_session_description")) {
              h.next = 26;
              break;
            }
            this.logger.error("Irrecoverable error, closing current recvTransport to create a new one", { transport: this.recvTransport, error: { code: h.t0.errorCode, message: h.t0.errorDescription } });
            try {
              this.stopTransports({ recv: !0 });
            } catch (v) {
            }
            return h.next = 26, this.setupTransports({ recv: !0 });
          case 26:
          case "end":
            return h.stop();
        }
    }, o, this, [[4, 18]]);
  })), np.apply(this, arguments);
}
function gO(o) {
  return l(this, $u)[$u].create(o);
}
function mO(o, t) {
  var e = this;
  o.on("close", /* @__PURE__ */ function() {
    var r = m(/* @__PURE__ */ p().mark(function n(a, i) {
      var s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              if (s = a.offer, u = a.reason, e.logger.info("producer::closing", { debuggingHint: u, producer: $($({}, o), {}, { status: "closing" }) }), u === nc) {
                f.next = 16;
                break;
              }
              return c = { producerId: o.id, description: { sdp: s.sdp, type: s.type, target: qa.PUBLISHER } }, f.prev = 4, f.next = 7, e.socketHandler.closeProducer(c);
            case 7:
              d = f.sent, h = { sdp: d == null ? void 0 : d.sdp, type: d == null ? void 0 : d.type }, e.logger.info("producer::closed", { producer: $($({}, o), {}, { status: "closed" }) }), i({ answer: h }), f.next = 16;
              break;
            case 13:
              f.prev = 13, f.t0 = f.catch(4), e.logger.error("producer close error", f.t0);
            case 16:
              e.producers.delete(o.id), t();
            case 18:
            case "end":
              return f.stop();
          }
      }, n, null, [[4, 13]]);
    }));
    return function(n, a) {
      return r.apply(this, arguments);
    };
  }()), o.on("trackended", function() {
    e.logger.info("producer::trackended", { producer: $($({}, o), {}, { status: "UNKNOWN" }) });
  }), l(this, Da)[Da].set(o.id, o);
}
function yO(o) {
  return ap.apply(this, arguments);
}
function ap() {
  return ap = m(/* @__PURE__ */ p().mark(function o(t) {
    var e;
    return p().wrap(function(n) {
      for (; ; )
        switch (n.prev = n.next) {
          case 0:
            return n.prev = 0, n.next = 3, this.recvTransport.canConsume();
          case 3:
            return n.next = 5, l(this, St)[St].create(t);
          case 5:
            return e = n.sent, n.abrupt("return", e);
          case 9:
            throw n.prev = 9, n.t0 = n.catch(0), this.logger.error("Error in consume request", { error: n.t0 }), n.t0;
          case 13:
          case "end":
            return n.stop();
        }
    }, o, this, [[0, 9]]);
  })), ap.apply(this, arguments);
}
function kO(o) {
  var t = this;
  o.on("close", /* @__PURE__ */ function() {
    var e = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              t.logger.debug("consumer closed", { consumer: { closureReason: n, id: o.id, kind: o.kind, appData: o.appData } }), l(t, $n)[$n].delete(o.id), t.context.getValue("peerSessionStore").emit(j.CONSUMER_CLOSED, { id: o.id });
            case 3:
            case "end":
              return i.stop();
          }
      }, r);
    }));
    return function(r) {
      return e.apply(this, arguments);
    };
  }()), l(this, $n)[$n].set(o.id, o), this.producerIdToConsumerIdMap.set(o.producerId, o.id), this.context.getValue("peerSessionStore").emit(j.NEW_CONSUMER, { id: o.id, appData: o.appData, peerId: o.peerId });
}
var yu = /* @__PURE__ */ S("zeroCrossingThreshold"), ku = /* @__PURE__ */ S("minVoiceDuration"), bu = /* @__PURE__ */ S("hangoverFrames"), Ts = /* @__PURE__ */ S("initialEnergyThreshold"), Vs = /* @__PURE__ */ S("noiseAdaptationRate"), Us = /* @__PURE__ */ S("voiceAdaptationRate"), Vu = /* @__PURE__ */ S("minEnergyThreshold"), Uu = /* @__PURE__ */ S("maxEnergyThreshold"), ws = /* @__PURE__ */ S("energyRatioThreshold"), Ar = /* @__PURE__ */ S("currentEnergyThreshold"), ct = /* @__PURE__ */ S("backgroundNoiseEnergy"), lt = /* @__PURE__ */ S("voiceDetected"), Ea = /* @__PURE__ */ S("consecutiveVoiceFrames"), Ca = /* @__PURE__ */ S("hangoverCount"), xt = /* @__PURE__ */ S("noiseEnergyHistory"), ju = /* @__PURE__ */ S("noiseHistorySize"), cd = /* @__PURE__ */ S("updateEnergyThreshold"), dd = /* @__PURE__ */ S("updateNoiseEstimate"), ip = /* @__PURE__ */ S("calculateEnergy"), sp = /* @__PURE__ */ S("calculateZeroCrossingRate"), Yp = /* @__PURE__ */ function() {
  function o() {
    var t = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {}, e = t.initialEnergyThreshold, r = e === void 0 ? 0.015 : e, n = t.zeroCrossingThreshold, a = n === void 0 ? 20 : n, i = t.minVoiceDuration, s = i === void 0 ? 3 : i, u = t.hangoverFrames, c = u === void 0 ? 5 : u, d = t.noiseAdaptationRate, h = d === void 0 ? 0.95 : d, v = t.voiceAdaptationRate, f = v === void 0 ? 0.99 : v, g = t.minEnergyThreshold, k = g === void 0 ? 5e-3 : g, y = t.maxEnergyThreshold, b = y === void 0 ? 0.2 : y, C = t.energyRatioThreshold, T = C === void 0 ? 1.5 : C, E = t.noiseHistorySize, D = E === void 0 ? 50 : E;
    w(this, o), Object.defineProperty(this, dd, { value: TO }), Object.defineProperty(this, cd, { value: bO }), Object.defineProperty(this, yu, { writable: !0, value: void 0 }), Object.defineProperty(this, ku, { writable: !0, value: void 0 }), Object.defineProperty(this, bu, { writable: !0, value: void 0 }), Object.defineProperty(this, Ts, { writable: !0, value: void 0 }), Object.defineProperty(this, Vs, { writable: !0, value: void 0 }), Object.defineProperty(this, Us, { writable: !0, value: void 0 }), Object.defineProperty(this, Vu, { writable: !0, value: void 0 }), Object.defineProperty(this, Uu, { writable: !0, value: void 0 }), Object.defineProperty(this, ws, { writable: !0, value: void 0 }), Object.defineProperty(this, Ar, { writable: !0, value: void 0 }), Object.defineProperty(this, ct, { writable: !0, value: void 0 }), Object.defineProperty(this, lt, { writable: !0, value: !1 }), Object.defineProperty(this, Ea, { writable: !0, value: 0 }), Object.defineProperty(this, Ca, { writable: !0, value: 0 }), Object.defineProperty(this, xt, { writable: !0, value: [] }), Object.defineProperty(this, ju, { writable: !0, value: void 0 }), l(this, Ts)[Ts] = r, l(this, Ar)[Ar] = r, l(this, yu)[yu] = a, l(this, ku)[ku] = s, l(this, bu)[bu] = c, l(this, Vs)[Vs] = h, l(this, Us)[Us] = f, l(this, Vu)[Vu] = k, l(this, Uu)[Uu] = b, l(this, ws)[ws] = T, l(this, ju)[ju] = D, l(this, ct)[ct] = r / 2;
  }
  return P(o, [{
    key: "voiceDetected",
    get: function() {
      return l(this, lt)[lt];
    }
    /**
    * Process an audio chunk and determine if it contains voice activity
    * @param audioChunk - Float32Array containing audio samples in range [-1, 1]
    * @returns boolean indicating if voice activity is detected
    */
  }, { key: "processAudioChunk", value: function(e) {
    var r = l(o, ip)[ip](e), n = l(o, sp)[sp](e);
    l(this, cd)[cd](r);
    var a = r / l(this, ct)[ct], i = a > l(this, ws)[ws] && r > l(this, Ar)[Ar] && n > l(this, yu)[yu];
    return i ? (l(this, Ea)[Ea] += 1, l(this, Ca)[Ca] = l(this, bu)[bu], l(this, Ea)[Ea] >= l(this, ku)[ku] && (l(this, lt)[lt] = !0)) : (l(this, Ea)[Ea] = 0, l(this, Ca)[Ca] > 0 ? l(this, Ca)[Ca] -= 1 : l(this, lt)[lt] && (l(this, lt)[lt] = !1), l(this, lt)[lt] || l(this, dd)[dd](r)), { energy: r, isVoice: l(this, lt)[lt] };
  } }, {
    key: "reset",
    value: (
      /**
      * Reset the detector state
      */
      function() {
        l(this, lt)[lt] = !1, l(this, Ea)[Ea] = 0, l(this, Ca)[Ca] = 0, l(this, Ar)[Ar] = l(this, Ts)[Ts], l(this, ct)[ct] = l(this, Ts)[Ts] / 2, l(this, xt)[xt] = [];
      }
    )
    /**
    * Get current adaptive threshold values for debugging/visualization
    */
  }, { key: "getThresholdInfo", value: function() {
    return { currentEnergyThreshold: l(this, Ar)[Ar], backgroundNoiseEnergy: l(this, ct)[ct], energyRatioThreshold: l(this, ws)[ws] };
  } }]);
}();
function bO(o) {
  l(this, lt)[lt] ? l(this, Ar)[Ar] = l(this, Us)[Us] * l(this, Ar)[Ar] + (1 - l(this, Us)[Us]) * o : l(this, Ar)[Ar] = l(this, Vs)[Vs] * l(this, Ar)[Ar] + (1 - l(this, Vs)[Vs]) * l(this, ct)[ct], l(this, Ar)[Ar] = Math.max(l(this, Vu)[Vu], Math.min(l(this, Uu)[Uu], l(this, Ar)[Ar]));
}
function TO(o) {
  if (o < l(this, Ar)[Ar] * 1.2)
    if (l(this, xt)[xt].push(o), l(this, xt)[xt].length > l(this, ju)[ju] && l(this, xt)[xt].shift(), l(this, xt)[xt].length >= 10) {
      var t = Se(l(this, xt)[xt]).sort(function(r, n) {
        return r - n;
      }), e = Math.floor(t.length / 2);
      l(this, ct)[ct] = t[e];
    } else
      l(this, ct)[ct] = 0.95 * l(this, ct)[ct] + 0.05 * o;
}
function wO(o) {
  return Math.sqrt(o.map(function(t) {
    return t * t;
  }).reduce(function(t, e) {
    return t + e;
  }) / o.length);
}
function PO(o) {
  for (var t = 0, e = 1; e < o.length; e += 1)
    (o[e] >= 0 && o[e - 1] < 0 || o[e] < 0 && o[e - 1] >= 0) && (t += 1);
  return t;
}
Object.defineProperty(Yp, sp, { value: PO });
Object.defineProperty(Yp, ip, { value: wO });
var Tu = /* @__PURE__ */ S("context"), Tv = /* @__PURE__ */ function() {
  function o(t) {
    var e = this;
    w(this, o), this.RNAudioSampleHandler = void 0, Object.defineProperty(this, Tu, { writable: !0, value: void 0 }), l(this, Tu)[Tu] = t;
    var r = navigator, n = r.RNAudioSampleHandlerImpl;
    n == null || n.init().then(function(a) {
      e.RNAudioSampleHandler = a;
    }).catch(function(a) {
      e.logger.error("ReactNativeAudioSampler: Failed to initialize audio sampler", a);
    });
  }
  return P(o, [{ key: "logger", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, Tu)[Tu].getValue("logger");
    }
  ) }, { key: "samples", get: function() {
    var e, r = new Float32Array(1024);
    return (e = this.RNAudioSampleHandler) === null || e === void 0 || e.getFloatTimeDomainData(r), r;
  } }, { key: "stop", value: function() {
    var e;
    (e = this.RNAudioSampleHandler) === null || e === void 0 || e.destructor();
  } }]);
}(), wu = /* @__PURE__ */ S("context"), wv = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.audioContext = void 0, this.analyser = void 0, Object.defineProperty(this, wu, { writable: !0, value: void 0 }), l(this, wu)[wu] = t, this.audioContext = new AudioContext(), this.analyser = this.audioContext.createAnalyser(), this.analyser.fftSize = 2048;
  }
  return P(o, [{ key: "logger", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, wu)[wu].getValue("logger");
    }
  ) }, { key: "samples", get: function() {
    if (this.audioContext.state === "suspended")
      try {
        this.audioContext.resume();
      } catch (r) {
        this.logger.error("AudioContextSampler: Failed to resume audio context", r);
      }
    var e = new Float32Array(this.analyser.frequencyBinCount);
    return this.analyser.getFloatTimeDomainData(e), e;
  } }, { key: "audioTrack", set: function(e) {
    var r = new MediaStream();
    r.addTrack(e);
    var n = this.audioContext.createMediaStreamSource(r);
    n.connect(this.analyser);
  } }]);
}(), SO = /* @__PURE__ */ function() {
  function o() {
    w(this, o);
  }
  return P(o, null, [{ key: "setInterval", value: function(e) {
    for (var r, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0, a = arguments.length, i = new Array(a > 2 ? a - 2 : 0), s = 2; s < a; s++)
      i[s - 2] = arguments[s];
    if (navigator && navigator.RNBackgroundTimerImpl) {
      var u;
      return (u = navigator.RNBackgroundTimerImpl).setInterval.apply(u, [e, n].concat(i));
    }
    return (r = global).setInterval.apply(r, [e, n].concat(i));
  } }, { key: "clearInterval", value: function(e) {
    return navigator && navigator.RNBackgroundTimerImpl ? navigator.RNBackgroundTimerImpl.clearInterval(e) : global.clearInterval(e);
  } }, { key: "setTimeout", value: function(e) {
    for (var r, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : 0, a = arguments.length, i = new Array(a > 2 ? a - 2 : 0), s = 2; s < a; s++)
      i[s - 2] = arguments[s];
    if (navigator && navigator.RNBackgroundTimerImpl) {
      var u;
      return (u = navigator.RNBackgroundTimerImpl).setTimeout.apply(u, [e, n].concat(i));
    }
    return (r = global).setTimeout.apply(r, [e, n].concat(i));
  } }, { key: "clearTimeout", value: function(e) {
    return navigator && navigator.RNBackgroundTimerImpl ? navigator.RNBackgroundTimerImpl.clearTimeout(e) : global.clearTimeout(e);
  } }]);
}(), EO = 60, CO = 400, Kt = /* @__PURE__ */ S("interval"), zt = /* @__PURE__ */ S("reportInterval"), dt = /* @__PURE__ */ S("producerId"), Pu = /* @__PURE__ */ S("audioTrack"), ja = /* @__PURE__ */ S("energy"), Ds = /* @__PURE__ */ S("vad"), Xt = /* @__PURE__ */ S("minEnergy"), On = /* @__PURE__ */ S("maxEnergy"), Ls = /* @__PURE__ */ S("previousState"), en = /* @__PURE__ */ S("context"), Zt = /* @__PURE__ */ S("audioSampler"), Tt = /* @__PURE__ */ S("timer"), pd = /* @__PURE__ */ S("getAudioCharacteristics"), xu = /* @__PURE__ */ S("isSilent"), hd = /* @__PURE__ */ S("report"), op = /* @__PURE__ */ S("logScale"), Ic = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, hd, { value: IO }), Object.defineProperty(this, pd, { value: RO }), Object.defineProperty(this, Kt, { writable: !0, value: void 0 }), Object.defineProperty(this, zt, { writable: !0, value: void 0 }), Object.defineProperty(this, dt, { writable: !0, value: void 0 }), Object.defineProperty(this, Pu, { writable: !0, value: void 0 }), Object.defineProperty(this, ja, { writable: !0, value: void 0 }), Object.defineProperty(this, Ds, { writable: !0, value: void 0 }), Object.defineProperty(this, Xt, { writable: !0, value: void 0 }), Object.defineProperty(this, On, { writable: !0, value: void 0 }), Object.defineProperty(this, Ls, { writable: !0, value: void 0 }), Object.defineProperty(this, en, { writable: !0, value: void 0 }), Object.defineProperty(this, Zt, { writable: !0, value: void 0 }), Object.defineProperty(this, Tt, { writable: !0, value: void 0 }), this.reportRequest = e, l(this, en)[en] = t, l(this, Ds)[Ds] = new Yp();
    var r = navigator, n = r.isReactNative;
    l(this, Zt)[Zt] = n ? new Tv(l(this, en)[en]) : new wv(l(this, en)[en]), l(this, Tt)[Tt] = n ? SO : Ml;
  }
  return P(o, [{ key: "logger", get: (
    /**
    * @access private
    * Not for external use
    */
    function() {
      return l(this, en)[en].getValue("logger");
    }
  ) }, { key: "producerId", set: function(e) {
    l(this, dt)[dt] = e;
  } }, { key: "audioTrack", set: function(e) {
    l(this, Pu)[Pu] = e, l(this, Zt)[Zt] instanceof wv && (l(this, Zt)[Zt].audioTrack = e);
  } }, { key: "start", value: function() {
    var e = this;
    this.logger.debug("AudioActivityReporter: Starting audio activity reporter: ".concat(l(this, dt)[dt])), l(this, Kt)[Kt] && l(this, Tt)[Tt].clearInterval(l(this, Kt)[Kt]), l(this, Kt)[Kt] = l(this, Tt)[Tt].setInterval(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (!(!l(e, Pu)[Pu] || !l(e, dt)[dt])) {
                c.next = 2;
                break;
              }
              return c.abrupt("return");
            case 2:
              n = l(e, pd)[pd](), a = n.energy, i = l(o, xu)[xu](a), s = 0.9, l(e, Ls)[Ls] !== i && l(e, Ls)[Ls] ? s = 0.9 : i ? s = 0.3 : s = 0.5, l(e, ja)[ja] = (l(e, ja)[ja] || 0) * (1 - s) + a * s;
            case 7:
            case "end":
              return c.stop();
          }
      }, r);
    })), EO), l(this, zt)[zt] && l(this, Tt)[Tt].clearInterval(l(this, zt)[zt]), l(this, zt)[zt] = l(this, Tt)[Tt].setInterval(l(this, hd)[hd].bind(this), CO);
  } }, { key: "stop", value: function() {
    try {
      this.logger.debug("AudioActivityReporter: Stopping audio activity reporter: ".concat(l(this, dt)[dt])), l(this, Kt)[Kt] && (l(this, Tt)[Tt].clearInterval(l(this, Kt)[Kt]), l(this, Kt)[Kt] = void 0), l(this, zt)[zt] && (l(this, Tt)[Tt].clearInterval(l(this, zt)[zt]), l(this, zt)[zt] = void 0);
    } catch (e) {
    }
    l(this, Ds)[Ds].reset(), l(this, Zt)[Zt] instanceof Tv && l(this, Zt)[Zt].stop();
  } }]);
}();
kp = Ic;
function RO() {
  var o = l(this, Zt)[Zt].samples, t = l(this, Ds)[Ds].processAudioChunk(o), e = t.energy, r = t.isVoice, n = l(kp, op)[op](e);
  if (l(this, en)[en].getValue("flagsmith").hasFeature(me.ENABLE_AUDIO_ACTIVITY_DEBUG_LOGS) && this.logger.debug("AudioActivityReporter: producer: ".concat(l(this, dt)[dt], ", energy: ").concat(l(this, ja)[ja], `,
				slogScale: `).concat(n, ", isVoice: ").concat(r, ", minEnergy: ").concat(l(this, Xt)[Xt], `,
				maxEnergy: `).concat(l(this, On)[On])), n === -1 / 0 || e < 1e-6)
    return { energy: 0, isVoice: !1 };
  (!l(this, Xt)[Xt] || n < l(this, Xt)[Xt]) && (l(this, Xt)[Xt] = n), (!l(this, On)[On] || n > l(this, On)[On]) && (l(this, On)[On] = n);
  var a = (n - l(this, Xt)[Xt]) / (l(this, On)[On] - l(this, Xt)[Xt]) * 10 || 0;
  return { energy: a, isVoice: r };
}
function AO(o) {
  return o < 5;
}
function IO() {
  var o = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : l(this, ja)[ja];
  if (!l(this, dt)[dt] || !o) {
    l(this, en)[en].getValue("flagsmith").hasFeature(me.ENABLE_AUDIO_ACTIVITY_DEBUG_LOGS) && this.logger.debug("AudioActivityReporter: No producerId or energy to report: ".concat(l(this, dt)[dt]));
    return;
  }
  var t = { producerId: l(this, dt)[dt], energy: Math.round(o), silent: l(kp, xu)[xu](o) };
  l(this, Ls)[Ls] = t.silent, this.reportRequest(t);
}
function MO(o) {
  var t = Math.log10(o);
  return Math.round(t);
}
Object.defineProperty(Ic, op, { value: MO });
Object.defineProperty(Ic, xu, { value: AO });
var _O = function() {
  var t = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !1;
  if ("MediaStreamTrackGenerator" in window && "AudioData" in window)
    try {
      var e = new window.MediaStreamTrackGenerator({ kind: "audio" }), r = e.writable.getWriter(), n = 48e3, a = 128, i = 1, s = 0, u = null, c = /* @__PURE__ */ function() {
        var C = m(/* @__PURE__ */ p().mark(function T() {
          var E, D;
          return p().wrap(function(_) {
            for (; ; )
              switch (_.prev = _.next) {
                case 0:
                  return _.prev = 0, E = new Float32Array(a * i), D = new window.AudioData({ format: "f32", sampleRate: n, numberOfFrames: a, numberOfChannels: i, timestamp: s, data: E }), s += a / n * 1e6, _.next = 6, r.ready;
                case 6:
                  return _.next = 8, r.write(D);
                case 8:
                  _.next = 15;
                  break;
                case 10:
                  _.prev = 10, _.t0 = _.catch(0), u && clearInterval(u), r.releaseLock(), e.writable.abort();
                case 15:
                case "end":
                  return _.stop();
              }
          }, T, null, [[0, 10]]);
        }));
        return function() {
          return C.apply(this, arguments);
        };
      }();
      u = window.setInterval(c, 100);
      var d = new MediaStream([e]), h = d.getAudioTracks()[0];
      return h.addEventListener("ended", function() {
        u && clearInterval(u), r.releaseLock(), e.writable.abort();
      }), Object.assign(h, { fakeTracks: "fakeTracks:fakeAudioTrack" }), h.enabled = t, h;
    } catch (C) {
    }
  var v = window.AudioContext || window.webkitAudioContext;
  if (v)
    try {
      var f = new v();
      if (!f || f.state !== "running" || !f.destination)
        return;
      var g = f.createOscillator();
      g.frequency.value = 0, g.type = "sine";
      var k = f.createGain();
      k.gain.value = 0, g.connect(k);
      var y = f.createMediaStreamDestination();
      k.connect(y), g.start();
      var b = y.stream.getAudioTracks()[0];
      return b ? (Object.assign(b, { fakeTracks: "fakeTracks:fakeAudioTrack" }), b.enabled = t, b) : void 0;
    } catch (C) {
      return;
    }
}, OO = function() {
  var t, e, r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : !1, n = new MediaStream().getVideoTracks()[0], a = document.createElement("canvas");
  a.height = (t = n == null ? void 0 : n.getSettings().height) !== null && t !== void 0 ? t : 720, a.width = (e = n == null ? void 0 : n.getSettings().width) !== null && e !== void 0 ? e : 1280;
  var i = a.getContext("2d");
  i.fillStyle = "black", i.fillRect(0, 0, a.width, a.height), setInterval(function() {
    i.fillStyle = "black", i.fillRect(0, 0, a.width, a.height);
  }, 1e3);
  var s = a.captureStream().getVideoTracks()[0];
  return Object.assign(s, { fakeTracks: "fakeTracks:fakeVideoTrack" }), s.enabled = r, s;
}, DO = Object.defineProperty, LO = Object.getOwnPropertyDescriptor, xe = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? LO(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && DO(e, r, a), a;
}, Yt = ["video/VP9", "video/VP8"], _g = (Eo = /* @__PURE__ */ S("roomUUID"), Co = /* @__PURE__ */ S("peerDisplayName"), Qe = /* @__PURE__ */ S("socketClient"), W = /* @__PURE__ */ S("sfuHandler"), Ei = /* @__PURE__ */ S("rtpCapabilities"), ur = /* @__PURE__ */ S("events"), ua = /* @__PURE__ */ S("roomJoiningInProgress"), la = /* @__PURE__ */ S("onceJoined"), ra = /* @__PURE__ */ S("transportQueue"), vo = /* @__PURE__ */ S("rejoinRoomFn"), Wr = /* @__PURE__ */ S("connectionPromise"), Ot = /* @__PURE__ */ S("screenshareConsumerProducer"), js = /* @__PURE__ */ S("location"), ta = /* @__PURE__ */ S("senderVideoCodecMap"), na = /* @__PURE__ */ S("receiverVideoCodecMap"), pr = /* @__PURE__ */ S("producerTypes"), Tr = /* @__PURE__ */ S("audioActivityReporter"), fn = /* @__PURE__ */ S("connectionHandler"), ml = /* @__PURE__ */ S("joinRoom"), Bl = /* @__PURE__ */ S("completeJoinRoom"), ql = /* @__PURE__ */ S("reportRoomJoinedAnalytics"), Ro = /* @__PURE__ */ S("initializeConnection"), Gl = /* @__PURE__ */ S("getLocation"), Wl = /* @__PURE__ */ S("getRtpCapabilities"), Jl = /* @__PURE__ */ S("sendJoinRoomMessage"), Kl = /* @__PURE__ */ S("setupInitialMediaProducers"), Ge = /* @__PURE__ */ S("getProducer"), aa = /* @__PURE__ */ S("setProducer"), yl = /* @__PURE__ */ S("deleteProducer"), kl = /* @__PURE__ */ S("getMicProducerDefaults"), bl = /* @__PURE__ */ S("getWebcamProducerDefaults"), Vc = /* @__PURE__ */ function() {
  function o(t, e) {
    var r, n, a = this;
    w(this, o), Object.defineProperty(this, bl, { value: zO }), Object.defineProperty(this, kl, { value: KO }), Object.defineProperty(this, yl, { value: JO }), Object.defineProperty(this, aa, { value: WO }), Object.defineProperty(this, Ge, { value: GO }), Object.defineProperty(this, Kl, { value: qO }), Object.defineProperty(this, Jl, { value: BO }), Object.defineProperty(this, Wl, { value: HO }), Object.defineProperty(this, Ro, { value: jO }), Object.defineProperty(this, ql, { value: UO }), Object.defineProperty(this, Bl, { value: VO }), Object.defineProperty(this, ml, { value: NO }), Object.defineProperty(this, fn, { get: $O, set: void 0 }), this.context = void 0, this.authToken = void 0, this.e2ee = void 0, Object.defineProperty(this, Eo, { writable: !0, value: void 0 }), Object.defineProperty(this, Co, { writable: !0, value: void 0 }), Object.defineProperty(this, Qe, { writable: !0, value: void 0 }), Object.defineProperty(this, W, { writable: !0, value: void 0 }), Object.defineProperty(this, Ei, { writable: !0, value: void 0 }), Object.defineProperty(this, ur, { writable: !0, value: void 0 }), Object.defineProperty(this, ua, { writable: !0, value: void 0 }), Object.defineProperty(this, la, { writable: !0, value: void 0 }), Object.defineProperty(this, ra, { writable: !0, value: void 0 }), Object.defineProperty(this, vo, { writable: !0, value: void 0 }), Object.defineProperty(this, Wr, { writable: !0, value: null }), Object.defineProperty(this, Ot, { writable: !0, value: void 0 }), Object.defineProperty(this, js, { writable: !0, value: void 0 }), Object.defineProperty(this, ta, { writable: !0, value: void 0 }), Object.defineProperty(this, na, { writable: !0, value: void 0 }), Object.defineProperty(this, pr, { writable: !0, value: void 0 }), Object.defineProperty(this, Tr, { writable: !0, value: void 0 }), this.context = t;
    var i = e.socket;
    this.mediaJoined = !1, l(this, ta)[ta] = /* @__PURE__ */ new Map([["video/VP9", /* @__PURE__ */ new Set()], ["video/VP8", /* @__PURE__ */ new Set()]]), l(this, na)[na] = /* @__PURE__ */ new Map([["video/VP9", /* @__PURE__ */ new Set()], ["video/VP8", /* @__PURE__ */ new Set()]]), l(this, Qe)[Qe] = i, l(this, ua)[ua] = !1, l(this, W)[W] = new vO(t, i), l(this, ur)[ur] = l(this, W)[W].events, l(this, Ot)[Ot] = /* @__PURE__ */ new Set(), l(this, pr)[pr] = /* @__PURE__ */ new Map(), l(this, la)[la] = !1, l(this, ra)[ra] = new Bd(t.getValue("logger")), l(this, Tr)[Tr] = new Ic(this.context, l(this, W)[W].socketHandler.audioActivity.bind(l(this, W)[W].socketHandler)), this.e2ee = (r = (n = t.getValue("modules").e2ee) === null || n === void 0 ? void 0 : n.enabled) !== null && r !== void 0 ? r : !1, this.handleSocketEvents(), this.handleCallstatsEvents(), l(this, vo)[vo] = jp(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function s() {
      var u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              if (l(a, fn)[fn].mediaJoinAttempted) {
                h.next = 2;
                break;
              }
              return h.abrupt("return");
            case 2:
              return h.next = 4, a.joinRoom(l(a, Co)[Co], l(a, Eo)[Eo], !0, !0);
            case 4:
              u = h.sent, c = u.roomJoined, c && (a.context.getValue("peerSessionStore").emit(j.RESET_PRODUCER_STATE), a.context.getValue("peerSessionStore").emit(j.ROOM_NODE_RECONNECTED));
            case 7:
            case "end":
              return h.stop();
          }
      }, s);
    })), 5e3, { leading: !0, maxWait: 1e3 });
  }
  return P(o, [{
    key: "peerId",
    get: function() {
      return this.context.getValue("peerId");
    }
    /**
    * @access private
    * Not for external use
    */
  }, {
    key: "telemetry",
    get: function() {
      return this.context.getValue("telemetry");
    }
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return this.context.getValue("logger");
  } }, { key: "mediaJoined", get: function() {
    return l(this, fn)[fn].mediaJoined;
  }, set: function(e) {
    l(this, fn)[fn].mediaJoined = e;
  } }, { key: "reset", value: function() {
    l(this, W)[W].closeAllProducers(), l(this, W)[W].closeAllConsumers(), l(this, pr)[pr].clear(), l(this, Ot)[Ot].clear(), l(this, Wr)[Wr] = null, l(this, ra)[ra].stop(), l(this, W)[W].stopAllTransports(), l(this, W)[W].reset(), l(this, ra)[ra] = new Bd();
  } }, { key: "joinRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i = this, s, u, c, d, h = arguments;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              return s = h.length > 2 && h[2] !== void 0 ? h[2] : !1, u = h.length > 3 && h[3] !== void 0 ? h[3] : !1, c = h.length > 4 && h[4] !== void 0 ? h[4] : {}, l(this, fn)[fn].mediaJoinAttempted = !0, l(this, ua)[ua] = !0, s && this.reset(), f.prev = 6, f.next = 9, l(this, ra)[ra].push(function() {
                return l(i, ml)[ml](n, a, u, c);
              }, "joinRoom");
            case 9:
              return d = f.sent, f.abrupt("return", d);
            case 13:
              return f.prev = 13, f.t0 = f.catch(6), this.logger.error("Error in room joining process", { error: f.t0 }), this.context.getValue("peerSessionStore").emit(j.ROOM_NODE_FAILED), f.abrupt("return", { roomJoined: !1 });
            case 18:
            case "end":
              return f.stop();
          }
      }, r, this, [[6, 13]]);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "initializeConnection", value: (
    /**
    * Initialize connection to the SFU.
    * This can be used to start establishing a connection
    * before the full join process.
    */
    function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
        var i = this, s, u, c = arguments;
        return p().wrap(function(h) {
          for (; ; )
            switch (h.prev = h.next) {
              case 0:
                if (s = c.length > 2 && c[2] !== void 0 ? c[2] : !1, u = c.length > 3 && c[3] !== void 0 ? c[3] : {}, !l(this, Wr)[Wr]) {
                  h.next = 4;
                  break;
                }
                return h.abrupt("return", l(this, Wr)[Wr]);
              case 4:
                return l(this, Wr)[Wr] = m(/* @__PURE__ */ p().mark(function v() {
                  return p().wrap(function(g) {
                    for (; ; )
                      switch (g.prev = g.next) {
                        case 0:
                          return g.prev = 0, g.next = 3, l(i, Ro)[Ro](n, a, s, u);
                        case 3:
                          g.next = 9;
                          break;
                        case 5:
                          throw g.prev = 5, g.t0 = g.catch(0), l(i, Wr)[Wr] = null, g.t0;
                        case 9:
                        case "end":
                          return g.stop();
                      }
                  }, v, null, [[0, 5]]);
                }))(), h.abrupt("return", l(this, Wr)[Wr]);
              case 6:
              case "end":
                return h.stop();
            }
        }, r, this);
      }));
      function e(r, n) {
        return t.apply(this, arguments);
      }
      return e;
    }()
  ) }, { key: "getConsumers", value: function() {
    return l(this, W)[W].consumers;
  } }, { key: "getProducers", value: function() {
    return l(this, W)[W].producers;
  } }, { key: "leaveRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n = this, a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              l(this, W)[W].stopAllTransports(), l(this, la)[la] = !1, l(this, fn)[fn].mediaJoinAttempted = !1, a = { closeRoom: !1 }, l(this, Qe)[Qe].sendMessagePromise(l(this, ur)[ur].leaveRoom, bS.toBinary(a)).then(function(c) {
                var d;
                (d = uE.fromBinary(c.payload)) !== null && d !== void 0 && d.closed && n.logger.warn("Weird state on peer closed and should not happen");
              }).catch(function(c) {
                n.logger.error("error on sending leave room request", { error: c });
              }), this.context.getValue("callstats").callEnded(), i = this.context.getValue("telemetry"), i.destruct();
            case 8:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "activatePeers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.createConsumers(n));
            case 1:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "createConsumers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (n.length !== 0) {
                i.next = 2;
                break;
              }
              return i.abrupt("return", Promise.resolve());
            case 2:
              return i.abrupt("return", l(this, W)[W].createConsumers(n));
            case 3:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "closeConsumers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              if (n.length) {
                u.next = 2;
                break;
              }
              return u.abrupt("return");
            case 2:
              return i = n.reduce(function(c, d) {
                var h = l(a, W)[W].producerIdToConsumerIdMap.get(d.producerId);
                return h ? (c.push(h), c) : (a.logger.warn("consumer not found in close consumers: ".concat(d.producerId)), c);
              }, []), u.next = 5, l(this, W)[W].closeConsumers(i);
            case 5:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "_shareWebcam", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s = this, u, c, d, h, v, f, g, k, y, b, C;
      return p().wrap(function(E) {
        for (; ; )
          switch (E.prev = E.next) {
            case 0:
              if (u = a === "video/VP9" ? cr.WEBCAM : cr.WEBCAM_BACKUP, c = l(this, Ge)[Ge](u), !c) {
                E.next = 17;
                break;
              }
              return E.next = 5, c;
            case 5:
              if (d = E.sent, !l(this, W)[W].producers.has(d)) {
                E.next = 16;
                break;
              }
              if (h = l(this, W)[W].producers.get(d), h.closed) {
                E.next = 14;
                break;
              }
              return E.next = 11, h.replaceTrack({ track: n });
            case 11:
              return E.next = 13, this.resumeWebcam(u);
            case 13:
              return E.abrupt("return", n);
            case 14:
              return E.next = 16, this.disableWebcam(a);
            case 16:
              return E.abrupt("return", this._shareWebcam(n, a));
            case 17:
              return v = [a].concat(Yt.filter(function(D) {
                return D !== a;
              })), f = l(this, bl)[bl](n, v), g = $o(this.context, "disableSimulcast"), k = (i = this.context) === null || i === void 0 || (i = i.getValue("overrides")) === null || i === void 0 ? void 0 : i.simulcastConfig, y = g || k && k.disable, !y && this.context.getValue("flagsmith").hasFeature(me.ENABLE_CF_SIMULCAST) ? (this.logger.info("Simulcast enabled for SFU: CF"), f.encodings = fM(this.context, n)) : this.logger.info("Simulcast disabled for webcam producer, SFU: CF"), this.context.getValue("flagsmith").hasFeature(me.TRACK_HINT) && (f.track.contentHint = this.context.getValue("flagsmith").getValue(me.TRACK_HINT)), b = function() {
                s.logger.info("Disabling video due to the producer closure"), l(s, pr)[pr].delete(u);
              }, C = l(this, W)[W].createProducer(f, b), l(this, aa)[aa](u, C.then(function(D) {
                return D.id;
              })), E.abrupt("return", C.then(function(D) {
                return D.track;
              }));
            case 28:
            case "end":
              return E.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "shareWebcam", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i = this, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (n !== void 0) {
                d.next = 2;
                break;
              }
              return d.abrupt("return", null);
            case 2:
              if (s = (a = this.context.getValue("flagsmith").getValue(me.FORCE_VIDEO_CODEC)) === null || a === void 0 ? void 0 : a.toString(), !s) {
                d.next = 6;
                break;
              }
              return this.logger.debug("Calling _shareWebcam with forced video codec: ".concat(s)), d.abrupt("return", this._shareWebcam(n, s));
            case 6:
              return u = Yt.filter(function(h) {
                var v;
                return (
                  // NOTE(roerohan): If the codec is supported
                  ((v = l(i, Ei)[Ei].sender) === null || v === void 0 || (v = v.video) === null || v === void 0 ? void 0 : v.codecs.findIndex(function(f) {
                    return f.mimeType === h;
                  })) >= 0 && l(i, na)[na].get(h).size > 0
                );
              }), u.length === 0 && u.push(Yt[0]), d.next = 10, Promise.all(u.map(function(h) {
                return i.logger.debug("Calling _shareWebcam with video codec: ".concat(h)), i._shareWebcam(n, h);
              }));
            case 10:
              return d.abrupt("return", n);
            case 11:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "shareScreen", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i, s, u, c, d, h, v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              if (i = n.video, s = n.audio, i !== void 0) {
                k.next = 3;
                break;
              }
              return k.abrupt("return");
            case 3:
              return u = { track: i, codecOptions: [{ name: "VP8" }], appData: { screenShare: !0, e2ee: this.e2ee, supportsRemoteControl: kr.isElectron() }, stopTracks: !1 }, c = function() {
                a.logger.info("Disabling screenShare due to the producer closure"), l(a, pr)[pr].delete(cr.SCREENSHARE_VIDEO), l(a, pr)[pr].delete(cr.SCREENSHARE_AUDIO);
              }, d = l(this, W)[W].createProducer(u, c), l(this, aa)[aa](cr.SCREENSHARE_VIDEO, d.then(function(y) {
                return y.id;
              })), s && (v = { track: s, codecOptions: [{ name: "opus" }], appData: { screenShare: !0, e2ee: this.e2ee, supportsRemoteControl: kr.isElectron() }, stopTracks: !1, zeroRtpOnPause: !1 }, f = function() {
              }, h = l(this, W)[W].createProducer(v, f), l(this, aa)[aa](cr.SCREENSHARE_AUDIO, h.then(function(y) {
                return y.id;
              }))), k.next = 10, Promise.all([d, h || Promise.resolve()]);
            case 10:
              this.context.getValue("callstats").screenShareStart();
            case 11:
            case "end":
              return k.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "shareMic", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this, i, s, u, c, d, h;
      return p().wrap(function(f) {
        for (; ; )
          switch (f.prev = f.next) {
            case 0:
              if (f.prev = 0, n !== void 0) {
                f.next = 3;
                break;
              }
              throw new kn("track undefined");
            case 3:
              if (i = l(this, Ge)[Ge](cr.MIC), !i) {
                f.next = 22;
                break;
              }
              return f.next = 7, i;
            case 7:
              if (s = f.sent, !l(this, W)[W].producers.has(s)) {
                f.next = 19;
                break;
              }
              if (u = l(this, W)[W].producers.get(s), u.closed) {
                f.next = 17;
                break;
              }
              return f.next = 13, u.replaceTrack({ track: n });
            case 13:
              return f.next = 15, this.resumeMic();
            case 15:
              return l(this, Tr)[Tr] && (l(this, Tr)[Tr].audioTrack = n, l(this, Tr)[Tr].producerId = s, l(this, Tr)[Tr].start()), f.abrupt("return");
            case 17:
              return f.next = 19, l(this, W)[W].closeProducer(s, { stopTrack: !1 });
            case 19:
              return f.next = 21, this.shareMic(n);
            case 21:
              return f.abrupt("return");
            case 22:
              return c = l(this, kl)[kl](n), d = function() {
                l(a, pr)[pr].delete(cr.MIC);
              }, h = l(this, W)[W].createProducer(c, d), l(this, aa)[aa](cr.MIC, h.then(function(g) {
                return g.id;
              })), f.next = 28, h.then(function(g) {
                l(a, Tr)[Tr] && (l(a, Tr)[Tr].audioTrack = g.track, l(a, Tr)[Tr].producerId = g.id, l(a, Tr)[Tr].start());
              });
            case 28:
              f.next = 33;
              break;
            case 30:
              throw f.prev = 30, f.t0 = f.catch(0), new U(f.t0);
            case 33:
            case "end":
              return f.stop();
          }
      }, r, this, [[0, 30]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "pauseMic", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return c.next = 2, l(this, Ge)[Ge](cr.MIC);
            case 2:
              if (a = c.sent, i = l(this, W)[W].producers.get(a), i) {
                c.next = 7;
                break;
              }
              return this.logger.error("pauseMic::could_not_find_mic_producer"), c.abrupt("return");
            case 7:
              if (!i.paused) {
                c.next = 10;
                break;
              }
              return this.logger.info("pauseMic::mic_producer_already_paused"), c.abrupt("return");
            case 10:
              i.pause(), (n = l(this, Tr)[Tr]) === null || n === void 0 || n.stop(), s = { producerId: i.id, pause: !0 }, l(this, Qe)[Qe].sendMessage(l(this, ur)[ur].toggleProducer, Sl.toBinary(s));
            case 14:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "pauseWebcam", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n = this, a, i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return h.next = 2, l(this, Ge)[Ge](cr.WEBCAM);
            case 2:
              return a = h.sent, h.next = 5, l(this, Ge)[Ge](cr.WEBCAM_BACKUP);
            case 5:
              if (i = h.sent, s = l(this, W)[W].producers.get(a), u = l(this, W)[W].producers.get(i), !(!s && !u)) {
                h.next = 11;
                break;
              }
              return this.logger.error("pauseWebcam::could_not_find_webcam_producer"), h.abrupt("return");
            case 11:
              c = function(f) {
                var g = { producerId: f.id, pause: !0 };
                l(n, Qe)[Qe].sendMessage(l(n, ur)[ur].toggleProducer, Sl.toBinary(g));
              }, s && (s.pause(), c(s)), u && (u.pause(), c(u));
            case 14:
            case "end":
              return h.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "resumeMic", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.next = 2, l(this, Ge)[Ge](cr.MIC);
            case 2:
              if (n = u.sent, a = l(this, W)[W].producers.get(n), a) {
                u.next = 7;
                break;
              }
              return this.logger.error("resumeMic::could_not_find_mic_producer"), u.abrupt("return");
            case 7:
              if (a.pause) {
                u.next = 10;
                break;
              }
              return this.logger.info("resumeMic::mic_producer_already_resumed"), u.abrupt("return");
            case 10:
              a.resume(), a.appData.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_ACTIVE_PRODUCER, a), i = { producerId: a.id, pause: !1 }, l(this, Qe)[Qe].sendMessage(l(this, ur)[ur].toggleProducer, Sl.toBinary(i));
            case 14:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "resumeWebcam", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return n = u.length > 0 && u[0] !== void 0 ? u[0] : cr.WEBCAM, d.next = 3, l(this, Ge)[Ge](n);
            case 3:
              if (a = d.sent, i = l(this, W)[W].producers.get(a), i) {
                d.next = 8;
                break;
              }
              return this.logger.error("resumeWebcam::could_not_find_webcam_producer"), d.abrupt("return");
            case 8:
              if (i.paused) {
                d.next = 11;
                break;
              }
              return this.logger.info("resumeWebcam::webcam_producer_already_resumed"), d.abrupt("return");
            case 11:
              i.resume(), i.appData.e2ee && this.context.getValue("peerSessionStore").emit(j.E2EE_ACTIVE_PRODUCER, i), s = { producerId: i.id, pause: !1 }, l(this, Qe)[Qe].sendMessage(l(this, ur)[ur].toggleProducer, Sl.toBinary(s));
            case 15:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableWebcam", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return a = n === "video/VP9" ? cr.WEBCAM : cr.WEBCAM_BACKUP, u.next = 3, l(this, Ge)[Ge](a);
            case 3:
              if (i = u.sent, l(this, yl)[yl](a), !i) {
                u.next = 8;
                break;
              }
              return u.next = 8, l(this, W)[W].closeProducer(i);
            case 8:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableMic", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, Ge)[Ge](cr.MIC);
            case 2:
              if (a = s.sent, !a) {
                s.next = 6;
                break;
              }
              return s.next = 6, l(this, W)[W].closeProducer(a);
            case 6:
              (n = l(this, Tr)[Tr]) === null || n === void 0 || n.stop(), l(this, pr)[pr].delete(cr.MIC);
            case 8:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableScreenShare", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.logger.info("screen_sharing_stopped"), this.context.getValue("callstats").screenShareStop(), s.next = 4, l(this, Ge)[Ge](cr.SCREENSHARE_VIDEO);
            case 4:
              return n = s.sent, s.next = 7, l(this, Ge)[Ge](cr.SCREENSHARE_AUDIO);
            case 7:
              if (a = s.sent, !n) {
                s.next = 11;
                break;
              }
              return s.next = 11, l(this, W)[W].closeProducer(n);
            case 11:
              if (!a) {
                s.next = 14;
                break;
              }
              return s.next = 14, l(this, W)[W].closeProducer(a);
            case 14:
              l(this, Ot)[Ot].clear(), l(this, pr)[pr].delete(cr.SCREENSHARE_VIDEO), l(this, pr)[pr].delete(cr.SCREENSHARE_AUDIO);
            case 17:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "muteSelf", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              this.pauseMic();
            case 1:
            case "end":
              return a.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "resetVideoProducers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              if (!n) {
                d.next = 12;
                break;
              }
              return d.next = 3, l(this, Ge)[Ge](cr.WEBCAM);
            case 3:
              return i = d.sent, d.next = 6, l(this, Ge)[Ge](cr.WEBCAM_BACKUP);
            case 6:
              return s = d.sent, d.next = 9, l(this, W)[W].closeProducer(i, { stopTrack: !1 });
            case 9:
              return d.next = 11, l(this, W)[W].closeProducer(s, { stopTrack: !1 });
            case 11:
              this.shareWebcam(n);
            case 12:
              if (!a) {
                d.next = 19;
                break;
              }
              return d.next = 15, l(this, Ge)[Ge](cr.SCREENSHARE_VIDEO);
            case 15:
              return u = d.sent, d.next = 18, l(this, W)[W].closeProducer(u, { stopTrack: !1 });
            case 18:
              this.shareScreen({ video: a });
            case 19:
            case "end":
              return d.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "changeDisplayName", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return i = { displayName: n, participantId: a != null ? a : this.peerId }, c.next = 3, l(this, W)[W].socketHandler.changeDisplayName(i);
            case 3:
              if (s = c.sent, s) {
                c.next = 6;
                break;
              }
              throw new Error("failed to change display name!");
            case 6:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "kick", value: function(e) {
    var r = { peerIds: [e] };
    l(this, W)[W].socketHandler.kickPeer(r);
  } }, {
    key: "kickAll",
    value: function() {
      l(this, W)[W].socketHandler.kickAll();
    }
    /* eslint-disable-next-line @typescript-eslint/no-unused-vars */
  }, { key: "muteAll", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, W)[W].socketHandler.hostControlForAll("audio");
            case 2:
              if (a = s.sent, a) {
                s.next = 5;
                break;
              }
              throw new Error("failed to mute all participant");
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "muteAllVideo", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, l(this, W)[W].socketHandler.hostControlForAll("video");
            case 2:
              if (n = i.sent, n) {
                i.next = 5;
                break;
              }
              throw new Error("failed to mute all video participant");
            case 5:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableAudio", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, W)[W].socketHandler.hostControlForPeer(n, "audio");
            case 2:
              if (a = s.sent, a) {
                s.next = 5;
                break;
              }
              throw new Error("failed to mute given participant");
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableVideo", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, W)[W].socketHandler.hostControlForPeer(n, "video");
            case 2:
              if (a = s.sent, a) {
                s.next = 5;
                break;
              }
              throw new Error("failed to mute video of given participant");
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "pinPeer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return a = { participantId: n != null ? n : "" }, s.prev = 1, s.next = 4, l(this, Qe)[Qe].sendMessagePromise(l(this, ur)[ur].globalPinPeer, LS.toBinary(a));
            case 4:
              s.next = 9;
              break;
            case 6:
              s.prev = 6, s.t0 = s.catch(1), this.logger.error("Error in pinning peer:", { error: s.t0 });
            case 9:
            case "end":
              return s.stop();
          }
      }, r, this, [[1, 6]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "validateScreenShare", value: function(e) {
    return this.peerId === e.peerId && l(this, W)[W].producers.get(e.producerId) && l(this, Ot)[Ot].add(e.consumerPeerId), l(this, Ot)[Ot].size;
  } }, { key: "switchConsumersToLayer", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i = this, s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              s = n.map(function(d) {
                return i.getConsumers().get(d);
              }), l(this, W)[W].switchConsumersToLayer(s, a);
            case 2:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "handleSocketEvents", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n = this;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              l(this, Qe)[Qe].on(l(this, ur)[ur].peerProducerCreateBroadcast, function(s) {
                var u = s.payload;
                if (n.mediaJoined)
                  try {
                    var c = UE.fromBinary(u), d = c.participantId, h = c.producerState;
                    if (d === n.peerId)
                      return;
                    if (h != null && h.mimeType || (h.mimeType = h.kind === ca.AUDIO ? "audio/opus" : "video/VP8"), h.kind === ca.VIDEO && !h.screenShare) {
                      var v;
                      if (
                        // Can receive vp9
                        ((v = l(n, Ei)[Ei].receiver) === null || v === void 0 || (v = v.video) === null || v === void 0 ? void 0 : v.codecs.findIndex(function(f) {
                          return f.mimeType === Yt[0];
                        })) >= 0 && l(n, ta)[ta].get(Yt[0]).has(d) && h.mimeType !== Yt[0]
                      ) {
                        n.logger.warn("Ignoring producer: ".concat(h.producerId));
                        return;
                      }
                    }
                    n.logger.info("producer created broadcast: ".concat(d, ", producer state: ").concat(h)), n.context.getValue("peerSessionStore").emit(j.NEW_PRODUCER, { peerId: d, producer: $($({}, h), {}, { kind: h.kind === ca.AUDIO ? "audio" : "video", producingPeerId: d }) });
                  } catch (f) {
                    n.logger.error("error in peer-producer-create-broadcast", { error: f });
                  }
              }), l(this, Qe)[Qe].on(l(this, ur)[ur].peerProducerToggleBroadcast, function(s) {
                var u = s.payload;
                if (n.mediaJoined)
                  try {
                    var c = zh.fromBinary(u), d = c.participantId, h = c.initiatorParticipantId, v = c.producerState, f = v.kind, g = v.pause, k = v.producerId, y = v.screenShare;
                    if (y)
                      return;
                    var b = f === ca.AUDIO ? "audio" : "video";
                    if (n.logger.info("producer toggle broadcast: ".concat(d, ", producerId: ").concat(k, ", kind:").concat(b, ", paused:").concat(g, " payload: ").concat(JSON.stringify(zh.fromBinary(u)))), d === n.peerId && h !== n.peerId && g && n.context.getValue("peerSessionStore").emit(b === "audio" ? j.MUTE_SELF : j.MUTE_SELF_VIDEO), d === n.peerId)
                      return;
                    n.context.getValue("peerSessionStore").emit(j.PRODUCER_TOGGLE, { peerId: d, producerId: k, paused: g, kind: b });
                    var C = Array.from(n.getConsumers().values()).filter(function(T) {
                      return T.producerId === k;
                    });
                    C.forEach(function(T) {
                      T.kind === "video" && g || T.paused !== g && (n.logger.debug("consumer state mismatched for ".concat(T.id, ". updating consumer pause state ").concat(T.paused, " to ").concat(g)), g ? (T.pause(), n.context.getValue("peerSessionStore").emit(j.CONSUMER_PAUSED, { id: T.id })) : (T.resume(), n.context.getValue("peerSessionStore").emit(j.CONSUMER_RESUMED, { id: T.id })));
                    });
                  } catch (T) {
                    n.logger.error("error in producer toggle broadcast handler", { error: T });
                  }
              }), l(this, Qe)[Qe].on(l(this, ur)[ur].peerLeaveBroadcast, function(s) {
                var u = s.payload;
                if (n.mediaJoined)
                  try {
                    var c = Cd.fromBinary(u), d = c.participantId;
                    if (d === n.peerId)
                      return;
                    n.logger.info("peer left broadcast:".concat(d)), l(n, Ot)[Ot].delete(d), l(n, W)[W].consumers.forEach(function(h) {
                      h.peerId === d && h.close();
                    }), n.context.getValue("peerSessionStore").emit(j.PEER_CLOSED, { id: d });
                  } catch (h) {
                    n.logger.error("error in peer left broadcast", { error: h });
                  }
              }), l(this, Qe)[Qe].on(l(this, ur)[ur].peerProducerCloseBroadcast, function(s) {
                var u = s.payload;
                if (n.mediaJoined)
                  try {
                    var c = HE.fromBinary(u), d = c.participantId, h = c.producerState.producerId;
                    if (d === n.peerId)
                      return;
                    n.logger.info("producer closed broadcast:".concat(d)), n.context.getValue("peerSessionStore").emit(j.PRODUCER_CLOSED, { peerId: d, producerId: h });
                    var v = l(n, W)[W].producerIdToConsumerIdMap.get(h);
                    if (!v) {
                      n.logger.warn("no consumer found for producer:".concat(h));
                      return;
                    }
                    n.logger.info("closing consumer ".concat(v, ", producer id: ").concat(h)), l(n, W)[W].closeConsumer(v).then(function() {
                      n.logger.info("closed consumer: ".concat(v)), l(n, W)[W].producerIdToConsumerIdMap.delete(h), n.context.getValue("peerSessionStore").emit(j.CONSUMER_CLOSED, { id: v });
                    }).catch(function(f) {
                      n.logger.error("error closing consumer", { error: f });
                    });
                  } catch (f) {
                    n.logger.error("error on producer close broadcast", { error: f });
                  }
              }), l(this, Qe)[Qe].on(l(this, ur)[ur].mediaRoomTerminationBroadcastResponse, function() {
                !n.mediaJoined && !l(n, ua)[ua] && !l(n, la)[la] || (n.logger.warn("media hub termination broadcast received, rejoining room"), n.context.getValue("peerSessionStore").emit(j.ROOM_NODE_DISCONNECTED), l(n, vo)[vo]());
              });
            case 5:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "handleCallstatsEvents", value: function() {
    var e = this;
    this.context.getValue("callstats").onConsumerScore(function(r) {
      r.forEach(function(n, a) {
        var i = l(e, W)[W].consumers.get(a);
        i && e.context.getValue("peerSessionStore").emit(j.CONSUMER_SCORE_UPDATE, { id: a, kind: i.kind, peerId: i.peerId, score: n.score, scoreStats: n });
      });
    }), this.context.getValue("callstats").onProducerScore(function(r) {
      r.forEach(function(n, a) {
        var i = Array.from(l(e, W)[W].producers.values()).find(function(s) {
          return s.id === a;
        });
        i && e.context.getValue("peerSessionStore").emit(j.PRODUCER_SCORE_UPDATE, { id: a, kind: i.kind, appData: i.appData, score: n.score, scoreStats: n });
      });
    });
  } }, { key: "handlePeerCapabilities", value: function(e, r) {
    for (var n = this, a = function() {
      var d, h = Yt[i];
      if (
        // if the codec is present in the peer capabilities
        (r == null || (d = r.receiver) === null || d === void 0 || (d = d.video) === null || d === void 0 ? void 0 : d.codecs.findIndex(function(v) {
          return v.mimeType === h;
        })) >= 0 || i === Yt.length - 1
      )
        return l(n, na)[na].get(h).add(e), 1;
    }, i = 0; i <= Yt.length && !a(); i += 1)
      ;
    for (var s = function() {
      var d, h = Yt[u];
      if (
        // if the codec is present in the peer capabilities
        (r == null || (d = r.sender) === null || d === void 0 || (d = d.video) === null || d === void 0 ? void 0 : d.codecs.findIndex(function(v) {
          return v.mimeType === h;
        })) >= 0 || u === Yt.length - 1
      )
        return l(n, ta)[ta].get(h).add(e), 1;
    }, u = 0; u <= Yt.length && !s(); u += 1)
      ;
  } }, { key: "handlePeerLeaving", value: function(e) {
    var r = this;
    this.context.getValue("flagsmith").hasFeature(me.FORCE_VIDEO_CODEC) || (l(this, ta)[ta].forEach(function(n) {
      return n.delete(e);
    }), l(this, na)[na].forEach(function(n, a) {
      n.delete(e), !(n.size !== 0 || a === Yt[0]) && r.disableWebcam(a);
    }));
  } }]);
}(), Object.defineProperty(Vc, Gl, { value: FO }), Vc);
function $O() {
  return this.context.getValue("connectionHandler");
}
function NO(o, t, e, r) {
  return up.apply(this, arguments);
}
function up() {
  return up = m(/* @__PURE__ */ p().mark(function o(t, e, r, n) {
    var a;
    return p().wrap(function(s) {
      for (; ; )
        switch (s.prev = s.next) {
          case 0:
            if (l(this, Co)[Co] = t, s.prev = 1, !l(this, Wr)[Wr]) {
              s.next = 7;
              break;
            }
            return s.next = 5, l(this, Wr)[Wr];
          case 5:
            s.next = 9;
            break;
          case 7:
            return s.next = 9, l(this, Ro)[Ro](t, e, r, n);
          case 9:
            return l(this, ql)[ql](e), s.next = 12, l(this, Bl)[Bl]();
          case 12:
            return a = s.sent, s.abrupt("return", { roomJoined: a });
          case 16:
            return s.prev = 16, s.t0 = s.catch(1), this.logger.error("Failed to complete room join", { error: s.t0 }), s.abrupt("return", { roomJoined: !1 });
          case 20:
            return s.prev = 20, l(this, Wr)[Wr] = null, s.finish(20);
          case 23:
          case "end":
            return s.stop();
        }
    }, o, this, [[1, 16, 20, 23]]);
  })), up.apply(this, arguments);
}
function VO() {
  return lp.apply(this, arguments);
}
function lp() {
  return lp = m(/* @__PURE__ */ p().mark(function o() {
    var t, e;
    return p().wrap(function(n) {
      for (; ; )
        switch (n.prev = n.next) {
          case 0:
            return n.prev = 0, this.mediaJoined = !0, n.next = 4, l(this, W)[W].socketHandler.notifySelfJoinComplete();
          case 4:
            return t = n.sent, e = t.roomState, l(this, Eo)[Eo] = e.roomUuid, l(this, la)[la] = !0, l(this, ua)[ua] = !1, n.abrupt("return", !0);
          case 12:
            return n.prev = 12, n.t0 = n.catch(0), this.logger.error("Error completing room join", { error: n.t0 }), this.mediaJoined = !1, n.abrupt("return", !1);
          case 17:
          case "end":
            return n.stop();
        }
    }, o, this, [[0, 12]]);
  })), lp.apply(this, arguments);
}
function UO(o) {
  var t = this;
  navigator.product !== "ReactNative" && setTimeout(function() {
    try {
      var e = t.context.getValue("userId"), r = { userId: e, peerId: t.peerId, roomUUID: o, roomViewType: "groupCall", deviceInfo: $($({}, kr.getDeviceInfo()), {}, { userAgent: navigator.userAgent, memory: navigator.deviceMemory, cpus: navigator.hardwareConcurrency }), sdkName: t.context.getValue("sdkName"), sdkVersion: t.context.getValue("sdkVersion"), metaData: {}, permissions: {} };
      t.context.getValue("callstats").roomJoined(r);
    } catch (n) {
      t.logger.error("Error reporting room joined analytics", { error: n });
    }
  }, 0);
}
function jO(o, t, e, r) {
  return cp.apply(this, arguments);
}
function cp() {
  return cp = m(/* @__PURE__ */ p().mark(function o(t, e, r, n) {
    var a, i, s;
    return p().wrap(function(c) {
      for (; ; )
        switch (c.prev = c.next) {
          case 0:
            return c.prev = 0, (i = (a = l(this, js))[js]) !== null && i !== void 0 || (a[js] = l(_g, Gl)[Gl]()), s = l(this, Wl)[Wl](), c.next = 5, l(this, Jl)[Jl](t, e, r, s);
          case 5:
            return c.next = 7, l(this, W)[W].setupTransports({ send: !0, recv: !0 });
          case 7:
            return c.next = 9, l(this, Kl)[Kl](n);
          case 9:
            c.next = 15;
            break;
          case 11:
            throw c.prev = 11, c.t0 = c.catch(0), this.logger.error("Failed to initialize connection", { error: c.t0 }), c.t0;
          case 15:
          case "end":
            return c.stop();
        }
    }, o, this, [[0, 11]]);
  })), cp.apply(this, arguments);
}
function FO() {
  var o = pt(), t = o.ipInfo;
  if (t != null && t.loc) {
    var e = t.loc.split(",").map(parseFloat), r = He(e, 2), n = r[0], a = r[1];
    return { latitude: n, longitude: a };
  }
}
function HO() {
  var o, t = (o = this.context.getValue("flagsmith").getValue(me.FORCE_VIDEO_CODEC)) === null || o === void 0 ? void 0 : o.toString(), e = N_(t);
  return l(this, Ei)[Ei] = e, e;
}
function BO(o, t, e, r) {
  return dp.apply(this, arguments);
}
function dp() {
  return dp = m(/* @__PURE__ */ p().mark(function o(t, e, r, n) {
    var a = this;
    return p().wrap(function(s) {
      for (; ; )
        switch (s.prev = s.next) {
          case 0:
            return s.next = 2, Ig(/* @__PURE__ */ function() {
              var u = m(/* @__PURE__ */ p().mark(function c(d, h) {
                return p().wrap(function(f) {
                  for (; ; )
                    switch (f.prev = f.next) {
                      case 0:
                        if (l(a, Qe)[Qe].isConnected) {
                          f.next = 3;
                          break;
                        }
                        return h(new Error("Socket is not connected")), f.abrupt("return");
                      case 3:
                        return d > 0 && a.logger.warn("Retry: send joinRoom message", { debuggingHint: "Retry attempt ".concat(d) }), f.prev = 4, f.next = 7, l(a, W)[W].socketHandler.joinRoom(e, t, n, r, l(a, js)[js]);
                      case 7:
                        f.next = 13;
                        break;
                      case 9:
                        throw f.prev = 9, f.t0 = f.catch(4), a.logger.error("Failed to send joinRoom message after retries", { error: f.t0 }), f.t0;
                      case 13:
                      case "end":
                        return f.stop();
                    }
                }, c, null, [[4, 9]]);
              }));
              return function(c, d) {
                return u.apply(this, arguments);
              };
            }(), { delayTime: 1e3, strategy: "exponential", maxRetryCount: 1 / 0 });
          case 2:
          case "end":
            return s.stop();
        }
    }, o);
  })), dp.apply(this, arguments);
}
function qO(o) {
  return pp.apply(this, arguments);
}
function pp() {
  return pp = m(/* @__PURE__ */ p().mark(function o(t) {
    var e, r, n;
    return p().wrap(function(i) {
      for (; ; )
        switch (i.prev = i.next) {
          case 0:
            if (e = this.context.getValue("flagsmith").hasFeature(me.PRECREATE_PRODUCERS), !(!e || !t)) {
              i.next = 3;
              break;
            }
            return i.abrupt("return");
          case 3:
            if (i.prev = 3, r = [], t.canProduceVideo === te.Allowed && r.push(this.shareWebcam(OO(!1))), t.canProduceAudio === te.Allowed && (n = _O(!1), n && r.push(this.shareMic(n))), !(r.length > 0)) {
              i.next = 10;
              break;
            }
            return i.next = 10, Promise.all(r);
          case 10:
            i.next = 15;
            break;
          case 12:
            i.prev = 12, i.t0 = i.catch(3), this.logger.warn("Failed to precreate producers", { error: i.t0 });
          case 15:
          case "end":
            return i.stop();
        }
    }, o, this, [[3, 12]]);
  })), pp.apply(this, arguments);
}
function GO(o) {
  return l(this, pr)[pr].get(o);
}
function WO(o, t) {
  return l(this, pr)[pr].set(o, t);
}
function JO(o) {
  return l(this, pr)[pr].delete(o);
}
function KO(o) {
  return { track: o, encodings: [{ priority: "high" }], codecOptions: [{ name: "opus" }], appData: { e2ee: this.e2ee }, stopTracks: !1, zeroRtpOnPause: !1 };
}
function zO(o, t) {
  return { track: o, codecOptions: t ? t.map(function(e) {
    return { name: e.split("/")[1] };
  }) : [{ name: "VP8" }], appData: { screenShare: !1, e2ee: this.e2ee }, stopTracks: !1 };
}
var ze = _g;
xe([O.trace("MediaNodeClient.reset", { country: O.location.country })], ze.prototype, "reset", 1);
xe([O.trace("MediaNodeClient.joinRoom")], ze.prototype, "joinRoom", 1);
xe([O.trace("MediaNodeClient.leaveRoom")], ze.prototype, "leaveRoom", 1);
xe([O.trace("MediaNodeClient.activatePeers")], ze.prototype, "activatePeers", 1);
xe([O.trace("MediaNodeClient.createConsumers")], ze.prototype, "createConsumers", 1);
xe([O.trace("MediaNodeClient.closeConsumers")], ze.prototype, "closeConsumers", 1);
xe([O.trace("MediaNodeClient._shareWebcam")], ze.prototype, "_shareWebcam", 1);
xe([O.trace("MediaNodeClient.shareWebcam")], ze.prototype, "shareWebcam", 1);
xe([O.trace("MediaNodeClient.shareScreen")], ze.prototype, "shareScreen", 1);
xe([O.trace("MediaNodeClient.shareMic")], ze.prototype, "shareMic", 1);
xe([O.trace("MediaNodeClient.pauseMic")], ze.prototype, "pauseMic", 1);
xe([O.trace("MediaNodeClient.pauseWebcam")], ze.prototype, "pauseWebcam", 1);
xe([O.trace("MediaNodeClient.resumeMic")], ze.prototype, "resumeMic", 1);
xe([O.trace("MediaNodeClient.resumeWebcam")], ze.prototype, "resumeWebcam", 1);
xe([O.trace("MediaNodeClient.disableWebcam")], ze.prototype, "disableWebcam", 1);
xe([O.trace("MediaNodeClient.disableMic")], ze.prototype, "disableMic", 1);
xe([O.trace("MediaNodeClient.disableScreenShare")], ze.prototype, "disableScreenShare", 1);
xe([O.trace("MediaNodeClient.muteSelf")], ze.prototype, "muteSelf", 1);
xe([O.trace("MediaNodeClient.resetVideoProducers")], ze.prototype, "resetVideoProducers", 1);
xe([O.trace("MediaNodeClient.changeDisplayName")], ze.prototype, "changeDisplayName", 1);
xe([O.trace("MediaNodeClient.kickPeer")], ze.prototype, "kick", 1);
xe([O.trace("MediaNodeClient.kickAllPeers")], ze.prototype, "kickAll", 1);
xe([O.trace("MediaNodeClient.muteAll")], ze.prototype, "muteAll", 1);
xe([O.trace("MediaNodeClient.muteAllVideo")], ze.prototype, "muteAllVideo", 1);
xe([O.trace("MediaNodeClient.disableAudio")], ze.prototype, "disableAudio", 1);
xe([O.trace("MediaNodeClient.disableVideo")], ze.prototype, "disableVideo", 1);
xe([O.trace("MediaNodeClient.pinPeer")], ze.prototype, "pinPeer", 1);
xe([O.trace("MediaNodeClient.validateScreenShare")], ze.prototype, "validateScreenShare", 1);
function Og(o, t) {
  var e = o.getValue("roomNodeClient");
  if (e) {
    if (e)
      return e;
    throw new Error("Room node client already set up.");
  }
  var r = new ze(o, t);
  return o.setValue("roomNodeClient", r), r;
}
function Dg(o) {
  var t = o.getValue("roomNodeClient");
  try {
    t == null || t.leaveRoom();
  } catch (e) {
    o.getValue("logger").error("roomNodeClient::cleanupRoomNodeClient");
  }
  o.setValue("roomNodeClient", void 0);
}
var YO = Object.defineProperty, QO = Object.getOwnPropertyDescriptor, no = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? QO(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && YO(e, r, a), a;
}, Lg = (ia = /* @__PURE__ */ S("socketService"), et = /* @__PURE__ */ S("roomSocketHandler"), X = /* @__PURE__ */ S("context"), lr = /* @__PURE__ */ S("roomNodeClient"), /* @__PURE__ */ function() {
  function o(t, e, r, n) {
    w(this, o), Object.defineProperty(this, lr, { get: XO, set: void 0 }), this.self = void 0, this.authToken = void 0, Object.defineProperty(this, ia, { writable: !0, value: void 0 }), this.viewType = void 0, Object.defineProperty(this, et, { writable: !0, value: void 0 }), Object.defineProperty(this, X, { writable: !0, value: void 0 });
    var a = r.socket, i = t.getValue("authToken");
    this.self = e, l(this, X)[X] = t, this.viewType = n, this.authToken = i, l(this, ia)[ia] = a, l(this, et)[et] = r, e.config.viewType !== Dt.Chat && this.setupEvents();
  }
  return P(o, [{ key: "peerId", get: function() {
    return l(this, X)[X].getValue("peerId");
  } }, {
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, X)[X].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, X)[X].getValue("logger");
  } }, { key: "mediaJoined", get: function() {
    return l(this, X)[X].getValue("connectionHandler").mediaJoined;
  } }, { key: "shareMediaTracks", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u, c, d, h, v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              if (n = this.self, a = n.audioTrack, i = n.videoTrack, s = n.permissions, u = n.audioEnabled, c = n.videoEnabled, d = n.screenShareEnabled, h = n.screenShareTracks, !(s.canProduceAudio === te.Allowed && u)) {
                k.next = 11;
                break;
              }
              return k.prev = 2, k.next = 5, l(this, lr)[lr].shareMic(a);
            case 5:
              this.self.audioEnabled || l(this, lr)[lr].pauseMic(), k.next = 11;
              break;
            case 8:
              k.prev = 8, k.t0 = k.catch(2), this.self.disableAudio();
            case 11:
              if (!(s.canProduceVideo === te.Allowed && c)) {
                k.next = 25;
                break;
              }
              return k.prev = 12, k.next = 15, l(this, lr)[lr].shareWebcam(i);
            case 15:
              if (v = k.sent, !(v && v.id !== i.id && l(this, X)[X].getValue("flagsmith").hasFeature(me.EXP_RESHARE))) {
                k.next = 19;
                break;
              }
              return k.next = 19, l(this, lr)[lr].shareWebcam(v);
            case 19:
              this.self.videoEnabled || l(this, lr)[lr].pauseWebcam(), k.next = 25;
              break;
            case 22:
              k.prev = 22, k.t1 = k.catch(12), this.self.disableVideo();
            case 25:
              if (!(s.canProduceScreenshare === te.Allowed && d)) {
                k.next = 34;
                break;
              }
              return k.prev = 26, k.next = 29, (f = l(this, lr)[lr]) === null || f === void 0 ? void 0 : f.shareScreen({ video: h.video, audio: h.audio });
            case 29:
              k.next = 34;
              break;
            case 31:
              k.prev = 31, k.t2 = k.catch(26), this.self.disableScreenShare();
            case 34:
            case "end":
              return k.stop();
          }
      }, r, this, [[2, 8], [12, 22], [26, 31]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "kickHandler",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                a = "kicked", (n == null ? void 0 : n.kickType) === "kickAll" && (a = "ended"), this.leaveRoom(a);
              case 3:
              case "end":
                return s.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * Waitlist handlers
    */
  }, { key: "waitlistedHandler", value: function() {
    this.logger.info("SelController.waitlisted"), this.self.waitlistStatus = "waiting", this.self.roomState = "waitlisted", this.self.emit("waitlisted");
  } }, { key: "waitlistAcceptHandler", value: function() {
    if (this.logger.info("SelController.waitlistAccepted"), this.self.waitlistStatus === "accepted") {
      this.logger.warn("SelfController.WAITLIST_ACCEPTED.UserAlreadyAccepted");
      return;
    }
    this.self.waitlistStatus = "accepted", this.joinRoom();
  } }, { key: "waitlistRejectedHandler", value: function() {
    if (this.logger.info("SelfController.waitlistRejected"), this.self.waitlistStatus === "rejected") {
      this.logger.warn("SelfController.WAITLIST_REJECTED.UserAlreadyRejected");
      return;
    }
    this.self.waitlistStatus = "rejected", this.leaveRoom("rejected");
  } }, { key: "resetSelf", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (l(this, X)[X].getValue("callstats").callEnded(), l(this, lr)[lr].reset(), !n) {
                i.next = 5;
                break;
              }
              return i.next = 5, this.joinRoom(n);
            case 5:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupEvents", value: function() {
    var e = this;
    l(this, X)[X].getValue("peerSessionStore").on(j.RESET_PRODUCER_STATE, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              if (e.mediaJoined) {
                a.next = 2;
                break;
              }
              return a.abrupt("return");
            case 2:
              e.shareMediaTracks();
            case 3:
            case "end":
              return a.stop();
          }
      }, r);
    }))), l(this, X)[X].getValue("peerSessionStore").on(j.ROOM_NODE_RECONNECTED, function() {
      e.self.roomState = "joined", e.self.emit("roomJoined", { reconnected: !0 });
    }), l(this, X)[X].getValue("peerSessionStore").on(j.ROOM_NODE_DISCONNECTED, function() {
      e.self.roomState !== "disconnected" && (e.self.roomState = "disconnected", e.self.emit("roomLeft", { state: "disconnected" }));
    }), l(this, X)[X].getValue("peerSessionStore").on(j.ROOM_NODE_FAILED, function() {
      e.self.roomState = "failed", e.self.emit("roomLeft", { state: "failed" });
    }), l(this, X)[X].getValue("peerSessionStore").on(j.SOCKET_SERVICE_RECONNECTED, function(r) {
      var n = r.wasJoinAttempted;
      n === !1 && (e.self.roomState = "init"), e.resetSelf(n);
    }), l(this, X)[X].getValue("peerSessionStore").on(j.SOCKET_SERVICE_DISCONNECTED, function(r) {
      var n = r.joinAttempted;
      if (e.self.roomState !== "disconnected") {
        var a = e.peerId;
        n && l(e, X)[X].getValue("flagsmith").hasFeature(me.REFRESH_ID_ON_DISCONNECTION) && (a = Js()), l(e, ia)[ia].updateURL(a);
        var i = l(e, X)[X].getValue("telemetry");
        i.resetPeerId(a);
        var s = pt();
        s.setHeader("tracing-id", a), Ha.remapContext(a, l(e, X)[X]), e.self.roomState = "disconnected", e.self.emit("roomLeft", { state: "disconnected" });
      }
    }), l(this, X)[X].getValue("peerSessionStore").on(j.SOCKET_SERVICE_FAILED, function() {
      e.self.roomState = "failed", e.self.emit("roomLeft", { state: "failed" });
    }), l(this, et)[et].on(Y.waitingRoomRequestAccepted, function() {
      e.waitlistAcceptHandler();
    }), l(this, et)[et].on($l.updateUserPreset, function(r) {
      r.updatePeersPresets.forEach(function(n) {
        n.userIds === e.self.userId && l(e, X)[X].getValue("peerSessionStore").emit(j.UPDATE_PERMISSIONS, n.patch);
      });
    }), l(this, et)[et].on(Y.waitingRoomRequestDenied, function() {
      e.waitlistRejectedHandler();
    }), l(this, et)[et].on(Y.kick, function() {
      e.kickHandler({ kickType: "kick" });
    }), l(this, et)[et].on(Y.kickAll, function() {
      e.kickHandler({ kickType: "kickAll" });
    }), l(this, X)[X].getValue("peerSessionStore").onAsync(j.JOIN_MEDIA_ROOM, this.joinMediaRoom.bind(this)), l(this, X)[X].getValue("peerSessionStore").on(j.PRODUCER_SCORE_UPDATE, function(r) {
      var n, a = r.score, i = r.kind, s = r.appData, u = r.scoreStats, c = (n = s == null ? void 0 : s.screenShare) !== null && n !== void 0 ? n : !1;
      e.self.emit("mediaScoreUpdate", { kind: i, isScreenshare: c, score: a, participantId: e.self.id, scoreStats: u });
    }), l(this, X)[X].getValue("peerSessionStore").on(j.MUTE_SELF, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              if (!e.self.audioEnabled) {
                a.next = 4;
                break;
              }
              return a.next = 3, e.self.disableAudio();
            case 3:
              l(e, X)[X].getValue("callstats").audioOff();
            case 4:
            case "end":
              return a.stop();
          }
      }, r);
    }))), l(this, X)[X].getValue("peerSessionStore").on(j.MUTE_SELF_VIDEO, /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              if (!e.self.videoEnabled) {
                a.next = 4;
                break;
              }
              return a.next = 3, e.self.disableVideo();
            case 3:
              l(e, X)[X].getValue("callstats").videoOff();
            case 4:
            case "end":
              return a.stop();
          }
      }, r);
    }))), l(this, X)[X].getValue("peerSessionStore").onAsync(j.LEAVE_MEDIA_ROOM, this.leaveMediaRoom.bind(this)), l(this, X)[X].getValue("peerSessionStore").on(j.PIP_HANGUP, this.leaveRoom.bind(this));
  } }, { key: "joinRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u = arguments;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return n = u.length > 0 && u[0] !== void 0 ? u[0] : !1, d.prev = 1, d.next = 4, l(this, et)[et].joinRoom(this.self);
            case 4:
              if (a = d.sent, i = a.peer, l(this, et)[et].socket.flush(), s = Gp(i.stageType), l(this, X)[X].setValue("stageStatus", s, !1), !i.waitlisted) {
                d.next = 12;
                break;
              }
              return this.waitlistedHandler(), d.abrupt("return");
            case 12:
              return d.next = 14, this.joinMediaRoom(n);
            case 14:
              l(this, X)[X].notify("stageStatus"), d.next = 21;
              break;
            case 17:
              throw d.prev = 17, d.t0 = d.catch(1), this.logger.error("Error in joinRoom", { error: d.t0 }), d.t0;
            case 21:
            case "end":
              return d.stop();
          }
      }, r, this, [[1, 17]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "leaveRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s = arguments;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              if (a = s.length > 0 && s[0] !== void 0 ? s[0] : "left", this.logger.info("Leaving room with state: ".concat(a)), (n = l(this, X)[X].getValue("roomSocketHandler")) === null || n === void 0 || n.cleanup(), a !== "rejected") {
                c.next = 7;
                break;
              }
              return this.self.roomState = a, this.self.emit("roomLeft", { state: a }), c.abrupt("return");
            case 7:
              return this.self.setIsPinned(!1), l(this, X)[X].setValue("stageStatus", "OFF_STAGE", !1), c.next = 11, this.leaveMediaRoom(a);
            case 11:
              l(this, X)[X].notify("stageStatus");
              try {
                (i = l(this, ia)[ia]) === null || i === void 0 || i.disconnect();
              } catch (d) {
                this.logger.error("SelfController::leaveRoom::socketDisconnect");
              }
              Dg(l(this, X)[X]), this.self.roomState = a, this.self.emit("roomLeft", { state: a }), this.logger.info("roomLeft event emitted with state: ".concat(a));
            case 17:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "joinMediaRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i, s, u, c, d, h, v, f, g, k, y, b, C = arguments;
      return p().wrap(function(E) {
        for (; ; )
          switch (E.prev = E.next) {
            case 0:
              if (n = C.length > 0 && C[0] !== void 0 ? C[0] : !1, a = l(this, X)[X].getAllValues(), i = a.peerId, s = a.viewType, u = a.meetingId, c = a.stageStatus, E.prev = 2, s !== Dt.Livestream) {
                E.next = 9;
                break;
              }
              if (c === "ON_STAGE") {
                E.next = 8;
                break;
              }
              return this.self.roomState = "joined", this.self.emit("roomJoined", { reconnected: n }), E.abrupt("return");
            case 8:
              Og(l(this, X)[X], { socket: l(this, ia)[ia], peerId: i });
            case 9:
              return v = this.self.permissions, f = v.canProduceAudio, g = v.canProduceVideo, k = v.canProduceScreenshare, E.next = 12, (h = l(this, lr)[lr]) === null || h === void 0 ? void 0 : h.joinRoom(this.self.name, u, n, n, { canProduceAudio: f, canProduceVideo: g, canProduceScreenshare: k });
            case 12:
              if (E.t1 = d = E.sent, E.t0 = E.t1 !== null, !E.t0) {
                E.next = 16;
                break;
              }
              E.t0 = d !== void 0;
            case 16:
              if (!E.t0) {
                E.next = 20;
                break;
              }
              E.t2 = d, E.next = 21;
              break;
            case 20:
              E.t2 = {};
            case 21:
              if (y = E.t2, b = y.roomJoined, b) {
                E.next = 25;
                break;
              }
              return E.abrupt("return");
            case 25:
              if (c !== "ON_STAGE") {
                E.next = 28;
                break;
              }
              return E.next = 28, this.shareMediaTracks();
            case 28:
              this.self.roomState = "joined", this.self.emit("roomJoined", { reconnected: n }), E.next = 36;
              break;
            case 32:
              throw E.prev = 32, E.t3 = E.catch(2), this.logger.error("Error:SelfController.mediaRoomJoin", { error: E.t3 }), new U("Error: could not join media room", "0002");
            case 36:
            case "end":
              return E.stop();
          }
      }, r, this, [[2, 32]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "leaveMediaRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              if (a = l(this, X)[X].getValue("viewType"), n === "connected-meeting") {
                s.next = 4;
                break;
              }
              return s.next = 4, this.cleanupSelf();
            case 4:
              if (!(n === "stageLeft" && a === Dt.Webinar)) {
                s.next = 6;
                break;
              }
              return s.abrupt("return");
            case 6:
              if (l(this, lr)[lr]) {
                s.next = 8;
                break;
              }
              return s.abrupt("return");
            case 8:
              if (!(l(this, lr)[lr].mediaJoined && n !== "disconnected")) {
                s.next = 11;
                break;
              }
              return s.next = 11, l(this, lr)[lr].leaveRoom();
            case 11:
              if (!(n === "stageLeft" && a === Dt.Livestream)) {
                s.next = 13;
                break;
              }
              return s.abrupt("return");
            case 13:
              l(this, lr)[lr].mediaJoined = !1;
            case 14:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "cleanupSelf", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              return a.next = 2, this.self.disableAudio();
            case 2:
              return a.next = 4, this.self.disableVideo();
            case 4:
              return a.next = 6, this.self.disableScreenShare();
            case 6:
              this.self.cleanUpTracks(), this.self.destructMediaHandler(), navigator.isReactNative || this.self.removeDocumentEventListeners();
            case 9:
            case "end":
              return a.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }], [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u) {
      var c, d, h, v, f, g;
      return p().wrap(function(y) {
        for (; ; )
          switch (y.prev = y.next) {
            case 0:
              return c = pt(), d = n.getValue("peerId"), h = !!n.getValue("cachedUserDetails"), y.next = 5, nt.__init__(n, i, s, u, u.name, h);
            case 5:
              return v = y.sent, n.setValue("self", v), f = n.getValue("logger"), navigator.product !== "ReactNative" ? (g = !n.getValue("flagsmith").hasFeature(me.PRECALL_BANDWIDTH_TEST), setTimeout(/* @__PURE__ */ m(/* @__PURE__ */ p().mark(function b() {
                var C;
                return p().wrap(function(E) {
                  for (; ; )
                    switch (E.prev = E.next) {
                      case 0:
                        return E.next = 2, v.getAllDevices();
                      case 2:
                        return C = E.sent, f.info("populated_full_device_list", { devices: JSON.stringify(C) }), n.getValue("callstats").devices("AUDIO", C == null ? void 0 : C.filter(function(D) {
                          return D.kind === "audioinput";
                        })), n.getValue("callstats").devices("VIDEO", C == null ? void 0 : C.filter(function(D) {
                          return D.kind === "videoinput";
                        })), n.getValue("callstats").devices("SPEAKER", C == null ? void 0 : C.filter(function(D) {
                          return D.kind === "audiooutput";
                        })), f.info("Callstats:: initializing"), E.prev = 8, E.t0 = n.getValue("callstats"), E.t1 = d, E.t2 = kr.getDeviceInfo().engineName, E.t3 = n.getValue("env"), E.next = 15, c.getICEServers();
                      case 15:
                        return E.t4 = E.sent, E.t5 = n.getValue("apiBase"), E.t6 = n.getValue("flagsmith").getAllFlags(), E.t7 = f, E.t8 = Kf(n), E.t9 = g, E.t10 = { peerId: E.t1, engineName: E.t2, env: E.t3, iceServers: E.t4, apiBase: E.t5, flags: E.t6, logger: E.t7, apiHostnames: E.t8, skipConnectivityChecks: E.t9 }, E.next = 24, E.t0.initialize.call(E.t0, E.t10);
                      case 24:
                        f.info("Callstats:: initialized"), E.next = 30;
                        break;
                      case 27:
                        E.prev = 27, E.t11 = E.catch(8), f.error("Callstats:: initialization failed", { error: E.t11 });
                      case 30:
                      case "end":
                        return E.stop();
                    }
                }, b, null, [[8, 27]]);
              })), 0)) : f.info("Callstats:: Skipped initialization due to navigator product being ReactNative."), y.abrupt("return", new Lg(n, v, a, u.viewType));
            case 10:
            case "end":
              return y.stop();
          }
      }, r);
    }));
    function e(r, n, a, i, s) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}());
function XO() {
  return l(this, X)[X].getValue("roomNodeClient");
}
var Di = Lg;
no([O.trace("SelfController.resetSelf")], Di.prototype, "resetSelf", 1);
no([O.trace("SelfController.setupEvents")], Di.prototype, "setupEvents", 1);
no([O.trace("SelfController.joinRoom")], Di.prototype, "joinRoom", 1);
no([O.trace("SelfController.leaveRoom")], Di.prototype, "leaveRoom", 1);
no([O.trace("SelfController.joinMediaRoom")], Di.prototype, "joinMediaRoom", 1);
no([O.trace("SelfController.leaveMediaRoom")], Di.prototype, "leaveMediaRoom", 1);
no([O.trace("SelfController.init")], Di, "init", 1);
var Su = /* @__PURE__ */ S("socket"), ZO = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, Su, { writable: !0, value: void 0 }), l(this, Su)[Su] = t;
  }
  return P(o, [{ key: "on", value: function(e, r) {
    var n;
    e === Y.roomPeerCount ? n = Xh.fromBinary.bind(Xh) : n = uv.fromBinary.bind(uv), l(this, Su)[Su].on(e, function(a) {
      var i = a.payload;
      if (!(e === Y.roomPeerCount && !i)) {
        var s = n(i);
        r(s);
      }
    });
  } }]);
}(), Eu = /* @__PURE__ */ S("socket"), Cu = /* @__PURE__ */ S("context"), xO = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, Eu, { writable: !0, value: void 0 }), Object.defineProperty(this, Cu, { writable: !0, value: void 0 }), l(this, Eu)[Eu] = e, l(this, Cu)[Cu] = t;
  }
  return P(o, [{ key: "logger", get: (
    /**
    * @private access
    * Not for external use
    */
    function() {
      return l(this, Cu)[Cu].getValue("logger");
    }
  ) }, { key: "on", value: function(e, r) {
    var n = this, a, i;
    switch (e) {
      case Y.transcript: {
        a = Bc.fromBinary.bind(Bc), i = Bc.create();
        break;
      }
      default: {
        this.logger.debug("AISocketHandler switch case hit default, event not accounted for.");
        break;
      }
    }
    l(this, Eu)[Eu].on(e, function(s) {
      var u = s.payload, c = i;
      try {
        c = a(u);
      } catch (d) {
        n.logger.error("chatSocketHandler::on::binary_decode_error", { error: d });
      }
      return r(c);
    });
  } }]);
}(), eD = Object.defineProperty, rD = Object.getOwnPropertyDescriptor, Qp = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? rD(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && eD(e, r, a), a;
}, Qt = /* @__PURE__ */ S("socket"), Ps = /* @__PURE__ */ S("context"), Mc = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, Qt, { writable: !0, value: void 0 }), Object.defineProperty(this, Ps, { writable: !0, value: void 0 }), l(this, Qt)[Qt] = e, l(this, Ps)[Ps] = t;
  }
  return P(o, [{
    key: "logger",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Ps)[Ps].getValue("logger");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "telemetry", get: function() {
    return l(this, Ps)[Ps].getValue("telemetry");
  } }, { key: "getPolls", value: function() {
    return l(this, Qt)[Qt].sendMessagePromise($a.getPolls);
  } }, { key: "createPoll", value: function(e, r) {
    var n = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : !1, a = arguments.length > 3 && arguments[3] !== void 0 ? arguments[3] : !1, i = { anonymous: n, hideVotes: a, question: e, options: r };
    return l(this, Qt)[Qt].sendMessage($a.createPoll, IA.toBinary(i));
  } }, { key: "votePoll", value: function(e, r) {
    var n = { index: r, pollId: e };
    return l(this, Qt)[Qt].sendMessage($a.votePoll, _A.toBinary(n));
  } }, { key: "on", value: function(e, r) {
    var n = this, a, i;
    switch (e) {
      case $a.updatePoll:
      case $a.createPoll:
      case $a.votePoll: {
        a = zc.fromBinary.bind(zc), i = zc.create();
        break;
      }
    }
    l(this, Qt)[Qt].on(e, function(s) {
      var u = s.payload, c = i;
      try {
        c = a(u);
      } catch (d) {
        n.logger.error("pollSocketHandler::on::binary_decode_error", { error: d });
      }
      return r(c);
    });
  } }, { key: "removeListeners", value: function(e) {
    l(this, Qt)[Qt].removeListeners(e);
  } }]);
}();
Qp([O.trace("PollSocketHandler.getPolls")], Mc.prototype, "getPolls", 1);
Qp([O.trace("PollSocketHandler.createPoll")], Mc.prototype, "createPoll", 1);
Qp([O.trace("PollSocketHandler.votePoll")], Mc.prototype, "votePoll", 1);
var tD = Object.defineProperty, nD = Object.getOwnPropertyDescriptor, aD = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? nD(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && tD(e, r, a), a;
}, Ur = /* @__PURE__ */ S("context"), $g = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), this.socket = void 0, Object.defineProperty(this, Ur, { writable: !0, value: void 0 }), l(this, Ur)[Ur] = t, this.socket = e, this.handleSocketEvents(), l(this, Ur)[Ur].setValue("roomSocketHandler", this);
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, Ur)[Ur].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, Ur)[Ur].getValue("logger");
  } }, { key: "cleanup", value: function() {
    try {
      var e;
      (e = this.socket) === null || e === void 0 || e.disconnect();
    } catch (r) {
      this.logger.error("roomSocketHandler::cleanup");
    }
  } }, { key: "joinRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k;
      return p().wrap(function(b) {
        for (; ; )
          switch (b.prev = b.next) {
            case 0:
              return this.socket.joinAttempted = !0, i = { capabilities: [], peer: { displayName: (a = n.name) !== null && a !== void 0 ? a : "Participant", customParticipantId: n.customParticipantId, peerId: n.id, userId: n.userId, displayPictureUrl: n.picture, waitlisted: !1 }, roomUuid: "" }, s = this.socket.sendMessagePromise(Y.joinRoom, gC.toBinary(i)), b.prev = 3, b.t0 = ko, b.next = 7, s;
            case 7:
              return b.t1 = b.sent.payload, u = b.t0.fromBinary.call(b.t0, b.t1), c = u.peer, l(this, Ur)[Ur].getValue("connectionHandler").socketJoined = !0, l(this, Ur)[Ur].getValue("peerSessionStore").emit(j.SOCKET_SERVICE_ROOM_JOINED, { peer: c }), d = this.getRoomState(), h = this.getRoomPeersNonPaginated(), b.next = 16, Promise.all([d, h]);
            case 16:
              return v = b.sent, f = He(v, 2), g = f[0].room, k = f[1].peers, l(this, Ur)[Ur].getValue("peerSessionStore").emit(j.ROOM_STATE, g), l(this, Ur)[Ur].getValue("peerSessionStore").emit(j.SOCKET_PEERS, k), b.abrupt("return", { peer: c });
            case 25:
              throw b.prev = 25, b.t2 = b.catch(3), this.logger.error("RoomSocketHandler.joinRoom.failed", { error: b.t2 }), new U("Error: RoomSocketHandler.joinRoom failed.", "0002", this.logger, b.t2);
            case 29:
            case "end":
              return b.stop();
          }
      }, r, this, [[3, 25]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getAllAddedParticipants", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.prev = 0, i.t0 = eR, i.next = 4, this.socket.sendMessagePromise(Y.getAllAddedParticipants);
            case 4:
              return i.t1 = i.sent.payload, n = i.t0.fromBinary.call(i.t0, i.t1), i.abrupt("return", n.participants.map(function(s) {
                var u = s.id, c = lc(s, em);
                return $($({}, c), {}, { userId: u });
              }));
            case 9:
              return i.prev = 9, i.t2 = i.catch(0), i.abrupt("return", []);
            case 12:
            case "end":
              return i.stop();
          }
      }, r, this, [[0, 9]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getRoomPeers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return h.prev = 0, u = {
                // F
                seachQuery: n,
                limit: a,
                offset: i
              }, h.next = 4, this.socket.sendMessagePromise(Y.getRoomPeersInfo, sC.toBinary(u));
            case 4:
              c = h.sent, s = qc.fromBinary(c.payload), h.next = 11;
              break;
            case 8:
              h.prev = 8, h.t0 = h.catch(0), this.logger.error("getRoomPeers::binary_decode_error", { error: h.t0 });
            case 11:
              return h.abrupt("return", s);
            case 12:
            case "end":
              return h.stop();
          }
      }, r, this, [[0, 8]]);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "getRoomPeersNonPaginated",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r() {
        var n, a;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return s.prev = 0, s.next = 3, this.socket.sendMessagePromise(Y.getRoomPeersInfo);
              case 3:
                a = s.sent, n = qc.fromBinary(a.payload), s.next = 10;
                break;
              case 7:
                s.prev = 7, s.t0 = s.catch(0), this.logger.error("getRoomJoinedPeers::binary_decode_error", { error: s.t0 });
              case 10:
                return s.abrupt("return", n);
              case 11:
              case "end":
                return s.stop();
            }
        }, r, this, [[0, 7]]);
      }));
      function e() {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    *  TODO:(ishita1805): uncomment this code when
    * socket service sends entire peer objects for roomEvents.getStagePeers
    */
  }, { key: "getStagePeers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.prev = 0, s.next = 3, this.socket.sendMessagePromise(Y.getRoomPeersInfo);
            case 3:
              a = s.sent, n = qc.fromBinary(a.payload), s.next = 10;
              break;
            case 7:
              s.prev = 7, s.t0 = s.catch(0), this.logger.error("getRoomJoinedPeers::binary_decode_error", { error: s.t0 });
            case 10:
              return s.abrupt("return", n);
            case 11:
            case "end":
              return s.stop();
          }
      }, r, this, [[0, 7]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getPeerInfo", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.prev = 0, u.next = 3, this.socket.sendMessagePromise(Y.getPeerInfo, ng.toBinary({ peerId: n }));
            case 3:
              i = u.sent, a = ko.fromBinary(i.payload), u.next = 10;
              break;
            case 7:
              u.prev = 7, u.t0 = u.catch(0), this.logger.error("getPeerInfo::binary_decode_error", { error: u.t0 });
            case 10:
              return u.abrupt("return", a);
            case 11:
            case "end":
              return u.stop();
          }
      }, r, this, [[0, 7]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getRoomState", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return n = Zh.create(), s.prev = 1, s.next = 4, this.socket.sendMessagePromise(Y.getRoomInfo);
            case 4:
              a = s.sent, n = Zh.fromBinary(a.payload), s.next = 11;
              break;
            case 8:
              s.prev = 8, s.t0 = s.catch(1), this.logger.error("getRoomState::binary_decode_error", { error: s.t0 });
            case 11:
              return s.abrupt("return", n);
            case 12:
            case "end":
              return s.stop();
          }
      }, r, this, [[1, 8]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getRoomStageState", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return n = tv.create(), s.prev = 1, s.next = 4, this.socket.sendMessagePromise(Y.getRoomStageState);
            case 4:
              a = s.sent, n = tv.fromBinary(a.payload), s.next = 11;
              break;
            case 8:
              s.prev = 8, s.t0 = s.catch(1), this.logger.error("getRoomStageState::binary_decode_error", { error: s.t0 });
            case 11:
              return s.abrupt("return", n);
            case 12:
            case "end":
              return s.stop();
          }
      }, r, this, [[1, 8]]);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "broadcastMessage", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return i = {
                type: n,
                payload: new TextEncoder().encode(JSON.stringify(a)),
                timestamp: Date.now(),
                ids: []
                // broadcast to all in all cases, this field has no value
              }, u.abrupt("return", this.socket.sendMessagePromise(Y.broadcastMessage, Qo.toBinary(i)));
            case 2:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "broadcastToMeetings", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return s = {
                type: n,
                payload: new TextEncoder().encode(JSON.stringify(i)),
                timestamp: Date.now(),
                ids: a,
                // Broadcast to given meetings
                broadcastType: 1
                // meetings
              }, c.abrupt("return", this.socket.sendMessagePromise(Y.broadcastToEntity, Qo.toBinary(s)));
            case 2:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "broadcastToPeers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i) {
      var s;
      return p().wrap(function(c) {
        for (; ; )
          switch (c.prev = c.next) {
            case 0:
              return s = {
                type: n,
                payload: new TextEncoder().encode(JSON.stringify(i)),
                timestamp: Date.now(),
                ids: a,
                // Broadcast to peers
                broadcastType: 0
                // peers
              }, c.abrupt("return", this.socket.sendMessage(Y.broadcastToEntity, Qo.toBinary(s)));
            case 2:
            case "end":
              return c.stop();
          }
      }, r, this);
    }));
    function e(r, n, a) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "leaveRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              this.socket.joinAttempted = !1, this.socket.sendMessagePromise(Y.leaveRoom, yC.toBinary({}));
            case 2:
            case "end":
              return a.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "kick", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              a = { peerIds: [n] }, this.socket.sendMessage(Y.kick, ig.toBinary(a));
            case 2:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "kickAll", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a, i = arguments;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              n = i.length > 0 && i[0] !== void 0 ? i[0] : !1, a = { propagateKickAcrossRooms: n }, this.socket.sendMessage(Y.kickAll, eg.toBinary(a));
            case 3:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getWaitingRoomRequests", value: function() {
    this.socket.sendMessage(Y.getWaitingRoomRequests);
  } }, { key: "acceptWaitingRoomRequest", value: function(e) {
    var r = { userIds: e };
    this.socket.sendMessage(Y.acceptWaitingRoomRequests, sR.toBinary(r));
  } }, { key: "rejectWaitingRoomRequest", value: function(e) {
    var r = { userIds: e };
    this.socket.sendMessage(Y.denyWaitingRoomRequests, uR.toBinary(r));
  } }, { key: "updatePermissions", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return i = { updatePeersPresets: [] }, n.forEach(function(c) {
                i.updatePeersPresets.push({ userIds: c, patch: a });
              }), u.abrupt("return", this.socket.sendMessagePromise($l.updateUserPreset, VR.toBinary(i)));
            case 3:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r, n) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "handleSocketEvents", value: function() {
    var e = this;
    this.socket.on(Y.broadcastMessage, function(r) {
      var n = r.payload;
      try {
        var a = Qo.fromBinary(n);
        l(e, Ur)[Ur].getValue("peerSessionStore").emit(j.ROOM_MESSAGE, { payload: JSON.parse(new TextDecoder().decode(a.payload)), type: a.type, timestamp: a.timestamp });
      } catch (i) {
        e.logger.error("failed to decode broadcast message:", i);
      }
    }), this.socket.on(Y.broadcastToEntity, function(r) {
      var n = r.payload;
      try {
        var a = Qo.fromBinary(n);
        l(e, Ur)[Ur].getValue("peerSessionStore").emit(j.MESSAGE, { payload: JSON.parse(new TextDecoder().decode(a.payload)), type: a.type, timestamp: a.timestamp });
      } catch (i) {
        e.logger.error("failed to decode peer broadcast message:", i);
      }
    });
  } }, { key: "on", value: function(e, r) {
    var n = this, a, i;
    switch (e) {
      case Y.joinRoom:
      case Y.leaveRoom:
      case Y.kick:
      case Y.kickAll: {
        a = ko.fromBinary.bind(ko), i = ko.create();
        break;
      }
      case Y.getWaitingRoomRequests: {
        a = function(u, c) {
          return u ? rv.fromBinary(u, c) : { requests: [] };
        }, i = rv.create();
        break;
      }
      case Y.recordingPaused:
      case Y.recordingStarted:
      case Y.recordingStopped: {
        a = dv.fromBinary.bind(dv);
        break;
      }
      case $l.updateUserPreset: {
        a = nv.fromBinary.bind(nv);
        break;
      }
      case Vn.peerJoinedBroadcast:
      case Ci.peerJoinedBroadcast: {
        a = Jh.fromBinary.bind(Jh);
        break;
      }
      case Vn.selfJoinComplete:
      case Ci.selfJoinComplete: {
        a = Ed.fromBinary.bind(Ed);
        break;
      }
      case Vn.globalPeerPinBroadcast:
      case Ci.globalPeerPinBroadcast: {
        a = Yh.fromBinary.bind(Yh);
        break;
      }
      case Vn.selectedPeer:
      case Ci.selectedPeer: {
        a = Sd.fromBinary.bind(Sd);
        break;
      }
      case Vn.selectedPeerDiff:
      case Ci.selectedPeerDiff: {
        a = Wh.fromBinary.bind(Wh);
        break;
      }
      case Vn.leaveRoom:
      case Ci.leaveRoom: {
        a = Cd.fromBinary.bind(Cd);
        break;
      }
    }
    this.socket.on(e, function(s) {
      var u = s.payload, c = i;
      if (!a)
        return r(void 0);
      try {
        c = a(u);
      } catch (d) {
        n.logger.error("roomSocketHandler::on::binary_decode_error", { error: d });
      }
      return r(c);
    });
  } }, { key: "getUserPermissions", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c;
      return p().wrap(function(h) {
        for (; ; )
          switch (h.prev = h.next) {
            case 0:
              return a = { userIds: [n] }, h.prev = 1, h.next = 4, this.socket.sendMessagePromise($l.getUserPresets, MR.toBinary(a));
            case 4:
              return i = h.sent, s = LR.fromBinary(i.payload).peerPresets[0], u = new TextDecoder().decode(s.preset), c = JSON.parse(u).permissions, h.abrupt("return", { chat: c.chat, polls: c.polls, plugins: c.plugins });
            case 11:
              throw h.prev = 11, h.t0 = h.catch(1), this.logger.error("Error in getting user preset", { error: h.t0 }), h.t0;
            case 15:
            case "end":
              return h.stop();
          }
      }, r, this, [[1, 11]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}();
aD([O.trace("RoomSocketHandler.joinRoom")], $g.prototype, "joinRoom", 1);
var Cr = /* @__PURE__ */ S("socket"), iD = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), Object.defineProperty(this, Cr, { writable: !0, value: void 0 }), l(this, Cr)[Cr] = t;
  }
  return P(o, [{ key: "getStageRequests", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, Cr)[Cr].sendMessagePromise(Y.getStageRequests);
            case 2:
              return n = s.sent, a = n.payload, s.abrupt("return", a ? Kc.fromBinary(a) : { stageRequests: [] });
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "requestAccess", value: function() {
    l(this, Cr)[Cr].sendMessage(Y.requestStageAccess);
  } }, { key: "cancelRequestAccess", value: function() {
    l(this, Cr)[Cr].sendMessage(Y.cancelStageRequest);
  } }, { key: "grantAccess", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              a = { userIds: n }, l(this, Cr)[Cr].sendMessage(Y.grantStageAccess, kA.toBinary(a));
            case 2:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "denyAccess", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              a = { userIds: n }, l(this, Cr)[Cr].sendMessage(Y.denyStageAccess, TA.toBinary(a));
            case 2:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "joinStage", value: function() {
    return l(this, Cr)[Cr].sendMessagePromise(Y.joinStage, void 0, void 0, Y.peerStageStatusUpdate);
  } }, { key: "leaveStage", value: function(e) {
    var r = { userIds: [e] };
    return l(this, Cr)[Cr].sendMessagePromise(Y.leaveStage, cv.toBinary(r), void 0, Y.peerStageStatusUpdate);
  } }, { key: "kick", value: function(e) {
    var r = { userIds: e };
    return l(this, Cr)[Cr].sendMessagePromise(Y.leaveStage, cv.toBinary(r));
  } }, { key: "on", value: function(e, r) {
    var n;
    switch (e) {
      case Y.grantStageAccess:
      case Y.denyStageAccess: {
        n = void 0;
        break;
      }
      case Y.getStagePeers: {
        n = lv.fromBinary.bind(lv);
        break;
      }
      case Y.getStageRequests:
      case Y.requestStageAccess:
      case Y.cancelStageRequest: {
        n = Kc.fromBinary.bind(Kc);
        break;
      }
      case Y.peerStageStatusUpdate: {
        n = Qh.fromBinary.bind(Qh);
        break;
      }
    }
    l(this, Cr)[Cr].on(e, function(a) {
      var i = a.payload, s = a.id;
      if (!i || !n)
        return r(void 0, s);
      var u = n(i);
      return r(u, s);
    });
  } }, { key: "getPeerInfo", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, Cr)[Cr].sendMessagePromise(Y.getPeerInfo, ng.toBinary({ peerId: n }));
            case 2:
              return a = s.sent, s.abrupt("return", ko.fromBinary(a.payload));
            case 4:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), Fe = /* @__PURE__ */ S("socket"), Ru = /* @__PURE__ */ S("context"), sD = /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, Fe, { writable: !0, value: void 0 }), Object.defineProperty(this, Ru, { writable: !0, value: void 0 }), l(this, Fe)[Fe] = e, l(this, Ru)[Ru] = t;
  }
  return P(o, [{ key: "logger", get: function() {
    return l(this, Ru)[Ru].getValue("logger");
  } }, { key: "addPlugin", value: function(e, r) {
    l(this, Fe)[Fe].sendMessage(se.addPlugin, N1.toBinary({ pluginId: e, staggered: r }));
  } }, { key: "removePlugin", value: function(e) {
    l(this, Fe)[Fe].sendMessage(se.removePlugin, U1.toBinary({ pluginId: e, staggered: !1 }));
  } }, { key: "getActivePlugins", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n, a;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return s.next = 2, l(this, Fe)[Fe].sendMessagePromise(se.getPlugins);
            case 2:
              return n = s.sent, a = n.payload, s.abrupt("return", a ? oA.fromBinary(a) : { plugins: [] });
            case 5:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "customPluginEventToRoom", value: function(e, r, n) {
    var a = { pluginId: e, pluginData: new TextEncoder().encode(JSON.stringify(r)) };
    l(this, Fe)[Fe].sendMessage(se.customPluginEventToRoom, z1.toBinary(a), n);
  } }, { key: "customPluginEventToPeers", value: function(e, r, n, a) {
    var i = { pluginId: e, peerIds: r, pluginData: new TextEncoder().encode(JSON.stringify(n)) };
    l(this, Fe)[Fe].sendMessage(se.customPluginEventToPeers, Q1.toBinary(i), a);
  } }, { key: "enablePluginForRoom", value: function(e, r) {
    l(this, Fe)[Fe].sendMessage(se.enablePluginForRoom, F1.toBinary({ pluginId: e }), r);
  } }, { key: "enablePluginForPeers", value: function(e, r, n) {
    l(this, Fe)[Fe].sendMessage(se.enablePluginForPeers, G1.toBinary({ pluginId: e, peerIds: r }), n);
  } }, { key: "disablePluginForRoom", value: function(e, r) {
    l(this, Fe)[Fe].sendMessage(se.disablePluginForRoom, B1.toBinary({ pluginId: e }), r);
  } }, { key: "disablePluginForPeers", value: function(e, r, n) {
    l(this, Fe)[Fe].sendMessage(se.disablePluginForPeers, J1.toBinary({ pluginId: e, peerIds: r }), n);
  } }, { key: "storeInsertKeys", value: function(e, r, n, a) {
    var i = { pluginId: e, storeName: r, insertKeys: n.map(function(s) {
      return { storeKey: s.key, payload: new TextEncoder().encode(JSON.stringify(s.payload)) };
    }) };
    l(this, Fe)[Fe].sendMessage(se.storeInsertKeys, av.toBinary(i), a);
  } }, { key: "storeGetKeys", value: function(e, r, n, a) {
    var i = { pluginId: e, storeName: r, getKeys: n.map(function(s) {
      return { storeKey: s.key };
    }) };
    l(this, Fe)[Fe].sendMessage(se.storeGetKeys, eA.toBinary(i), a);
  } }, { key: "storeDeleteKeys", value: function(e, r, n, a) {
    var i = { pluginId: e, storeName: r, deleteKeys: n.map(function(s) {
      return { storeKey: s.key };
    }) };
    l(this, Fe)[Fe].sendMessage(se.storeDeleteKeys, tA.toBinary(i), a);
  } }, {
    key: "storeDelete",
    value: function(e, r, n) {
      l(this, Fe)[Fe].sendMessage(se.storeDelete, aA.toBinary({ pluginId: e, storeName: r }), n);
    }
    /**
    * @deprecated
    */
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "getPluginDataOld",
    value: function(e, r) {
      this.logger.info("getPluginDataOld", { plugin: { id: e, storeName: r } });
    }
    /**
    * @deprecated
    */
  }, { key: "storePluginDataOld", value: function(e, r, n) {
    var a = { pluginId: e, storeName: r, insertKeys: [{ storeKey: n.key, payload: new TextEncoder().encode(JSON.stringify(n)) }] };
    l(this, Fe)[Fe].sendMessage(se.storeInsertKeys, av.toBinary(a));
  } }, { key: "on", value: function(e, r) {
    var n;
    switch (e) {
      case se.addPlugin:
      case se.enablePluginForPeers:
      case se.enablePluginForRoom: {
        n = Md.fromBinary.bind(Md);
        break;
      }
      case se.removePlugin:
      case se.disablePluginForPeers:
      case se.disablePluginForRoom: {
        n = iv.fromBinary.bind(iv);
        break;
      }
      case se.customPluginEventToPeers:
      case se.customPluginEventToRoom: {
        n = ov.fromBinary.bind(ov);
        break;
      }
      case se.storeInsertKeys:
      case se.storeGetKeys:
      case se.storeDeleteKeys:
      case se.storeDelete: {
        n = sv.fromBinary.bind(sv);
        break;
      }
    }
    l(this, Fe)[Fe].on(e, function(a) {
      var i = a.payload, s = a.id, u = n(i);
      return r(u, s);
    });
  } }]);
}(), oD = Object.defineProperty, uD = function(t, e, r) {
  return e in t ? oD(t, e, { enumerable: !0, configurable: !0, writable: !0, value: r }) : t[e] = r;
}, lD = function(t, e, r) {
  return uD(t, be(e) != "symbol" ? e + "" : e, r), r;
}, Xp = function(t, e, r) {
  if (!e.has(t))
    throw TypeError("Cannot " + r);
}, J = function(t, e, r) {
  return Xp(t, e, "read from private field"), r ? r.call(t) : e.get(t);
}, mr = function(t, e, r) {
  if (e.has(t))
    throw TypeError("Cannot add the same private member more than once");
  e instanceof WeakSet ? e.add(t) : e.set(t, r);
}, Ke = function(t, e, r, n) {
  return Xp(t, e, "write to private field"), n ? n.call(t, r) : e.set(t, r), r;
}, Pr = function(t, e, r) {
  return Xp(t, e, "access private method"), r;
}, ac = {}, cD = { get exports() {
  return ac;
}, set exports(o) {
  ac = o;
} }, Mo = (typeof Reflect == "undefined" ? "undefined" : be(Reflect)) == "object" ? Reflect : null, Pv = Mo && typeof Mo.apply == "function" ? Mo.apply : function(o, t, e) {
  return Function.prototype.apply.call(o, t, e);
}, Vl;
Mo && typeof Mo.ownKeys == "function" ? Vl = Mo.ownKeys : Object.getOwnPropertySymbols ? Vl = function(t) {
  return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t));
} : Vl = function(t) {
  return Object.getOwnPropertyNames(t);
};
function dD(o) {
  console && console.warn && console.warn(o);
}
var Ng = Number.isNaN || function(o) {
  return o !== o;
};
function Ze() {
  Ze.init.call(this);
}
cD.exports = Ze;
ac.once = fD;
Ze.EventEmitter = Ze;
Ze.prototype._events = void 0;
Ze.prototype._eventsCount = 0;
Ze.prototype._maxListeners = void 0;
var Sv = 10;
function _c(o) {
  if (typeof o != "function")
    throw new TypeError('The "listener" argument must be of type Function. Received type ' + be(o));
}
Object.defineProperty(Ze, "defaultMaxListeners", { enumerable: !0, get: function() {
  return Sv;
}, set: function(t) {
  if (typeof t != "number" || t < 0 || Ng(t))
    throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received ' + t + ".");
  Sv = t;
} });
Ze.init = function() {
  (this._events === void 0 || this._events === Object.getPrototypeOf(this)._events) && (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0), this._maxListeners = this._maxListeners || void 0;
};
Ze.prototype.setMaxListeners = function(o) {
  if (typeof o != "number" || o < 0 || Ng(o))
    throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received ' + o + ".");
  return this._maxListeners = o, this;
};
function Vg(o) {
  return o._maxListeners === void 0 ? Ze.defaultMaxListeners : o._maxListeners;
}
Ze.prototype.getMaxListeners = function() {
  return Vg(this);
};
Ze.prototype.emit = function(o) {
  for (var t = [], e = 1; e < arguments.length; e++)
    t.push(arguments[e]);
  var r = o === "error", n = this._events;
  if (n !== void 0)
    r = r && n.error === void 0;
  else if (!r)
    return !1;
  if (r) {
    var a;
    if (t.length > 0 && (a = t[0]), a instanceof Error)
      throw a;
    var i = new Error("Unhandled error." + (a ? " (" + a.message + ")" : ""));
    throw i.context = a, i;
  }
  var s = n[o];
  if (s === void 0)
    return !1;
  if (typeof s == "function")
    Pv(s, this, t);
  else
    for (var u = s.length, c = Bg(s, u), e = 0; e < u; ++e)
      Pv(c[e], this, t);
  return !0;
};
function Ug(o, t, e, r) {
  var n, a, i;
  if (_c(e), a = o._events, a === void 0 ? (a = o._events = /* @__PURE__ */ Object.create(null), o._eventsCount = 0) : (a.newListener !== void 0 && (o.emit("newListener", t, e.listener ? e.listener : e), a = o._events), i = a[t]), i === void 0)
    i = a[t] = e, ++o._eventsCount;
  else if (typeof i == "function" ? i = a[t] = r ? [e, i] : [i, e] : r ? i.unshift(e) : i.push(e), n = Vg(o), n > 0 && i.length > n && !i.warned) {
    i.warned = !0;
    var s = new Error("Possible EventEmitter memory leak detected. " + i.length + " " + String(t) + " listeners added. Use emitter.setMaxListeners() to increase limit");
    s.name = "MaxListenersExceededWarning", s.emitter = o, s.type = t, s.count = i.length, dD(s);
  }
  return o;
}
Ze.prototype.addListener = function(o, t) {
  return Ug(this, o, t, !1);
};
Ze.prototype.on = Ze.prototype.addListener;
Ze.prototype.prependListener = function(o, t) {
  return Ug(this, o, t, !0);
};
function pD() {
  if (!this.fired)
    return this.target.removeListener(this.type, this.wrapFn), this.fired = !0, arguments.length === 0 ? this.listener.call(this.target) : this.listener.apply(this.target, arguments);
}
function jg(o, t, e) {
  var r = { fired: !1, wrapFn: void 0, target: o, type: t, listener: e }, n = pD.bind(r);
  return n.listener = e, r.wrapFn = n, n;
}
Ze.prototype.once = function(o, t) {
  return _c(t), this.on(o, jg(this, o, t)), this;
};
Ze.prototype.prependOnceListener = function(o, t) {
  return _c(t), this.prependListener(o, jg(this, o, t)), this;
};
Ze.prototype.removeListener = function(o, t) {
  var e, r, n, a, i;
  if (_c(t), r = this._events, r === void 0)
    return this;
  if (e = r[o], e === void 0)
    return this;
  if (e === t || e.listener === t)
    --this._eventsCount === 0 ? this._events = /* @__PURE__ */ Object.create(null) : (delete r[o], r.removeListener && this.emit("removeListener", o, e.listener || t));
  else if (typeof e != "function") {
    for (n = -1, a = e.length - 1; a >= 0; a--)
      if (e[a] === t || e[a].listener === t) {
        i = e[a].listener, n = a;
        break;
      }
    if (n < 0)
      return this;
    n === 0 ? e.shift() : hD(e, n), e.length === 1 && (r[o] = e[0]), r.removeListener !== void 0 && this.emit("removeListener", o, i || t);
  }
  return this;
};
Ze.prototype.off = Ze.prototype.removeListener;
Ze.prototype.removeAllListeners = function(o) {
  var t, e, r;
  if (e = this._events, e === void 0)
    return this;
  if (e.removeListener === void 0)
    return arguments.length === 0 ? (this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0) : e[o] !== void 0 && (--this._eventsCount === 0 ? this._events = /* @__PURE__ */ Object.create(null) : delete e[o]), this;
  if (arguments.length === 0) {
    var n = Object.keys(e), a;
    for (r = 0; r < n.length; ++r)
      a = n[r], a !== "removeListener" && this.removeAllListeners(a);
    return this.removeAllListeners("removeListener"), this._events = /* @__PURE__ */ Object.create(null), this._eventsCount = 0, this;
  }
  if (t = e[o], typeof t == "function")
    this.removeListener(o, t);
  else if (t !== void 0)
    for (r = t.length - 1; r >= 0; r--)
      this.removeListener(o, t[r]);
  return this;
};
function Fg(o, t, e) {
  var r = o._events;
  if (r === void 0)
    return [];
  var n = r[t];
  return n === void 0 ? [] : typeof n == "function" ? e ? [n.listener || n] : [n] : e ? vD(n) : Bg(n, n.length);
}
Ze.prototype.listeners = function(o) {
  return Fg(this, o, !0);
};
Ze.prototype.rawListeners = function(o) {
  return Fg(this, o, !1);
};
Ze.listenerCount = function(o, t) {
  return typeof o.listenerCount == "function" ? o.listenerCount(t) : Hg.call(o, t);
};
Ze.prototype.listenerCount = Hg;
function Hg(o) {
  var t = this._events;
  if (t !== void 0) {
    var e = t[o];
    if (typeof e == "function")
      return 1;
    if (e !== void 0)
      return e.length;
  }
  return 0;
}
Ze.prototype.eventNames = function() {
  return this._eventsCount > 0 ? Vl(this._events) : [];
};
function Bg(o, t) {
  for (var e = new Array(t), r = 0; r < t; ++r)
    e[r] = o[r];
  return e;
}
function hD(o, t) {
  for (; t + 1 < o.length; t++)
    o[t] = o[t + 1];
  o.pop();
}
function vD(o) {
  for (var t = new Array(o.length), e = 0; e < t.length; ++e)
    t[e] = o[e].listener || o[e];
  return t;
}
function fD(o, t) {
  return new Promise(function(e, r) {
    function n(i) {
      o.removeListener(t, a), r(i);
    }
    function a() {
      typeof o.removeListener == "function" && o.removeListener("error", n), e([].slice.call(arguments));
    }
    qg(o, t, a, { once: !0 }), t !== "error" && gD(o, n, { once: !0 });
  });
}
function gD(o, t, e) {
  typeof o.on == "function" && qg(o, "error", t, e);
}
function qg(o, t, e, r) {
  if (typeof o.on == "function")
    r.once ? o.once(t, e) : o.on(t, e);
  else if (typeof o.addEventListener == "function")
    o.addEventListener(t, function n(a) {
      r.once && o.removeEventListener(t, n), e(a);
    });
  else
    throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type ' + be(o));
}
var mD = /* @__PURE__ */ function(o) {
  function t() {
    return w(this, t), R(this, t, ["message.v1.SocketMessage", [{
      no: 1,
      name: "event",
      kind: "scalar",
      T: 13
      /*ScalarType.UINT32*/
    }, {
      no: 2,
      name: "id",
      kind: "scalar",
      opt: !0,
      T: 9
      /*ScalarType.STRING*/
    }, {
      no: 3,
      name: "payload",
      kind: "scalar",
      opt: !0,
      T: 12
      /*ScalarType.BYTES*/
    }, {
      no: 4,
      name: "metadata",
      kind: "scalar",
      opt: !0,
      T: 12
      /*ScalarType.BYTES*/
    }]]);
  }
  return A(t, o), P(t);
}(M), Ev = new mD(), Gg = /* @__PURE__ */ function() {
  function o() {
    w(this, o);
  }
  return P(o, null, [{ key: "encode", value: function(e) {
    return Ev.toBinary(e);
  } }, { key: "decode", value: function(e) {
    return Ev.fromBinary(new Uint8Array(e));
  } }]);
}();
function yD(o, t) {
  return Math.floor(Math.random() * (t - o + 1) + o);
}
var ki, kD = /* @__PURE__ */ function() {
  function o() {
    var t = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {};
    w(this, o), lD(this, "opts"), mr(this, ki, void 0), this.opts = { initialTimeout: t.initialTimeout || 1e3, maxTimeout: t.maxTimeout || 1e4, factor: t.factor || 2 }, Ke(this, ki, 0);
  }
  return P(o, [{ key: "wait", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return Ke(this, ki, J(this, ki) + 1), n = yD(0, Math.min(this.opts.maxTimeout, this.opts.initialTimeout * Math.pow(2, J(this, ki)))), i.next = 4, new Promise(function(s) {
                setTimeout(s, n);
              });
            case 4:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "getAttempts", value: function() {
    return J(this, ki);
  } }, { key: "reset", value: function() {
    Ke(this, ki, 0);
  } }]);
}();
ki = /* @__PURE__ */ new WeakMap();
var mi = { debug: 0, info: 1, warn: 2, error: 3 }, Cs, Rs, bD = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), mr(this, Cs, void 0), mr(this, Rs, void 0), Ke(this, Cs, console), Ke(this, Rs, t);
  }
  return P(o, [{ key: "debug", value: function() {
    for (var e, r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    mi[J(this, Rs)] > mi.debug || (e = J(this, Cs)).debug.apply(e, ["[Sockrates]:"].concat(n));
  } }, { key: "info", value: function() {
    for (var e, r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    mi[J(this, Rs)] > mi.info || (e = J(this, Cs)).info.apply(e, ["[Sockrates]:"].concat(n));
  } }, { key: "warn", value: function() {
    for (var e, r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    mi[J(this, Rs)] > mi.warn || (e = J(this, Cs)).warn.apply(e, ["[Sockrates]:"].concat(n));
  } }, { key: "error", value: function() {
    for (var e, r = arguments.length, n = new Array(r), a = 0; a < r; a++)
      n[a] = arguments[a];
    mi[J(this, Rs)] > mi.error || (e = J(this, Cs)).error.apply(e, ["[Sockrates]:"].concat(n));
  } }]);
}();
Cs = /* @__PURE__ */ new WeakMap(), Rs = /* @__PURE__ */ new WeakMap();
var Wg = /* @__PURE__ */ function(o) {
  return o[o.CONNECTING = 0] = "CONNECTING", o[o.OPEN = 1] = "OPEN", o[o.CLOSING = 2] = "CLOSING", o[o.CLOSED = 3] = "CLOSED", o;
}(Wg || {}), TD = "2", wD = "3", Or, To, wr, jr, bi, rt, Fa, Ai, Nn, wo, La, hp, Jg, Mu, Ul, vp, Kg, fp, Cv, ic, gp, mp, zg, Fu, jl, Hu, sc, oc, yp, _o, Bu, qu, uc, PD = /* @__PURE__ */ function() {
  function o(t, e) {
    var r, n, a, i, s, u, c, d, h, v;
    w(this, o), mr(this, hp), mr(this, Mu), mr(this, vp), mr(this, fp), mr(this, ic), mr(this, mp), mr(this, Fu), mr(this, Hu), mr(this, oc), mr(this, _o), mr(this, qu), mr(this, Or, void 0), mr(this, To, void 0), mr(this, wr, void 0), mr(this, jr, void 0), mr(this, bi, void 0), mr(this, rt, void 0), mr(this, Fa, void 0), mr(this, Ai, void 0), mr(this, Nn, void 0), mr(this, wo, void 0), mr(this, La, void 0);
    var f, g, k, y, b, C, T, E, D;
    Ke(this, To, t), Ke(this, bi, []), Ke(this, rt, new ac()), Ke(this, Fa, !0), Ke(this, Nn, !1), Ke(this, wr, e != null ? e : {}), (r = (f = J(this, wr)).autoReconnect) !== null && r !== void 0 || (f.autoReconnect = !0), (n = (g = J(this, wr)).retryConnectionInterval) !== null && n !== void 0 || (g.retryConnectionInterval = 1e3), (a = (k = J(this, wr)).pingTimeout) !== null && a !== void 0 || (k.pingTimeout = 3e4), (i = (y = J(this, wr)).connectionTimeout) !== null && i !== void 0 || (y.connectionTimeout = 5e3), (s = (b = J(this, wr)).debug) !== null && s !== void 0 || (b.debug = !0), (u = (C = J(this, wr)).maxReconnectionAttempts) !== null && u !== void 0 || (C.maxReconnectionAttempts = 10), (c = (T = J(this, wr)).disconnectOnPingTimeout) !== null && c !== void 0 || (T.disconnectOnPingTimeout = !0), (d = (E = J(this, wr)).queueOnDisconnect) !== null && d !== void 0 || (E.queueOnDisconnect = !1), (h = (D = J(this, wr)).flushOnReconnect) !== null && h !== void 0 || (D.flushOnReconnect = !1), Ke(this, Ai, { code: void 0, reason: void 0 }), Ke(this, jr, (v = J(this, wr).logger) !== null && v !== void 0 ? v : new bD(J(this, wr).debug ? "debug" : "info")), Ke(this, La, new kD());
  }
  return P(o, [{
    key: "readyState",
    get: function() {
      var e;
      return (e = J(this, Or)) == null ? void 0 : e.readyState;
    }
    /**
    * Sockrates connection URL.
    */
  }, {
    key: "url",
    get: function() {
      return J(this, To);
    }
    /**
    * Update connection URL.
    */
  }, {
    key: "updateURL",
    value: function(e) {
      Ke(this, To, e), Pr(this, mp, zg).call(this);
    }
    /**
    * Configuration options passed to Sockrates.
    */
  }, {
    key: "config",
    get: function() {
      return J(this, wr);
    }
    /**
    * Messages that got queued due to the
    * socket not being connected.
    */
  }, {
    key: "sendQueue",
    get: function() {
      return J(this, bi);
    }
    /**
    * Flushes all messages that were queued
    * due to the socket not being connected.
    */
  }, { key: "flush", value: function() {
    var e = this;
    if (!J(this, wr).queueOnDisconnect)
      return !1;
    var r = [];
    return J(this, bi).forEach(function(n) {
      e.send(n.event, n.id, n.payload, n.metadata) || r.push(n);
    }), Ke(this, bi, r), J(this, bi);
  } }, {
    key: "connect",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r() {
        var n = this, a, i = arguments;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                if (a = i.length > 0 && i[0] !== void 0 ? i[0] : !1, !(!a && [
                  0,
                  1
                  /* OPEN */
                ].includes(this.readyState))) {
                  u.next = 4;
                  break;
                }
                return J(this, jr).debug("Websocket was already connecting or connected."), u.abrupt("return");
              case 4:
                if (J(this, Fa) === !1) {
                  u.next = 6;
                  break;
                }
                return u.abrupt("return", new Promise(function(c, d) {
                  Pr(n, _o, Bu).call(n), Pr(n, qu, uc).call(n);
                  try {
                    Ke(n, Or, new WebSocket(Pr(n, hp, Jg).call(n, J(n, To)))), J(n, Or).binaryType = "arraybuffer", J(n, jr).debug("Connecting");
                    var h = setTimeout(function() {
                      J(n, jr).debug("Connection timeout. Closing socket"), Ke(n, Fa, !0), Pr(n, qu, uc).call(n), J(n, Or).close(3001, "Connection Timeout"), J(n, wr).autoReconnect && !J(n, Nn) && (J(n, rt).emit(
                        "reconnecting"
                        /* reconnecting */
                      ), Pr(n, Fu, jl).call(n)), d(new Error("Connection timed out!"));
                    }, J(n, wr).connectionTimeout);
                    J(n, Or).onopen = function() {
                      J(n, jr).debug("Ready State: ".concat(Wg[J(n, Or).readyState])), h && clearTimeout(h), Pr(n, oc, yp).call(n), Ke(n, Ai, { code: void 0, reason: void 0 }), J(n, rt).emit(
                        "connected"
                        /* connected */
                      ), J(n, wr).flushOnReconnect && n.flush(), c();
                    }, J(n, Or).onclose = function(v) {
                      try {
                        h && clearTimeout(h);
                        var f = v.code, g = v.reason;
                        d(g), J(n, jr).debug("Socket closed. Close event:", { event: v }), J(n, jr).debug("Connection closed code: ".concat(f)), J(n, jr).debug("Connection closed reason: ".concat(g)), J(n, Nn) || Pr(n, ic, gp).call(n, f, g);
                      } catch (k) {
                        Pr(n, Mu, Ul).call(n, k);
                      }
                    }, J(n, Or).onerror = function(v) {
                      Pr(n, Mu, Ul).call(n, v);
                    }, J(n, Or).onmessage = function(v) {
                      return Pr(n, vp, Kg).call(n, v);
                    };
                  } catch (v) {
                    Pr(n, Mu, Ul).call(n, v, d);
                  }
                }));
              case 6:
              case "end":
                return u.stop();
            }
        }, r, this);
      }));
      function e() {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * Send a message to the socket server.
    * @returns {boolean} Returns true if the payload was sent successfully.
    */
  }, {
    key: "send",
    value: function(e, r, n, a) {
      var i = { event: e, id: r, payload: n, metadata: a };
      if (J(this, wr).queueOnDisconnect && (!J(this, Or) || J(this, Or).readyState !== 1))
        return J(this, jr).debug("Queuing message since socket is not connected!", i), J(this, bi).push(i), !1;
      var s = Gg.encode(i);
      return Pr(this, Hu, sc).call(this, s);
    }
    /**
    * Alias for `send`.
    */
  }, {
    key: "emit",
    value: function(e, r, n, a) {
      return this.send(e, r, n, a);
    }
    /**
    * Send a raw message to the socket server.
    */
  }, {
    key: "sendRaw",
    value: function(e) {
      return Pr(this, Hu, sc).call(this, e);
    }
    /**
    * Alias to `on`.
    */
  }, {
    key: "receive",
    value: function(e, r) {
      return J(this, rt).on(e.toString(), r);
    }
    /**
    * Event listener that is fired on receiving socket messages.
    */
  }, {
    key: "on",
    value: function(e, r) {
      if (typeof e == "string" && (e === "connected" || e === "disconnected" || e === "errored" || e === "reconnected" || e === "reconnecting" || e === "reconnectAttempt" || e === "reconnectFailure" || e === "failed")) {
        J(this, rt).on(e, r);
        return;
      }
      this.receive(e, r);
    }
    /**
    * Remove all event listeners that were added using `on`.
    */
  }, {
    key: "removeAllListeners",
    value: function() {
      J(this, rt).removeAllListeners();
    }
    /**
    * Alias to `removeListener`.
    */
  }, {
    key: "removeReceiver",
    value: function(e, r) {
      this.removeListener(e, r);
    }
    /**
    * Remove a specific listener that was added using `on`.
    */
  }, {
    key: "removeListener",
    value: function(e, r) {
      J(this, rt).removeListener(e.toString(), r);
    }
    /**
    * Alias to `removeListeners`.
    */
  }, {
    key: "removeReceivers",
    value: function(e) {
      this.removeListeners(e);
    }
    /**
    * Remove all listeners for a specific event.
    */
  }, {
    key: "removeListeners",
    value: function(e) {
      var r = this;
      J(this, rt).listeners(e.toString()).map(function(n) {
        return r.removeListener(e, n);
      });
    }
    /**
    * Disconnect the socket.
    */
  }, { key: "disconnect", value: function() {
    Ke(this, Fa, !1), Pr(this, _o, Bu).call(this), this.removeAllListeners(), Ke(this, Ai, { code: 1e3, reason: "Sockrates disconnect method called" }), J(this, Or).close(1e3, "Sockrates disconnect method called.");
  } }]);
}();
Or = /* @__PURE__ */ new WeakMap(), To = /* @__PURE__ */ new WeakMap(), wr = /* @__PURE__ */ new WeakMap(), jr = /* @__PURE__ */ new WeakMap(), bi = /* @__PURE__ */ new WeakMap(), rt = /* @__PURE__ */ new WeakMap(), Fa = /* @__PURE__ */ new WeakMap(), Ai = /* @__PURE__ */ new WeakMap(), Nn = /* @__PURE__ */ new WeakMap(), wo = /* @__PURE__ */ new WeakMap(), La = /* @__PURE__ */ new WeakMap(), hp = /* @__PURE__ */ new WeakSet(), Jg = function(t) {
  if (t.startsWith("ws://") || t.startsWith("wss://"))
    return t;
  if (t.startsWith("https://"))
    return "wss://".concat(t.substring(8));
  if (t.startsWith("http://"))
    return "ws://".concat(t.substring(7));
  throw new Error("Invalid URL. URL must start with http(s):// or ws(s)://.");
}, Mu = /* @__PURE__ */ new WeakSet(), Ul = function(t, e) {
  J(this, jr).error("Error:", { error: t }), J(this, rt).emit("errored", { error: t }), e == null || e(t);
}, vp = /* @__PURE__ */ new WeakSet(), Kg = function(t) {
  if (Pr(this, oc, yp).call(this), t.data === TD) {
    J(this, jr).debug("Received ping from server"), Pr(this, Hu, sc).call(this, wD);
    return;
  }
  var e = Gg.decode(t.data), r = e.id, n = e.payload;
  J(this, jr).debug("Received message", { event: e.event, messageID: r }), J(this, rt).emit(e.event.toString(), { id: r, payload: n });
}, fp = /* @__PURE__ */ new WeakSet(), Cv = function() {
  return J(this, Or).readyState === 1;
}, ic = /* @__PURE__ */ new WeakSet(), gp = function(t, e) {
  Ke(this, Ai, { reason: e, code: t }), J(this, rt).emit("disconnected", { code: t, reason: e });
}, mp = /* @__PURE__ */ new WeakSet(), zg = function() {
  var t = J(this, Ai), e = t.reason, r = t.code;
  r && r !== 1e3 && J(this, Fa) && J(this, wr).autoReconnect && !J(this, Nn) && (J(this, jr).debug("Triggering reconnection due to ".concat(e, ".")), J(this, rt).emit(
    "reconnecting"
    /* reconnecting */
  ), Pr(this, Fu, jl).call(this));
}, Fu = /* @__PURE__ */ new WeakSet(), jl = /* @__PURE__ */ function() {
  var o = m(/* @__PURE__ */ p().mark(function t() {
    var e, r = arguments;
    return p().wrap(function(a) {
      for (; ; )
        switch (a.prev = a.next) {
          case 0:
            if (e = r.length > 0 && r[0] !== void 0 ? r[0] : !0, !(e && J(this, Nn))) {
              a.next = 4;
              break;
            }
            return J(this, jr).debug("Reconnect called when already in a reconnect loop. Ignoring."), a.abrupt("return");
          case 4:
            if (J(this, Nn) || J(this, La).reset(), !(J(this, wr).maxReconnectionAttempts !== null && J(this, La).getAttempts() >= J(this, wr).maxReconnectionAttempts)) {
              a.next = 7;
              break;
            }
            return J(this, rt).emit(
              "failed"
              /* failed */
            ), Ke(this, Nn, !1), a.abrupt("return");
          case 7:
            return Ke(this, Nn, !0), Pr(this, qu, uc).call(this), Pr(this, _o, Bu).call(this), a.prev = 8, a.next = 11, J(this, La).wait();
          case 11:
            if (J(this, Fa) !== !1) {
              a.next = 13;
              break;
            }
            return a.abrupt("return");
          case 13:
            return J(this, jr).debug("Reconnection attempt ".concat(J(this, La).getAttempts())), J(this, rt).emit("reconnectAttempt", { attempt: J(this, La).getAttempts() }), a.next = 17, this.connect();
          case 17:
            if (Pr(this, fp, Cv).call(this)) {
              a.next = 19;
              break;
            }
            throw Error("Reconnect Failed");
          case 19:
            Ke(this, Nn, !1), Ke(this, Ai, { code: void 0, reason: void 0 }), J(this, rt).emit(
              "reconnected"
              /* reconnected */
            ), a.next = 25;
            break;
          case 22:
            a.prev = 22, a.t0 = a.catch(8), J(this, jr).debug("Failed to reconnect."), J(this, rt).emit("reconnectFailure", { attempt: J(this, La).getAttempts() }), Pr(this, Fu, jl).call(this, !1);
          case 25:
          case "end":
            return a.stop();
        }
    }, t, this, [[8, 22]]);
  }));
  return function() {
    return o.apply(this, arguments);
  };
}(), Hu = /* @__PURE__ */ new WeakSet(), sc = function(t) {
  try {
    return J(this, Or).send(t), !0;
  } catch (e) {
    return J(this, jr).error(e.message), !1;
  }
}, oc = /* @__PURE__ */ new WeakSet(), yp = function() {
  var t = this;
  this.config.disconnectOnPingTimeout && (J(this, jr).debug("Resetting ping timeout"), Pr(this, _o, Bu).call(this), Ke(this, wo, setTimeout(function() {
    var e;
    J(t, jr).debug("Disconnecting the socket due to ping timeout"), Ke(t, Fa, !0);
    var r = 3002, n = "Ping timeout";
    (e = J(t, Or)) == null || e.close(r, n), Pr(t, ic, gp).call(t, r, n);
  }, J(this, wr).pingTimeout)));
}, _o = /* @__PURE__ */ new WeakSet(), Bu = function() {
  J(this, wo) && (clearTimeout(J(this, wo)), Ke(this, wo, void 0));
}, qu = /* @__PURE__ */ new WeakSet(), uc = function() {
  J(this, Or) && (J(this, Or).onopen = void 0, J(this, Or).onerror = void 0, J(this, Or).onmessage = void 0, J(this, Or).onclose = void 0);
};
var SD = Object.defineProperty, ED = Object.getOwnPropertyDescriptor, Oc = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? ED(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && SD(e, r, a), a;
}, Rv = 65535, CD = 3e3, Yg = (gn = /* @__PURE__ */ S("url"), Te = /* @__PURE__ */ S("sockrates"), we = /* @__PURE__ */ S("connectionHandler"), Gr = /* @__PURE__ */ S("socketDisconnectionTimeout"), We = /* @__PURE__ */ S("context"), fo = /* @__PURE__ */ S("getSocketURL"), go = /* @__PURE__ */ S("generateId"), /* @__PURE__ */ function() {
  function o(t, e) {
    var r, n = e.peerId, a = e.meetingId, i = e.authToken, s = e.capabilities;
    if (w(this, o), Object.defineProperty(this, go, { value: ID }), Object.defineProperty(this, fo, { value: AD }), Object.defineProperty(this, we, { get: RD, set: void 0 }), Object.defineProperty(this, gn, { writable: !0, value: void 0 }), Object.defineProperty(this, Te, { writable: !0, value: void 0 }), this.roomName = void 0, this.authToken = void 0, this.capabilities = void 0, Object.defineProperty(this, Gr, { writable: !0, value: void 0 }), Object.defineProperty(this, We, { writable: !0, value: void 0 }), !n || !a || !i)
      throw new U("peerId, meetingId, or authToken can not be empty", "0404");
    l(this, Gr)[Gr] = void 0, l(this, We)[We] = t, this.capabilities = s, this.roomName = a, this.authToken = i, l(this, gn)[gn] = l(this, fo)[fo](n), l(this, Te)[Te] = new PD(l(this, gn)[gn], { autoReconnect: !0, disconnectOnPingTimeout: (r = s.includes("PING")) !== null && r !== void 0 ? r : !1, queueOnDisconnect: !0, flushOnReconnect: !1, logger: this.logger }), this.handleSocketConnectionEvents();
  }
  return P(o, [{ key: "joinAttempted", get: function() {
    return l(this, we)[we].socketJoinAttempted;
  }, set: function(e) {
    l(this, we)[we].socketJoinAttempted = e;
  } }, {
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, We)[We].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, We)[We].getValue("logger");
  } }, { key: "peerId", get: function() {
    return l(this, We)[We].getValue("peerId");
  } }, { key: "updateURL", value: function(e) {
    e !== this.peerId && (l(this, gn)[gn] = l(this, fo)[fo](e), this.logger.debug("SocketService:: Connection URL updated.")), l(this, Te)[Te].updateURL(l(this, gn)[gn]);
  } }, { key: "url", get: function() {
    return l(this, gn)[gn];
  } }, { key: "connect", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              return l(this, we)[we].socketJoinAttempted = !0, a.next = 3, l(this, Te)[Te].connect();
            case 3:
              l(this, we)[we].socketJoinAttempted = !0, l(this, we)[we].socketState = { state: "connected", reconnected: !1, reconnectionAttempt: void 0 };
            case 5:
            case "end":
              return a.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disconnect", value: function() {
    l(this, we)[we].socketJoinAttempted = !1, l(this, Te)[Te].disconnect(), l(this, we)[we].socketJoinAttempted = !0, l(this, we)[we].socketState = { state: "disconnected", reconnected: !1, reconnectionAttempt: void 0 };
  } }, { key: "isConnected", get: function() {
    try {
      return l(this, Te)[Te].readyState === 1;
    } catch (e) {
      return !1;
    }
  } }, { key: "sendMessage", value: function(e, r, n) {
    var a = {}, i = l(this, We)[We].getValue("telemetry");
    return i.injectContext(a), l(this, Te)[Te].send(e, n != null ? n : l(this, go)[go](), r, new TextEncoder().encode(JSON.stringify(a)));
  } }, { key: "sendMessagePromise", value: function(e, r, n, a) {
    var i = parseInt({}.SOCKET_SERVICE_MESSAGE_REQUEST_TIMEOUT, 10) || 2e4;
    return this.sendMessagePromiseWithTimeout({ event: e, timeout: i, protobuf: r, messageId: n, resp: a });
  } }, { key: "sendMessagePromiseWithTimeout", value: function(e) {
    var r = this, n = e.event, a = e.timeout, i = e.protobuf, s = e.messageId, u = e.resp, c = u != null ? u : n;
    return new Promise(function(d, h) {
      var v = function(T, E) {
        l(r, Te)[Te].removeListener(c, T), l(r, Te)[Te].removeListener(Rv, E), l(r, Te)[Te].removeListener(Ci.errorResponse, E), l(r, Te)[Te].removeListener(Vn.errorResponse, E);
      }, f = s != null ? s : l(r, go)[go](), g = {}, k = l(r, We)[We].getValue("telemetry");
      k.injectContext(g);
      var y = function(T) {
        var E = T.id, D = T.payload;
        if (f === E) {
          var I;
          try {
            var _ = ZS.fromBinary(D);
            I = new Error(_.errorMessage);
          } catch (F) {
            I = new Error("failed to parse error message", { cause: F });
            try {
              var V = xE.fromBinary(D);
              I = new Error(V.message);
            } catch (N) {
              I = new Error("failed to parse error message", { cause: N });
            }
          }
          h(I), v(b, y);
        }
      }, b = function(T) {
        var E = T.id, D = T.payload;
        f === E && (d({ id: E, payload: D }), v(b, y));
      };
      l(r, Te)[Te].on(c, b), l(r, Te)[Te].on(Rv, y), l(r, Te)[Te].on(Ci.errorResponse, y), l(r, Te)[Te].on(Vn.errorResponse, y), setTimeout(function() {
        v(b, y), h(new Error("request timeout for callback eventId:".concat(n)));
      }, a), l(r, Te)[Te].send(n, f, i, new TextEncoder().encode(JSON.stringify(g)));
    });
  } }, { key: "on", value: function(e, r) {
    l(this, Te)[Te].on(e, r);
  } }, { key: "onStateEvent", value: function(e, r) {
    l(this, Te)[Te].on(e, r);
  } }, { key: "removeListener", value: function(e, r) {
    l(this, Te)[Te].removeListener(e, r);
  } }, { key: "removeListeners", value: function(e) {
    l(this, Te)[Te].removeListeners(e);
  } }, { key: "flush", value: function() {
    return l(this, Te)[Te].flush();
  } }, { key: "handleSocketConnectionEvents", value: function() {
    var e = this;
    this.onStateEvent("connected", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              e.logger.info("SocketService::Connected to socket-edge"), l(e, Gr)[Gr] && (clearTimeout(l(e, Gr)[Gr]), l(e, Gr)[Gr] = void 0), l(e, we)[we].updateSocketConnectionState("connected");
            case 3:
            case "end":
              return a.stop();
          }
      }, r);
    }))), this.onStateEvent("disconnected", function(r) {
      var n, a = r.code, i = r.reason;
      e.logger.info("SocketService::Disconnected from socket-edge", { error: { code: a, reason: i }, country: O.location.country });
      var s = (n = l(e, we)[we].mediaState) !== null && n !== void 0 ? n : {}, u = s.recv, c = s.send;
      u != null && u.state && (u == null ? void 0 : u.state) !== Vo.CONNECTED || c != null && c.state && (c == null ? void 0 : c.state) !== Vo.CONNECTED ? l(e, We)[We].getValue("peerSessionStore").emit(j.SOCKET_SERVICE_DISCONNECTED, { joinAttempted: l(e, we)[we].joinAttempted }) : l(e, Gr)[Gr] = setTimeout(function() {
        l(e, We)[We].getValue("peerSessionStore").emit(j.SOCKET_SERVICE_DISCONNECTED, { joinAttempted: l(e, we)[we].joinAttempted }), l(e, Gr)[Gr] = void 0;
      }, CD), l(e, we)[we].updateSocketConnectionState("disconnected");
    }), this.onStateEvent("reconnecting", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              e.logger.info("SocketService::Reconnecting to socket-edge", { country: O.location.country }), l(e, we)[we].updateSocketConnectionState("reconnecting");
            case 2:
            case "end":
              return a.stop();
          }
      }, r);
    }))), this.onStateEvent("reconnectAttempt", /* @__PURE__ */ function() {
      var r = m(/* @__PURE__ */ p().mark(function n(a) {
        var i;
        return p().wrap(function(u) {
          for (; ; )
            switch (u.prev = u.next) {
              case 0:
                i = a.attempt, e.logger.info("SocketService::Attempting to reconnect to socket-edge", { socket: { retryAttempt: i } }), l(e, we)[we].updateSocketConnectionState("reconnectAttempt", i);
              case 3:
              case "end":
                return u.stop();
            }
        }, n);
      }));
      return function(n) {
        return r.apply(this, arguments);
      };
    }()), this.onStateEvent("reconnectFailure", function(r) {
      var n = r.attempt;
      e.logger.info("SocketService::Reconnect attempt to socket-edge failed", { socket: { retryAttempt: n } }), l(e, we)[we].updateSocketConnectionState("reconnectFailure", n);
    }), this.onStateEvent("reconnected", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              e.logger.info("SocketService::Reconnected to socket-edge", { connectionState: { joinAttempted: l(e, we)[we].mediaJoinAttempted } }), l(e, Gr)[Gr] && (clearTimeout(l(e, Gr)[Gr]), l(e, Gr)[Gr] = void 0), l(e, We)[We].getValue("peerSessionStore").emit(j.SOCKET_SERVICE_RECONNECTED, { wasJoinAttempted: l(e, we)[we].mediaJoinAttempted }), l(e, we)[we].updateSocketConnectionState("reconnected");
            case 4:
            case "end":
              return a.stop();
          }
      }, r);
    }))), this.onStateEvent("failed", /* @__PURE__ */ m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              e.logger.info("SocketService::Failed to connect to socket-edge", { country: O.location.country }), l(e, We)[We].getValue("peerSessionStore").emit(j.SOCKET_SERVICE_FAILED), l(e, we)[we].updateSocketConnectionState("failed");
            case 3:
            case "end":
              return a.stop();
          }
      }, r);
    })));
  } }], [{ key: "getSocketEdgeDomain", value: function(e) {
    return Fs({ servicePrefix: "socket-edge", baseURI: e });
  } }]);
}());
function RD() {
  return l(this, We)[We].getValue("connectionHandler");
}
function AD(o) {
  var t = Yg.getSocketEdgeDomain(l(this, We)[We].getValue("baseURI"));
  typeof $o(l(this, We)[We], "socket_server_base") == "string" && (t = $o(l(this, We)[We], "socket_server_base"));
  var e = "wss://".concat(t), r = new URL("".concat(e, "/ws")), n = this.peerId, a = $($({ roomID: this.roomName, peerID: o, authToken: this.authToken, useMediaV2: !0 }, n !== o && { oldPeerID: n }), {}, { ping: this.capabilities.includes("PING"), capabilities: this.capabilities.map(function(i) {
    return ec[i];
  }).join(" "), joinWithDetails: !0, useCfWorker: !0, useStartSession: !0 });
  return Object.entries(a).forEach(function(i) {
    var s = He(i, 2), u = s[0], c = s[1];
    r.searchParams.append(u, c.toString());
  }), r.href;
}
function ID() {
  return "".concat(this.peerId, "-").concat((Math.random() + 1).toString(36).substring(7));
}
var cl = Yg;
Oc([O.trace("SocketService.connect")], cl.prototype, "connect", 1);
Oc([O.trace("SocketService.disconnect")], cl.prototype, "disconnect", 1);
Oc([O.trace("SocketService.sendMessagePromise")], cl.prototype, "sendMessagePromise", 1);
Oc([O.trace("SocketService.sendMessagePromiseWithTimeout")], cl.prototype, "sendMessagePromiseWithTimeout", 1);
var MD = /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.socketService = void 0, this.socketService = t;
  }
  return P(o, [{
    key: "handleConnectedRoomsDumpRaw",
    value: function(e) {
      var r, n = e.payload, a = CC.fromBinary(n), i = a.meetings.map(function(u) {
        var c;
        return { id: u.id, title: u.title, participants: (c = u.participants) !== null && c !== void 0 ? c : [] };
      }), s = { id: a.parentMeeting.id, title: a.parentMeeting.title, participants: (r = a.parentMeeting.participants) !== null && r !== void 0 ? r : [] };
      return { parentMeeting: s, meetings: i };
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "handleTransferPeerRaw",
    value: function(e) {
      var r = e.payload, n = ZC.fromBinary(r);
      return { authToken: n.authToken, meetingId: n.meetingId };
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "handleMovedPeerRaw",
    value: function(e) {
      var r = e.payload, n = ag.fromBinary(r);
      return { meetingId: n.meetingId, customParticipantId: n.customParticipantId };
    }
    // eslint-disable-next-line class-methods-use-this
  }, {
    key: "handleConnectedRoomsUpdatedRaw",
    value: function(e) {
      var r = e.payload, n = ev.fromBinary(r);
      return n.payloads.map(function(a) {
        return { id: a.id, title: a.title };
      });
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "handleConnectedRoomsDeletedRaw", value: function(e) {
    var r = e.payload, n = BC.fromBinary(r);
    return n.payloads;
  } }, { key: "getConnectedRoomsDump", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.next = 2, this.socketService.sendMessagePromise(Y.getConnectedRoomsDump);
            case 2:
              return n = i.sent, i.abrupt("return", this.handleConnectedRoomsDumpRaw(n));
            case 4:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "createConnectedRooms",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a, i, s;
        return p().wrap(function(c) {
          for (; ; )
            switch (c.prev = c.next) {
              case 0:
                return c.next = 2, this.socketService.sendMessagePromise(Y.createConnectedRooms, MC.toBinary({ payloads: n }));
              case 2:
                return a = c.sent, i = a.payload, s = ev.fromBinary(i).payloads, c.abrupt("return", s.map(function(d) {
                  return { id: d.id, title: d.title };
                }));
              case 6:
              case "end":
                return c.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    // eslint-disable-next-line @typescript-eslint/no-unused-vars, class-methods-use-this
  }, { key: "updateConnectedRooms", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
            case "end":
              return i.stop();
          }
      }, r);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "disableConnectedRooms", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return a = n.map(function(c) {
                return { id: c };
              }), u.next = 3, this.socketService.sendMessagePromise(Y.deleteConnectedRooms, FC.toBinary({ payloads: a }));
            case 3:
              return i = u.sent, u.abrupt("return", this.handleConnectedRoomsDeletedRaw(i));
            case 5:
            case "end":
              return u.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "movePeersBetweenRooms", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return u.prev = 0, u.next = 3, this.socketService.sendMessagePromise(Y.movePeers, zC.toBinary({ sourceMeetingId: n.sourceMeetingId, destinationMeetingId: n.destinationMeetingId, participants: n.participants }));
            case 3:
              if (a = u.sent, i = new TextDecoder().decode(a.payload), !i.includes("error")) {
                u.next = 7;
                break;
              }
              return u.abrupt("return", { success: !1, error: "failed to move participants" });
            case 7:
              return u.abrupt("return", { success: !0 });
            case 10:
              return u.prev = 10, u.t0 = u.catch(0), u.abrupt("return", { success: !1, error: u.t0 });
            case 13:
            case "end":
              return u.stop();
          }
      }, r, this, [[0, 10]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }]);
}(), _D = Object.defineProperty, OD = Object.getOwnPropertyDescriptor, DD = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? OD(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && _D(e, r, a), a;
}, ut = /* @__PURE__ */ S("context"), Qg = /* @__PURE__ */ function(o) {
  function t(e) {
    var r;
    w(this, t);
    var n = e.getValue("logger");
    return r = R(this, t, [n]), r.meetings = [], r.parentMeeting = null, Object.defineProperty(r, ut, { writable: !0, value: void 0 }), l(r, ut)[ut] = e, r;
  }
  return A(t, o), P(t, [{ key: "supportsConnectedMeetings", get: function() {
    return l(this, ut)[ut].getValue("self").id !== "";
  } }, { key: "isActive", get: function() {
    return this.meetings.length !== 0;
  } }, { key: "validateConnectedMeetingsAction", value: function() {
    if (!this.supportsConnectedMeetings)
      throw new Error(`You are not allowed to perform this action.
						Please connect with our support team to enable connected meetings.`);
  } }, {
    key: "getConnectedMeetings",
    value: function() {
      var e = m(/* @__PURE__ */ p().mark(function n() {
        var a;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return this.validateConnectedMeetingsAction(), s.next = 3, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").getConnectedRoomsDump();
              case 3:
                return a = s.sent, s.abrupt("return", a);
              case 5:
              case "end":
                return s.stop();
            }
        }, n, this);
      }));
      function r() {
        return e.apply(this, arguments);
      }
      return r;
    }()
    /**
    * create connected meetings
    */
  }, { key: "createMeetings", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i;
      return p().wrap(function(u) {
        for (; ; )
          switch (u.prev = u.next) {
            case 0:
              return this.validateConnectedMeetingsAction(), u.next = 3, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").createConnectedRooms(a);
            case 3:
              return i = u.sent, u.abrupt("return", i.map(function(c) {
                return { id: c.id, title: c.title };
              }));
            case 5:
            case "end":
              return u.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "updateMeetings", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return this.validateConnectedMeetingsAction(), s.next = 3, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").updateConnectedRooms(a.map(function(u) {
                return { meetingId: u.id, title: u.title };
              }));
            case 3:
            case "end":
              return s.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "deleteMeetings", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a) {
      var i = this, s, u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return this.validateConnectedMeetingsAction(), s = this.meetings.map(function(h) {
                return a.includes(h.id) && h.participants.length !== 0 ? i.moveParticipants(h.id, i.parentMeeting.id, h.participants.map(function(v) {
                  return v.id;
                })) : Promise.resolve();
              }), d.next = 4, Promise.all(s);
            case 4:
              return d.next = 6, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").disableConnectedRooms(a);
            case 6:
              return u = d.sent, d.abrupt("return", u);
            case 8:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "moveParticipants", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return this.validateConnectedMeetingsAction(), d.next = 3, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").movePeersBetweenRooms({ sourceMeetingId: a, destinationMeetingId: i, participants: s.map(function(h) {
                return { id: h };
              }) });
            case 3:
              return u = d.sent, u.success && this.moveSuccessHandler(a, i, s), d.abrupt("return", u);
            case 6:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "moveParticipantsWithCustomPreset", value: function() {
    var e = m(/* @__PURE__ */ p().mark(function n(a, i, s) {
      var u;
      return p().wrap(function(d) {
        for (; ; )
          switch (d.prev = d.next) {
            case 0:
              return this.validateConnectedMeetingsAction(), d.next = 3, l(this, ut)[ut].getValue("connectedMeetingsSocketHandler").movePeersBetweenRooms({ sourceMeetingId: a, destinationMeetingId: i, participants: s });
            case 3:
              return u = d.sent, u.success && this.moveSuccessHandler(a, i, s.map(function(h) {
                return h.id;
              })), d.abrupt("return", u);
            case 6:
            case "end":
              return d.stop();
          }
      }, n, this);
    }));
    function r(n, a, i) {
      return e.apply(this, arguments);
    }
    return r;
  }() }, { key: "moveSuccessHandler", value: function(r, n, a) {
    var i = /* @__PURE__ */ new Map();
    [].concat(Se(this.parentMeeting.participants), Se(this.meetings.flatMap(function(s) {
      return s.participants;
    }))).forEach(function(s) {
      return i.set(s.id, s);
    }), n === this.parentMeeting.id && (this.parentMeeting.participants = this.parentMeeting.participants.concat(a.map(function(s) {
      return i.get(s);
    }))), r === this.parentMeeting.id && (this.parentMeeting.participants = this.parentMeeting.participants.filter(function(s) {
      return !a.includes(s.id);
    })), this.meetings = this.meetings.map(function(s) {
      if (n === s.id) {
        var u = s.participants.concat(a.map(function(d) {
          return i.get(d);
        }));
        return $($({}, s), {}, { participants: u });
      }
      if (r === s.id) {
        var c = s.participants.filter(function(d) {
          return !a.includes(d.id);
        });
        return $($({}, s), {}, { participants: c });
      }
      return s;
    });
  } }]);
}(an);
DD([Lt({ maxInvocations: 60, period: 60 })], Qg.prototype, "getConnectedMeetings", 1);
var LD = Object.defineProperty, $D = Object.getOwnPropertyDescriptor, Zp = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? $D(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && LD(e, r, a), a;
}, Xg = (ve = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t) {
    w(this, o), this.connectedMeetings = void 0, Object.defineProperty(this, ve, { writable: !0, value: void 0 }), l(this, ve)[ve] = t, this.connectedMeetings = new Qg(t);
  }
  return P(o, [{
    key: "telemetry",
    get: (
      /**
      * @access private
      * Not for external use
      */
      function() {
        return l(this, ve)[ve].getValue("telemetry");
      }
    )
    /**
    * @access private
    * Not for external use
    */
  }, { key: "logger", get: function() {
    return l(this, ve)[ve].getValue("logger");
  } }, { key: "getConnectedMeetings", value: function() {
    this.connectedMeetings.getConnectedMeetings();
  } }, {
    key: "setupEvents",
    value: function() {
      l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").socketService.on(Y.getConnectedRoomsDump, this.handleConnectedRoomsDump.bind(this)), l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").socketService.on(Y.transferPeer, this.handleTransferPeer.bind(this)), l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").socketService.on(Y.movedPeer, this.handleMovedPeer.bind(this)), l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").socketService.on(Y.connectedRoomsUpdated, this.handleConnectedRoomsUpdated.bind(this)), l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").socketService.on(Y.connectedRoomsDeleted, this.handleConnectedRoomsDeleted.bind(this));
    }
    // event handlers
  }, { key: "handleTransferPeer", value: function(e) {
    var r = l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").handleTransferPeerRaw(e);
    return this.switchMeeting(r);
  } }, { key: "switchMeeting", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f;
      return p().wrap(function(k) {
        for (; ; )
          switch (k.prev = k.next) {
            case 0:
              if (s = n.authToken, u = n.meetingId, this.connectedMeetings.supportsConnectedMeetings) {
                k.next = 3;
                break;
              }
              throw new Error(`You are not allowed to perform this action.
								Please connect with our support team to enable connected meetings.`);
            case 3:
              return this.logger.info("ConnectedMeetingsController::switchMeeting:: asking ui-kit to show switching breakout UI"), this.connectedMeetings.emit("changingMeeting", u), c = { video: l(this, ve)[ve].getValue("self").videoEnabled, audio: l(this, ve)[ve].getValue("self").audioEnabled }, k.prev = 6, l(this, ve)[ve].getValue("self").cleanupEvents(), k.next = 10, l(this, ve)[ve].getValue("meeting").leave("connected-meeting");
            case 10:
              k.next = 15;
              break;
            case 12:
              k.prev = 12, k.t0 = k.catch(6), this.logger.error("ConnectedMeetingsController:: switchMeeting:: issues in leaving previous meeting. Meeting Id: ".concat((d = l(this, ve)[ve].getValue("meeting")) === null || d === void 0 || (d = d.meta) === null || d === void 0 ? void 0 : d.meetingId), { error: k.t0 });
            case 15:
              return this.logger.info("ConnectedMeetingsController::switchMeeting:: initializing new meeting. Meeting Id: ".concat(u)), k.next = 18, WD.init($($({}, l(this, ve)[ve].getValue("options")), {}, { cachedUserDetails: null, defaults: $($($({}, l(this, ve)[ve].getValue("options").defaults), c), {}, {
                /**
                * NOTE(ravindra-cloudflare):
                * Protected methods & variables of SelfMedia,
                * such as localMediaHandler cannot be type checked outside class hierarchy,
                * therefore typecasting Self to SelfMedia,
                * Even though Self extends SelfMedia.
                *
                * Alternative approach is to make either SelfMedia methods public
                * or expose a public wrapper on Self.
                */
                mediaHandler: l(this, ve)[ve].getValue("self")
              }), authToken: s }));
            case 18:
              return h = k.sent, this.logger.info("ConnectedMeetingsController::switchMeeting:: initialized new meeting. Meeting Id: ".concat(h == null || (a = h.meta) === null || a === void 0 ? void 0 : a.meetingId)), k.prev = 20, v = l(this, ve)[ve].getValue("self"), f = v.hidden, h.self.setName(l(this, ve)[ve].getValue("self").name), k.next = 25, h.join();
            case 25:
              f && h.self.hide(), k.next = 31;
              break;
            case 28:
              k.prev = 28, k.t1 = k.catch(20), this.logger.error("ConnectedMeetingsController.joinRoom", { error: k.t1 });
            case 31:
              return this.logger.info("ConnectedMeetingsController::switchMeeting:: asking ui-kit to show in-meeting ui of newly joined meeting id: ".concat(h == null || (i = h.meta) === null || i === void 0 ? void 0 : i.meetingId)), this.connectedMeetings.emit("meetingChanged", h), k.abrupt("return", h);
            case 34:
            case "end":
              return k.stop();
          }
      }, r, this, [[6, 12], [20, 28]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "handleConnectedRoomsDump",
    value: function(e) {
      var r = l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").handleConnectedRoomsDumpRaw(e);
      this.connectedMeetings.meetings = r.meetings.map(function(n) {
        return { id: n.id, title: n.title, participants: n.participants || [] };
      }), this.connectedMeetings.parentMeeting = { id: r.parentMeeting.id, title: r.parentMeeting.title, participants: r.parentMeeting.participants }, this.emitStateUpdate();
    }
    // eslint-disable-next-line class-methods-use-this
  }, { key: "handleMovedPeer", value: function(e) {
    var r = l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").handleMovedPeerRaw(e);
    return r;
  } }, { key: "handleConnectedRoomsUpdated", value: function(e) {
    var r = l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").handleConnectedRoomsUpdatedRaw(e), n = /* @__PURE__ */ new Map();
    this.connectedMeetings.meetings.forEach(function(a) {
      n.set(a.id, a);
    }), r.forEach(function(a) {
      n.has(a.id) ? n.get(a.id).title = a.title : n.set(a.id, $($({}, a), {}, { participants: [] }));
    }), this.connectedMeetings.meetings = Array.from(n.values()), this.emitStateUpdate();
  } }, { key: "handleConnectedRoomsDeleted", value: function(e) {
    var r = l(this, ve)[ve].getValue("connectedMeetingsSocketHandler").handleConnectedRoomsDeletedRaw(e), n = r.map(function(a) {
      return a.id;
    });
    this.connectedMeetings.meetings = this.connectedMeetings.meetings.filter(function(a) {
      return !n.includes(a.id);
    }), this.emitStateUpdate();
  } }, { key: "emitStateUpdate", value: function() {
    this.connectedMeetings.emit("stateUpdate", { meetings: this.connectedMeetings.meetings, parentMeeting: this.connectedMeetings.parentMeeting });
  } }], [{ key: "init", value: function(e) {
    var r = new Xg(e);
    return r.connectedMeetings.supportsConnectedMeetings && (r.setupEvents(), e.getValue("self").once("roomJoined", function() {
      return r.getConnectedMeetings();
    })), r;
  } }]);
}()), Dc = Xg;
Zp([O.trace("ConnectedMeetingsController.getConnectedMeetings")], Dc.prototype, "getConnectedMeetings", 1);
Zp([O.trace("ConnectedMeetingsController.setupEvents")], Dc.prototype, "setupEvents", 1);
Zp([O.trace("ConnectedMeetingsController.switchMeeting")], Dc.prototype, "switchMeeting", 1);
var ND = Object.defineProperty, VD = Object.getOwnPropertyDescriptor, Lc = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? VD(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && ND(e, r, a), a;
}, Po = /* @__PURE__ */ function() {
  function o(t, e, r) {
    w(this, o), this.apiBase = void 0, this.selfController = void 0, this.pollController = void 0, this.chatController = void 0, this.metaController = void 0, this.storesManager = void 0, this.stageController = void 0, this.pluginController = void 0, this.internalsController = void 0, this.recordingController = void 0, this.livestreamController = void 0, this.participantController = void 0, this.connectedMeetingsController = void 0, this.telemetry = void 0, this.logger = void 0, this.apiBase = t, this.storesManager = e.storesManager, this.metaController = e.metaController, this.selfController = e.selfController, this.chatController = e.chatController, this.pollController = e.pollController, this.stageController = e.stageController, this.pluginController = e.pluginController, this.recordingController = e.recordingController, this.internalsController = e.internalsController, this.participantController = e.participantController, this.livestreamController = e.livestreamController, this.connectedMeetingsController = e.connectedMeetingsController, this.telemetry = r.getValue("telemetry"), this.logger = r.getValue("logger");
  }
  return P(o, null, [{ key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k, y, b, C, T, E, D, I, _, V, F, N, L, H, Q;
      return p().wrap(function(G) {
        for (; ; )
          switch (G.prev = G.next) {
            case 0:
              if (i = n.getAllValues(), s = i.peerId, u = i.apiBase, c = i.authToken, d = i.meetingId, h = i.organizationId, v = i.cachedUserDetails, f = i.logger, Dg(n), kr.isSupported() !== !1) {
                G.next = 4;
                break;
              }
              throw new U("Browser not supported", "0010", f, !0);
            case 4:
              return g = cI(n, { authToken: c, baseURL: u, cachedUserDetails: v }), g.setRoomName(d), g.setRoomUUID(d), g.setOrganizationId(h), g.setHeader("tracing-id", s), n.setValue("apiClient", g), k = new xI(n), n.setValue("connectionHandler", k), y = Po.createSocketService(n), b = y.connect(), C = g.getUserDetails(), T = g.getPlugins(), D = "", G.prev = 17, G.next = 20, Po.setupFlagsmith(n);
            case 20:
              G.next = 25;
              break;
            case 22:
              G.prev = 22, G.t0 = G.catch(17), f.error("Failed to setup flagsmith", { error: G.t0 });
            case 25:
              return G.prev = 25, G.next = 28, b;
            case 28:
              G.next = 33;
              break;
            case 30:
              G.prev = 30, G.t1 = G.catch(25), f.error("[Controller]: Failed to connect to socket server:", { error: G.t1 });
            case 33:
              return G.prev = 33, G.next = 36, g.getRoomNodeData();
            case 36:
              return I = G.sent, D = I.meetingTitle, G.next = 40, C;
            case 40:
              E = G.sent, f.info("CF SFU is being used."), n.setValue("presetName", E.preset.name), G.next = 48;
              break;
            case 45:
              G.prev = 45, G.t2 = G.catch(33), f.error("Failed to get room metadata", { error: G.t2 });
            case 48:
              return _ = HM.init(E.preset, !n.getValue("modules").theme), V = w_.init(n, _.viewType, E.preset.permissions), F = Po.setupControllers(y, n, E, T, D, _, V), BI(_) && (L = Po.createRoomNodeClient(n, y), (N = L.initializeConnection(E.participant.name, d, !1, V)) === null || N === void 0 || N.catch(function(x) {
                f.error("[Controller]: Failed to queue partial media room promise:", { error: x });
              })), O.location.country = (a = g.ipInfo) === null || a === void 0 ? void 0 : a.country, G.next = 55, F;
            case 55:
              return H = G.sent, Q = H.controllers, OP(), G.abrupt("return", new Po(u, Q, n));
            case 59:
            case "end":
              return G.stop();
          }
      }, r, null, [[17, 22], [25, 30], [33, 45]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupFlagsmith", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k;
      return p().wrap(function(b) {
        for (; ; )
          switch (b.prev = b.next) {
            case 0:
              return a = n.getAllValues(), i = a.peerId, s = a.baseURI, u = a.overrides, c = a.meetingId, d = a.organizationId, h = a.logger, v = _P(c), f = $($({ entity: Pd.PEER, clientId: d, isAnonUser: !d, sdkVersion: n.getValue("sdkVersion"), presetName: n.getValue("presetName"), meetingHash: v, roomName: c }, kr.getDeviceInfo()), {}, { isReactNative: navigator.isReactNative }), b.prev = 3, k = !((g = u == null ? void 0 : u.whitelabelled_flags_endpoint) !== null && g !== void 0) || g ? Fs({ servicePrefix: "flags", baseURI: s }) : "edge.api.flagsmith.com", b.next = 7, n.getValue("flagsmith").identify(
                "".concat(Pd.PEER, "_").concat(i),
                JSON.parse(JSON.stringify(f)),
                !1,
                // force evaluate
                5e3,
                // timeout
                k,
                h
              );
            case 7:
              h.info("flagsmith::allFlags", { flags: JSON.stringify(n.getValue("flagsmith").getAllFlags()) }, !0), b.next = 13;
              break;
            case 10:
              b.prev = 10, b.t0 = b.catch(3), h.error("Failed to fetch flagsmith flags");
            case 13:
            case "end":
              return b.stop();
          }
      }, r, null, [[3, 10]]);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupControllers", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n, a, i, s, u, c, d) {
      var h, v, f, g, k, y, b, C, T, E, D, I, _, V, F, N, L, H, Q, B, G, x, Pe, ie, le, Fr, Z, Lr, ln, gt, ae, ee, Ya, Qa;
      return p().wrap(function(Ae) {
        for (; ; )
          switch (Ae.prev = Ae.next) {
            case 0:
              return g = a.getValue("modules"), k = i.participant, y = a.getValue("defaults"), b = a.getValue("logger"), C = c.viewType, T = c.mediaConstraints.audio, a.setValue("viewType", C), a.setValue("defaults", $({ mediaConfiguration: { audio: { enableHighBitrate: (h = T.enableHighBitrate) !== null && h !== void 0 ? h : !1, enableStereo: (v = T.enableStereo) !== null && v !== void 0 ? v : !1 } } }, y)), a.setValue("maxPreferredStreams", kr.isMobile() ? c.maxVideoStreams.mobile : c.maxVideoStreams.desktop), Q = new xO(a, n), B = new MD(n), a.setValue("connectedMeetingsSocketHandler", B), G = new Mc(a, n), x = new wn(a, n), Pe = new iD(n), ie = new $g(a, n), le = new sD(a, n), Fr = new ZO(n), Z = new zs(a, n), Ae.next = 20, Di.init(a, ie, k, d, c);
            case 20:
              return Lr = Ae.sent, a.setValue("selfController", Lr), Ae.next = 24, gg.init(a, Lr.self, ie, Q, u);
            case 24:
              if (ln = Ae.sent, g.participant && (L = new za(a, Lr.self, ie)), (f = g.e2ee) !== null && f !== void 0 && f.enabled && g.e2ee.manager.init(b, a.getValue("peerSessionStore")), !g.chat) {
                Ae.next = 31;
                break;
              }
              return Ae.next = 30, Un.init(a, x, Z, Lr.self, L.participants);
            case 30:
              D = Ae.sent;
            case 31:
              if (!g.internals) {
                Ae.next = 35;
                break;
              }
              return Ae.next = 34, uM.init(a);
            case 34:
              V = Ae.sent;
            case 35:
              if (g.livestream && c.viewType === Dt.Livestream && a.getValue("flagsmith").hasFeature(me.LIVESTREAM) && (N = new Eg(a, Lr.self, Fr)), c.viewType === Dt.Chat) {
                Ae.next = 61;
                break;
              }
              if (!g.poll) {
                Ae.next = 41;
                break;
              }
              return Ae.next = 40, pg.init(a, Lr.self, G);
            case 40:
              E = Ae.sent;
            case 41:
              if (g.recording && (F = new bg(a, Lr.self, ie)), g.stage && (I = new mg(a, Pe, ie, Lr.self, L.participants)), !g.plugin) {
                Ae.next = 52;
                break;
              }
              if (L) {
                Ae.next = 46;
                break;
              }
              throw new U("The plugin module cannot be initialized without the `participant` module", "0102");
            case 46:
              return Ae.next = 48, s;
            case 48:
              return ae = Ae.sent, Ae.next = 51, il.init(a, ae, le, x, (gt = D) === null || gt === void 0 ? void 0 : gt.chat, Lr.self, L.participants, u);
            case 51:
              _ = Ae.sent;
            case 52:
              if (!g.connectedMeetings) {
                Ae.next = 56;
                break;
              }
              return Ae.next = 55, Dc.init(a);
            case 55:
              H = Ae.sent;
            case 56:
              if (!g.pip) {
                Ae.next = 61;
                break;
              }
              return Ae.next = 59, $P._init(a, Lr.self);
            case 59:
              ee = Ae.sent, a.setValue("pip", ee);
            case 61:
              return Ya = new QM(a, le), Qa = { storesManager: Ya, pollController: E, selfController: Lr, metaController: ln, chatController: D, stageController: I, pluginController: _, recordingController: F, internalsController: V, livestreamController: N, participantController: L, connectedMeetingsController: H }, Ae.abrupt("return", { theme: c, permissions: d, controllers: Qa });
            case 64:
            case "end":
              return Ae.stop();
          }
      }, r);
    }));
    function e(r, n, a, i, s, u, c) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "createRoomNodeClient", value: function(e, r) {
    var n = e.getAllValues(), a = n.peerId;
    return Og(e, { socket: r, peerId: a });
  } }, { key: "createSocketService", value: function(e) {
    var r = e.getAllValues(), n = r.peerId, a = r.meetingId, i = r.authToken, s = ["PING"], u = new cl(e, { peerId: n, meetingId: a, authToken: i, capabilities: s });
    return u;
  } }]);
}(), dl = Po;
Lc([O.trace("Controller.init")], dl, "init", 1);
Lc([O.trace("setupFlagsmith")], dl, "setupFlagsmith", 1);
Lc([O.trace("Controller.createRoomNodeClient")], dl, "createRoomNodeClient", 1);
Lc([O.trace("Controller.createSocketService")], dl, "createSocketService", 1);
var UD = /* @__PURE__ */ P(function o() {
  var t = this;
  w(this, o), this.battery = void 0, this.logger = void 0, this.init = /* @__PURE__ */ function() {
    var e = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (t.logger = n, i.prev = 1, !("getBattery" in navigator)) {
                i.next = 10;
                break;
              }
              return i.next = 5, navigator.getBattery();
            case 5:
              t.battery = i.sent, t.battery.addEventListener("chargingchange", t.updateChargeInfo), t.battery.addEventListener("levelchange", t.updateLevelInfo), t.updateLevelInfo(), t.updateChargeInfo();
            case 10:
              i.next = 15;
              break;
            case 12:
              i.prev = 12, i.t0 = i.catch(1), n.error("Error getting battery", i.t0);
            case 15:
            case "end":
              return i.stop();
          }
      }, r, null, [[1, 12]]);
    }));
    return function(r) {
      return e.apply(this, arguments);
    };
  }(), this.updateChargeInfo = function() {
    var e;
    t.logger.log("Battery charging? ".concat((e = t.battery) !== null && e !== void 0 && e.charging ? "Yes" : "No"));
  }, this.updateLevelInfo = function() {
    if (!t.battery) {
      t.logger.log("Battery level: Not known");
      return;
    }
    t.logger.log("Battery level: ".concat(t.battery.level * 100, "%"));
  }, this.cleanup = function() {
    if ("getBattery" in navigator) {
      var e, r;
      (e = t.battery) === null || e === void 0 || e.removeEventListener("chargingchange", t.updateChargeInfo), (r = t.battery) === null || r === void 0 || r.removeEventListener("levelchange", t.updateLevelInfo);
    }
  };
}), Av = new UD();
function jD(o, t) {
  o.startsWith("eyJ") || console.error("Invalid auth token provided. Ensure you are passing a %cparticipant `authToken`%c  not an Org API Key or an incorrectly formatted token.\nYou get the participant token from the Add Participant API: https://docs.realtime.cloudflare.com/api#/operations/add_participant", "font-weight: bold", "font-weight: normal");
  try {
    var e = JSON.parse(atob(o.split(".")[1])), r = e.meetingId, n = e.orgId, a = e.participantId;
    if (!r)
      throw Error("Received V1 auth token ".concat(o));
    var i = $s.baseURI.prod;
    t && (i = t);
    var s = "https://".concat(Fs({ servicePrefix: "api", baseURI: i }));
    return { meetingId: r, orgId: n, participantId: a, baseURI: i, apiBase: s };
  } catch (u) {
    throw new U("Invalid auth token", "0004");
  }
}
var _n = /* @__PURE__ */ S("audioEl"), Ra = /* @__PURE__ */ S("stream"), Aa = /* @__PURE__ */ S("tracks"), Gu = /* @__PURE__ */ S("onError"), vd = /* @__PURE__ */ S("runErrorCallbacks"), FD = /* @__PURE__ */ function() {
  function o() {
    w(this, o), Object.defineProperty(this, vd, { value: HD }), Object.defineProperty(this, _n, { writable: !0, value: new Audio() }), Object.defineProperty(this, Ra, { writable: !0, value: new MediaStream() }), Object.defineProperty(this, Aa, { writable: !0, value: /* @__PURE__ */ new Map() }), Object.defineProperty(this, Gu, { writable: !0, value: void 0 }), l(this, _n)[_n].srcObject = l(this, Ra)[Ra], l(this, _n)[_n].autoplay = !0;
  }
  return P(o, [{ key: "playTracks", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a = this;
      return p().wrap(function(s) {
        for (; ; )
          switch (s.prev = s.next) {
            case 0:
              return n.forEach(function(u) {
                l(a, Aa)[Aa].has(u.id) || (l(a, Ra)[Ra].addTrack(u), l(a, Aa)[Aa].set(u.id, u));
              }), s.abrupt("return", this.play());
            case 2:
            case "end":
              return s.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setSpeakerDevice", value: function(e) {
    typeof HTMLAudioElement.prototype.setSinkId == "function" && l(this, _n)[_n].setSinkId(e);
  } }, { key: "removeTrack", value: function(e) {
    var r = l(this, Aa)[Aa].get(e);
    r && (l(this, Ra)[Ra].removeTrack(r), l(this, Aa)[Aa].delete(e));
  } }, { key: "play", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n = this;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return l(this, _n)[_n].srcObject = l(this, Ra)[Ra], i.abrupt("return", l(this, _n)[_n].play().catch(function(s) {
                l(n, vd)[vd](s);
              }));
            case 2:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "onError", value: function(e) {
    l(this, Gu)[Gu] = e;
  } }]);
}();
function HD(o) {
  var t, e;
  (t = (e = l(this, Gu))[Gu]) === null || t === void 0 || t.call(e, o);
}
var Ia = /* @__PURE__ */ S("trackMap"), BD = /* @__PURE__ */ function(o) {
  function t() {
    var e;
    return w(this, t), e = R(this, t), Object.defineProperty(e, Ia, { writable: !0, value: void 0 }), l(e, Ia)[Ia] = /* @__PURE__ */ new Map(), e;
  }
  return A(t, o), P(t, [{ key: "addParticipantTrack", value: function(r, n) {
    l(this, Ia)[Ia].set(r, n.id), this.playTracks([n]);
  } }, { key: "removeParticipantTrack", value: function(r) {
    var n = l(this, Ia)[Ia].get(r);
    n && this.removeTrack(n), l(this, Ia)[Ia].delete(r);
  } }]);
}(FD), qD = Object.defineProperty, GD = Object.getOwnPropertyDescriptor, $c = function(t, e, r, n) {
  for (var a = n > 1 ? void 0 : n ? GD(e, r) : e, i = t.length - 1, s; i >= 0; i--)
    (s = t[i]) && (a = (n ? s(e, r, a) : s(a)) || a);
  return n && a && qD(e, r, a), a;
}, _i = (Ue = /* @__PURE__ */ S("controller"), sa = /* @__PURE__ */ S("context"), /* @__PURE__ */ function() {
  function o(t, e) {
    w(this, o), Object.defineProperty(this, Ue, { writable: !0, value: void 0 }), Object.defineProperty(this, sa, { writable: !0, value: void 0 }), l(this, sa)[sa] = t, l(this, Ue)[Ue] = e;
  }
  return P(o, [{ key: "peerId", get: function() {
    return l(this, sa)[sa].getValue("peerId");
  } }, { key: "join", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      var n;
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              if (n = l(this, Ue)[Ue].selfController, !n.self.roomJoined) {
                i.next = 3;
                break;
              }
              return i.abrupt("return", null);
            case 3:
              return i.abrupt("return", n.joinRoom());
            case 4:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, {
    key: "leave",
    value: function() {
      var t = m(/* @__PURE__ */ p().mark(function r(n) {
        var a;
        return p().wrap(function(s) {
          for (; ; )
            switch (s.prev = s.next) {
              case 0:
                return Av.cleanup(), l(this, sa)[sa].getValue("peerSessionStore").reset(), a = l(this, Ue)[Ue].selfController, s.abrupt("return", a.leaveRoom(n));
              case 4:
              case "end":
                return s.stop();
            }
        }, r, this);
      }));
      function e(r) {
        return t.apply(this, arguments);
      }
      return e;
    }()
    /**
    * The `participants` object consists of 4 maps of participants,
    * `waitlisted`, `joined`, `active`, `pinned`. The maps are indexed by
    * `peerId`s, and the values are the corresponding participant objects.
    */
  }, {
    key: "participants",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].participantController) === null || e === void 0 ? void 0 : e.participants;
    }
    /**
    * The `self` object can be used to manipulate audio and video settings,
    * and other configurations for the local participant. This exposes methods
    * to enable and disable media tracks, share the user's screen, etc.
    */
  }, {
    key: "self",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].selfController) === null || e === void 0 ? void 0 : e.self;
    }
    /**
    * The `room` object stores information about the current meeting, such
    * as chat messages, polls, room name, etc.
    */
  }, {
    key: "meta",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].metaController) === null || e === void 0 ? void 0 : e.meta;
    }
    /**
    * The `ai` object is used to interface with AI features.
    * You can obtain the live meeting transcript and use other meeting AI
    * features such as summary, and agenda using this object.
    */
  }, {
    key: "ai",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].metaController) === null || e === void 0 ? void 0 : e.ai;
    }
    /**
    * The `plugins` object stores information about the plugins available in
    * the current meeting. It exposes methods to activate and deactivate them.
    */
  }, {
    key: "plugins",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].pluginController) === null || e === void 0 ? void 0 : e.plugins;
    }
    /**
    * The chat object stores the chat messages that were sent in the meeting.
    * This includes text messages, images, and files.
    */
  }, {
    key: "chat",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].chatController) === null || e === void 0 ? void 0 : e.chat;
    }
    /**
    * The polls object stores the polls that were initiated in the meeting.
    * It exposes methods to create and vote on polls.
    */
  }, {
    key: "polls",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].pollController) === null || e === void 0 ? void 0 : e.polls;
    }
    /**
    * The connectedMeetings object stores the connected meetings states.
    * It exposes methods to create/read/update/delete methods for connected meetings.
    */
  }, {
    key: "connectedMeetings",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].connectedMeetingsController) === null || e === void 0 ? void 0 : e.connectedMeetings;
    }
    /*
    * The recording object stores the recording state of the meeting.
    * It exposes methods to start and stop recording.
    */
  }, { key: "recording", get: function() {
    var e;
    return (e = l(this, Ue)[Ue].recordingController) === null || e === void 0 ? void 0 : e.recording;
  } }, { key: "livestream", get: function() {
    var e;
    return (e = l(this, Ue)[Ue].livestreamController) === null || e === void 0 ? void 0 : e.livestream;
  } }, { key: "stage", get: function() {
    var e;
    return (e = l(this, Ue)[Ue].stageController) === null || e === void 0 ? void 0 : e.stage;
  } }, { key: "stores", get: function() {
    return l(this, Ue)[Ue].storesManager;
  } }, {
    key: "audio",
    get: function() {
      return l(this, sa)[sa].getValue("audioPlayback");
    }
    /**
    * The __internals__ object exposes the internal tools & utilities such as features and logger
    * so that client can utilise the same to build their own feature based UI.
    * Logger (__internals__.logger) can be used to send logs to servers
    *	to inform  of issues, if any, proactively.
    */
  }, {
    key: "__internals__",
    get: function() {
      var e;
      return (e = l(this, Ue)[Ue].internalsController) === null || e === void 0 ? void 0 : e.internals;
    }
    /** @deprecated Use `join()` instead */
  }, { key: "joinRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r() {
      return p().wrap(function(a) {
        for (; ; )
          switch (a.prev = a.next) {
            case 0:
              return a.abrupt("return", this.join());
            case 1:
            case "end":
              return a.stop();
          }
      }, r, this);
    }));
    function e() {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "leaveRoom", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      return p().wrap(function(i) {
        for (; ; )
          switch (i.prev = i.next) {
            case 0:
              return i.abrupt("return", this.leave(n));
            case 1:
            case "end":
              return i.stop();
          }
      }, r, this);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }], [{ key: "initMedia", value: function() {
    var e, r = arguments.length > 0 && arguments[0] !== void 0 ? arguments[0] : {}, n = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : !1, a = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : void 0, i = (e = a == null ? void 0 : a.peerId) !== null && e !== void 0 ? e : Js(), s = Ha.createContext(i, { peerId: i }), u = s.getValue("logger");
    u.init(s);
    var c = new Ag(u);
    return c.init(r, n, s), s.setValue("defaults", { mediaHandler: c }), c;
  } }, { key: "init", value: function() {
    var t = m(/* @__PURE__ */ p().mark(function r(n) {
      var a, i, s, u, c, d, h, v, f, g, k, y, b, C, T, E, D, I, _, V;
      return p().wrap(function(N) {
        for (; ; )
          switch (N.prev = N.next) {
            case 0:
              return kr.init(), v = (a = n.defaults) !== null && a !== void 0 ? a : {}, f = v.mediaHandler, g = (f == null ? void 0 : f.peerId) || ((i = n == null || (s = n.cachedUserDetails) === null || s === void 0 ? void 0 : s.peerId) !== null && i !== void 0 ? i : Js()), k = n.authToken, y = n.baseURI, b = jD(k, y), C = b.meetingId, T = lc(b, rm), window.__zone_symbol__DISABLE_WRAPPING_UNCAUGHT_PROMISE_REJECTION = !0, E = _i.setupContext(g, n, C, T), D = E.getValue("telemetry"), I = E.getValue("logger"), bm(I), Av.init(I), D.init(E, { roomName: C, userId: T.participantId, organizationId: T.orgId, peerId: g }, (u = (c = n.modules) === null || c === void 0 ? void 0 : c.tracing) !== null && u !== void 0 ? u : !0), I.init(E), I.info("Client::init::options", { clientInitOptions: $($({}, n), {}, { authToken: "".concat((d = n.authToken) === null || d === void 0 ? void 0 : d.slice(0, 10), `...
				`).concat((h = n.authToken) === null || h === void 0 ? void 0 : h.slice(-10)) }) }), N.next = 16, dl.init(E);
            case 16:
              return _ = N.sent, V = new _i(E, _), E.setValue("meeting", V), N.abrupt("return", V);
            case 20:
            case "end":
              return N.stop();
          }
      }, r);
    }));
    function e(r) {
      return t.apply(this, arguments);
    }
    return e;
  }() }, { key: "setupContext", value: function(e, r, n, a) {
    var i, s, u = Ha.createContext(e, r), c = $($({}, TP), r == null ? void 0 : r.modules), d = r.defaults || { audio: !0, video: !0 };
    return u.setValue("options", r), u.setValue("peerId", e), u.setValue("modules", c), u.setValue("sdkName", "web-core"), u.setValue("meetingId", n), u.setValue("apiBase", a.apiBase), u.setValue("baseURI", a.baseURI), u.setValue("userId", a.participantId), u.setValue("organizationId", a.orgId), u.setValue("authToken", r.authToken), u.setValue("overrides", (i = r.overrides) !== null && i !== void 0 ? i : {}), u.setValue("env", wP({ baseURI: a.baseURI })), u.setValue("defaults", d), u.setValue("onError", r.onError || function() {
    }), u.setValue("cachedUserDetails", jn(r.cachedUserDetails)), u.setValue("sdkVersion", "VERSION_PLACEHOLDER"), (s = r.modules) !== null && s !== void 0 && s.experimentalAudioPlayback && u.setValue("audioPlayback", new BD()), u;
  } }]);
}());
$c([vt("0002"), Ka.executeWithLock({ methodName: "meeting.join", lockName: "Client.join", timeout: 3e3 })], _i.prototype, "join", 1);
$c([vt("0003")], _i.prototype, "leave", 1);
$c([vt("0001"), Ka.executeWithLock({ methodName: "Client.init", lockName: "Client.init", timeout: 3e3 })], _i, "init", 1);
_i = $c([vt("0000")], _i);
var WD = _i;
export {
  WD as default
};
